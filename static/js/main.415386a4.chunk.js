(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{171:function(e,t,a){e.exports=a.p+"static/media/mylogo.92bbdbd4.png"},27:function(e){e.exports={monthlyTargetPer:5,dailyLossPer:1,totalCapital:1e5,perTradeExposurePer:20,perTradeStopLossPer:1}},307:function(e,t,a){e.exports=a(476)},312:function(e,t,a){},316:function(e,t,a){},476:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(42),o=a.n(l),s=(a(312),a(66)),i=a(143),c=a(265),m=a(45),u={packs:[],pack:[],updatedPack:null},d=Object(i.b)({packs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET PACK LOADED":return Object(m.a)({},e,{packs:t.payload});case"EDIT PACK INFO":return Object(m.a)({},e,{updatedPack:t.payload});case"GET_PACK_INFO_BY_ID":return Object(m.a)({},e,{pack:t.payload});default:return e}}}),g=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||i.c,h=Object(i.d)(d,g(Object(i.a)(c.a))),p=(a(316),a(188)),f=a(54),y=a(4),b=a(7),E=a(9),S=a(11),v=a(10),k=a(25),T=a(12),L=a(23),C=a.n(L),w=new(function(){function e(){Object(b.a)(this,e)}return Object(E.a)(e,[{key:"getLoggedInUserInfo",value:function(){localStorage.getItem("UserInfo")}},{key:"getHeader",value:function(){var e=localStorage.getItem("userTokens")&&JSON.parse(localStorage.getItem("userTokens"));return{headers:{Authorization:"Bearer "+(e&&e.jwtToken),"Content-Type":"application/json",Accept:"application/json","X-UserType":"USER","X-SourceID":"WEB","X-ClientLocalIP":"192.168.1.128","X-ClientPublicIP":"91.0.4472.114","X-MACAddress":"f0:18:98:26:c4:cc","X-PrivateKey":"I4O6PJAn"}}}},{key:"loginHeader",value:function(){return{headers:{"Content-Type":"application/json",Accept:"application/json","X-UserType":"USER","X-SourceID":"WEB","X-ClientLocalIP":"192.168.1.128","X-ClientPublicIP":"91.0.4472.114","X-MACAddress":"f0:18:98:26:c4:cc","X-PrivateKey":"I4O6PJAn"}}}},{key:"getImageHeader",value:function(){return{headers:{token:localStorage.getItem("token")}}}},{key:"getScannerHeader",value:function(){return{headers:{"Content-Type":"application/json",Accept:"application/json"}}}},{key:"getNSESessionHeader",value:function(e){return{headers:{sessionId:e,Accept:"application/json"}}}}]),e}()),x=new(function(){function e(){Object(b.a)(this,e)}return Object(E.a)(e,[{key:"login",value:function(e){return C.a.post("https://apiconnect.angelbroking.com/rest/auth/angelbroking/user/v1/loginByPassword",e,w.loginHeader())}},{key:"logout",value:function(e){return C.a.post("https://apiconnect.angelbroking.com/rest/secure/angelbroking/user/v1/logout",e,w.getHeader())}},{key:"getUserData",value:function(e){return C.a.get("https://apiconnect.angelbroking.com/rest/secure/angelbroking/user/v1/getProfile",w.getHeader())}},{key:"getFunds",value:function(e){return C.a.get("https://apiconnect.angelbroking.com/rest/secure/angelbroking/user/v1/getRMS",w.getHeader())}},{key:"retrieveOrderBook",value:function(e){return C.a.get("https://apiconnect.angelbroking.com/rest/secure/angelbroking/order/v1/getOrderBook",w.getHeader())}},{key:"retrieveTradeBook",value:function(e){return C.a.get("https://apiconnect.angelbroking.com/rest/secure/angelbroking/order/v1/getTradeBook",w.getHeader())}},{key:"retrieveallTradableInstruments",value:function(e){return C.a.get("https://margincalculator.angelbroking.com/OpenAPI_File/files/OpenAPIScripMaster.json","")}},{key:"placeOrder",value:function(e){return C.a.post("https://apiconnect.angelbroking.com/rest/secure/angelbroking/order/v1/placeOrder",e,w.getHeader())}},{key:"modifyOrder",value:function(e){return C.a.post("https://apiconnect.angelbroking.com/rest/secure/angelbroking/order/v1/modifyOrder",e,w.getHeader())}},{key:"cancelOrder",value:function(e){return C.a.post("https://apiconnect.angelbroking.com/rest/secure/angelbroking/order/v1/cancelOrder",e,w.getHeader())}},{key:"getLTP",value:function(e){return C.a.post("https://apiconnect.angelbroking.com/rest/secure/angelbroking/order/v1/getLtpData",e,w.getHeader())}},{key:"getHistoryData",value:function(e){return C.a.post("https://apiconnect.angelbroking.com/rest/secure/angelbroking/historical/v1/getCandleData",e,w.getHeader())}},{key:"scanStocks",value:function(e){return C.a.post("https://chartink.com/screener/process",e,w.getScannerHeader())}},{key:"autoCompleteSearch",value:function(e){return C.a.get("http://localhost:8081/search/"+e,"")}},{key:"stockOptionSearch",value:function(e){return C.a.post("http://localhost:8081/stockOptionSearch/",e,"")}},{key:"getStockOptions",value:function(e){return C.a.post("http://localhost:8081/getStockOptions",e,"")}},{key:"getAllListTokens",value:function(e){return C.a.post("http://localhost:8081/getAllListTokens",e,"")}},{key:"saveWatchList",value:function(e){return C.a.get("http://localhost:8081/saveWatchList/"+e,"")}},{key:"addIntoStaticData",value:function(e){return C.a.post("http://localhost:8081/addIntoStaticData",e,"")}},{key:"saveWatchListJSON",value:function(e){return C.a.post("http://localhost:8081/saveWatchListJSON",e,"")}},{key:"getWatchListJSON",value:function(){return C.a.get("/myJsonWatchList.json","")}},{key:"updateStockList",value:function(){return"vijaykumarsaurav.github.io"==window.location.hostname?C.a.get("/mtrade/stockList.json",""):C.a.get("/stockList.json","")}},{key:"getStaticData",value:function(){return"vijaykumarsaurav.github.io"==window.location.hostname?C.a.get("/mtrade/staticData.json",""):C.a.get("/staticData.json","")}},{key:"saveCandleHistory",value:function(e){return C.a.post("http://localhost:8081/saveCandleHistory",e,"")}},{key:"backupHistoryData",value:function(e){return C.a.post("http://localhost:8081/backupHistoryData",e,"")}},{key:"getAll145Tokens",value:function(e){return C.a.post("http://localhost:8081/getAll145Tokens",e,"")}},{key:"saveDeliveryData",value:function(e){return C.a.post("http://localhost:8081/store_delivery_data",e,"")}},{key:"saveBidData",value:function(e){return C.a.post("http://localhost:8081/store_bid_data",e,"")}},{key:"getDeliveryDataFromDb",value:function(e){return C.a.get("http://localhost:8081/get_delivery_data?symbol="+e,"")}},{key:"getBidDataFromDb",value:function(e,t,a){return C.a.get("http://localhost:8081/get_bid_data?backDate="+e+"&allSymbol="+t+"&count="+a,"")}},{key:"getBackUpdateList",value:function(){return C.a.get("http://localhost:8081/get_backup_date_list","")}},{key:"getPosition",value:function(e){return C.a.get("https://apiconnect.angelbroking.com/rest/secure/angelbroking/order/v1/getPosition",w.getHeader())}},{key:"getAutoScanStock",value:function(){return C.a.get("http://localhost:8081/getScannedStocks","")}},{key:"getNSETopStock",value:function(){return C.a.get("http://localhost:8081/getNseTopStocks","")}},{key:"getChartInkStock",value:function(){return C.a.get("http://localhost:8081/get_chartink_stock","")}},{key:"getSelectedStockFromDb",value:function(){return C.a.get("http://localhost:8081/getSelectedStock","")}},{key:"getIndiceStock",value:function(e){return C.a.get("https://www.nseindia.com/api/equity-stockIndices?index="+e,"")}},{key:"checkOtherApi",value:function(e){return C.a.get("https://www1.nseindia.com/live_market/dynaContent/live_watch/stock_watch/liveIndexWatchData.json","")}},{key:"checkSectorApiOther",value:function(e){return C.a.get("http://localhost:8081/nse/get_index_stocks?symbol="+e,"")}},{key:"getAllIndices",value:function(){return C.a.get("https://www.nseindia.com/api/allIndices")}},{key:"allIndicesDirectJSON",value:function(){return C.a.get("http://localhost:8081/nse/get_indices","")}},{key:"getBNcpdata",value:function(e){return"NIFTY"==e||"BANKNIFTY"==e?C.a.get("http://localhost:8081/nse/getOptionChain?symbol="+e,""):C.a.get("http://localhost:8081/nse/getOptionChainEquity?symbol="+e,"")}},{key:"getDeliveryData",value:function(e){return C.a.get("http://localhost:8081/nse/get_quote_info?companyName="+e,"")}},{key:"checkLiveBids",value:function(e){return C.a.get("http://localhost:8081/nse/get_quote_info?companyName="+e,"")}}]),e}()),I=a(530),D=a(533),O=a(171),P=a.n(O),F=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(I.a,{position:"static"},r.a.createElement(D.a,null,r.a.createElement("img",{alt:"logo",style:{width:"190px"},src:P.a}))))},N=a(543),M=a(578),B=a(542),A=a(536),Y=a(577),H=a(267),j=a.n(H),W=a(581),R=a(144),U=a(534),_=a(535),V=Object(U.a)(function(e){return{"@global":{body:{backgroundColor:e.palette.common.white}},paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:"#df0915"},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}});function J(e){var t=V(),a=function(t){e.loginProps.onChange(t)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{component:"main",maxWidth:"xs"},r.a.createElement(A.a,null),r.a.createElement("div",{className:t.paper},r.a.createElement(W.a,{className:t.avatar},r.a.createElement(j.a,null)),r.a.createElement(R.a,{component:"h1",variant:"h5"},"Sign in"),r.a.createElement("form",{className:t.form,noValidate:!0},r.a.createElement(Y.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,id:"email",label:"User Id",name:"userName",autoComplete:"email",autoFocus:!0,onChange:a,value:e.loginProps.userName}),r.a.createElement(Y.a,{variant:"outlined",margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",onChange:a,value:e.loginProps.password}),r.a.createElement(B.a,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:t.submit,onClick:e.loginProps.login},"Sign In")))))}var q=a(127),z=new(function(){function e(){Object(b.a)(this,e)}return Object(E.a)(e,[{key:"showError",value:function(e){q.b.error(e,this.options())}},{key:"showSuccess",value:function(e){q.b.success(e,this.options())}},{key:"showWarning",value:function(e){q.b.warn(e,this.options())}},{key:"options",value:function(){return{position:q.b.POSITION.BOTTOM_RIGHT,autoClose:2e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!1}}}]),e}());function Q(e,t){var a={};if(200===e.status)return(a=e.data).status?(a.message&&"noPop"!==t&&z.showSuccess(a.message),a):(z.showError(a.message),"Invalid Token"===a.message&&(window.location.replace("#/login"),localStorage.setItem("userTokens",""),localStorage.setItem("userProfile","")),Promise.reject(a.message));e&&!e.status&&z.showError(a.message)}var K=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value.trim()))},a.login=function(e){if(a.setState({isError:""}),e.preventDefault(),a.state.userName||a.state.password)if(a.state.userName)if(a.state.password){a.setState({isDasable:!0});var t={clientcode:a.state.userName,password:a.state.password};x.login(t).then(function(e){Q(e);(e=e&&e.data).status&&"SUCCESS"!==e.message&&a.setState({isError:e.message}),a.setState({isDasable:!1}),e.data&&(window.localStorage.setItem("userTokens",JSON.stringify(e.data)),x.getUserData().then(function(e){Q(e);(e=e&&e.data).status&"SUCCESS"===e.message&&(window.localStorage.setItem("userProfile",JSON.stringify(e.data)),x.getStaticData().then(function(e){var t=e.data;localStorage.setItem("staticData",JSON.stringify(t));var n=Object.keys(t);a.setState({totalWatchlist:n}),localStorage.setItem("totalWatchlist",JSON.stringify(n)),a.setState({staticData:t});var r=[];n.forEach(function(e){t[e].forEach(function(e){r.filter(function(t){return t.token===e.token}).length||r.push(e)})}),localStorage.setItem("watchList",JSON.stringify(r)),window.location.replace("#/strong-charts")}))}))})}else a.setState({isError:"Password is required."});else a.setState({isError:"Olms Id is required."});else a.setState({isError:"Olms Id and Password are required."})},a.state={userName:"V193588",password:"",isDasable:!1,isError:!1},a.login=a.login.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(F,null),r.a.createElement(J,{loginProps:{onChange:this.onChange,login:this.login,userName:this.state.userName,password:this.state.password}}),r.a.createElement(N.a,{container:!0,justify:"space-around"},r.a.createElement(N.a,{justify:"center",container:!0,xs:12,sm:10},this.state.isDasable?r.a.createElement(M.a,{variant:"subtitle1",style:G.waitMessage}," Please wait..."):"",this.state.isError?r.a.createElement(M.a,{variant:"subtitle1",style:G.errorMessage}," ",this.state.isError," "):"")))}},{key:"componentDidMount",value:function(){window.localStorage.getItem("userTokens")&&this.props.history.push("home"),document.location.href.includes("logout")&&(document.location.href="#/login",window.location.reload(!0))}}]),t}(r.a.Component),G={formStyle:{display:"flex",flexFlow:"row wrap"},label:{display:"flex",justifyContent:"center"},errorMessage:{color:"red",marginTop:"11px"},waitMessage:{color:"gray",marginTop:"11px"}},X=K,Z=a(2),$=a.n(Z),ee=a(13),te=a(16),ae=a(19),ne=a(6),re=a(55),le=a(582),oe=a(541),se=a(557),ie=a(478),ce=a(272),me=a.n(ce),ue=a(274),de=a.n(ue),ge=a(275),he=a.n(ge),pe=a(477),fe=a(544),ye=a(545),be=a(269),Ee=a.n(be),Se=a(216),ve=a.n(Se),ke=a(100),Te=a.n(ke),Le=a(40),Ce=a.n(Le),we=a(47),xe=a.n(we),Ie=r.a.createElement("div",null,r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/home"},r.a.createElement(fe.a,null,r.a.createElement(Ce.a,null)),r.a.createElement(ye.a,{primary:"Home"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/position"},r.a.createElement(fe.a,null,r.a.createElement(ve.a,null)),r.a.createElement(ye.a,{primary:"Positions"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/sector-heat-map2"},r.a.createElement(fe.a,null,r.a.createElement(Ce.a,null)),r.a.createElement(ye.a,{primary:"Heat Map2"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/strong-charts"},r.a.createElement(fe.a,null,r.a.createElement(Ce.a,null)),r.a.createElement(ye.a,{primary:"Strong Charts"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/delivery"},r.a.createElement(fe.a,null,r.a.createElement(Ce.a,null)),r.a.createElement(ye.a,{primary:"Delivery"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/slow-motion"},r.a.createElement(fe.a,null,r.a.createElement(Ce.a,null)),r.a.createElement(ye.a,{primary:"Slow Motion"})),r.a.createElement(pe.a,{button:!0,component:"a",target:"_blank",href:"/mtrade/#/find-fast-movement"},r.a.createElement(fe.a,null,r.a.createElement(Ce.a,null)),r.a.createElement(ye.a,{primary:"Fast Movement"})),r.a.createElement(pe.a,{button:!0,component:"a",target:"_blank",href:"/mtrade/#/index-charts"},r.a.createElement(fe.a,null,r.a.createElement(xe.a,null)),r.a.createElement(ye.a,{primary:"Index Charts"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/order-watchlist"},r.a.createElement(fe.a,null,r.a.createElement(ve.a,null)),r.a.createElement(ye.a,{primary:"Order Watchlist"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/funds"},r.a.createElement(fe.a,null,r.a.createElement(Te.a,null)),r.a.createElement(ye.a,{primary:"Funds"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/order"},r.a.createElement(fe.a,null,r.a.createElement(Te.a,null)),r.a.createElement(ye.a,{primary:"Order Book"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/trade"},r.a.createElement(fe.a,null,r.a.createElement(Te.a,null)),r.a.createElement(ye.a,{primary:"Trade Book"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/sector-heat-map"},r.a.createElement(fe.a,null,r.a.createElement(Ce.a,null)),r.a.createElement(ye.a,{primary:"Heat Map"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/market-depth"},r.a.createElement(fe.a,null,r.a.createElement(Ce.a,null)),r.a.createElement(ye.a,{primary:"Depth Live"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/market-depth-mobile"},r.a.createElement(fe.a,null,r.a.createElement(Ce.a,null)),r.a.createElement(ye.a,{primary:"Depth Live Mobile"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/backtest"},r.a.createElement(fe.a,null,r.a.createElement(Te.a,null)),r.a.createElement(ye.a,{primary:"Backtest"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/chartink-backtest"},r.a.createElement(fe.a,null,r.a.createElement(Te.a,null)),r.a.createElement(ye.a,{primary:"Chartink Backtest"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/custom-backtest"},r.a.createElement(fe.a,null,r.a.createElement(Te.a,null)),r.a.createElement(ye.a,{primary:"Custom Backtest"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/track145"},r.a.createElement(fe.a,null,r.a.createElement(Te.a,null)),r.a.createElement(ye.a,{primary:"Track 145"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/backup-history"},r.a.createElement(fe.a,null,r.a.createElement(Te.a,null)),r.a.createElement(ye.a,{primary:"Backup History"})),r.a.createElement(pe.a,{button:!0,component:"a",href:"/mtrade/#/addtowatchlist"},r.a.createElement(fe.a,null,r.a.createElement(Te.a,null)),r.a.createElement(ye.a,{primary:"Watchlist ("+(localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList")).length)+")"})));var De=localStorage.getItem("userProfile");De=De&&JSON.parse(De);var Oe=r.a.createElement("div",null,r.a.createElement(p.b,{to:"",style:{textDecoration:"none"},onClick:function(){var e=localStorage.getItem("userProfile"),t={clientcode:(e=e&&JSON.parse(e))&&e.clientcode};x.logout(t).then(function(e){localStorage.clear(),function(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var a=e[t],n=a.indexOf("="),r=n>-1?a.substr(0,n):a;document.cookie=r+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}}(),window.location.replace("#/login?logout=1")})}},r.a.createElement(pe.a,{button:!0},r.a.createElement(fe.a,{title:"Logout"},r.a.createElement(Ee.a,null)),r.a.createElement(ye.a,{primary:r.a.createElement("span",{title:De&&De.clientcode?De.clientcode:""}," ",De&&De.name?De.name.split(" ")[0]:""," ")})))),Pe=a(119),Fe=a.n(Pe),Ne=a(579),Me=a(547),Be=a(546),Ae=Object(U.a)(function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}}});function Ye(){var e=Ae(),t=r.a.useState(!0),a=Object(ae.a)(t,2),n=a[0],l=a[1];return r.a.createElement("div",{className:e.root},r.a.createElement(Be.a,null,r.a.createElement(Me.a,{control:r.a.createElement(Ne.a,{checked:n,onChange:function(e){localStorage.setItem("invertColorFlag",e.target.checked),l(e.target.checked)},"aria-label":"login switch"}),label:n?"Black & White":"Colorfull"})))}var He=a(24),je=a(14),We=a(551),Re=a(548),Ue=a(549),_e=a(550),Ve=a(65),Je=a.n(Ve),qe=a(552),ze=a(553),Qe=a(554),Ke=a(555),Ge=a(52),Xe=a.n(Ge),Ze=(a(147),a(184));function $e(e){var t=e.candleChartData,a=e.vwapDataChart,n=[],l=[];if(t)for(var o=0;o<t.length;o++)t[o]&&(n.push(t[o][4]),l.push(new Date(t[o][0]).getHours()+":"+new Date(t[o][0]).getMinutes()));var s={labels:l,datasets:[{label:"Close",data:n,fill:!0,borderColor:e.percentChange>0?"green":"red"},{label:"Vwap",data:a,fill:!0,borderColor:"blue"}]};return r.a.createElement("div",{className:"App"},r.a.createElement(Ze.a,{data:s,options:{maintainAspectRatio:!1,legend:{display:!1}}}))}function et(e){var t=r.a.useState(!1),a=Object(ae.a)(t,2);a[0],a[1];return setTimeout(function(){var t=window.LightweightCharts.createChart(document.getElementById("chart"),{width:600,height:300,rightPriceScale:{scaleMargins:{top:.3,bottom:.25},borderVisible:!1},layout:{backgroundColor:"white",textColor:"#d1d4dc"},grid:{vertLines:{color:"rgba(42, 46, 57, 0)"},horzLines:{color:"rgba(42, 46, 57, 0.6)"}}}),a=t.addCandlestickSeries({upColor:"green",downColor:"red",borderDownColor:"red",borderUpColor:"green",wickDownColor:"red",wickUpColor:"green"}),n=e.chartData&&e.chartData.candleSeries;a.setData(n),t.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}}).setData(e.chartData&&e.chartData.volumeSeries),t.subscribeCrosshairMove(function(e){var t=e.seriesPrices[Symbol.iterator](),a="",n="",r=!0,l=!1,o=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var c=s.value;console.log(c),"object"==typeof c[1]?(a+=" O: <b>"+c[1].open+"</b>",a+=" H: <b>"+c[1].high+"</b>",a+=" L: <b>"+c[1].low+"</b>",a+=" C: <b>"+c[1].close+"</b>",a+=" CH: <b>"+(n=100*(c[1].close-c[1].open)/c[1].open).toFixed(2)+"%</b>"):a+="&nbsp;"+c[1].toFixed(2)+" "}}catch(u){l=!0,o=u}finally{try{r||null==i.return||i.return()}finally{if(l)throw o}}e.time&&(a+=" T: <b>"+new Date(e.time).toLocaleString()+"</b>");var m="<span style=color:green>"+a+"</span> ";n<0&&(m="<span style=color:red>"+a+"</span> "),document.getElementById("showChartTitle").innerHTML=m});var r=function(e,t){for(var a=function(e){for(var t=0,a=0;a<e.length;a++)t+=e[a].close;return t/e.length},n=[],r=t-1,l=e.length;r<l;r++){var o=a(e.slice(r-t+1,r));n.push({time:e[r].time,value:o})}return n}(n,20);t.addLineSeries({color:"rgba(4, 111, 232, 1)",lineWidth:2}).setData(r)},100),r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:1,style:{paddingLeft:"5px",paddingRight:"5px"}},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement("div",{id:"showChartTitle",style:{fontSize:"12px"}}," ")),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement("div",{id:"chart"}))))}var tt=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})(function(e){var t=e.children,a=e.classes,n=e.onClose,l=Object(He.a)(e,["children","classes","onClose"]);return r.a.createElement(Re.a,Object.assign({disableTypography:!0,className:a.root},l),r.a.createElement(R.a,{variant:"h6"},t),n?r.a.createElement(ie.a,{"aria-label":"close",className:a.closeButton,onClick:n},r.a.createElement(Je.a,null)):null)}),at=Object(je.a)(function(e){return{root:{padding:e.spacing(2)}}})(Ue.a),nt=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(1)}}})(_e.a);function rt(e){var t=r.a.useState(!1),a=Object(ae.a)(t,2),n=a[0],l=a[1],o=r.a.useState({data:[],candledata:{}}),s=Object(ae.a)(o,2),i=(s[0],s[1],function(){l(!1)});return r.a.createElement("div",null,r.a.createElement(B.a,{variant:"outlined",id:"showCandleChart",color:"primary",style:{display:"none"},onClick:function(){l(!0)}},"Chart"),r.a.createElement(We.a,{onClose:i,"aria-labelledby":"customized-dialog-title",open:n},r.a.createElement(tt,{id:"customized-dialog-title",onClose:i},localStorage.getItem("cadleChartSymbol"),"   ",localStorage.getItem("candlePriceShow"),"  (",localStorage.getItem("candleChangeShow"),"%)",r.a.createElement("br",null),localStorage.getItem("chartInfoDetails")?r.a.createElement("span",{style:{fontSize:"12px"}},r.a.createElement("b",null,"FoundAt:"),"  ",localStorage.getItem("chartInfoDetails")&&JSON.parse(localStorage.getItem("chartInfoDetails")).foundAt.substr(0,16)," \xa0\xa0",r.a.createElement("b",null,"Buy: "),localStorage.getItem("chartInfoDetails")&&JSON.parse(localStorage.getItem("chartInfoDetails")).buyExitPrice," \xa0\xa0",r.a.createElement("b",null,"Sell: "),localStorage.getItem("chartInfoDetails")&&JSON.parse(localStorage.getItem("chartInfoDetails")).sellEntyPrice," \xa0\xa0",r.a.createElement("b",null,"Change %: "),"  ",localStorage.getItem("chartInfoDetails")&&JSON.parse(localStorage.getItem("chartInfoDetails")).perChange," \xa0\xa0    ",r.a.createElement("br",null),r.a.createElement("b",null,"Change on High/Low %: "),localStorage.getItem("chartInfoDetails")&&JSON.parse(localStorage.getItem("chartInfoDetails")).perChange," \xa0\xa0",r.a.createElement("b",null,"SquareOffAt:"),localStorage.getItem("chartInfoDetails")&&JSON.parse(localStorage.getItem("chartInfoDetails")).squareOffAt):""),r.a.createElement(at,{dividers:!0,id:"chart"},localStorage.getItem("candleChartData")?r.a.createElement(Xe.a,{options:{chart:{type:"candlestick",height:350},title:{text:"",align:"left"},xaxis:{type:"datetime"},yaxis:{tooltip:{enabled:!0}}},series:[{data:localStorage.getItem("candleChartData")&&JSON.parse(localStorage.getItem("candleChartData"))}],type:"candlestick",width:500,height:350}):"",localStorage.getItem("candleChartDataInside")?r.a.createElement(Xe.a,{options:{chart:{type:"candlestick",height:350},title:{text:"",align:"left"},xaxis:{type:"datetime"},yaxis:{tooltip:{enabled:!0}}},series:[{data:localStorage.getItem("candleChartDataInside")&&JSON.parse(localStorage.getItem("candleChartDataInside"))}],type:"candlestick",width:500,height:350}):""),r.a.createElement(nt,null,r.a.createElement(B.a,{autoFocus:!0,onClick:i,color:"primary"},"Close"))))}Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})(function(e){var t=e.children,a=e.classes,n=e.onClose,l=Object(He.a)(e,["children","classes","onClose"]);return r.a.createElement(Re.a,Object.assign({disableTypography:!0,className:a.root},l),r.a.createElement(R.a,{variant:"h6"},t),n?r.a.createElement(ie.a,{"aria-label":"close",className:a.closeButton,onClick:n},r.a.createElement(Je.a,null)):null)}),Object(je.a)(function(e){return{root:{padding:e.spacing(2)}}})(Ue.a),Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(1)}}})(_e.a);var lt=a(27),ot=a(1),st=a(573),it=a(574),ct=a(30),mt=a.n(ct),ut=(a(443),new function e(){var t=this;Object(b.a)(this,e),this.speckIt=function(e){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)},this.getMinPriceAllowTick=function(e){e=e.toFixed(2);var t=parseInt(e.split(".")[0]),a=parseFloat(e.split(".")[1]);return e=parseFloat(t+"."+(a-a%5))},this.placeSLMOrder=function(e){var a={triggerprice:e.stopLossPrice,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,quantity:e.quantity,transactiontype:"BUY"===e.transactiontype?"SELL":"BUY",exchange:"NSE",producttype:e.producttype,duration:"DAY",price:0,squareoff:"0",stoploss:"0",ordertype:"STOPLOSS_MARKET",variety:"STOPLOSS"};console.log("SLM option data",a),x.placeOrder(a).then(function(a){var n=Q(a);n.status&&"SUCCESS"===n.message&&(t.speckIt("hey Vijay, "+e.tradingsymbol+" buy order placed"),document.getElementById("orderRefresh")&&document.getElementById("orderRefresh").click())})},this.getStockTokenDetails=function(e){var t="";if("BANKNIFTY"===e||"NIFTY"===e){var a=(localStorage.getItem("staticData")?JSON.parse(localStorage.getItem("staticData")).NSE_OPTION_INDEX:[]).filter(function(t){return"NSE"===t.exch_seg&&t.symbol===e.toUpperCase()});a.length&&(t=a[0])}else{var n=localStorage.getItem("staticData")?JSON.parse(localStorage.getItem("staticData")).CashStocks:[],r=e.toUpperCase()+"-EQ",l=n.filter(function(e){return"NSE"===e.exch_seg&&e.symbol===r});l.length&&(t=l[0])}return t},this.updateOrderList=function(){x.retrieveOrderBook().then(function(e){var t=Q(e,"noPop");if(t&&t.data){var a=t.data;a.sort(function(e,t){return new Date(t.updatetime)-new Date(e.updatetime)}),localStorage.setItem("oderbookData",JSON.stringify(a))}})},this.getPercentageColor=function(e){return"rgb("+((e*=100)<50?255:Math.floor(255-255*(2*e-100)/100))+","+(e>50?255:Math.floor(2*e*255/100))+",0)"},this.historyWiseOrderPlace=function(e,a,n,r){var l=e.token,o=e.symbol,s={exchange:"NSE",tradingsymbol:o,symboltoken:l};x.getLTP(s).then(function(n){var s=Q(n,"noPop"),i=s&&s.data;console.log(o," ltd data ",i);var c=0;if(i&&i.ltp){var m=lt.totalCapital*lt.perTradeExposurePer/100;c=Math.floor(m/i.ltp)}if(c>0&&e.qtyToTake&&(c=e.qtyToTake),console.log(o,"  quantity can be order ",e,c),c){var u="YYYY-MM-DD HH:mm",d=ot("9:15am","h:mma").format(u);console.log("beginningTime",d);var g=ot.duration("75:10:00"),h=ot(new Date).subtract(g),p={exchange:"NSE",symboltoken:l,interval:"FIVE_MINUTE",fromdate:ot(h).format(u),todate:ot(new Date).format(u)};x.getHistoryData(p).then(function(n){var s=Q(n,"noPop");if(s&&s.data&&s.data.length){var m=s.data,u=0,d=0,g=0,h=0,p=0;if(m.reverse(),h=m[0][3],g=m[0][2],m&&m.length>0){for(var f=0;f<20;f++)m[f]&&(u+=m[f][4],d+=m[f][3],p+=m[f][2],m[f][2]>g&&(console.log(f,g,m[f][2]),g=m[f][2]),m[f][3]<=h&&(h=m[f][3]));var y=[],b=[],E=[],S=[],v=[],k=[],T=[],L=[];s.data.forEach(function(e,t){y.push([e[0],e[1],e[2],e[3],e[4]]),b.push([e[5],(e[2]+e[3]+e[4])/3]),E.push(e[4]),S.push(e[2]),v.push(e[3]),k.push(e[3]),T.push(e[5]),L.push((e[2]+e[3]+e[4])/3)});var C={values:E,period:14},w=st.a.calculate(C);console.log(o,"lastRsiValue",w[w.length-1]);var x={period:20,values:L,stdDev:2},I=it.a.calculate(x);console.log(o,"BB",x,I,I[I.length-1]),console.log(o,"VWAP",b,mt()(b)),I[I.length-1];var D=m.length>20?20:m.length,O=u/D,P=d/D,F=p/D,N=0,M=0;"BUY"==a&&w[w.length-1]>60&&(N=P-3*(g-h)/100,N=t.getMinPriceAllowTick(N),M=100*(i.ltp-N)/i.ltp,console.log(o,"My stoploss",a," LTP ",i.ltp),console.log(o+"highestHigh:",g,"lowestLow",h,"stoploss after tick:",N,"stoploss%",M),console.log(o+"  close avg middle ",O,"lowerest avg",P,"bbhigerValue",F)),"SELL"==a&&w[w.length-1]<40&&(N=F+3*(g-h)/100,M=100*((N=t.getMinPriceAllowTick(N))-i.ltp)/i.ltp,console.log(o,a," LTP ",i.ltp),console.log(o+"highestHigh:",g,"lowestLow",h,"stoploss after tick:",N,"stoploss%",M),console.log(o+"  close avg middle ",O,"lowerest avg",P,"bbhigerValue",F));var B={transactiontype:a,tradingsymbol:o,symboltoken:l,buyPrice:0,quantity:c,stopLossPrice:N,producttype:e.producttype};c?t.placeOrderMethod(B,r):(z.showError(o+" stoploss is > 1.5% Rejected"),console.log(o+" its not fullfilled"))}}else z.showError(o+" candle data emply"),console.log(o+" candle data emply"),r({transactiontype:a,tradingsymbol:o,symboltoken:l,status:!1})})}else z.showError(c+"  quantity |  "+o+" "+a+" Rejected")}).catch(function(e){})},this.getMinPriceAllowTick=function(e){e=e.toFixed(2);var t=parseInt(e.split(".")[0]),a=parseFloat(e.split(".")[1]);return e=parseFloat(t+"."+(a-a%5))},this.placeOptionOrder=function(e){var t={transactiontype:e.transactiontype,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,quantity:e.quantity,ordertype:0===e.buyPrice?"MARKET":"LIMIT",price:e.buyPrice,producttype:e.producttype?e.producttype:"INTRADAY",duration:"DAY",squareoff:"0",stoploss:"0",exchange:e.exchange?e.exchange:"NSE",variety:"NORMAL"};console.log("place order option",t),x.placeOrder(t).then(function(e){Q(e)})},this.placeOptionSLMOrder=function(e){var a={triggerprice:e.stopLossTriggerPrice,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,quantity:e.netqty,transactiontype:"SELL",exchange:e.exchange,producttype:e.producttype,duration:"DAY",price:e.stopLossPrice,squareoff:"0",stoploss:"0",ordertype:"STOPLOSS_MARKET",variety:"STOPLOSS"};console.log("SLM option data",a),x.placeOrder(a).then(function(a){var n=Q(a);n.status&&"SUCCESS"===n.message&&(t.speckIt("hey Vijay, "+e.tradingsymbol+" stop loss order placed"),document.getElementById("orderRefresh")&&document.getElementById("orderRefresh").click(),t.updateOrderList())})},this.placeOrderMethod=function(e,t){var a={transactiontype:e.transactiontype,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,quantity:e.quantity,ordertype:0===e.buyPrice?"MARKET":"LIMIT",price:e.buyPrice,producttype:e.producttype,duration:"DAY",squareoff:"0",stoploss:"0",exchange:"NSE",variety:"NORMAL"};console.log("place order option",a),x.placeOrder(a).then(function(e){Q(e)})},this.placeSLMOrder=function(e){var a={triggerprice:e.stopLossPrice,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,quantity:e.quantity,transactiontype:"BUY"===e.transactiontype?"SELL":"BUY",exchange:"NSE",producttype:e.producttype,duration:"DAY",price:0,squareoff:"0",stoploss:"0",ordertype:"STOPLOSS_MARKET",variety:"STOPLOSS"};console.log("SLM option data",a),x.placeOrder(a).then(function(a){var n=Q(a);n.status&&"SUCCESS"===n.message&&(t.speckIt("hey Vijay, "+e.tradingsymbol+" stop loss order placed"),document.getElementById("orderRefresh")&&document.getElementById("orderRefresh").click(),t.updateOrderList())})}}),dt=a(20),gt=a.n(dt),ht=a(571),pt=a(539),ft=a(570),yt=a(556),bt=Object(U.a)(function(e){return{root:{display:"flex"},endMenu:{display:"flex",flexDirection:"row reverse"},appBar:{transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:"calc(100% - ".concat(240,"px)"),marginLeft:240,transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},menuButton:{marginRight:e.spacing(2)},hide:{display:"none"},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},drawerHeader:Object(m.a)({display:"flex",alignItems:"center",padding:"0 8px"},e.mixins.toolbar,{justifyContent:"flex-end"}),content:{flexGrow:1,padding:e.spacing(3),transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:-240},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginLeft:0}}});function Et(e){var t=r.a.useState({buyFlag:!0,sellFlag:!0,searchSymbol:"",producttype:"INTRADAY"}),a=Object(ae.a)(t,2),n=a[0],l=a[1],o=localStorage.getItem("staticData")?JSON.parse(localStorage.getItem("staticData")).CashStocks:[],s=bt(),i=Object(re.a)(),c=r.a.useState(!1),u=Object(ae.a)(c,2),d=u[0],g=u[1];function h(e){l(Object(m.a)({},n,Object(y.a)({},"buyFlag",e.status))),l(Object(m.a)({},n,Object(y.a)({},"sellFlag",e.status))),l(Object(m.a)({},n,Object(y.a)({},"searchSymbol","")))}function p(e){if(n.token&&n.searchSymbol){if("BUY"==e){l(Object(m.a)({},n,Object(y.a)({},"buyFlag",!1)));var t={token:n.token,symbol:n.searchSymbol,qtyToTake:n.qtyToTake,producttype:n.producttype};ut.historyWiseOrderPlace(t,"BUY","no",h)}if("SELL"==e){l(Object(m.a)({},n,Object(y.a)({},"sellFlag",!1)));t={token:n.token,symbol:n.searchSymbol,qtyToTake:n.qtyToTake,producttype:n.producttype};ut.historyWiseOrderPlace(t,"SELL","no",h)}}else z.showError("Type Symbol!!!")}return r.a.createElement("div",{className:s.root},r.a.createElement(A.a,null),r.a.createElement(I.a,{position:"fixed",className:Object(ne.a)(s.appBar,Object(y.a)({},s.appBarShift,d))},r.a.createElement(D.a,null,r.a.createElement(ie.a,{"aria-label":"open drawer",onClick:function(){g(!0)},edge:"start",className:Object(ne.a)(s.menuButton,d&&s.hide)},r.a.createElement(me.a,null)),r.a.createElement(N.a,{justify:"space-between",container:!0},r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{href:"/mtrade/#/home"},r.a.createElement("img",{alt:"logo",style:{width:"125px"},src:P.a}))),r.a.createElement(ht.a,{xsDown:!0},r.a.createElement(N.a,{item:!0},r.a.createElement(N.a,{justify:"space-between",container:!0,spacing:2},r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"Search Symbol",name:"searchSymbol",value:n.searchSymbol,onChange:function(e){l(Object(m.a)({},n,Object(y.a)({},"searchSymbol",e.target.value)));var t,a=e.target.value.toUpperCase()+"-EQ",r=o.filter(function(e){return"NSE"===e.exch_seg&&"1"===e.lotsize&&e.symbol===a});r.length&&l(Object(m.a)({},n,(t={},Object(y.a)(t,"searchSymbol",r[0].symbol),Object(y.a)(t,"token",r[0].token),t)))}})),r.a.createElement(N.a,{item:!0},r.a.createElement(pt.a,Object(y.a)({style:St.selectStyle},"style",{marginTop:"3px"}),r.a.createElement(M.a,{htmlFor:"gender"},"Order Type"),r.a.createElement(ft.a,{value:n.producttype,name:"producttype",onChange:function(e){l(Object(m.a)({},n,Object(y.a)({},"producttype",e.target.value))),console.log(e.target.value)}},r.a.createElement(yt.a,{value:"INTRADAY"},"Interaday"),r.a.createElement(yt.a,{value:"DELIVERY"},"Delivery")))),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"Qty",style:{width:"50px"},type:"number",name:"qtyToTake",value:n.qtyToTake,onChange:function(e){l(Object(m.a)({},n,Object(y.a)({},"qtyToTake",e.target.value)))}})),r.a.createElement(N.a,{item:!0},n.buyFlag?r.a.createElement(B.a,{variant:"contained",color:"primary",style:{marginLeft:"10px",marginTop:"10px"},onClick:function(){return p("BUY")}},"Buy"):r.a.createElement(gt.a,null)),r.a.createElement(N.a,{item:!0},n.sellFlag?r.a.createElement(B.a,{variant:"contained",color:"secondary",style:{marginLeft:"10px",marginTop:"10px"},onClick:function(){return p("SELL")}},"SELL"):r.a.createElement(gt.a,null))))),r.a.createElement(ht.a,{xsDown:!0,smDown:!0},r.a.createElement(N.a,{item:!0},r.a.createElement(N.a,{container:!0,spacing:1,direction:"row"},r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{variant:"outlined",color:"primary",href:"/mtrade/#/market-depth-mobile"},"Depth")),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{variant:"outlined",target:"_blank",color:"primary",href:"/mtrade/#/strong-charts"},"Charts ",r.a.createElement(Fe.a,null))),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{variant:"outlined",target:"_blank",color:"primary",href:"/mtrade/#/sector-heat-map2"},"Sector ",r.a.createElement(Fe.a,null))),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{variant:"outlined",color:"primary",target:"_blank",href:"/mtrade/#/find-fast-movement2"},"Pattern ",r.a.createElement(Fe.a,null))),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{variant:"contained",autoFocus:!0,href:"/mtrade/#/track145"},"145")),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{variant:"contained",autoFocus:!0,href:"/mtrade/#/order-watchlist",color:"primary"},"Order WL")),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{variant:"contained",autoFocus:!0,href:"/mtrade/#/position-new",color:"primary"},"Position")))))))),r.a.createElement(le.a,{className:s.drawer,variant:"persistent",anchor:"left",open:d,classes:{paper:s.drawerPaper}},r.a.createElement("div",{className:s.drawerHeader},r.a.createElement(oe.a,null,Oe),r.a.createElement(ie.a,{onClick:function(){g(!1)}},"ltr"===i.direction?r.a.createElement(de.a,{style:{color:"gray"}}):r.a.createElement(he.a,{style:{color:"gray"}}))),r.a.createElement(se.a,null),r.a.createElement(oe.a,null,Ie),r.a.createElement(se.a,null),r.a.createElement(Ye,null)),r.a.createElement("main",{className:Object(ne.a)(s.content,Object(y.a)({},s.contentShift,d))},r.a.createElement("div",{className:s.drawerHeader})))}var St={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},vt=a(279),kt=a(276),Tt=a(566);var Lt=function(e){var t=new Date;t.setHours(9,0,0,0),t.setMinutes(15,0,0,0);var a=r.a.useState(t),n=Object(ae.a)(a,2),l=n[0],o=n[1],s=new Date;s.setHours(15,0,0,0),s.setMinutes(30,0,0,0);var i=r.a.useState(s),c=Object(ae.a)(i,2),m=c[0],u=c[1];return r.a.createElement(kt.b,{utils:vt.a},r.a.createElement(N.a,{containers:!0},r.a.createElement(Tt.a,{margin:"normal",style:{width:"140px"},id:"date-picker-dialog",label:"Start Date",format:"dd-MM-yyyy",value:l,onChange:function(t){o(t),e.callbackFromParent.myCallback(t,"START_DATE")},KeyboardButtonProps:{"aria-label":"change date"}}),"\xa0\xa0",r.a.createElement(Tt.a,{style:{width:"140px"},margin:"normal",id:"date-picker-dialog",label:"End Date",format:"dd-MM-yyyy",value:m,onChange:function(t){u(t),e.callbackFromParent.myCallback(t,"END_DATE")},KeyboardButtonProps:{"aria-label":"change date"}})))},Ct=a(281),wt=a(564),xt=a(567),It=a(57),Dt=a(75),Ot=a(76),Pt=a.n(Ot),Ft=a(105),Nt=a(575),Mt=a(558),Bt=a(559),At=a(137),Yt=a.n(At),Ht=Object(U.a)(function(e){return{root:{width:"100%"},heading:{fontSize:e.typography.pxToRem(15),fontWeight:e.typography.fontWeightRegular}}});function jt(e){var t=Ht(),a=e.data;return r.a.createElement("div",{className:t.root},r.a.createElement(Nt.a,{defaultExpanded:!1},r.a.createElement(Mt.a,{expandIcon:r.a.createElement(Yt.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},r.a.createElement(R.a,null," ",a.title," (",a.list.length,")")),r.a.createElement(Bt.a,null,r.a.createElement("div",{style:{overflowY:"scroll",width:"100%",height:"50vh"}},a&&a.list.length?a.list.map(function(e,t){return r.a.createElement(r.a.Fragment,null,e?r.a.createElement(pe.a,{button:!0,style:{fontSize:"12px",padding:"0px",paddingLeft:"5px",paddingRight:"5px"}},r.a.createElement(ye.a,{style:{color:e.nc&&0!=e.nc?e.nc>0?"#20d020":"#e66e6e":"",background:e.highlisht?"#375a00":""},onClick:function(){return a.LoadSymbolDetails(e.symbol)},primary:e.symbol})," ",e.ltp," (",e.nc,"%)"):"")}):""))))}var Wt=Object(U.a)(function(e){return{root:{width:"100%"},heading:{fontSize:e.typography.pxToRem(15),fontWeight:e.typography.fontWeightRegular}}});function Rt(e){var t=Wt(),a=e.data;return r.a.createElement("div",{className:t.root},r.a.createElement(Nt.a,{defaultExpanded:!1},r.a.createElement(Mt.a,{expandIcon:r.a.createElement(Yt.a,null),"aria-controls":"panel1a-content",id:"panel1a-header"},r.a.createElement(R.a,null," ",a.title," (",a.list&&a.list.length,")")),r.a.createElement(Bt.a,null,r.a.createElement("div",{style:{overflowY:"scroll",width:"100%",height:"50vh"}},a&&a.list?a.list.map(function(e,t){return r.a.createElement(r.a.Fragment,null,e?r.a.createElement(pe.a,{button:!0,style:{fontSize:"10px",padding:"0px",paddingLeft:"5px",paddingRight:"5px"}},r.a.createElement(ye.a,{style:{color:e.nc&&0!=e.nc?e.nc>0?"#20d020":"#e66e6e":"",fontSize:"10px"},onClick:function(){return a.LoadSymbolDetails(e.symbol)},primary:e.symbol+" "+e.orderType})," ",r.a.createElement("span",{style:{fontSize:"14px"}},e.ltp," (",e.nc,"%)  ",r.a.createElement("br",null)," At ",e.foundAt," ")):"")}):""))))}Object(U.a)(function(e){return{root:{width:"100%"},heading:{fontSize:e.typography.pxToRem(15),fontWeight:e.typography.fontWeightRegular}}});var Ut=a(568),_t=a(585),Vt=a(584),Jt=a(583);a(94);function qt(e){var t=e.children,a=e.value,r=e.index,l=Object(He.a)(e,["children","value","index"]);return n.createElement("div",Object.assign({role:"tabpanel",hidden:a!==r,id:"simple-tabpanel-".concat(r),"aria-labelledby":"simple-tab-".concat(r)},l),a===r&&n.createElement(Jt.a,{sx:{p:3}},n.createElement(Vt.a,null,t)))}function zt(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}function Qt(e){var t=e.data,a=t.cursor,r=(t.onSelectItem,t.autoSearchList,t.LoadSymbolDetails),l=t.symbolList,o=(t.onChange,t.onChangeWatchlist),s=t.search,i=t.handleKeyDown,c=t.selectedWatchlist,m=t.totalWatchlist,u=n.useState(0),d=Object(ae.a)(u,2),g=d[0],h=d[1],p=n.useState({searchedSymbolList:l}),f=Object(ae.a)(p,2),y=(f[0],f[1],e.data.gainerList?e.data.gainerList:[]),b=e.data.looserList?e.data.looserList:[];return n.createElement(Jt.a,{sx:{width:"100%"}},n.createElement(Jt.a,{sx:{borderBottom:1,borderColor:"divider"}},n.createElement(Ut.a,{value:g,onChange:function(e,t){h(t)},"aria-label":"basic tabs example",style:{overflowY:"scroll"}},n.createElement(_t.a,Object.assign({label:"My WL"},zt(0))),n.createElement(_t.a,Object.assign({label:y&&y.length+" Gainner"},zt(1))),n.createElement(_t.a,Object.assign({label:b&&b.length+" Looser"},zt(2))),n.createElement(_t.a,Object.assign({label:"Fevrate"},zt(3))))),n.createElement(qt,{value:g,index:0},n.createElement("div",{style:{marginLeft:"5px"}},n.createElement(pt.a,{style:{width:"100%"}},n.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),n.createElement(ft.a,{value:c,name:"selectedWatchlist",onChange:o},n.createElement(yt.a,{value:"selectall"},"Select All"),m&&m.map(function(e){return n.createElement(yt.a,{value:e},e)}))),n.createElement(Y.a,{style:{width:"100%"},label:"Filter Symbol",margin:"normal",variant:"standard",name:"search",onKeyDown:i,value:s})),n.createElement("div",{style:{overflowY:"scroll",height:"75vh"}},l&&l.length?l.map(function(e,t){return n.createElement(n.Fragment,null,n.createElement(pe.a,{onKeyDown:i,button:!0,selected:a===t?"active":null,style:{fontSize:"12px",padding:"0px",paddingLeft:"5px",paddingRight:"5px"}},a===t?localStorage.setItem("selectedKeyRow",JSON.stringify(e)):"",n.createElement(B.a,{style:{color:e.nc&&0!=e.nc?e.nc>0?"#20d020":"#e66e6e":""},onClick:function(){return r(e.symbol,t)}},n.createElement("div",{style:{textAlign:"left"}},"  ",e.name," "),"\xa0 \xa0 \xa0",n.createElement("div",{style:{textAlign:"right"}},"  ",e.ltp," (",e.nc,"%)  "))))}):"")),n.createElement(qt,{value:g,index:1},n.createElement("div",{style:{overflowY:"scroll",height:"75vh"}},y&&y.length?y.map(function(e,t){return n.createElement(n.Fragment,null,n.createElement(pe.a,{onKeyDown:i,button:!0,selected:a===t?"active":null,style:{fontSize:"12px",padding:"0px",paddingLeft:"5px",paddingRight:"5px"}},a===t?localStorage.setItem("selectedKeyRow",JSON.stringify(e)):"",n.createElement(B.a,{title:"Found At: "+e.foundAt,style:{color:e.nc&&0!=e.nc?e.nc>0?"#20d020":"#e66e6e":""},onClick:function(){return r(e.name,t)}}," ",e.name," ",e.ltp," (",e.nc,"%) ",e.sector.split(" ")[1]," ")))}):"")),n.createElement(qt,{value:g,index:2},n.createElement("div",{style:{overflowY:"scroll",height:"75vh"}},b&&b.length?b.map(function(e,t){return n.createElement(n.Fragment,null,n.createElement(pe.a,{onKeyDown:i,button:!0,selected:a===t?"active":null,style:{fontSize:"12px",padding:"0px",paddingLeft:"5px",paddingRight:"5px"}},a===t?localStorage.setItem("selectedKeyRow",JSON.stringify(e)):"",n.createElement(B.a,{title:"Found At: "+e.foundAt,style:{color:e.nc&&0!=e.nc?e.nc>0?"#20d020":"#e66e6e":""},onClick:function(){return r(e.name,t)}}," ",e.name," ",e.ltp," (",e.nc,"%) ",e.sector.split(" ")[1]," ")))}):"")),n.createElement(qt,{value:g,index:3},"Fevrate list"))}var Kt=a(139),Gt=a.n(Kt),Xt=C.a.create({baseURL:""}),Zt=function(){return function(){var e=Object(te.a)($.a.mark(function e(t){var a,n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={allPacks:!0,portal:!0},e.next=3,Xt.post("getPrepaidPacks",a);case 3:n=e.sent,t({type:"SET PACK LOADED",payload:n});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()},$t=a(537),ea=a(82);function ta(e){var t=e.diffData&&e.diffData.data,a=[],n=[],l=[],o=[];t.reverse();for(var s=t.length-20;s<t.length;s++)t[s]&&(a.push(t[s].totPEOI),n.push(t[s].totCEOI),o.push(t[s].diff),l.push(t[s].dateTime.substring(19,11)));var i={labels:l,datasets:[{label:"Put",data:a,fill:!0,backgroundColor:"rgba(75,192,192,0.2)",borderColor:"green"},{label:"Call",data:n,fill:!0,backgroundColor:"rgba(75,192,192,0.1)",borderColor:"red"}]};return r.a.createElement("div",null,r.a.createElement(Ze.a,{data:i,options:{maintainAspectRatio:!0}}))}var aa={PaperProps:{style:{maxHeight:224,width:250}}},na=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).onChangeSelectSymbol=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.loadPackList()})},a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.filterOptionChain(e.target.name,e.target.value)})},a.filterOptionChain=function(e,t){var n=[],r=a.state.optionChainDataBN&&a.state.optionChainDataBN.records&&a.state.optionChainDataBN.records.data;if("expiry"===e&&"All"===t&&(n=r),"expiry"===e)for(var l=0;l<r.length;l++){var o=r[l];o.expiryDate===t&&n.push(o)}if("strike"===e)for(var s=0;s<r.length;s++){var i=r[s];i.strikePrice===t&&n.push(i)}a.setState({filtered:n,FilteredBY:e+" "+t})},a.handleScroll=function(e){var t=a.state.scrollcount;a.setState({scrollcount:t+=1})},a.onChangeCallLot=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.calculateCallMargin()})},a.calculateCallMargin=function(e){a.state.filtered&&a.state.filtered.forEach(function(e){e.CE&&e.CE.lastPrice&&(e.CE.totalMargin=Object(ea.a)((e.CE.lastPrice*a.state.buyCallLot*a.state.lotSize).toFixed(2)),e.CE.maxLoss=Object(ea.a)(" SL 10%: <br /><b style='color:red'>"+(e.CE.lastPrice*a.state.buyCallLot*a.state.lotSize*10/100).toFixed(2)+"</b>"))}),a.setState({filtered:a.state.filtered})},a.onChangePutLot=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.calculatePutMargin()})},a.calculatePutMargin=function(e){a.state.filtered&&a.state.filtered.forEach(function(e){e.PE&&e.PE.lastPrice&&(e.PE.totalMargin=Object(ea.a)((e.PE.lastPrice*a.state.buyPutLot*a.state.lotSize).toFixed(2)),e.PE.maxLoss=Object(ea.a)(" SL 10%: <br /><b style='color:red'>"+(e.PE.lastPrice*a.state.buyPutLot*a.state.lotSize*10/100).toFixed(2)+"</b>"))}),a.setState({filtered:a.state.filtered})},a.getDataforStrike=function(e){for(var t=JSON.parse(localStorage.getItem("optionChainDataBN")).records&&JSON.parse(localStorage.getItem("optionChainDataBN")).records.data,a=0,n=0,r=0;r<t.length;r++){var l=t[r];e===l.strikePrice&&(l.CE&&l.CE.openInterest&&(a+=l.CE.openInterest),l.PE&&l.PE.openInterest&&(n+=l.PE.openInterest))}return{strikePrice:e,sumOfCEoi:a,sumOfPEoi:n}},a.findSupportResistence=function(e){var t=e&&e.records&&e.records.data,n=0,r=0,l=0,o=0;if(t)for(var s=0;s<t.length;s++){var i=t[s];i&&i.PE&&(n+=i.PE.openInterest,l+=i.PE.changeinOpenInterest),i&&i.CE&&(r+=i.CE.openInterest,o+=i.CE.changeinOpenInterest)}var c=[],m=a.state.underlyingValue-a.state.showOptionDownside,u=Math.round(m)%100,d=Math.round(m)+100-u,g=a.state.underlyingValue+a.state.showOptionUpside,h=Math.round(g)%100,p=Math.round(g)+100-h;console.log(a.state.underlyingValue,"start from",d,"endto",p);for(var f=d;f<=p;f+=100)c.push(f);c=c.sort(function(e,t){return t-e});var y=[],b=0,E=0;c.forEach(function(e){var t=a.getDataforStrike(e);b+=t.sumOfPEoi,E+=t.sumOfCEoi,y.push(t),console.log(e,t)}),a.setState({AllspTotalOI:y,selectedSPpcr:(b/E).toFixed(3),totalspeoi:b,totalsceoi:E}),a.setState({CEoi:r,PEoi:n,allStrikediff:n-r,CEoiChange:o,PEoiChange:l,allStrikeChngeDiff:l-o})},a.state={products:[],stopnview:"",curnewdata:"",showOptionUpside:800,showOptionDownside:800,timestamp:"",totalCOI:0,expiry:"",strike:"",FilteredBY:"",AllspTotalOI:[],PEoi:0,CEoi:0,waitForChainFlag:!0,scrollcount:0,pcrTableBN:JSON.parse(localStorage.getItem("pcrTableBN"))&&JSON.parse(localStorage.getItem("pcrTableBN")).data,optionChainDataBN:JSON.parse(localStorage.getItem("optionChainDataBN")),filtered:JSON.parse(localStorage.getItem("optionChainDataBN"))&&JSON.parse(localStorage.getItem("optionChainDataBN")).filtered&&JSON.parse(localStorage.getItem("optionChainDataBN")).filtered.data,staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},selectedWatchlist:"Securities in F&O",selectOptionStock:"BANKNIFTY",underlyingValue:JSON.parse(localStorage.getItem("optionChainDataBN"))&&JSON.parse(localStorage.getItem("optionChainDataBN")).records&&JSON.parse(localStorage.getItem("optionChainDataBN")).records.underlyingValue,buyCallLot:1,buyPutLot:1,niftyLogSize:50,niftybankLogSize:25},a.findSupportResistence=a.findSupportResistence.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.setState({SecuritiesInFO:this.state.staticData[this.state.selectedWatchlist]},function(){}),JSON.parse(localStorage.getItem("optionDiffdata"+this.state.selectOptionStock))?this.setState({products:JSON.parse(localStorage.getItem("optionDiffdata"+this.state.selectOptionStock)).data}):localStorage.setItem("optionDiffdata"+this.state.selectOptionStock,JSON.stringify({data:[]})),JSON.parse(localStorage.getItem("pcrTableBN"))?this.setState({pcrTableBN:JSON.parse(localStorage.getItem("pcrTableBN")).data}):localStorage.setItem("pcrTableBN",JSON.stringify({data:[]}));var t=new Date;t.getHours()>=9&&t.getHours()<16&&setInterval(function(){e.loadPackList()},36e4),setInterval(function(){e.updatepcr()},36e4);var a=25;"NIFTY"==this.state.selectOptionStock&&(a=50),"BANKNIFTY"==this.state.selectOptionStock&&(a=25),this.setState({lotSize:a},function(){this.calculateCallMargin(),this.calculatePutMargin()})}},{key:"loadPackList",value:function(){var e=this;this.setState({waitForChainFlag:!1}),x.getBNcpdata(this.state.selectOptionStock).then(function(t){var a=t.data&&t.data;if(localStorage.setItem("optionChainDataBN",JSON.stringify(a)),e.setState({filtered:a.filtered&&a.filtered.data,optionChainDataBN:a}),a.filtered){var n=a.filtered.PE.totOI-a.filtered.CE.totOI,r={dateTime:e.dateFormat(new Date),totCEOI:a.filtered.CE.totOI,totCEVol:a.filtered.CE.totVol,totPEOI:a.filtered.PE.totOI,totPEVol:a.filtered.PE.totVol,diff:n,totChangeINOICall:parseInt(localStorage.getItem("totCEOIChange")),totChangeINOIPut:parseInt(localStorage.getItem("totPEOIChange")),totChangeINOIDiff:parseInt(localStorage.getItem("totPEOIChange"))-parseInt(localStorage.getItem("totCEOIChange"))};if(e.setState({curnewdata:r}),document.getElementById("title").innerHTML=(n/1e5).toFixed(2)+"|"+((localStorage.getItem("totPEOIChange")-localStorage.getItem("totCEOIChange"))/1e5).toFixed(2)+"L "+e.state.selectOptionStock,JSON.parse(localStorage.getItem("optionDiffdata"+e.state.selectOptionStock))){var l=JSON.parse(localStorage.getItem("optionDiffdata"+e.state.selectOptionStock)),o=l&&l.data[0];o?(r.isDuplicate=r.diff===o.diff,r.totCEOIChange=(100*(r.totCEOI-o.totCEOI)/o.totCEOI).toFixed(3),r.totPEOIChange=(100*(r.totPEOI-o.totPEOI)/o.totPEOI).toFixed(3),r.totDiffChange=(100*(r.diff-o.diff)/o.diff).toFixed(3)):(r.isDuplicate=!1,r.totCEOIChange=0,r.totPEOIChange=0,r.totDiffChange=0),a.records&&(l.timestamp=a.records.timestamp,l.underlyingValue=a.records.underlyingValue),localStorage.setItem("optionDiffdata"+e.state.selectOptionStock,JSON.stringify(l)),e.setState({products:l.data,underlyingValue:a.records.underlyingValue,timestamp:a.records.timestamp}),e.setState({waitForChainFlag:!0})}}e.updatepcr(),e.setState({pcrTableBN:JSON.parse(localStorage.getItem("pcrTableBN"))&&JSON.parse(localStorage.getItem("pcrTableBN")).data})})}},{key:"updatepcr",value:function(){var e={allPCR:(this.state.PEoi/this.state.CEoi).toFixed(3),expiryPCR:localStorage.getItem("thisWeekPCR"),selectedSPpcr:this.state.selectedSPpcr};if(JSON.parse(localStorage.getItem("pcrTableBN"))){var t=JSON.parse(localStorage.getItem("pcrTableBN"));t.data.unshift(e),localStorage.setItem("pcrTableBN",JSON.stringify(t))}console.log(e),this.setState({pcrTableBN:t})}},{key:"dateFormat",value:function(e){return ot(e).format("DD-MM-YYYY h:mm:ss A")}},{key:"render",value:function(){var e=this,t=0,a=0,n=0,l=0;return r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:1,style:{paddingLeft:"5px",paddingRight:"5px"}},r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement(pt.a,{style:ra.selectStyle},r.a.createElement(M.a,{id:"selectOptionStock"},"Select Symbol"),r.a.createElement(ft.a,{id:"selectOptionStock",name:"selectOptionStock",value:this.state.selectOptionStock,onChange:this.onChangeSelectSymbol,input:r.a.createElement($t.a,null),MenuProps:aa},r.a.createElement(yt.a,{key:"NIFTY",value:"NIFTY"}," ","NIFTY"),r.a.createElement(yt.a,{key:"BANKNIFTY",value:"BANKNIFTY"}," ","BANKNIFTY"),this.state.SecuritiesInFO&&this.state.SecuritiesInFO.length?this.state.SecuritiesInFO.map(function(e,t){return r.a.createElement(yt.a,{key:e.name,value:e.name},e.name)}):""))),r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement(pt.a,{style:ra.selectStyle},r.a.createElement(M.a,{id:"expiry"},"Select Expiry Date"),r.a.createElement(ft.a,{id:"expiry",name:"expiry",value:this.state.expiry,onChange:this.onChange,input:r.a.createElement($t.a,null),MenuProps:aa},r.a.createElement(yt.a,{key:"All",value:"All"},"All"),this.state.optionChainDataBN&&this.state.optionChainDataBN.records&&this.state.optionChainDataBN.records.expiryDates?this.state.optionChainDataBN.records.expiryDates.map(function(e,t){return r.a.createElement(yt.a,{key:e+"key"+t,value:e},e)}):""))),r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement(pt.a,{style:ra.selectStyle},r.a.createElement(M.a,{id:"strike"},"Select Strick Price"),r.a.createElement(ft.a,{labelId:"strike",id:"strike","max-height":"100%",name:"strike",value:this.state.strike,onChange:this.onChange,input:r.a.createElement($t.a,null),MenuProps:aa},this.state.optionChainDataBN&&this.state.optionChainDataBN.records&&this.state.optionChainDataBN.records.strikePrices?this.state.optionChainDataBN.records.strikePrices.map(function(e){return r.a.createElement(yt.a,{key:e,value:e},e)}):""))),r.a.createElement(N.a,{item:!0,xs:2,sm:2},this.state.waitForChainFlag?r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.loadPackList()}},"Refesh"):r.a.createElement(gt.a,null)),r.a.createElement(N.a,{item:!0,xs:6,sm:4},r.a.createElement(R.a,{component:"h3",variant:"h6",color:"primary"},this.state.selectOptionStock," ",this.state.underlyingValue," ",this.state.timestamp))),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{padding:"10px",overflow:"auto"}},r.a.createElement(N.a,Object(y.a)({container:!0,spacing:3,direction:"row",alignItems:"center"},"container",!0),r.a.createElement(N.a,{item:!0,xs:3,sm:3},r.a.createElement("span",null," ",r.a.createElement("b",null,"Total ")),r.a.createElement("span",null," PE OI: ",r.a.createElement("b",null," ",(this.state.PEoi/1e5).toFixed(3),"L")),r.a.createElement("span",null," CE OI: ",r.a.createElement("b",null,(this.state.CEoi/1e5).toFixed(3),"L")),r.a.createElement("span",null," PE-CE: ",this.state.allStrikediff>0?r.a.createElement("b",{style:{color:"green"}},(this.state.allStrikediff/1e5).toFixed(3),"L"):r.a.createElement("b",{style:{color:"red"}},(this.state.allStrikediff/1e5).toFixed(3),"L"))),r.a.createElement(N.a,{item:!0,xs:3,sm:5},r.a.createElement("span",null," ",r.a.createElement("b",null,"Total Chng ")),r.a.createElement("span",null," PE OI: ",r.a.createElement("b",null,(this.state.PEoiChange/1e5).toFixed(3),"L")),r.a.createElement("span",null," CE OI: ",r.a.createElement("b",null,(this.state.CEoiChange/1e5).toFixed(3),"L")),r.a.createElement("span",null," PE-CE: ",this.state.allStrikeChngeDiff>0?r.a.createElement("b",{style:{color:"green"}},(this.state.allStrikeChngeDiff/1e5).toFixed(3),"L"):r.a.createElement("b",{style:{color:"red"}}," ",(this.state.allStrikeChngeDiff/1e5).toFixed(3),"L"))),r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement("span",null,"ALL PCR: ",r.a.createElement("b",null,(this.state.PEoi/this.state.CEoi).toFixed(3)," "))),r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement("span",null,"Expire Week PCR: ",r.a.createElement("b",null,localStorage.getItem("thisWeekPCR")," ")))))),r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:0,style:{paddingLeft:"5px",paddingRight:"5px"}},r.a.createElement(N.a,{id:"tabledatachart",item:!0,xs:6,sm:6,style:{padding:"2px",overflow:"auto",height:"350px"}},r.a.createElement(qe.a,{id:"tabledata",stickyHeader:!0,"aria-label":"sticky table",size:"small"},r.a.createElement(wt.a,{key:2222,variant:"head",style:{width:"",whiteSpace:"nowrap"}},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Time")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"VIEW")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Put-Call(diff)")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Chng in OI(diff)")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"PUT OI")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Chng Put OI")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Call OI")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Chng Call OI")))),r.a.createElement(Ke.a,{hover:!0,style:{width:"",whiteSpace:"nowrap"}},this.state.products?this.state.products.map(function(e){return r.a.createElement(ze.a,{key:e.dateTime,style:{background:e.isDuplicate?"lightgray":""}},r.a.createElement(Qe.a,{align:"center"},e.dateTime.substring(19,11)),r.a.createElement(Qe.a,{align:"center"},e.diff>0?r.a.createElement(R.a,{variant:"body2",style:{color:"green"}},"BUY"):r.a.createElement(R.a,{variant:"body2",style:{color:"red"}},"SELL")),r.a.createElement(Qe.a,{align:"center"},e.diff," (",(e.diff/1e5).toFixed(2),"L)(",e.totDiffChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},e.totDiffChange,"%"):"0.000"==e.totDiffChange?r.a.createElement("span",null,e.totDiffChange,"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},e.totDiffChange,"%"),") "),r.a.createElement(Qe.a,{align:"center"},e.totChangeINOIDiff," (",(e.totChangeINOIDiff/1e5).toFixed(2),"L)"),r.a.createElement(Qe.a,{align:"center"},e.totPEOI," (",e.totPEOIChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},e.totPEOIChange,"%"):"0.000"==e.totPEOIChange?r.a.createElement("span",null,e.totPEOIChange,"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},e.totPEOIChange,"%"),")"),r.a.createElement(Qe.a,{align:"center"},e.totChangeINOIPut," "),r.a.createElement(Qe.a,{align:"center"},e.totCEOI," (",e.totCEOIChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},e.totCEOIChange,"%"):"0.000"==e.totCEOIChange?r.a.createElement("span",null,e.totCEOIChange,"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},e.totCEOIChange,"%"),")"),r.a.createElement(Qe.a,{align:"center"},e.totChangeINOICall))}):r.a.createElement(gt.a,null)))),r.a.createElement(N.a,{item:!0,xs:6,sm:6,style:{padding:"2px",overflow:"auto"}},r.a.createElement(ta,{diffData:{data:this.state.products,scrollcount:this.state.scrollcount}})),r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{padding:"2px",overflow:"auto",height:"900px"}},r.a.createElement(qe.a,{stickyHeader:!0,"aria-label":"sticky table",id:"tabledata",size:"small"},r.a.createElement(wt.a,{variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{colSpan:6,align:"center"},r.a.createElement("b",null,"CALL")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null)),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null)),r.a.createElement(Qe.a,{colSpan:6,align:"center"},r.a.createElement("b",null,"PUT"))),r.a.createElement(ze.a,{variant:"head",style:{width:"",whiteSpace:"nowrap"}},r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"OI Total OI ",r.a.createElement("br",null),localStorage.getItem("totCEOI"),"(",(localStorage.getItem("totCEOI")/1e5).toFixed(3),"L) ")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Chng in OI ",r.a.createElement("br",null),localStorage.getItem("totCEOIChange"),"(",(localStorage.getItem("totCEOIChange")/1e5).toFixed(3),"L)")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"LTP")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"CHNG")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Lot")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Cost")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Max Loss")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Buy")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("span",{style:{color:"#3e85c5",fontWeight:"bold"}}," STRIKE PRICE")," "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("span",{style:{color:"#3e85c5",fontWeight:"bold"}}," Expiry")," "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Buy")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Max Loss")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Cost")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Lot")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"CHNG")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"LTP")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Chng in OI ",r.a.createElement("br",null),localStorage.getItem("totPEOIChange"),"(",(localStorage.getItem("totPEOIChange")/1e5).toFixed(3),"L)")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"OI ",r.a.createElement("br",null),localStorage.getItem("totPEOI"),"(",(localStorage.getItem("totPEOI")/1e5).toFixed(3),"L)")))),r.a.createElement(Ke.a,null,this.state.filtered?this.state.filtered.map(function(o,s){return r.a.createElement(ze.a,{hover:!0,key:s},o&&o.CE&&o.PE&&o.strikePrice>=o.CE.underlyingValue-e.state.showOptionUpside&&o.strikePrice<=o.CE.underlyingValue+e.state.showOptionDownside?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,Object.assign({},t+=o.CE.openInterest,{style:{backgroundColor:o.strikePrice<o.CE.underlyingValue?"#caca5b":""},align:"center"}),o.CE.openInterest),r.a.createElement(Qe.a,Object.assign({},a+=o.CE.changeinOpenInterest,{style:{backgroundColor:o.strikePrice<o.CE.underlyingValue?"#caca5b":""},align:"center"}),o.CE.changeinOpenInterest),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice<o.CE.underlyingValue?"#caca5b":""},align:"center"},r.a.createElement("span",{style:{color:"#3e85c5",fontWeight:"bold"}}," ",o.CE.lastPrice),"(",o.CE.pChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},o.CE.pChange.toFixed(2),"%"):0==o.CE.pChange?r.a.createElement("span",null,o.CE.pChange.toFixed(2),"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},o.CE.pChange.toFixed(2),"%"),") "),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice<o.CE.underlyingValue?"#caca5b":""},align:"center"},o.CE.change.toFixed(2)," "),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice<o.CE.underlyingValue?"#caca5b":""},align:"center"},r.a.createElement(Y.a,{label:"Lot: "+e.state.lotSize,type:"number",style:{width:"50px",textAlign:"center"},value:e.state.buyCallLot,onChange:e.onChangeCallLot,name:"buyCallLot"})),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice<o.CE.underlyingValue?"#caca5b":""},align:"center"}," ",o.CE.totalMargin," "),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice<o.CE.underlyingValue?"#caca5b":""},align:"center"}," ",o.CE.maxLoss," "),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice<o.CE.underlyingValue?"#caca5b":""},align:"center"},"  ",r.a.createElement(B.a,{size:"small",variant:"contained",onClick:function(){return e.props.buyOption("CE",e.state.selectOptionStock,o.strikePrice,o.expiryDate,e.state.buyCallLot)}}," Call Buy ")," "),r.a.createElement(Qe.a,{style:{borderLeft:"dashed",borderRight:"dashed",fontWeight:"500"},align:"center"},r.a.createElement("span",null," ",r.a.createElement("a",{href:"#",style:{textDecoration:"none"},onClick:function(){return e.filterOptionChain("strike",o.strikePrice)}}," ",o.strikePrice)," ")," "),r.a.createElement(Qe.a,{style:{borderRight:"dashed",whiteSpace:"nowrap"},align:"center"},r.a.createElement("span",{style:{paddingLeft:"5px",paddingRight:"5px"}}," ",r.a.createElement("a",{href:"#",style:{textDecoration:"none"},onClick:function(){return e.filterOptionChain("expiry",o.expiryDate)}}," ",o.expiryDate))," "),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice>o.CE.underlyingValue?"#caca5b":""},align:"center"},"  ",r.a.createElement(B.a,{size:"small",variant:"contained",onClick:function(){return e.props.buyOption("PE",e.state.selectOptionStock,o.strikePrice,o.expiryDate,e.state.buyPutLot)}},"Put Buy ")," "),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice>o.CE.underlyingValue?"#caca5b":""},align:"center"}," ",o.PE.maxLoss," "),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice>o.CE.underlyingValue?"#caca5b":""},align:"center"}," ",o.PE.totalMargin," "),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice>o.CE.underlyingValue?"#caca5b":""},align:"center"},r.a.createElement(Y.a,{label:"Lot: "+e.state.lotSize,type:"number",style:{width:"50px",textAlign:"center"},value:e.state.buyPutLot,onChange:e.onChangePutLot,name:"buyPutLot"})),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice>o.CE.underlyingValue?"#caca5b":""},align:"center"},o.PE.change.toFixed(2)," "),r.a.createElement(Qe.a,{style:{backgroundColor:o.strikePrice>o.CE.underlyingValue?"#caca5b":""},align:"center"},r.a.createElement("span",{style:{color:"#3e85c5",fontWeight:"bold"}}," ",o.PE.lastPrice),"(",o.PE.pChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},o.PE.pChange.toFixed(2),"%"):0==o.PE.pChange?r.a.createElement("span",null,o.PE.pChange.toFixed(2),"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},o.PE.pChange.toFixed(2),"%"),")"),r.a.createElement(Qe.a,Object.assign({},l+=o.PE.changeinOpenInterest,{style:{backgroundColor:o.strikePrice>o.CE.underlyingValue?"#caca5b":""},align:"center"}),o.PE.changeinOpenInterest),r.a.createElement(Qe.a,Object.assign({},n+=o.PE.openInterest,{style:{backgroundColor:o.strikePrice>o.CE.underlyingValue?"#caca5b":""},align:"center"}),o.PE.openInterest," ")):"")}):r.a.createElement(gt.a,null),r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totCEOI",t)),r.a.createElement("b",null,t,r.a.createElement("br",null),"(",(t/1e5).toFixed(3),"L)")),r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totCEOIChange",a)),r.a.createElement("b",null,a,r.a.createElement("br",null),"(",(a/1e5).toFixed(3),"L)")," "),r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totCEVol",0)),r.a.createElement("b",null,0,r.a.createElement("br",null),"(",(0).toFixed(3),"L)")),r.a.createElement(Qe.a,{colSpan:3,align:"center"}),r.a.createElement(Qe.a,Object.assign({},localStorage.setItem("thisWeekPCR",(n/t).toFixed(3)),{align:"center",colSpan:2}),r.a.createElement("b",null," PCR : ",(n/t).toFixed(3))),r.a.createElement(Qe.a,{colSpan:5,align:"center"}),r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totPEVol",0)),r.a.createElement("b",null,0,r.a.createElement("br",null),"(",(0).toFixed(3),"L)")),r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totPEOIChange",l)),r.a.createElement("b",null,l,r.a.createElement("br",null),"(",(l/1e5).toFixed(3),"L)")," "),r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totPEOI",n)),r.a.createElement("b",null,n,r.a.createElement("br",null),"(",(n/1e5).toFixed(3),"L)")," ")))))))}}]),t}(r.a.Component),ra={tableStyle:{display:"flex",justifyContent:"center"},selectStyle:{marginBottom:"0px",minWidth:240,maxWidth:240}},la=Object(s.b)(function(e){return{packs:e.packs.packs.data}},{setPackLoaded:Zt})(na),oa=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).searchSymbolPendingOrder=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value)),x.stockOptionSearch(e.target.value).then(function(t){var n=t.data;if(e.target.value){var r=e.target.value.toUpperCase()+"-EQ",l=n.filter(function(e){return"NSE"===e.exch_seg&&"1"===e.lotsize&&e.symbol===r});l.length&&a.setState({searchSymbolPending:l[0].symbol,searchTokenPending:l[0].token,exch_seg:l[0].exch_seg})}})},a.updateInput=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.addInOrderPenidngList=Object(te.a)($.a.mark(function e(){var t;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(a.state.searchSymbolPending,a.state.searchTokenPending,a.state.buyAtPending,a.state.sellAtPending),!(parseFloat(a.state.sellAtPending)>a.state.lastTradedData.low)){e.next=4;break}if(window.confirm("Be carefull Selling at high price "+a.state.sellAtPending+", today "+a.state.searchSymbolPending+" low is "+a.state.lastTradedData.low)){e.next=4;break}return e.abrupt("return");case 4:if(!(parseFloat(a.state.buyAtPending)<a.state.lastTradedData.high)){e.next=7;break}if(window.confirm("Be carefull Buying at low price "+a.state.buyAtPending+", today "+a.state.searchSymbolPending+" high is "+a.state.lastTradedData.high)){e.next=7;break}return e.abrupt("return");case 7:(a.state.searchSymbolPending&&a.state.buyAtPending||a.state.sellAtPending)&&(t={createdAt:(new Date).toLocaleTimeString(),token:a.state.searchTokenPending,symbol:a.state.searchSymbolPending,buyAt:a.state.buyAtPending,sellAt:a.state.sellAtPending,pattenName:a.state.pattenNamePending,exch_seg:a.state.exch_seg,priceStopLoss:a.state.priceStopLoss,priceTarget:a.state.priceTarget},a.setState({orderPenidngOptionList:[].concat(Object(ee.a)(a.state.orderPenidngOptionList),[t])},function(){this.setState({searchSymbolPending:"",searchTokenPending:"",buyAtPending:"",sellAtPending:"",pattenNamePending:""}),localStorage.setItem("orderPenidngOptionList",JSON.stringify(this.state.orderPenidngOptionList)),localStorage.setItem("orderTagToPosition",JSON.stringify(this.state.orderPenidngOptionList))}));case 8:case"end":return e.stop()}},e)})),a.deleteInOrderPenidngList=function(e){console.log("callback",e);for(var t="",n=localStorage.getItem("orderPenidngOptionList")&&JSON.parse(localStorage.getItem("orderPenidngOptionList")),r=0;r<a.state.orderPenidngOptionList.length;r++){var l=n[r];if(e.symbol==l.symbol){t=n.splice(r,1),localStorage.setItem("orderPenidngOptionList",JSON.stringify(n)),a.setState({orderPenidngOptionList:n});break}}return console.log("del",t),!(!t||t[0].symbol!=e.symbol)},a.callBackUpdate=function(e){console.log("call back called")},a.placeOptionSPLevelOver=function(e,t){var n=ot().isoWeekday(),r=0,l=(localStorage.getItem("optionChainDataBN")&&JSON.parse(localStorage.getItem("optionChainDataBN"))).records.expiryDates[0];e.buyAt?(5==n||1==n?(r=Math.round(t)-Math.round(t)%100+400,"NIFTY"==e.symbol&&(r=Math.round(t)-Math.round(t)%100+200)):2==n?(r=Math.round(t)-Math.round(t)%100+300,"NIFTY"==e.symbol&&(r=Math.round(t)-Math.round(t)%100+150)):3==n?(r=Math.round(t)-Math.round(t)%100+200,"NIFTY"==e.symbol&&(r=Math.round(t)-Math.round(t)%100+100)):r=Math.round(t)-Math.round(t)%100,r=Math.round(t)-Math.round(t)%100,a.props.buyOption("CE",e.symbol,r,l,1,e)):e.sellAt&&(5==n||1==n?(r=Math.round(t)-Math.round(t)%100-400,"NIFTY"==e.symbol&&(r=Math.round(t)-Math.round(t)%100-200)):2==n?(r=Math.round(t)-Math.round(t)%100-300,"NIFTY"==e.symbol&&(r=Math.round(t)-Math.round(t)%100-150)):3==n?(r=Math.round(t)-Math.round(t)%100-200,"NIFTY"==e.symbol&&(r=Math.round(t)-Math.round(t)%100-100)):r=Math.round(t)-Math.round(t)%100,r=Math.round(t)-Math.round(t)%100,console.log(r,n),a.props.buyOption("PE",e.symbol,r,l,1,e))},a.updateLTP=Object(te.a)($.a.mark(function e(){var t,n,r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.orderPenidngOptionList[t],r={exchange:n.exch_seg,tradingsymbol:n.symbol,symboltoken:n.token},x.getLTP(r).then(function(e){var t=Q(e,"noPop"),r=t&&t.data;if(r&&r.ltp)if(n.ltp=r.ltp,n.perChange=(100*(r.ltp-r.close)/r.close).toFixed(2),localStorage.setItem("orderPenidngOptionList",JSON.stringify(a.state.orderPenidngOptionList)),a.setState({orderPenidngOptionList:a.state.orderPenidngOptionList}),console.log("ltp update",n.symbol,n),n.buyAt&&r.ltp>=parseFloat(n.buyAt))a.deleteInOrderPenidngList(n)&&(console.log("buyopiton",n.symbol,n),a.setState({buyOptionFlag:!0},function(){this.placeOptionSPLevelOver(n,r.ltp)}));else if(n.sellAt&&r.ltp<=parseFloat(n.sellAt)){a.deleteInOrderPenidngList(n)&&a.setState({buyOptionFlag:!0},function(){this.placeOptionSPLevelOver(n,r.ltp)})}}),e.next=5,new Promise(function(e){return setTimeout(e,500)});case 5:case"end":return e.stop()}},e)}),n=0;case 2:if(!(n<a.state.orderPenidngOptionList.length)){e.next=7;break}return e.delegateYield(t(n),"t0",4);case 4:n++,e.next=2;break;case 7:case"end":return e.stop()}},e)})),a.getTradePrice=function(){var e={exchange:a.state.exch_seg,tradingsymbol:a.state.searchSymbolPending,symboltoken:a.state.searchTokenPending};x.getLTP(e).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;if(n&&n.ltp){var r={symbol:n.tradingsymbol,ltp:n.ltp,perChange:(100*(n.ltp-n.close)/n.close).toFixed(2),open:n.open,high:n.high,close:n.close,low:n.low};a.setState({lastTradedData:r})}})},a.refreshCandleChartManually=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=ot("9:15am","h:mma"),r=ot.duration("12:00:00"),ot(new Date).subtract(r),l={exchange:"NSE",symboltoken:t.token,interval:"FIVE_MINUTE",fromdate:ot(n).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(l).then(function(e){var a=Q(e,"noPop");if(a&&a.data&&a.data.length){var n=[];a.data.forEach(function(e){n.push([e[0],e[1],e[2],e[3],e[4]])}),localStorage.setItem("candleChangeShow",t.perChange),localStorage.setItem("candleChartData",JSON.stringify(n)),localStorage.setItem("cadleChartSymbol",t.symbol),document.getElementById("showCandleChart").click()}else console.log(t.symboltoken,"  emply candle found")}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),z.showError(t.symboltoken+" candle failed!")});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value.trim()))},a.onChange2=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));e.target.value;a.setState({lastTradedData:{},buyAtPending:"",sellAtPending:"",pattenNamePending:"",searchSymbolPending:""});var t=a.state.staticData[a.state.selectedWatchlist].filter(function(t){return t.name==e.target.value.toUpperCase()});if(console.log("stock",t),t.length>0){var n={exchange:t[0].exch_seg,tradingsymbol:t[0].symbol,symboltoken:t[0].token};x.getLTP(n).then(function(e){var n=Q(e,"noPop"),r=n&&n.data;r&&r.ltp&&(console.log("LtpData",r),x.stockOptionSearch({name:t[0].name,ltp:r.ltp}).then(function(e){var t=e.data;console.log(t),localStorage.setItem("autoSearchTemp",JSON.stringify(t)),a.setState({autoSearchList:t})}))})}},a.openNewPage=function(e){window.open("/mtrade/#/order-watchlist"),localStorage.setItem("isOpenInNewPage","yes")},a.backToPositionPage=function(e){window.location.replace("/mtrade/#/position-new"),localStorage.setItem("isOpenInNewPage","no")},a.onSelectItem=function(e,t){var n=JSON.parse(localStorage.getItem("autoSearchTemp"));if(console.log("values",t),console.log("autoSearchTemp",n),n.length>0){for(var r="",l=0;l<n.length;l++)if(n[l].symbol===t){r=n[l];break}a.setState({searchSymbolPending:r.symbol,searchTokenPending:r.token,exch_seg:r.exch_seg},function(){this.getTradePrice()})}},a.state={orderPenidngOptionList:localStorage.getItem("orderPenidngOptionList")&&JSON.parse(localStorage.getItem("orderPenidngOptionList"))||[],buyAtPending:"",sellAtPending:"",pattenNamePending:"",searchSymbolPending:"",autoSearchList:[{token:"26009",symbol:"BANKNIFTY",name:"BANKNIFTY",expiry:"",strike:"-1.000000",lotsize:"-1",instrumenttype:"",exch_seg:"NSE",tick_size:"-1.000000"},{token:"26000",symbol:"NIFTY",name:"NIFTY",expiry:"",strike:"-1.000000",lotsize:"-1",instrumenttype:"",exch_seg:"NSE",tick_size:"-1.000000"}],lastTradedData:{},buyOptionFlag:!1,staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},selectedWatchlist:"Securities in F&O"},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.updateLTP();var t=ot("9:15am","h:mma"),a=ot("3:30pm","h:mma"),n=ot(new Date,"h:mma");if(ot().isoWeekday()<=5&&n.isBetween(t,a)){var r=2001;this.state.orderPenidngOptionList.length>10&&(r=110*this.state.orderPenidngOptionList.length),this.setState({findlast5minMovementInterval:setInterval(function(){e.updateLTP()},r)})}localStorage.setItem("autoSearchTemp",JSON.stringify(this.state.autoSearchList))}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Ct.a,{style:{overflow:"auto",padding:"5px",background:"#f500570a"}},r.a.createElement(N.a,{justify:"space-between",container:!0},r.a.createElement(N.a,{item:!0},r.a.createElement(R.a,{color:"primary",gutterBottom:!0},"Option Buy With Level (",this.state.orderPenidngOptionList&&this.state.orderPenidngOptionList.length,")","#/order-watchlist"!=window.location.hash?r.a.createElement(B.a,{onClick:function(){return e.openNewPage()}}," New Page ",r.a.createElement(Fe.a,null)," "):"","#/position"!=window.location.hash?r.a.createElement(B.a,{onClick:function(){return e.backToPositionPage()}}," Back to Position "):"")),r.a.createElement(N.a,{item:!0},r.a.createElement(N.a,{container:!0,spacing:2},r.a.createElement(N.a,{item:!0},r.a.createElement(xt.a,{freeSolo:!0,id:"free-solo-2-demo",disableClearable:!0,onChange:this.onSelectItem,value:this.state.searchSymbolPending,options:this.state.autoSearchList.length>0?this.state.autoSearchList.map(function(e){return e.symbol}):[],renderInput:function(t){return r.a.createElement(Y.a,Object.assign({onChange:e.onChange2},t,{label:"Search Symbol",margin:"normal",style:{width:"200px",marginTop:"inherit"},name:"searchSymbolPending",variant:"standard",InputProps:Object(m.a)({},t.InputProps,{type:"search"})}))}}),this.state.lastTradedData.symbol,"  Ltp: ",r.a.createElement("b",{style:{color:0==this.state.lastTradedData.perChange?"none":this.state.lastTradedData.perChange>0?"green":"red"}}," ",this.state.lastTradedData.ltp," ",this.state.lastTradedData.ltp?"("+this.state.lastTradedData.perChange+"%)":"")),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"BuyAt(Above)",type:"number",name:"buyAtPending",value:this.state.buyAtPending,onChange:this.updateInput}),r.a.createElement("br",null)," High: ",this.state.lastTradedData.high),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"SellAt(Below)",type:"number",name:"sellAtPending",value:this.state.sellAtPending,onChange:this.updateInput}),r.a.createElement("br",null)," Low: ",this.state.lastTradedData.low),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"Which Pattern",name:"pattenNamePending",value:this.state.pattenNamePending,onChange:this.updateInput}),r.a.createElement("br",null)," Open: ",this.state.lastTradedData.open),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"Price Stop Loss",name:"priceStopLoss",value:this.state.priceStopLoss,onChange:this.updateInput}),r.a.createElement("br",null)),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"Price Target",name:"priceTarget",value:this.state.priceTarget,onChange:this.updateInput}),r.a.createElement("br",null)),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{variant:"contained",style:{marginLeft:"20px",marginTop:"10px"},onClick:function(){return e.addInOrderPenidngList()}}," Add "),r.a.createElement("br",null)," P.Close: ",this.state.lastTradedData.close))),r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{key:"1",variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Symbol"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"CreatetAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Patten"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"BuyAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"SellAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"LTP"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"PriceSL"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"PriceTarget"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Delete"))),r.a.createElement(Ke.a,{id:"tableAdd",style:{width:"",whiteSpace:"nowrap"}},this.state.orderPenidngOptionList?this.state.orderPenidngOptionList.map(function(t){return r.a.createElement(ze.a,{hover:!0},r.a.createElement(Qe.a,{align:"left"},r.a.createElement(B.a,{style:{color:t.perChange>0?"green":"red"},size:"small",variant:"contained",title:"Candle refresh",onClick:function(){return e.refreshCandleChartManually(t)}},t.symbol," ",t.ltp," (",t.perChange,") ",r.a.createElement(Ce.a,null))),r.a.createElement(Qe.a,{align:"left"},t.createdAt),r.a.createElement(Qe.a,{align:"left"},t.pattenName),r.a.createElement(Qe.a,{align:"left"},t.buyAt),r.a.createElement(Qe.a,{align:"left"},t.sellAt),r.a.createElement(Qe.a,{align:"left",style:{color:0==t.perChange?"none":t.perChange>0?"green":"red"}},r.a.createElement("b",null,t.ltp," (",t.perChange,"%) ")),r.a.createElement(Qe.a,{align:"left"},t.priceStopLoss),r.a.createElement(Qe.a,{align:"left"},t.priceTarget),r.a.createElement(Qe.a,{align:"left"},r.a.createElement(Gt.a,{style:{cursor:"pointer"},onClick:function(){return e.deleteInOrderPenidngList(t)}})))}):"")))),r.a.createElement("br",null))}}]),t}(r.a.Component),sa=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).searchSymbolPendingOrder=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value)),x.autoCompleteSearch(e.target.value).then(function(t){var n=t.data;if(e.target.value){var r=e.target.value.toUpperCase()+"-EQ",l=n.filter(function(e){return"NSE"===e.exch_seg&&"1"===e.lotsize&&e.symbol===r});l.length&&a.setState({searchSymbolPending:l[0].symbol,searchTokenPending:l[0].token,exch_seg:l[0].exch_seg})}})},a.updateInput=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.addInOrderPenidngList=Object(te.a)($.a.mark(function e(){var t;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(a.state.searchSymbolPending,a.state.searchTokenPending,a.state.buyAtPending,a.state.sellAtPending,"CEStrikePrice",a.state.CEStrikePrice),!(parseFloat(a.state.sellAtPending)>a.state.lastTradedData.low)){e.next=4;break}if(window.confirm("Be carefull Selling at high price "+a.state.sellAtPending+", today "+a.state.searchSymbolPending+" low is "+a.state.lastTradedData.low)){e.next=4;break}return e.abrupt("return");case 4:if(!(parseFloat(a.state.buyAtPending)<a.state.lastTradedData.high)){e.next=7;break}if(window.confirm("Be carefull Buying at low price "+a.state.buyAtPending+", today "+a.state.searchSymbolPending+" high is "+a.state.lastTradedData.high)){e.next=7;break}return e.abrupt("return");case 7:(a.state.searchSymbolPending&&a.state.buyAtPending||a.state.sellAtPending)&&(t={createdAt:(new Date).toLocaleTimeString(),token:a.state.searchTokenPending,symbol:a.state.searchSymbolPending,buyAt:a.state.buyAtPending,sellAt:a.state.sellAtPending,pattenName:a.state.pattenNamePending,exch_seg:a.state.exch_seg,buyCallOption:a.state.CEStrikePrice,buyPutOption:a.state.PEStrikePrice},a.setState({orderPenidngList:[].concat(Object(ee.a)(a.state.orderPenidngList),[t]),CEStrikePrice:"",PEStrikePrice:""},function(){this.setState({searchSymbolPending:"",searchTokenPending:"",buyAtPending:"",sellAtPending:"",pattenNamePending:""}),localStorage.setItem("orderPenidngList",JSON.stringify(this.state.orderPenidngList)),localStorage.setItem("orderTagToPosition",JSON.stringify(this.state.orderPenidngList))}));case 8:case"end":return e.stop()}},e)})),a.deleteInOrderPenidngList=function(e){console.log("callback",e);for(var t="",n=localStorage.getItem("orderPenidngList")&&JSON.parse(localStorage.getItem("orderPenidngList")),r=0;r<a.state.orderPenidngList.length;r++){var l=n[r];if(e.token==l.token){t=n.splice(r,1);localStorage.setItem("orderPenidngList",JSON.stringify(n)),a.setState({orderPenidngList:n});break}}return t[0].token==e.token},a.callBackUpdate=function(e){console.log("call back called")},a.updateLTP=Object(te.a)($.a.mark(function e(){var t,n,r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.orderPenidngList[t],r={exchange:n.exch_seg,tradingsymbol:n.symbol,symboltoken:n.token},x.getLTP(r).then(function(e){var t=Q(e,"noPop"),r=t&&t.data;if(r&&r.ltp)if(n.ltp=r.ltp,n.perChange=(100*(r.ltp-r.close)/r.close).toFixed(2),localStorage.setItem("orderPenidngList",JSON.stringify(a.state.orderPenidngList)),a.setState({orderPenidngList:a.state.orderPenidngList}),n.buyAt&&r.ltp>=parseFloat(n.buyAt))a.deleteInOrderPenidngList(n)&&(n.buyCallOption?a.buyStockOption(n.buyCallOption):ut.historyWiseOrderPlace(n,"BUY","isAutomatic",a.callBackUpdate));else if(n.sellAt&&r.ltp<=parseFloat(n.sellAt)){a.deleteInOrderPenidngList(n)&&(n.buyPutOption?a.buyStockOption(n.buyPutOption):ut.historyWiseOrderPlace(n,"SELL","isAutomatic",a.callBackUpdate))}}),e.next=5,new Promise(function(e){return setTimeout(e,100)});case 5:case"end":return e.stop()}},e)}),n=0;case 2:if(!(n<a.state.orderPenidngList.length)){e.next=7;break}return e.delegateYield(t(n),"t0",4);case 4:n++,e.next=2;break;case 7:case"end":return e.stop()}},e)})),a.getTradePrice=function(){var e={exchange:a.state.exch_seg,tradingsymbol:a.state.searchSymbolPending,symboltoken:a.state.searchTokenPending};x.getLTP(e).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;if(n&&n.ltp){var r={symbol:n.tradingsymbol,ltp:n.ltp,perChange:(100*(n.ltp-n.close)/n.close).toFixed(2),open:n.open,high:n.high,close:n.close,low:n.low};a.setState({lastTradedData:r}),a.showStrikesLtp("CE"),a.showStrikesLtp("PE")}})},a.refreshCandleChartManually=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=ot("9:15am","h:mma"),r=ot.duration("12:00:00"),ot(new Date).subtract(r),l={exchange:"NSE",symboltoken:t.token,interval:"FIVE_MINUTE",fromdate:ot(n).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(l).then(function(e){var a=Q(e,"noPop");if(a&&a.data&&a.data.length){var n=[];a.data.forEach(function(e){n.push([e[0],e[1],e[2],e[3],e[4]])}),localStorage.setItem("candleChangeShow",t.perChange),localStorage.setItem("candleChartData",JSON.stringify(n)),localStorage.setItem("cadleChartSymbol",t.symbol),document.getElementById("showCandleChart").click()}else console.log(t.symboltoken,"  emply candle found")}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),z.showError(t.symboltoken+" candle failed!")});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value.trim()))},a.onChangeOption=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.onChange2=function(e){a.setState({lastTradedData:{},buyAtPending:"",sellAtPending:"",pattenNamePending:"",searchSymbolPending:"",CEStrikePrice:"",PEStrikePrice:""}),a.setState(Object(y.a)({},e.target.name,e.target.value));var t=e.target.value;x.autoCompleteSearch(t).then(function(e){var t=e.data;console.log(t),localStorage.setItem("autoSearchTemp",JSON.stringify(t)),a.setState({autoSearchList:t},function(){})})},a.openNewPage=function(e){window.open("/mtrade/#/order-watchlist"),localStorage.setItem("isOpenInNewPage","yes")},a.backToPositionPage=function(e){window.location.replace("/mtrade/#/position"),localStorage.setItem("isOpenInNewPage","no")},a.onSelectItem=function(e,t){var n=JSON.parse(localStorage.getItem("autoSearchTemp"));if(n.length>0){for(var r="",l=0;l<n.length;l++)if(n[l].symbol===t){r=n[l];break}a.setState({searchSymbolPending:r.symbol,searchTokenPending:r.token,exch_seg:r.exch_seg},function(){this.getTradePrice()})}},a.getChunkPrice=function(e){return Math.round(e/100)/10},a.suggestBuyPrice=function(e){e&&a.setState({buyAtPending:(e+a.getChunkPrice(e)).toFixed(2)})},a.suggestSellPrice=function(e){e&&a.setState({sellAtPending:(e-a.getChunkPrice(e)).toFixed(2)})},a.showStrikesLtp=function(e){console.log(a.state.searchSymbolPending,a.state.lastTradedData.ltp),a.setState({CEoptionsLtpList:[],PEoptionsLtpList:[],selectedOptionLotsize:""});var t={name:a.state.searchSymbolPending,ltp:a.state.lastTradedData.ltp,optionType:e};x.getStockOptions(t).then(function(t){var n=t.data;a.getOptionsLtp(n,e)})},a.getOptionsLtp=function(){var e=Object(te.a)($.a.mark(function e(t,n){var r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("nearOptions",t,t.length),r=$.a.mark(function e(r){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=t[r],console.log("element",l),o={exchange:l.exch_seg,tradingsymbol:l.symbol,symboltoken:l.token},x.getLTP(o).then(function(e){var t=Q(e,"noPop"),r=t&&t.data;if(console.log(l.symbol,r,e),r&&r.ltp){var o={symbol:r.tradingsymbol,ltp:r.ltp,perChange:(100*(r.ltp-r.close)/r.close).toFixed(2),open:r.open,high:r.high,close:r.close,low:r.low,buyPrice:(parseFloat(l.lotsize)*r.ltp).toFixed(2),expiryMonth:l.expiryMonth,strikePrice:parseFloat(l.strike/100),optionType:l.optionType,token:l.token,exch_seg:l.exch_seg,lotsize:l.lotsize};"CE"===n&&a.setState({CEoptionsLtpList:[].concat(Object(ee.a)(a.state.CEoptionsLtpList),[o]),selectedOptionLotsize:l.lotsize},function(){console.log(a.state.CEoptionsLtpList)}),"PE"===n&&a.setState({PEoptionsLtpList:[].concat(Object(ee.a)(a.state.PEoptionsLtpList),[o]),selectedOptionLotsize:l.lotsize},function(){console.log(a.state.PEoptionsLtpList)})}}),e.next=6,new Promise(function(e){return setTimeout(e,250)});case 6:case"end":return e.stop()}},e)}),l=0;case 3:if(!(l<t.length)){e.next=8;break}return e.delegateYield(r(l),"t0",5);case 5:l++,e.next=3;break;case 8:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.buyOption=function(e,t,n,r,l,o){console.log(e,t,n,r);var s=r.toUpperCase().split("-");s=s[0]+s[1]+s[2]%1e3;var i=t+s+n+e;console.log(i),x.autoCompleteSearch(i).then(function(n){var r=n.data,s=r&&r[0];if(console.log("optionData",s),s&&s.symbol&&s.symbol==i){var c={exchange:s.exch_seg,tradingsymbol:s.symbol,symboltoken:s.token};x.getLTP(c).then(function(n){var r=Q(n,"noPop"),i=r&&r.data;if(i&&i.ltp){console.log("option ltp",i);var c=s.lotsize*l,m=ot().isoWeekday(),u=10;2==m?u=15:3==m?u=20:4==m&&(u=30);var d=i.ltp-i.ltp*u/100,g=(d=ut.getMinPriceAllowTick(d))-1*d/100;if(g=ut.getMinPriceAllowTick(g),o&&o.priceStopLoss){u=50,d=i.ltp-i.ltp*u/100,g=(d=ut.getMinPriceAllowTick(d))-1*d/100,g=ut.getMinPriceAllowTick(g);var h={name:t,priceStopLoss:o.priceStopLoss,priceTarget:o.priceTarget,tradingsymbol:s.symbol,symboltoken:s.token,optiontype:e};a.setState({trackSLPrice:[].concat(Object(ee.a)(a.state.trackSLPrice),[h])},function(){localStorage.setItem("trackSLPrice",JSON.stringify(this.state.trackSLPrice))})}var p={tradingsymbol:s.symbol,symboltoken:s.token,transactiontype:"BUY",ordertype:"LIMIT",buyPrice:i.ltp,producttype:"CARRYFORWARD",exchange:s.exch_seg,stopLossTriggerPrice:d,stopLossPrice:g,quantity:c};ut.placeOptionOrder(p)}})}else z.showError(i+" not found")})},a.buyStockOption=function(e){var t={exchange:e.exch_seg,tradingsymbol:e.symbol,symboltoken:e.token};x.getLTP(t).then(function(t){var a=Q(t,"noPop"),n=a&&a.data;if(n&&n.ltp){console.log("option ltp",n);var r=e.lotsize,l=n.ltp-10*n.ltp/100,o=(l=ut.getMinPriceAllowTick(l))-1*l/100;o=ut.getMinPriceAllowTick(o);var s={tradingsymbol:e.symbol,symboltoken:e.token,transactiontype:"BUY",ordertype:"LIMIT",buyPrice:n.ltp,producttype:"CARRYFORWARD",exchange:e.exch_seg,stopLossTriggerPrice:l,stopLossPrice:o,quantity:r,netqty:r};ut.placeOptionOrder(s)}})},a.toFixedAmount=function(e){if(e)return parseFloat(e).toFixed(2)},a.state={orderPenidngList:localStorage.getItem("orderPenidngList")&&JSON.parse(localStorage.getItem("orderPenidngList"))||[],buyAtPending:"",sellAtPending:"",pattenNamePending:"",searchSymbolPending:"",autoSearchList:[],lastTradedData:{},CEoptionsLtpList:[],PEoptionsLtpList:[],selectedOptionLotsize:"",trackSLPrice:localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))||[]},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.updateLTP();var t=ot("9:15am","h:mma"),a=ot("3:30pm","h:mma"),n=ot(new Date,"h:mma");if(ot().isoWeekday()<=5&&n.isBetween(t,a)){var r=1e3;this.state.orderPenidngList.length>10&&(r=110*this.state.orderPenidngList.length),this.setState({findlast5minMovementInterval:setInterval(function(){e.updateLTP()},r)})}x.getFunds().then(function(t){var a=Q(t);a.status&"SUCCESS"===a.message&&e.setState({fundData:a.data})})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,"#/order-watchlist"==window.location.hash?r.a.createElement(Et,null):"",r.a.createElement(rt,null),r.a.createElement(N.a,{justify:"space-between",container:!0},r.a.createElement(R.a,{style:{color:"green"}},"Net Balance:   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.net)),r.a.createElement(R.a,{style:{color:"green"}},"Available Cash :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.availablecash)),r.a.createElement(N.a,{item:!0,xs:12,sm:12},"#/position-new"==window.location.hash||"#/order-watchlist"==window.location.hash?r.a.createElement(oa,{buyOption:this.buyOption}):""),"#/order-watchlist"==window.location.hash?r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{overflow:"auto",padding:"5px",background:"#d4ffe0"}},r.a.createElement(R.a,{color:"primary",gutterBottom:!0},"Stock  Order Watchlist (",this.state.orderPenidngList&&this.state.orderPenidngList.length,")","#/order-watchlist"!=window.location.hash?r.a.createElement(B.a,{onClick:function(){return e.openNewPage()}}," New Page ",r.a.createElement(Fe.a,null)," "):"","#/position-new"!=window.location.hash?r.a.createElement(B.a,{onClick:function(){return e.backToPositionPage()}}," Back to Position "):""),r.a.createElement(N.a,{justify:"space-between",container:!0},r.a.createElement(N.a,{item:!0},r.a.createElement(N.a,{container:!0,spacing:2},r.a.createElement(N.a,{item:!0},r.a.createElement(xt.a,{freeSolo:!0,id:"free-solo-2-demo",disableClearable:!0,onChange:this.onSelectItem,value:this.state.searchSymbolPending,options:this.state.autoSearchList.length>0?this.state.autoSearchList.map(function(e){return e.symbol}):[],renderInput:function(t){return r.a.createElement(Y.a,Object.assign({onChange:e.onChange2},t,{label:"Search Symbol",margin:"normal",style:{width:"200px",marginTop:"inherit"},name:"searchSymbolPending",variant:"standard",InputProps:Object(m.a)({},t.InputProps,{type:"search"})}))}}),this.state.lastTradedData.symbol,"  Ltp: ",r.a.createElement("b",{style:{color:0==this.state.lastTradedData.perChange?"none":this.state.lastTradedData.perChange>0?"green":"red"}}," ",this.state.lastTradedData.ltp," ",this.state.lastTradedData.ltp?"("+this.state.lastTradedData.perChange+"%)":"")),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"BuyAt(Above)",type:"number",name:"buyAtPending",value:this.state.buyAtPending,onChange:this.updateInput}),r.a.createElement("br",null)," High: ",this.state.lastTradedData.high,r.a.createElement(B.a,{size:"small",style:{color:"blue"},onClick:function(){return e.suggestBuyPrice(e.state.lastTradedData.high)}}," Suggest Price ")),r.a.createElement(N.a,{item:!0},r.a.createElement(pt.a,{style:ia.selectStyle},r.a.createElement(M.a,{htmlFor:"strike"},"Strike"),r.a.createElement(ft.a,{value:this.state.CEStrikePrice,name:"CEStrikePrice",style:{width:"200px"},onChange:this.onChangeOption},r.a.createElement(yt.a,{value:""},"Month Strike Type Ltp Margin"),this.state.CEoptionsLtpList&&this.state.CEoptionsLtpList.map(function(e){return r.a.createElement(yt.a,{style:{fontWeight:ot().format("MMM").toUpperCase()==e.expiryMonth?"bold":""},value:e},e.expiryMonth+" "+e.strikePrice+" "+e.optionType+" ltp: "+e.ltp+"/- "+e.buyPrice)})),"Lotsize: ",this.state.selectedOptionLotsize)),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"SellAt(Below)",type:"number",name:"sellAtPending",value:this.state.sellAtPending,onChange:this.updateInput}),r.a.createElement("br",null)," Low: ",this.state.lastTradedData.low,r.a.createElement(B.a,{size:"small",style:{color:"blue"},onClick:function(){return e.suggestSellPrice(e.state.lastTradedData.low)}}," Suggest Price ")),r.a.createElement(N.a,{item:!0},r.a.createElement(pt.a,{style:ia.selectStyle},r.a.createElement(M.a,{htmlFor:"strike"},"Strike"),r.a.createElement(ft.a,{value:this.state.PEStrikePrice,name:"PEStrikePrice",style:{width:"200px"},onChange:this.onChangeOption},r.a.createElement(yt.a,{value:""},"Month Strike Type Ltp Margin"),this.state.PEoptionsLtpList&&this.state.PEoptionsLtpList.map(function(e){return r.a.createElement(yt.a,{style:{fontWeight:ot().format("MMM").toUpperCase()==e.expiryMonth?"bold":""},value:e},e.expiryMonth+" "+e.strikePrice+" "+e.optionType+" ltp: "+e.ltp+"/- "+e.buyPrice)})),"Lotsize: ",this.state.selectedOptionLotsize)),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"Which Pattern",name:"pattenNamePending",value:this.state.pattenNamePending,onChange:this.updateInput}),r.a.createElement("br",null)," Open: ",this.state.lastTradedData.open),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{variant:"contained",style:{marginLeft:"20px",marginTop:"10px"},onClick:function(){return e.addInOrderPenidngList()}}," Add "),r.a.createElement("br",null)," P.Close: ",this.state.lastTradedData.close))),r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{key:"1",variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Symbol"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Patten Name"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"CreatetAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Exch_seg"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Token"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"BuyAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"CE Buy"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"SellAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"PE Buy"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"LTP"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Delete"))),r.a.createElement(Ke.a,{id:"tableAdd",style:{width:"",whiteSpace:"nowrap"}},this.state.orderPenidngList?this.state.orderPenidngList.map(function(t){return r.a.createElement(ze.a,{hover:!0},r.a.createElement(Qe.a,{align:"left"},r.a.createElement(B.a,{style:{color:t.perChange>0?"green":"red"},size:"small",variant:"contained",title:"Candle refresh",onClick:function(){return e.refreshCandleChartManually(t)}},t.symbol," ",t.ltp," (",t.perChange,") ",r.a.createElement(Ce.a,null))),r.a.createElement(Qe.a,{align:"left"},t.pattenName),r.a.createElement(Qe.a,{align:"left"},t.createdAt),r.a.createElement(Qe.a,{align:"left"},t.exch_seg),r.a.createElement(Qe.a,{align:"left"},t.token),r.a.createElement(Qe.a,{align:"left"},t.buyAt),r.a.createElement(Qe.a,{align:"left"},t.buyCallOption&&t.buyCallOption.symbol),r.a.createElement(Qe.a,{align:"left"},t.sellAt),r.a.createElement(Qe.a,{align:"left"},t.buyPutOption&&t.buyPutOption.symbol),r.a.createElement(Qe.a,{align:"left",style:{color:0==t.perChange?"none":t.perChange>0?"green":"red"}},r.a.createElement("b",null,t.ltp," (",t.perChange,"%) ")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement(Gt.a,{style:{cursor:"pointer"},onClick:function(){return e.deleteInOrderPenidngList(t)}})))}):""))))):""),"#/order-watchlist"==window.location.hash?r.a.createElement(Ct.a,{style:{overflow:"auto",padding:"5px"}},r.a.createElement(R.a,{color:"primary",gutterBottom:!0},"Option Chain (Equity Derivatives)"),r.a.createElement(la,{buyOption:this.buyOption})):"")}}]),t}(r.a.Component),ia={tableStyle:{display:"flex",justifyContent:"center"},selectStyle:{minWidth:"100%",marginBottom:"10px"}},ca=sa,ma=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));var t=e.target.value;x.autoCompleteSearch(t).then(function(e){var t=e.data;localStorage.setItem("autoSearchTemp",JSON.stringify(t)),a.setState({autoSearchList:t})})},a.onInputChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.state.tradingsymbol&&this.showStaticChart(this.state.symboltoken)})},a.onChangeWatchlist=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));var t=a.state.staticData;a.setState({symbolList:t[e.target.value]},function(){this.checkOpenEqualToLow(),this.setState({cursor:""})}),"selectall"==e.target.value&&a.setState({symbolList:localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))},function(){this.setState({cursor:""})})},a.checkOpenEqualToLow=Object(te.a)($.a.mark(function e(){var t,n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState((t={openEqualHighList:[],openEqualLowList:[]},Object(y.a)(t,"openEqualLowList",[]),Object(y.a)(t,"advanceShareCount",0),Object(y.a)(t,"declineShareCount",0),Object(y.a)(t,"UnchangeShareCount",0),Object(y.a)(t,"volumeCrossedList",[]),Object(y.a)(t,"closeingEqualHighList",[]),t)),n=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.symbolList[t],l={exchange:n.exch_seg,tradingsymbol:n.symbol,symboltoken:n.token},x.getLTP(l).then(function(e){var r=Q(e,"noPop"),l=r&&r.data;if(l){var o=(100*(l.ltp-l.close)/l.close).toFixed(2);if(l.nc=o,l.symbol=n.symbol,a.state.symbolList[t].ltp=l.ltp,a.state.symbolList[t].nc=o,l&&l.open==l.low)console.log("o=l",l),a.state.openEqualLowList.filter(function(e){return e.symboltoken==n.token}).length||a.setState({openEqualLowList:[].concat(Object(ee.a)(a.state.openEqualLowList),[l])});if(console.log(n.symbol,"ltp=newhigh",l.ltp,l.high-.5*l.high/100),l&&l.ltp>=l.high-.5*l.high/100)a.state.closeingEqualHighList.filter(function(e){return e.symboltoken==n.token}).length||a.setState({closeingEqualHighList:[].concat(Object(ee.a)(a.state.closeingEqualHighList),[l])});if(l&&l.open==l.high)console.log("o=h",l),a.state.openEqualHighList.filter(function(e){return e.symboltoken==n.token}).length||a.setState({openEqualHighList:[].concat(Object(ee.a)(a.state.openEqualHighList),[l])});l.perChange>0?a.setState({advanceShareCount:a.state.advanceShareCount+1}):l.perChange<0?a.setState({declineShareCount:a.state.declineShareCount+1}):a.setState({UnchangeShareCount:a.state.UnchangeShareCount+1}),a.state.symbolList&&a.state.symbolList.sort(function(e,t){return t.nc-e.nc}),a.setState({symbolList:a.state.symbolList,tradingsymbol:n.symbol,symboltoken:n.token})}}),e.next=5,new Promise(function(e){return setTimeout(e,310)});case 5:case"end":return e.stop()}},e)}),r=0;case 3:if(!(r<a.state.symbolList.length)){e.next=8;break}return e.delegateYield(n(r),"t0",5);case 5:r++,e.next=3;break;case 8:case"end":return e.stop()}},e)})),a.myCallback=function(e,t){"START_DATE"===t?a.setState({startDate:e}):"END_DATE"===t&&a.setState({endDate:e})},a.getLTP=function(){var e={exchange:"NSE",tradingsymbol:a.state.tradingsymbol,symboltoken:a.state.symboltoken};x.getLTP(e).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;a.setState({InstrumentLTP:n}),n&&n.ltp&&a.setState({InstrumentPerChange:(100*(n.ltp-n.close)/n.close).toFixed(2)})})},a.decodeWebsocketData=function(e){var t=[];try{for(var a=0;a<e.length;a++)t.push(String.fromCharCode(e[a]))}catch(n){}return t.join("")},a.makeConnection=function(e){var t='{"task":"cn","channel":"NONLM","token":"'+a.state.feedToken+'","user": "'+a.state.clientcode+'","acctid":"'+a.state.clientcode+'"}';e.send(t),a.updateSocketWatch(e)},a.updateSocketWatch=function(e){var t=a.state.symbolList.map(function(e){return"nse_cm|"+e.token}),n={task:"mw",channel:t=t.join("&"),token:a.state.feedToken,user:a.state.clientcode,acctid:a.state.clientcode};console.log("updated ws watchlisht",a.state.selectedWatchlist,n),e.send(JSON.stringify(n))},a.updateSocketDetails=function(e){e.onopen=function(t){a.makeConnection(e),a.updateSocketWatch(e)},e.onmessage=function(e){var t=window.atob(e.data),n=a.decodeWebsocketData(Pt.a.inflate(t)),r=JSON.parse(n),l=a.state.symbolList;a.state.symbolList&&a.state.symbolList.forEach(function(e,t){var a=r.filter(function(t){return t.tk==e.token});a.length>0&&a[0].ltp&&a[0].nc&&(l[t].ltp=a[0].ltp,l[t].nc=a[0].nc)}),l&&l.sort(function(e,t){return t.nc-e.nc}),a.setState({symbolList:l})},e.onerror=function(e){console.log("socket error",e)},setInterval(function(){var t='{"task":"hb","channel":"","token":"'+a.state.feedToken+'","user": "'+a.state.clientcode+'","acctid":"'+a.state.clientcode+'"}';e.send(t)},59e3)},a.placeOrder=function(e){var t={variety:"NORMAL",tradingsymbol:a.state.tradingsymbol,symboltoken:a.state.symboltoken,transactiontype:e,exchange:"NSE",ordertype:0===a.state.buyPrice?"MARKET":"LIMIT",producttype:a.state.producttype,duration:"DAY",price:0,squareoff:"0",stoploss:"0",quantity:a.state.quantity};x.placeOrder(t).then(function(t){var n=Q(t);n.status&&"SUCCESS"===n.message&&(localStorage.setItem("ifNotBought","false"),a.setState({orderid:n.data&&n.data.orderid}),a.state.stoploss&&("BUY"==e&&a.placeSLMOrder("SELL"),"SELL"==e&&a.placeSLMOrder("BUY")))})},a.LoadSymbolDetails=function(e,t){console.log("name",e);for(var n="",r=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))||[],l=0;l<r.length;l++){if(r[l].symbol===e||r[l].name===e){n=r[l].token,console.log("name % token",e,n),a.setState({tradingsymbol:r[l].symbol,symboltoken:r[l].token},function(){this.setState({cursor:t},function(){this.showStaticChart(n)})});break}console.log(e+" not found!")}},a.getTimeFrameValue=function(e){switch(e){case"ONE_MINUTE":return"720:00:00";case"FIVE_MINUTE":case"TEN_MINUTE":case"FIFTEEN_MINUTE":case"THIRTY_MINUTE":case"ONE_HOUR":case"ONE_DAY":return"1000:00:00"}},a.calculateSMA=function(e,t){for(var a=function(e){for(var t=0,a=0;a<e.length;a++)t+=e[a].close;return t/e.length},n=[],r=t-1,l=e.length;r<l;r++){var o=a(e.slice(r-t+1,r));n.push({time:e[r].time,value:o})}return n},a.showStaticChart=function(e){a.setState({chartStaticData:""},function(){console.log("reset done",e)}),console.log("time in function ",a.state.timeFrame);var t="YYYY-MM-DD HH:mm",n=(ot("9:15am","h:mma"),a.getTimeFrameValue(a.state.timeFrame)),r=ot.duration(n),l=ot(new Date).subtract(r),o={exchange:"NSE",symboltoken:e,interval:a.state.timeFrame,fromdate:ot(l).format(t),todate:ot(new Date).format(t)};x.getHistoryData(o).then(function(n){var r=Q(n,"noPop");if(r&&r.data){var o=r.data,s=o.map(function(e){return{time:new Date(e[0]).getTime(),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4])}}),i=[],c=[],m=[],u=[],d=[],g=[],h=[],p=[],f=[];o.forEach(function(e,t){i.push([e[0],e[1],e[2],e[3],e[4]]),c.push([e[5],(e[2]+e[3]+e[4])/3]),m.push(e[4]),u.push(e[2]),d.push(e[3]),g.push(e[3]),h.push(e[5]),p.push((e[2]+e[3]+e[4])/3),f.push({time:new Date(e[0]).getTime(),value:e[5],color:"rgba(211, 211, 211, 1)"})});var y={period:20,values:p,stdDev:2},b=it.a.calculate(y);console.log(e,"Bolinger band",y,b);b=it.a.calculate(y);console.log(e,"Bolinger band",y,b);var E={values:m,period:14},S=st.a.calculate(E);if(console.log(e,"Rsi",E,S),console.log(e,"vwap",c,mt()(c)),a.setState({chartStaticData:s,bblastValue:b[b.length-1],vwapvalue:mt()(c),rsiValues:S.slice(Math.max(h.length-19,1)),valumeData:h.slice(Math.max(h.length-5,1))},function(){this.state.candleSeries.setData(this.state.chartStaticData),this.state.volumeSeries.setData(f);var e=this.calculateSMA(this.state.chartStaticData,20);this.state.smaLineSeries.setData(e),this.state.chart.subscribeCrosshairMove(function(e){var t=e.seriesPrices[Symbol.iterator](),a="",n="",r=!0,l=!1,o=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var c=s.value;"object"==typeof c[1]?(a+=" Open: <b>"+c[1].open+"</b>",a+=" High: <b>"+c[1].high+"</b>",a+=" Low: <b>"+c[1].low+"</b>",a+=" Close: <b>"+c[1].close+"</b>",a+=" Chng: <b>"+(n=100*(c[1].close-c[1].open)/c[1].open).toFixed(2)+"%</b>"):a+=" &nbsp; "+c[1].toFixed(2)+" "}}catch(u){l=!0,o=u}finally{try{r||null==i.return||i.return()}finally{if(l)throw o}}e.time?a+=" Time: <b>"+new Date(e.time).toLocaleString()+"</b>":a+=" <b>Time: </b>";var m="<span style=color:green>"+a+"</span> ";n<0&&(m="<span style=color:red>"+a+"</span> "),document.getElementById("showChartTitle").innerHTML=m})}),o&&o.sort(function(e,t){return new Date(t[0])-new Date(e[0])}),o.length>0){localStorage.setItem("InstrumentHistroy",JSON.stringify(o)),a.setState({InstrumentHistroy:o});var v=0,k=0,T=0;o.forEach(function(e){var t=100*(e[4]-e[1])/e[1];t>=.3&&(v+=1),t<=-.3&&(k+=1),T+=t}),a.setState({downMoveCount:k,upsideMoveCount:v,totalPerchentageChange:T,startingFrom:ot(l).format(t)})}}})},a.checkSlowMotionStock=function(e,t){var n=ot.duration("240:00:00"),r=ot(new Date).subtract(n),l={exchange:"NSE",symboltoken:e,interval:"FIVE_MINUTE",fromdate:ot(r).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")};x.getHistoryData(l).then(function(e){var n=Q(e,"noPop");if(n&&n.data&&n.data.length){for(var r=n.data,l=0,o=r.length-375;o<r.length;o++){var s=r[o];if(s){var i=100*(s[4]-s[1])/s[1];i>=.4&&(l+=1,console.log(t.symbol,i,s[0])),i<=-.4&&(l+=1,console.log(t.symbol,i,s[0]))}}console.log("Totalcount",t.symbol,l),l<=15&&(t.bigCandleCount=l,a.setState({slowMotionStockList:[].concat(Object(ee.a)(a.state.slowMotionStockList),[t])},function(){localStorage.setItem("slowMotionStockList",JSON.stringify(this.state.slowMotionStockList))}))}})},a.checkSlowMotionCheckLive=Object(te.a)($.a.mark(function e(){var t,n,r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.slowMotionStockList[t],"YYYY-MM-DD HH:mm",r=ot.duration("22:00:00"),l=ot(new Date).subtract(r),o={exchange:"NSE",symboltoken:n.token,interval:"FIVE_MINUTE",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(o).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){for(var r=t.data,l=0,o=r.length-3;o<r.length;o++){var s=r[o];if(s){var i=100*(s[4]-s[1])/s[1];i>=.7&&(l+=1),i>=0&&1}}l>=1&&(n.highlisht=!0,window.document.title="SM: "+n.symbol,console.log("hey listen, slow motion stock"+n.symbol+" broken"),a.speckIt("hey listen, slow motion stock"+n.symbol+" broken"),a.setState({slowMotionStockList:a.state.slowMotionStockList}))}}),e.next=8,new Promise(function(e){return setTimeout(e,310)});case 8:case"end":return e.stop()}},e)}),n=0;case 2:if(!(n<a.state.slowMotionStockList.length)){e.next=7;break}return e.delegateYield(t(n),"t0",4);case 4:n++,e.next=2;break;case 7:case"end":return e.stop()}},e)})),a.checkLiveBids=Object(te.a)($.a.mark(function e(){var t,n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<a.state.symbolList.length)){e.next=9;break}return n=a.state.symbolList[t],x.checkLiveBids(n.name).then(function(e){if(console.log("bid",e.data.data),e.data&&e.data.data.length){var t=e.data.data[0],n={totalBuyQuantity:t.totalBuyQuantity,totalSellQuantity:t.totalSellQuantity,deliveryToTradedQuantity:t.deliveryToTradedQuantity,symbol:t.symbol,orderType:t.totalBuyQuantity+"|"+t.totalSellQuantity,nc:t.pChange,ltp:t.lastPrice};a.setState({liveBidsList:[].concat(Object(ee.a)(a.state.liveBidsList),[n])},function(){localStorage.setItem("liveBidsList",JSON.stringify(this.state.liveBidsList))})}}),e.next=6,new Promise(function(e){return setTimeout(e,100)});case 6:t++,e.next=1;break;case 9:case"end":return e.stop()}},e)})),a.oneHourBullBearCheck=Object(te.a)($.a.mark(function e(){var t,n,r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.symbolList[t],"YYYY-MM-DD HH:mm",r=ot.duration("04:00:00"),l=ot(new Date).subtract(r),o={exchange:"NSE",symboltoken:n.token,interval:"ONE_HOUR",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(o).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){var r=t.data,l="";(l=r.length>1?r[r.length-2]:r[r.length-1])[1]==l[3]&&l[2]==l[4]&&(window.document.title="Hourly Buy: "+n.symbol,console.log(n.name,"Hourly Buy",r[r.length-1]),n.orderType=" Hourly Buy",n.foundAt=new Date(r[r.length-1][0]).toLocaleString(),a.speckIt(n.name+" Hourly Bullish "),a.setState({oneHourBullBearCheckList:[].concat(Object(ee.a)(a.state.oneHourBullBearCheckList),[n])})),l[1]==l[2]&&l[3]==l[4]&&(window.document.title="Hourly Sell: "+n.symbol,console.log(n.name,"Hourly Sell",r[r.length-1]),n.orderType=" Hourly Sell",n.foundAt=new Date(r[r.length-1][0]).toLocaleString(),a.speckIt(n.name+" Hourly Sell "),a.setState({oneHourBullBearCheckList:[].concat(Object(ee.a)(a.state.oneHourBullBearCheckList),[n])}))}}),e.next=8,new Promise(function(e){return setTimeout(e,310)});case 8:case"end":return e.stop()}},e)}),n=0;case 2:if(!(n<a.state.symbolList.length)){e.next=7;break}return e.delegateYield(t(n),"t0",4);case 4:n++,e.next=2;break;case 7:case"end":return e.stop()}},e)})),a.searchValumeBreakoutStock=Object(te.a)($.a.mark(function e(){var t,n,r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.symbolList[t],"YYYY-MM-DD HH:mm",r=ot.duration("60:00:00"),l=ot(new Date).subtract(r),o={exchange:"NSE",symboltoken:n.token,interval:"FIFTEEN_MINUTE",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(o).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){for(var r=t.data,l=0,o=r[0][5],s=r[r.length-1][5],i=r[0][4],c=0,m=r[0][4],u=0,d=r.length-6;d<r.length-1;d++){var g=r[d];g&&(l+=g[5],o<g[5]&&(o=g[5]),i<g[4]&&(console.log(n.symbol,i,"upside last candle index ",d,g[4]),i=g[4],c+=1),g[4]<m&&(console.log(n.symbol,i," downside last candle index ",d,g[4]),m=g[4],u+=1))}var h=l/5;s/o>1.75&&c>=4&&(window.document.title="VB: "+n.symbol,n.orderType=" Vol "+(s/o).toFixed(2)+" Time & price incresing",n.foundAt=new Date(r[r.length-1][0]).toLocaleString(),console.log(n.name+" volume crossed "+(s/o).toFixed(2)+" time of average ",h,s,r[r.length-1][0],o),a.speckIt(n.name+" volume crossed "+(s/o).toFixed(2)+" Time and price incresing"),a.setState({volumeBreakoutlast5CandleList:[].concat(Object(ee.a)(a.state.volumeBreakoutlast5CandleList),[n])})),s/o>1.75&&u>=4&&(window.document.title="VB: "+n.symbol,n.orderType=" Vol "+(s/o).toFixed(2)+" Time & price decresing",n.foundAt=new Date(r[r.length-1][0]).toLocaleString(),console.log(n.name+" volume crossed "+(s/o).toFixed(2)+" time of average ",h,s,r[r.length-1][0],o),a.speckIt(n.name+" volume crossed "+(s/o).toFixed(2)+" Time and price decresing "),a.setState({volumeBreakoutlast5CandleList:[].concat(Object(ee.a)(a.state.volumeBreakoutlast5CandleList),[n])}))}}),e.next=8,new Promise(function(e){return setTimeout(e,310)});case 8:case"end":return e.stop()}},e)}),n=0;case 2:if(!(n<a.state.symbolList.length)){e.next=7;break}return e.delegateYield(t(n),"t0",4);case 4:n++,e.next=2;break;case 7:case"end":return e.stop()}},e)})),a.speckIt=function(e){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)},a.dailyBasisInfoCheck=function(e,t){var n=a.getTimeFrameValue("ONE_DAY"),r=ot.duration(n),l=ot(new Date).subtract(r),o={exchange:"NSE",symboltoken:e,interval:"ONE_DAY",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")};x.getHistoryData(o).then(function(n){var r=Q(n,"noPop"),l="";if(r&&r.data&&r.data.length){for(var o=r.data,s=[],i=0,c=o.length-20;c<o.length;c++){var m=o[c];m&&(s.push(m[4]),i+=m[5])}l=Ft.a.calculate({period:20,values:s}),a.setState({dailyAvgValume:i/20});var u=l&&l[l.length-1];console.log(e,"DSMA",u),u&&a.setState({DailyBulishStatus:u,todayCurrentVolume:o[o.length-1][5]}),o[o.length-1][5]>i/20&&(console.log("crosssed voliue",t),a.setState({volumeCrossedList:[].concat(Object(ee.a)(a.state.volumeCrossedList),[t])}))}})},a.placeSLMOrder=function(e){var t={tradingsymbol:a.state.tradingsymbol,symboltoken:a.state.symboltoken,transactiontype:e,exchange:"NSE",ordertype:"STOPLOSS_MARKET",producttype:a.state.producttype,duration:"DAY",price:0,squareoff:"0",stoploss:"0",quantity:a.state.quantity,triggerprice:a.state.stoploss,variety:"STOPLOSS"};x.placeOrder(t).then(function(e){var t=Q(e);t.status&&"SUCCESS"===t.message&&(localStorage.setItem("ifNotBought","false"),a.setState({orderid:t.data&&t.data.orderid}))})},a.onSelectItem=function(e,t){var n=JSON.parse(localStorage.getItem("autoSearchTemp"));if(n.length>0){for(var r="",l=0;l<n.length;l++)if(n[l].symbol===t){r=n[l];break}var o=[];o.filter(function(e){return e.token===t}).length||(o.push(r),a.setState({tradingsymbol:r.symbol,symboltoken:r.token},function(){this.LoadSymbolDetails(r.symbol)}),a.setState({symbolList:o},function(){}))}},a.onSelectItemChart=function(e,t){var n=JSON.parse(localStorage.getItem("autoSearchTemp"));if(n.length>0){for(var r="",l=0;l<n.length;l++)if(n[l].symbol===t){r=n[l];break}a.setState({tradingsymbol:r.symbol,symboltoken:r.token,seachSumbol:""},function(){this.getLTP(),this.showStaticChart(r.token),this.LoadSymbolDetails(r.symbol)})}},a.getPercentageColor=function(e){return"rgb("+((e*=100)<50?255:Math.floor(255-255*(2*e-100)/100))+","+(e>50?255:Math.floor(2*e*255/100))+",0)"},a.deleteItemWatchlist=function(e){var t=a.state.symbolList,n=t.findIndex(function(t){return t.symbol===e});t.splice(n,1),a.setState({symbolList:t})},a.getAveragePrice=function(e){for(var t=localStorage.getItem("oderbookData"),n=0,r=0;r<t.length;r++)if("orderId"===t[r].orderid){n=t[r].averageprice,a.setState({averageprice:n});break}return n},a.showCandleChart=function(e,t,a){e=e&&e.reverse(),localStorage.setItem("candleChartData",JSON.stringify(e)),localStorage.setItem("cadleChartSymbol",t),a&&localStorage.setItem("chartInfoDetails",JSON.stringify(a)),document.getElementById("showCandleChart").click()},a.showCandleBothChart=function(e){var t=e.candleChartData&&e.candleChartData.reverse();localStorage.setItem("candleChartData",JSON.stringify(t)),localStorage.setItem("cadleChartSymbol",e.symbol);var a=e.candleChartDataInside;a&&localStorage.setItem("candleChartDataInside",JSON.stringify(a)),document.getElementById("showCandleChart").click()},a.handleKeyDown=function(e){console.log("key",e.keyCode),38===e.keyCode&&a.state.cursor>0?a.setState(function(e){return{cursor:e.cursor-1}}):40===e.keyCode&&a.state.cursor<a.state.symbolList.length-1&&a.setState(function(e){return{cursor:e.cursor+1}}),setTimeout(function(){a.updateCandleOnkey()},100)},a.updateCandleOnkey=function(){var e=localStorage.getItem("selectedKeyRow")&&JSON.parse(localStorage.getItem("selectedKeyRow"));e.token&&e.symbol&&a.setState({tradingsymbol:e.symbol,symboltoken:e.token},function(){this.getLTP(),this.showStaticChart(e.token)})},a.state={sumPercentage:0,InstrumentPerChange:"",autoSearchList:[],isDasable:!1,isError:!1,InstrumentLTP:{},ifNotBought:!0,autoSearchTemp:[],symboltoken:"",tradingsymbol:"",buyPrice:0,quantity:1,producttype:"INTRADAY",symbolList:localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))||[],totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},selectedWatchlist:"NIFTY BANK",longExitPriceType:4,shortExitPriceType:4,candleChartData:[],stopScaningFlag:!1,searchFailed:0,openEqualHighList:[],openEqualLowList:[],closeingEqualHighList:[],chartStaticData:[],volumeCrossedList:[],slowMotionStockList:[],volumeBreakoutlast5CandleList:[],oneHourBullBearCheckList:[],timeFrame:"FIFTEEN_MINUTE",cursor:"",advanceShareCount:0,declineShareCount:0,UnchangeShareCount:0,FoundPatternList:localStorage.getItem("FoundPatternList")&&JSON.parse(localStorage.getItem("FoundPatternList"))||[],fastMovementList:localStorage.getItem("fastMovementList")&&JSON.parse(localStorage.getItem("fastMovementList"))||[],liveBidsList:[],gainerList:localStorage.getItem("gainerList")&&JSON.parse(localStorage.getItem("gainerList"))||[],looserList:localStorage.getItem("looserList")&&JSON.parse(localStorage.getItem("looserList"))||[]},a.myCallback=a.myCallback.bind(Object(k.a)(a)),a.updateSocketWatch=a.updateSocketWatch.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.document.title="Home",this.setState({symbolList:this.state.staticData[this.state.selectedWatchlist]});var t=JSON.parse(localStorage.getItem("userTokens")),a=t&&t.feedToken,n=JSON.parse(localStorage.getItem("userProfile")),r=n&&n.clientcode;this.setState({feedToken:a,clientcode:r});var l=document.getElementById("tvchart");document.getElementById("tvchart").innerHTML="";var o=Object(It.a)(l,{width:600,height:400,timeVisible:!0,secondsVisible:!0}),s=o.addCandlestickSeries(),i=o.addLineSeries({color:"rgba(4, 111, 232, 1)",lineWidth:2}),c=o.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}});this.setState({chart:o,candleSeries:s,smaLineSeries:i,volumeSeries:c});var m=ot("9:15am","h:mma"),u=ot("3:30pm","h:mma"),d=ot(new Date,"h:mma");if(ot().isoWeekday()<=5&&d.isBetween(m,u)){setInterval(function(){e.state.tradingsymbol&&e.getLTP();var t=localStorage.getItem("fastMovementList")&&JSON.parse(localStorage.getItem("fastMovementList"));t&&t.length&&t.reverse(),e.setState({fastMovementList:t})},1e3),setInterval(function(){e.checkSlowMotionCheckLive()},375e3),setInterval(function(){e.searchValumeBreakoutStock()},1125e3);var g=setInterval(function(){var t=new Date;console.log("setinterval ",(new Date).toLocaleString()),t.getMinutes()%60===0&&(setTimeout(function(){e.oneHourBullBearCheck()},9e4),setInterval(function(){e.oneHourBullBearCheck()},367e4),clearInterval(g))},1e3)}setInterval(function(){e.setState({gainerList:localStorage.getItem("gainerList")&&JSON.parse(localStorage.getItem("gainerList"))}),e.setState({looserList:localStorage.getItem("looserList")&&JSON.parse(localStorage.getItem("looserList"))})},1e3)}},{key:"render",value:function(){var e,t=this;this.myCallback;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,{LoadSymbolDetails:this.LoadSymbolDetails}),r.a.createElement(rt,null),r.a.createElement(N.a,{direction:"row",container:!0,spacing:1,style:{padding:"5px"}},r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(Qt,{style:{position:"fixed"},data:(e={gainerList:this.state.gainerList,looserList:this.state.looserList,LoadSymbolDetails:this.LoadSymbolDetails,cursor:this.state.cursor,symbolList:this.state.symbolList,totalWatchlist:this.state.totalWatchlist,onChangeWatchlist:this.onChangeWatchlist,selectedWatchlist:this.state.selectedWatchlist,search:this.state.search,handleKeyDown:this.handleKeyDown,onChange:this.onChange,autoSearchList:this.state.autoSearchList,onSelectItem:this.onSelectItem},Object(y.a)(e,"symbolList",this.state.symbolList),Object(y.a)(e,"LoadSymbolDetails",this.LoadSymbolDetails),Object(y.a)(e,"deleteItemWatchlist",this.deleteItemWatchlist),e)})),r.a.createElement(N.a,{item:!0,xs:12,sm:8},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(R.a,{style:{textAlign:"center",background:"lightgray"}},"Place Order"),r.a.createElement(N.a,{style:{display:"visible"},spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:10,sm:3},this.state.tradingsymbol?r.a.createElement(R.a,{variant:"body1",style:{color:this.state.InstrumentPerChange>0?"#20d020":"#e66e6e"}},this.state.tradingsymbol," : ",this.state.InstrumentLTP?this.state.InstrumentLTP.ltp:""," (",this.state.InstrumentPerChange+"%",")"):r.a.createElement(R.a,{variant:"h5"},"Select Symbol "),"O: ",this.state.InstrumentLTP?this.state.InstrumentLTP.open:""," \xa0 H: ",this.state.InstrumentLTP?this.state.InstrumentLTP.high:""," \xa0 L: ",this.state.InstrumentLTP?this.state.InstrumentLTP.low:"","\xa0 C: ",this.state.InstrumentLTP?this.state.InstrumentLTP.close:""," \xa0"),r.a.createElement(N.a,{item:!0,xs:10,sm:2},r.a.createElement(xt.a,{freeSolo:!0,id:"free-solo-2-demo",disableClearable:!0,style:{paddingLeft:"10px",paddingRight:"10px"},onChange:this.onSelectItemChart,value:this.state.seachSumbol,options:this.state.autoSearchList.length>0?this.state.autoSearchList.map(function(e){return e.symbol}):[],renderInput:function(e){return r.a.createElement(Y.a,Object.assign({onChange:t.onChange},e,{label:"Search",margin:"normal",variant:"standard",name:"seachSumbol",InputProps:Object(m.a)({},e.InputProps,{type:"search"})}))}})),r.a.createElement(N.a,{item:!0,xs:10,sm:1},r.a.createElement(pt.a,Object(y.a)({style:ua.selectStyle},"style",{marginTop:"10px"}),r.a.createElement(M.a,{htmlFor:"gender"},"Time"),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onInputChange},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1M"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5M"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10M"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15M"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30M"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1H"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1D")))),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,Object(y.a)({style:ua.selectStyle},"style",{marginTop:"3px"}),r.a.createElement(M.a,{htmlFor:"gender"},"Order Type"),r.a.createElement(ft.a,{value:this.state.producttype,name:"producttype",onChange:this.onChange},r.a.createElement(yt.a,{value:"INTRADAY"},"Interaday"),r.a.createElement(yt.a,{value:"DELIVERY"},"Del")))),r.a.createElement(N.a,{item:!0,xs:10,sm:1},r.a.createElement(Y.a,{id:"buyPrice",label:"Buy Price",value:this.state.buyPrice,name:"buyPrice",onChange:this.onChange})),r.a.createElement(N.a,{item:!0,xs:10,sm:1},r.a.createElement(Y.a,{id:"quantity",label:"Qty",value:this.state.quantity,name:"quantity",onChange:this.onChange})),r.a.createElement(N.a,{item:!0,xs:10,sm:1},r.a.createElement(Y.a,{id:"stoploss",label:"SL",value:this.state.stoploss,name:"stoploss",onChange:this.onChange})),r.a.createElement(N.a,{item:!0,xs:1,sm:2},r.a.createElement(B.a,{variant:"contained",color:"",style:{marginLeft:"20px"},onClick:function(){return t.placeOrder("BUY")}},"Buy"),r.a.createElement(B.a,{variant:"contained",color:"",style:{marginLeft:"20px"},onClick:function(){return t.placeOrder("SELL")}},"Sell")),r.a.createElement(N.a,{style:{display:"visible"},spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement("br",null),this.state.InstrumentLTP?r.a.createElement(N.a,{item:!0,xs:12,sm:3,style:{background:"#00000014"}},r.a.createElement("div",{style:{background:"#bdbdbd"}},r.a.createElement("b",null,"  Daily: ",this.state.tradingsymbol)," ",r.a.createElement("br",null),r.a.createElement("span",{title:"20SMA",item:!0,xs:12,sm:12,style:{color:this.state.InstrumentLTP.ltp>this.state.DailyBulishStatus?"green":"red",fontWeight:"bold"}},"Daily Avg Price: ",this.state.DailyBulishStatus&&this.state.DailyBulishStatus.toFixed(0)," ",this.state.DailyBulishStatus?this.state.InstrumentLTP.ltp>this.state.DailyBulishStatus?"BUY":"SELL":""),r.a.createElement("br",null),r.a.createElement("span",{title:"averge of showed candle volume",item:!0,xs:12,sm:12},r.a.createElement("b",null,"Daily Avg Volume:"),"  ",(this.state.dailyAvgValume/1e5).toFixed(2),"L"),r.a.createElement("br",null),r.a.createElement("span",{title:"averge of showed candle volume",item:!0,xs:12,sm:12},this.state.todayCurrentVolume>this.state.dailyAvgValume?r.a.createElement("b",{title:"if cossed avg volume then its green",style:{color:"green"}},"Today Volume: ",(this.state.todayCurrentVolume/1e5).toFixed(2),"L "):"Today Volume:"+(this.state.todayCurrentVolume/1e5).toFixed(2)+"L")),r.a.createElement("br",null),r.a.createElement("b",null,"  Intraday: ",this.state.timeFrame," : ",this.state.tradingsymbol)," ",r.a.createElement("br",null),this.state.bblastValue?r.a.createElement("span",{item:!0,xs:12,sm:12},r.a.createElement("span",{title:"Green color mean price running above upper bb band",style:{color:this.state.InstrumentLTP.ltp>=this.state.bblastValue.upper?"green":"",fontWeight:"bold"}},"BB Upper: ",this.state.bblastValue.upper.toFixed(2)),r.a.createElement("br",null),"BB Middle(20 SMA): ",this.state.bblastValue.middle.toFixed(2),r.a.createElement("br",null),r.a.createElement("span",{title:"Green red mean price running below lower bb band",style:{color:this.state.InstrumentLTP.ltp<=this.state.bblastValue.lower?"red":"",fontWeight:"bold"}},"BB Lower: ",this.state.bblastValue.lower.toFixed(2)),r.a.createElement("br",null)):"",r.a.createElement("span",{item:!0,xs:12,sm:12,style:{color:this.state.InstrumentLTP.ltp>this.state.vwapvalue?"green":"red",fontWeight:"bold"}},"VWAP:  ",this.state.vwapvalue&&this.state.vwapvalue.toFixed(2)),r.a.createElement("br",null),r.a.createElement("b",null," RSI: "),this.state.rsiValues&&this.state.rsiValues.map(function(e,t){return e>=60?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}}," ",e," \xa0"):r.a.createElement("span",{style:{color:e<=40?"red":"",fontWeight:"bold"}}," ",e," \xa0")}),r.a.createElement("br",null),r.a.createElement("b",null,"Vol:")," ",this.state.valumeData&&this.state.valumeData.map(function(e,a){return r.a.createElement("span",{style:{color:e>t.state.dailyAvgValume?"green":"",fontWeight:e>t.state.dailyAvgValume?"bold":""}}," ",(e/1e5).toFixed(2),"L \xa0")}),r.a.createElement("br",null),"  ",r.a.createElement("br",null)):"",r.a.createElement(N.a,{item:!0,xs:12,sm:this.state.InstrumentLTP?9:12},r.a.createElement("div",{id:"showChartTitle"}),r.a.createElement("div",{id:"tvchart"})),r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{overflowY:"scroll",maxHeight:"50vh"}},r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Symbol"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Timestamp"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Chng% ",r.a.createElement("b",{style:{color:"#20d020"}}," UP(",this.state.upsideMoveCount,")")," | ",r.a.createElement("b",{style:{color:"red"}}," Down(",this.state.downMoveCount,")")," | Total:  ",r.a.createElement("b",{style:{color:this.state.totalPerchentageChange>0?"green":"red"}},"  ",this.state.totalPerchentageChange&&this.state.totalPerchentageChange.toFixed(2),"% ")," from ",this.state.startingFrom," "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Open"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"High"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Low"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Close "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Volume"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.InstrumentHistroy&&this.state.InstrumentHistroy?this.state.InstrumentHistroy.map(function(e,a){return r.a.createElement(ze.a,{key:a,style:{background:100*(e[4]-e[1])/e[1]>=.3?"#20d020":100*(e[4]-e[1])/e[1]<=-.3?"#e66e6e":"none"}},r.a.createElement(Qe.a,{align:"center"},t.state.tradingsymbol),r.a.createElement(Qe.a,{align:"center"},new Date(e[0]).toLocaleString()),r.a.createElement(Qe.a,{align:"center"}," ",r.a.createElement("b",null,100*(e[4]-e[1])/e[1]&&(100*(e[4]-e[1])/e[1]).toFixed(2),"%")),r.a.createElement(Qe.a,{align:"center"},e[1]),r.a.createElement(Qe.a,{align:"center"},e[2]),r.a.createElement(Qe.a,{align:"center"},e[3]),r.a.createElement(Qe.a,{align:"center"},e[4]),r.a.createElement(Qe.a,{align:"center"},e[5]))}):"")))),r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{height:"100%",overflow:"auto"}},r.a.createElement(ca,null)))),r.a.createElement("br",null)),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(N.a,{style:{display:"visible"},spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(jt,{data:{list:this.state.closeingEqualHighList,title:"Strong Closing",LoadSymbolDetails:this.LoadSymbolDetails}})),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Rt,{data:{list:this.state.oneHourBullBearCheckList,title:"Hourly Bullish/Bearish",LoadSymbolDetails:this.LoadSymbolDetails}})),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Rt,{data:{list:this.state.volumeBreakoutlast5CandleList,title:"Last 5 bar Volume breakout",LoadSymbolDetails:this.LoadSymbolDetails}})),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Rt,{data:{list:this.state.fastMovementList,title:"Fast Movement",LoadSymbolDetails:this.LoadSymbolDetails}})),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(jt,{data:{list:this.state.volumeCrossedList,title:"Average Volume Crossed",LoadSymbolDetails:this.LoadSymbolDetails}})),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(jt,{data:{list:this.state.openEqualLowList,title:"Open = Low : Buy",LoadSymbolDetails:this.LoadSymbolDetails}})),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(jt,{data:{list:this.state.openEqualHighList,title:"Open = High : Sell",LoadSymbolDetails:this.LoadSymbolDetails}})),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(jt,{data:{list:this.state.slowMotionStockList,title:"Last 5 days no Movement",LoadSymbolDetails:this.LoadSymbolDetails}}))))))}}]),t}(r.a.Component),ua={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},da=ma,ga={PaperProps:{style:{maxHeight:224,width:250}}},ha=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value)),a.filterOptionChain(e.target.name,e.target.value)},a.filterOptionChain=function(e,t){var n=[],r=a.state.optionChainData&&a.state.optionChainData.records&&a.state.optionChainData.records.data;if("expiry"===e&&"All"===t&&(n=r),"expiry"===e)for(var l=0;l<r.length;l++){var o=r[l];o.expiryDate===t&&n.push(o)}if("strike"===e)for(var s=0;s<r.length;s++){var i=r[s];i.strikePrice===t&&n.push(i)}a.setState({filtered:n,FilteredBY:e+" "+t})},a.getDataforStrike=function(e){for(var t=JSON.parse(localStorage.getItem("optionChainData")).records.data,a=0,n=0,r=0;r<t.length;r++){var l=t[r];e===l.strikePrice&&(l.CE&&l.CE.openInterest&&(a+=l.CE.openInterest),l.PE&&l.PE.openInterest&&(n+=l.PE.openInterest))}return{strikePrice:e,sumOfCEoi:a,sumOfPEoi:n}},a.findSupportResistence=function(e){for(var t=e&&e.records&&e.records.data,n=0,r=0,l=0,o=0,s=0;s<t.length;s++){var i=t[s];i&&i.PE&&(n+=i.PE.openInterest,l+=i.PE.changeinOpenInterest),i&&i.CE&&(r+=i.CE.openInterest,o+=i.CE.changeinOpenInterest)}e.records.expiryDates,e.records.strikePrices;var c=[],m=0,u=0;[14e3,14050,14100,14150,14200,14050,14300,14350,14400,14450,14500,14550,14600,14650,14700,14750,14800,14850,14900,14950,15e3,15050,15100,15150,15200,15250].forEach(function(e){var t=a.getDataforStrike(e);m+=t.sumOfPEoi,u+=t.sumOfCEoi,c.push(t)}),a.setState({AllspTotalOI:c,selectedSPpcr:(m/u).toFixed(3),totalspeoi:m,totalsceoi:u}),a.setState({CEoi:r,PEoi:n,allStrikediff:n-r,CEoiChange:o,PEoiChange:l,allStrikeChngeDiff:l-o})},a.state={products:[],stopnview:"",curnewdata:"",underlyingValue:"",timestamp:"",totalCOI:0,expiry:"",strike:"",FilteredBY:"",AllspTotalOI:[],PEoi:0,CEoi:0,pcrTable:JSON.parse(localStorage.getItem("pcrTable"))&&JSON.parse(localStorage.getItem("pcrTable")).data,optionChainData:JSON.parse(localStorage.getItem("optionChainData")),filtered:JSON.parse(localStorage.getItem("optionChainData"))&&JSON.parse(localStorage.getItem("optionChainData")).filtered&&JSON.parse(localStorage.getItem("optionChainData")).filtered.data},a.findSupportResistence=a.findSupportResistence.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.loadPackList(),JSON.parse(localStorage.getItem("cpdata"))?this.setState({products:JSON.parse(localStorage.getItem("cpdata")).data}):localStorage.setItem("cpdata",JSON.stringify({data:[]})),JSON.parse(localStorage.getItem("pcrTable"))?this.setState({pcrTable:JSON.parse(localStorage.getItem("pcrTable")).data}):localStorage.setItem("pcrTable",JSON.stringify({data:[]}));var t=new Date;t.getHours()>=9&&t.getHours()<16&&setInterval(function(){e.loadPackList()},120002),setInterval(function(){e.updatepcr()},120020)}},{key:"loadPackList",value:function(){var e=this;x.getBNcpdata("NIFTY").then(function(t){var a=t.data&&t.data;if(localStorage.setItem("optionChainData",JSON.stringify(a)),e.setState({filtered:a.filtered&&a.filtered.data,optionChainData:a}),a.filtered){var n=a.filtered.PE.totOI-a.filtered.CE.totOI,r={dateTime:e.dateFormat(new Date),totCEOI:a.filtered.CE.totOI,totCEVol:a.filtered.CE.totVol,totPEOI:a.filtered.PE.totOI,totPEVol:a.filtered.PE.totVol,diff:n,totChangeINOICall:parseInt(localStorage.getItem("totCEOIChange")),totChangeINOIPut:parseInt(localStorage.getItem("totPEOIChange")),totChangeINOIDiff:parseInt(localStorage.getItem("totPEOIChange"))-parseInt(localStorage.getItem("totCEOIChange"))};e.setState({curnewdata:r});if(n>0?"BUY":"SELL",document.getElementById("title").innerHTML=(n/1e5).toFixed(2)+"|"+((localStorage.getItem("totPEOIChange")-localStorage.getItem("totCEOIChange"))/1e5).toFixed(2)+"L NIFTY ",JSON.parse(localStorage.getItem("cpdata"))){var l=JSON.parse(localStorage.getItem("cpdata")),o=l&&l.data[0];o?(r.isDuplicate=r.diff==o.diff,r.totCEOIChange=(100*(r.totCEOI-o.totCEOI)/o.totCEOI).toFixed(3),r.totPEOIChange=(100*(r.totPEOI-o.totPEOI)/o.totPEOI).toFixed(3),r.totDiffChange=(100*(r.diff-o.diff)/o.diff).toFixed(3)):(r.isDuplicate=!1,r.totCEOIChange=0,r.totPEOIChange=0,r.totDiffChange=0),l.data.unshift(r),a.records&&(l.timestamp=a.records.timestamp,l.underlyingValue=a.records.underlyingValue),localStorage.setItem("cpdata",JSON.stringify(l)),e.setState({products:l.data,underlyingValue:a.records.underlyingValue,timestamp:a.records.timestamp})}}e.updatepcr(),e.setState({pcrTable:JSON.parse(localStorage.getItem("pcrTable"))&&JSON.parse(localStorage.getItem("pcrTable")).data})})}},{key:"updatepcr",value:function(){var e={allPCR:(this.state.PEoi/this.state.CEoi).toFixed(3),expiryPCR:localStorage.getItem("thisWeekPCR"),selectedSPpcr:this.state.selectedSPpcr};if(JSON.parse(localStorage.getItem("pcrTable"))){var t=JSON.parse(localStorage.getItem("pcrTable"));t.data.unshift(e),localStorage.setItem("pcrTable",JSON.stringify(t))}console.log(e),this.setState({pcrTable:t})}},{key:"dateFormat",value:function(e){return ot(e).format("DD-MM-YYYY h:mm:ss A")}},{key:"render",value:function(){var e,t,a,n=this,l=0,o=0,s=0,i=0;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:1,style:{paddingLeft:"5px",paddingRight:"5px"}},r.a.createElement(N.a,{item:!0,xs:7,sm:7},r.a.createElement(R.a,{component:"h3",variant:"h6",color:"primary"},"My View(",this.state.products&&this.state.products.length,") ",r.a.createElement("b",null," Nifty: ",this.state.underlyingValue)," at Time: ",this.state.timestamp)),r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement(pt.a,{style:pa.selectStyle},r.a.createElement(M.a,{id:"expiry"},"Select Expiry Date"),r.a.createElement(ft.a,{id:"expiry",name:"expiry",value:this.state.expiry,onChange:this.onChange,input:r.a.createElement($t.a,null),MenuProps:ga},r.a.createElement(yt.a,{key:"All",value:"All"},"All"),this.state.optionChainData&&this.state.optionChainData.records&&this.state.optionChainData.records.expiryDates?this.state.optionChainData.records.expiryDates.map(function(e,t){return r.a.createElement(yt.a,{key:e+"key"+t,value:e},e)}):""))),r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement(pt.a,{style:pa.selectStyle},r.a.createElement(M.a,{id:"strike"},"Select Strick Price"),r.a.createElement(ft.a,{labelId:"strike",id:"strike","max-height":"100%",name:"strike",value:this.state.strike,onChange:this.onChange,input:r.a.createElement($t.a,null),MenuProps:ga},this.state.optionChainData&&this.state.optionChainData.records&&this.state.optionChainData.records.strikePrices?this.state.optionChainData.records.strikePrices.map(function(e){return r.a.createElement(yt.a,{key:e,value:e},e)}):""))),r.a.createElement(N.a,{item:!0,xs:1,sm:1,style:{paddingTop:"20px",paddingLeft:"20px"}},r.a.createElement(B.a,{variant:"contained",color:"primary",onClick:function(){return n.loadPackList()}},"Refesh"))),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{padding:"10px",overflow:"auto"}},r.a.createElement(N.a,Object(y.a)({container:!0,spacing:3,direction:"row",alignItems:"center"},"container",!0),r.a.createElement(N.a,{item:!0,xs:3,sm:3},r.a.createElement("span",null,"All PUT OI: ",r.a.createElement("b",null,this.state.PEoi," (",(this.state.PEoi/1e5).toFixed(3),"L)")),r.a.createElement("br",null),r.a.createElement("span",null,"All CALL OI: ",r.a.createElement("b",null,this.state.CEoi," (",(this.state.CEoi/1e5).toFixed(3),"L)")),r.a.createElement("br",null),r.a.createElement("span",null,"All Put-Call Diff: ",this.state.allStrikediff>0?r.a.createElement("b",{style:{color:"green"}},this.state.allStrikediff," (",(this.state.allStrikediff/1e5).toFixed(3),"L)"):r.a.createElement("b",{style:{color:"red"}},this.state.allStrikediff," (",(this.state.allStrikediff/1e5).toFixed(3),"L)"))),r.a.createElement(N.a,{item:!0,xs:3,sm:3},r.a.createElement("span",null,"All PUT Chng in OI: ",r.a.createElement("b",null,this.state.PEoiChange," (",(this.state.PEoiChange/1e5).toFixed(3),"L)")),r.a.createElement("br",null),r.a.createElement("span",null,"All CALL Chng in  OI: ",r.a.createElement("b",null,this.state.CEoiChange," (",(this.state.CEoiChange/1e5).toFixed(3),"L)")),r.a.createElement("br",null),r.a.createElement("span",null,"All Put-Call Chng in Diff: ",this.state.allStrikeChngeDiff>0?r.a.createElement("b",{style:{color:"green"}},this.state.allStrikeChngeDiff," (",(this.state.allStrikeChngeDiff/1e5).toFixed(3),"L)"):r.a.createElement("b",{style:{color:"red"}},this.state.allStrikeChngeDiff," (",(this.state.allStrikeChngeDiff/1e5).toFixed(3),"L)"))),r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement(R.a,{component:"h3",variant:"body1",color:"primary"},r.a.createElement("span",null,"ALL PCR: ",r.a.createElement("b",null,(this.state.PEoi/this.state.CEoi).toFixed(3)," ")))),r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement(R.a,{component:"h3",variant:"body1",color:"primary"},r.a.createElement("span",null,"Expire Week PCR: ",r.a.createElement("b",null,localStorage.getItem("thisWeekPCR")," ")))),r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement(R.a,{component:"h3",variant:"body1",color:"primary",style:{justifyContent:"left"}},r.a.createElement("span",null,"14000 to 15250 PCR: ",r.a.createElement("b",null,this.state.selectedSPpcr," "))))))),r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:0,style:{paddingLeft:"5px",paddingRight:"5px"}},r.a.createElement(N.a,{item:!0,xs:7,sm:7,style:{padding:"2px",overflow:"auto",height:"250px"}},r.a.createElement(qe.a,(e={id:"tabledata",stickyHeader:!0,"aria-label":"sticky table"},Object(y.a)(e,"id","tabledata"),Object(y.a)(e,"size","small"),e),r.a.createElement(wt.a,{style:{},variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Time")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"VIEW")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Put-Call(diff)")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Chng in OI(diff)")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"PUT OI")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Chng Put OI")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Call OI")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Chng Call OI")))),r.a.createElement(Ke.a,{hover:!0,style:{width:"",whiteSpace:"nowrap"}},this.state.products?this.state.products.map(function(e){return r.a.createElement(ze.a,{key:e.dateTime,style:{background:e.isDuplicate?"lightgray":""}},r.a.createElement(Qe.a,{align:"center"},e.dateTime.substring(19,11)),r.a.createElement(Qe.a,{align:"center"},e.diff>0?r.a.createElement(R.a,{variant:"body2",style:{color:"green"}},"BUY"):r.a.createElement(R.a,{variant:"body2",style:{color:"red"}},"SELL")),r.a.createElement(Qe.a,{align:"center"},e.diff," (",(e.diff/1e5).toFixed(2),"L)(",e.totDiffChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},e.totDiffChange,"%"):"0.000"==e.totDiffChange?r.a.createElement("span",null,e.totDiffChange,"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},e.totDiffChange,"%"),") "),r.a.createElement(Qe.a,{align:"center"},e.totChangeINOIDiff," (",(e.totChangeINOIDiff/1e5).toFixed(2),"L)"),r.a.createElement(Qe.a,{align:"center"},e.totPEOI," (",e.totPEOIChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},e.totPEOIChange,"%"):"0.000"==e.totPEOIChange?r.a.createElement("span",null,e.totPEOIChange,"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},e.totPEOIChange,"%"),")"),r.a.createElement(Qe.a,{align:"center"},e.totChangeINOIPut," "),r.a.createElement(Qe.a,{align:"center"},e.totCEOI," (",e.totCEOIChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},e.totCEOIChange,"%"):"0.000"==e.totCEOIChange?r.a.createElement("span",null,e.totCEOIChange,"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},e.totCEOIChange,"%"),")"),r.a.createElement(Qe.a,{align:"center"},e.totChangeINOICall))}):r.a.createElement(gt.a,null)))),r.a.createElement(N.a,{item:!0,xs:3,sm:3,style:{padding:"2px",overflow:"auto",height:"250px"}},r.a.createElement(qe.a,(t={style:{borderLeft:"dashed",borderRight:"dashed",fontWeight:"500"},id:"tabledata",stickyHeader:!0,"aria-label":"sticky table"},Object(y.a)(t,"id","tabledata"),Object(y.a)(t,"size","small"),t),r.a.createElement(wt.a,{style:{},variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Total CE OI ",r.a.createElement("br",null),(this.state.totalsceoi/1e5).toFixed(3),"L")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Strike Price")," "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Total PE OI",r.a.createElement("br",null),(this.state.totalspeoi/1e5).toFixed(3),"L")))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.AllspTotalOI?this.state.AllspTotalOI.map(function(e){return r.a.createElement(ze.a,{hover:!0,key:e.dateTime},r.a.createElement(Qe.a,{align:"center",style:{backgroundColor:e.strikePrice<n.state.underlyingValue?"#ded6a269":""}},e.sumOfCEoi," (",(e.sumOfCEoi/1e5).toFixed(2),"L)"),r.a.createElement(Qe.a,{align:"center"},e.strikePrice),r.a.createElement(Qe.a,{align:"center",style:{backgroundColor:e.strikePrice>n.state.underlyingValue?"#ded6a269":""}},e.sumOfPEoi," (",(e.sumOfPEoi/1e5).toFixed(2),"L)"))}):r.a.createElement(gt.a,null)))),r.a.createElement(N.a,{item:!0,xs:2,sm:2,style:{padding:"2px",overflow:"auto",height:"250px"}},r.a.createElement(qe.a,(a={id:"tabledata",stickyHeader:!0,"aria-label":"sticky table"},Object(y.a)(a,"id","tabledata"),Object(y.a)(a,"size","small"),a),r.a.createElement(wt.a,{variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"center"},"ALL Pcr"),r.a.createElement(Qe.a,{align:"center"},"Expiry Pcr "),r.a.createElement(Qe.a,{align:"center"},"Selected Pcr"))),r.a.createElement(Ke.a,{style:{whiteSpace:"nowrap"}},this.state.pcrTable&&this.state.pcrTable.length>0&&this.state.pcrTable?this.state.pcrTable.map(function(e){return r.a.createElement(ze.a,{hover:!0,key:e.expiryPCR},r.a.createElement(Qe.a,{align:"center"},e.allPCR," "),r.a.createElement(Qe.a,{align:"center"},e.expiryPCR),r.a.createElement(Qe.a,{align:"center"},e.selectedSPpcr," "))}):r.a.createElement(gt.a,null)))),r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{padding:"2px",overflow:"auto",height:"900px"}},r.a.createElement(qe.a,{stickyHeader:!0,"aria-label":"sticky table",id:"tabledata",size:"small"},r.a.createElement(wt.a,{variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{colSpan:6,align:"center"},r.a.createElement("b",null,"CALL")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null)),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null)),r.a.createElement(Qe.a,{colSpan:6,align:"center"},r.a.createElement("b",null,"PUT"))),r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"OI Total OI ",r.a.createElement("br",null),localStorage.getItem("totCEOI"),"(",(localStorage.getItem("totCEOI")/1e5).toFixed(3),"L) ")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Chng in OI ",r.a.createElement("br",null),localStorage.getItem("totCEOIChange"),"(",(localStorage.getItem("totCEOIChange")/1e5).toFixed(3),"L)")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"IV")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Delta")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"LTP")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"CHNG")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("span",{style:{color:"#3e85c5",fontWeight:"bold"}}," STRIKE PRICE")," "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("span",{style:{color:"#3e85c5",fontWeight:"bold"}}," Expiry")," "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"CHNG")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"LTP")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"IV")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Delta")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Chng in OI ",r.a.createElement("br",null),localStorage.getItem("totPEOIChange"),"(",(localStorage.getItem("totPEOIChange")/1e5).toFixed(3),"L)")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"OI ",r.a.createElement("br",null),localStorage.getItem("totPEOI"),"(",(localStorage.getItem("totPEOI")/1e5).toFixed(3),"L)")))),r.a.createElement(Ke.a,null,this.state.filtered?this.state.filtered.map(function(e,t){return r.a.createElement(ze.a,{hover:!0,key:t,style:{background:e.isDuplicate?"lightgray":""}},e&&e.CE&&e.PE?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,Object.assign({},l+=e.CE.openInterest,{style:{backgroundColor:e.strikePrice<e.CE.underlyingValue?"#ded6a269":""},align:"center"}),e.CE.openInterest),r.a.createElement(Qe.a,Object.assign({},o+=e.CE.changeinOpenInterest,{style:{backgroundColor:e.strikePrice<e.CE.underlyingValue?"#ded6a269":""},align:"center"}),e.CE.changeinOpenInterest),r.a.createElement(Qe.a,{align:"center"},e.CE.impliedVolatility," "),r.a.createElement(Qe.a,{align:"center"},(10*(e.CE.change/e.strikePrice-e.CE.underlyingValue)).toFixed(2)," "),r.a.createElement(Qe.a,{style:{backgroundColor:e.strikePrice<e.CE.underlyingValue?"#ded6a269":""},align:"center"},r.a.createElement("span",{style:{color:"#3e85c5",fontWeight:"bold"}}," ",e.CE.lastPrice),"(",e.CE.pChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},e.CE.pChange.toFixed(2),"%"):0==e.CE.pChange?r.a.createElement("span",null,e.CE.pChange.toFixed(2),"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},e.CE.pChange.toFixed(2),"%"),") "),r.a.createElement(Qe.a,{style:{backgroundColor:e.strikePrice<e.CE.underlyingValue?"#ded6a269":""},align:"center"},e.CE.change.toFixed(2)," "),r.a.createElement(Qe.a,{style:{borderLeft:"dashed",borderRight:"dashed",fontWeight:"500"},align:"center"},r.a.createElement("span",null," ",r.a.createElement("a",{href:"#",style:{textDecoration:"none"},onClick:function(){return n.filterOptionChain("strike",e.strikePrice)}}," ",e.strikePrice)," ")," "),r.a.createElement(Qe.a,{style:{borderRight:"dashed",whiteSpace:"nowrap"},align:"center"},r.a.createElement("span",{style:{paddingLeft:"5px",paddingRight:"5px"}}," ",r.a.createElement("a",{href:"#",style:{textDecoration:"none"},onClick:function(){return n.filterOptionChain("expiry",e.expiryDate)}}," ",e.expiryDate))," "),r.a.createElement(Qe.a,{style:{backgroundColor:e.strikePrice>e.CE.underlyingValue?"#ded6a269":""},align:"center"},e.PE.change.toFixed(2)," "),r.a.createElement(Qe.a,{style:{backgroundColor:e.strikePrice>e.CE.underlyingValue?"#ded6a269":""},align:"center"},r.a.createElement("span",{style:{color:"#3e85c5",fontWeight:"bold"}}," ",e.PE.lastPrice),"(",e.PE.pChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},e.PE.pChange.toFixed(2),"%"):0==e.PE.pChange?r.a.createElement("span",null,e.PE.pChange.toFixed(2),"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},e.PE.pChange.toFixed(2),"%"),")"),r.a.createElement(Qe.a,{align:"center"},e.PE.impliedVolatility," "),r.a.createElement(Qe.a,{align:"center"},(10*(e.PE.change/e.strikePrice-e.PE.underlyingValue)).toFixed(2)," "),r.a.createElement(Qe.a,Object.assign({},i+=e.PE.changeinOpenInterest,{style:{backgroundColor:e.strikePrice>e.CE.underlyingValue?"#ded6a269":""},align:"center"}),e.PE.changeinOpenInterest),r.a.createElement(Qe.a,Object.assign({},s+=e.PE.openInterest,{style:{backgroundColor:e.strikePrice>e.CE.underlyingValue?"#ded6a269":""},align:"center"}),e.PE.openInterest," ")):"")}):r.a.createElement(gt.a,null),r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totCEOI",l)),r.a.createElement("b",null,l,r.a.createElement("br",null),"(",(l/1e5).toFixed(3),"L)")),r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totCEOIChange",o)),r.a.createElement("b",null,o,r.a.createElement("br",null),"(",(o/1e5).toFixed(3),"L)")," "),r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totCEVol",0)),r.a.createElement("b",null,0,r.a.createElement("br",null),"(",(0).toFixed(3),"L)")),r.a.createElement(Qe.a,{colSpan:3,align:"center"}),r.a.createElement(Qe.a,Object.assign({},localStorage.setItem("thisWeekPCR",(s/l).toFixed(3)),{align:"center",colSpan:2}),r.a.createElement("b",null," PCR : ",(s/l).toFixed(3))),r.a.createElement(Qe.a,{colSpan:3,align:"center"}),r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totPEVol",0)),r.a.createElement("b",null,0,r.a.createElement("br",null),"(",(0).toFixed(3),"L)")),r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totPEOIChange",i)),r.a.createElement("b",null,i,r.a.createElement("br",null),"(",(i/1e5).toFixed(3),"L)")," "),r.a.createElement(Qe.a,Object.assign({align:"center"},localStorage.setItem("totPEOI",s)),r.a.createElement("b",null,s,r.a.createElement("br",null),"(",(s/1e5).toFixed(3),"L)")," ")))))))}}]),t}(r.a.Component),pa={tableStyle:{display:"flex",justifyContent:"center"},selectStyle:{marginBottom:"0px",minWidth:240,maxWidth:240}},fa=Object(s.b)(function(e){return{packs:e.packs.packs.data}},{setPackLoaded:Zt})(ha),ya=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})(function(e){var t=e.children,a=e.classes,n=e.onClose,l=Object(He.a)(e,["children","classes","onClose"]);return r.a.createElement(Re.a,Object.assign({disableTypography:!0,className:a.root},l),r.a.createElement(R.a,{variant:"h6"},t),n?r.a.createElement(ie.a,{"aria-label":"close",className:a.closeButton,onClick:n},r.a.createElement(Je.a,null)):null)}),ba=Object(je.a)(function(e){return{root:{padding:e.spacing(2)}}})(Ue.a),Ea=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(1)}}})(_e.a);function Sa(e){var t=r.a.useState(!1),a=Object(ae.a)(t,2),n=a[0],l=a[1],o=function(){l(!1)};return r.a.createElement("div",null,r.a.createElement(B.a,{variant:"outlined",color:"primary",onClick:function(){l(!0)}},e.data.indexSymbol),r.a.createElement(We.a,{onClose:o,"aria-labelledby":"customized-dialog-title",open:n},r.a.createElement(ya,{id:"customized-dialog-title",onClose:o},e.data.indexSymbol,"  At ",e.data.timestamp),r.a.createElement(ba,{dividers:!0},r.a.createElement(qe.a,{stickyHeader:!0,"aria-label":"sticky table",id:"tabledata",size:"medium"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Sr.")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Stock Name")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Last Price")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"CHNG%")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Change Points"))),r.a.createElement(Ke.a,null,e.data.indexSymbolData?e.data.indexSymbolData.map(function(e,t){return r.a.createElement(ze.a,{hover:!0,key:t},0!==t?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{align:"left"},t," "),r.a.createElement(Qe.a,{align:"left"},e.symbol),r.a.createElement(Qe.a,{align:"left"},e.lastPrice),r.a.createElement(Qe.a,{align:"left"},e.pChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},e.pChange,"%"):0===e.pChange?r.a.createElement("span",null,e.pChange,"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},e.pChange,"%")," "),r.a.createElement(Qe.a,{align:"left"},e.change)):"")}):r.a.createElement(r.a.Fragment,null," ",r.a.createElement("br",null)," ",r.a.createElement(B.a,{variant:"outlined",size:"large",color:"primary"},"Refresh")," ")))),r.a.createElement(Ea,null,r.a.createElement(B.a,{autoFocus:!0,onClick:o,color:"primary"},"Close"))))}var va=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).getIndicesStocks=function(e,t){x.getIndiceStock(e).then(function(n){console.log(n.data);var r=n.data;if(z.showSuccess("Success, Top is"+r.data[1].symbol),a.speckIt("1st top "+e+" stock is "+r.data[1].symbol.toLocaleLowerCase()+" high of "+r.data[1].pChange+"%"),a.speckIt("2nd top "+e+" stock is "+r.data[2].symbol.toLocaleLowerCase()+" high of "+r.data[2].pChange+"%"),a.speckIt("3rd top "+e+" stock is "+r.data[3].symbol.toLocaleLowerCase()+" high of "+r.data[3].pChange+"%"),r){localStorage.setItem(e,JSON.stringify(r)),document.getElementById("topDate_"+t)&&(document.getElementById("topDate_"+t).innerHTML=r.timestamp.substring(12,23));var l=0;document.getElementById("top1_"+t)&&(l=r.data[1].pChange>0?'<span style="color:green">'+r.data[1].pChange+"</span>":'<span style="color:red">'+r.data[1].pChange+"</span>",document.getElementById("top1_"+t).innerHTML=r.data[1].symbol+" "+r.data[1].lastPrice+"("+l+")"),document.getElementById("top2_"+t)&&(l=r.data[2].pChange>0?'<span style="color:green">'+r.data[2].pChange+"</span>":'<span style="color:red">'+r.data[2].pChange+"</span>",document.getElementById("top2_"+t).innerHTML=r.data[2].symbol+" "+r.data[2].lastPrice+"("+l+")"),document.getElementById("top3_"+t)&&(l=r.data[3].pChange>0?'<span style="color:green">'+r.data[3].pChange+"</span>":'<span style="color:red">'+r.data[3].pChange+"</span>",document.getElementById("top3_"+t).innerHTML=r.data[3].symbol+" "+r.data[3].lastPrice+"("+l+")"),document.getElementById("top4_"+t)&&(l=r.data[4].pChange>0?'<span style="color:green">'+r.data[4].pChange+"</span>":'<span style="color:red">'+r.data[4].pChange+"</span>",document.getElementById("top4_"+t).innerHTML=r.data[4].symbol+" "+r.data[4].lastPrice+"("+l+")"),document.getElementById("top5_"+t)&&(l=r.data[5].pChange>0?'<span style="color:green">'+r.data[5].pChange+"</span>":'<span style="color:red">'+r.data[5].pChange+"</span>",document.getElementById("top5_"+t).innerHTML=r.data[5].symbol+" "+r.data[5].lastPrice+"("+l+")")}}).catch(function(t){z.showError(e+" Failed"+r.a.createElement("br",null)+t),a.speckIt(e+" API Failed ")})},a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.speckIt=function(e){(new SpeechSynthesisUtterance).text=e.toString()},a.state={stopnview:"",indexTimeStamp:"",products:JSON.parse(localStorage.getItem("sorteIndexList"))},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.loadPackList();var t=new Date;t.getHours()>=9&&t.getHours()<16&&setInterval(function(){e.loadPackList()},120002)}},{key:"loadPackList",value:function(){var e=this;x.getAllIndices().then(function(t){if(t.data){e.setState({indexTimeStamp:t.data.timestamp});var a=t.data.data.sort(function(e,t){return t.percentChange-e.percentChange});localStorage.setItem("sorteIndexList",JSON.stringify(a)),e.setState({products:a}),e.speckIt("1st sector is "+a[0].indexSymbol+" "+a[0].percentChange+"%"),e.speckIt("2nd sector is "+a[1].indexSymbol+" "+a[1].percentChange+"%"),e.speckIt("3rd sector is "+a[2].indexSymbol+" "+a[2].percentChange+"%"),e.getIndicesStocks(a[0].indexSymbol,0),e.getIndicesStocks(a[1].indexSymbol,1),e.getIndicesStocks(a[2].indexSymbol,2)}}).catch(function(t){z.showError("All Indices API Failed"+r.a.createElement("br",null)+t),e.speckIt("All Indices API Failed")})}},{key:"dateFormat",value:function(e){return ot(e).format("DD-MM-YYYY h:mm:ss A")}},{key:"timeFormat",value:function(e){return ot().calendar()}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:1,style:{paddingLeft:"5px",paddingRight:"5px"}},r.a.createElement(N.a,{item:!0,xs:7,sm:7}),r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{padding:"20px",overflow:"auto",height:"900px"}},r.a.createElement(R.a,{component:"h3",variant:"h6",color:"primary"},"Market - Indices at ",this.state.indexTimeStamp),r.a.createElement(qe.a,{stickyHeader:!0,"aria-label":"sticky table",id:"tabledata",size:"small"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Sr.")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Index Name")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"CHNG%")),r.a.createElement(Qe.a,{align:"left",title:"Advances/Declines/Unchanged"},r.a.createElement("b",null,"A/D/Un")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Refresh")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"TIME")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Top1")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Top2")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Top3")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Top4")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,"Top5"))),r.a.createElement(Ke.a,null,this.state.products?this.state.products.map(function(t,a){return r.a.createElement(ze.a,{hover:!0,key:a},"vijay"!==t.key?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{align:"left"},a+1," "),r.a.createElement(Qe.a,{align:"left"},r.a.createElement(Sa,{data:{indexSymbol:t.indexSymbol+" @ "+t.last,indexSymbolData:JSON.parse(localStorage.getItem(t.indexSymbol))&&JSON.parse(localStorage.getItem(t.indexSymbol)).data,timestamp:JSON.parse(localStorage.getItem(t.indexSymbol))&&JSON.parse(localStorage.getItem(t.indexSymbol)).timestamp}})),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("a",{href:"https://www.nseindia.com/api/equity-stockIndices?index="+encodeURIComponent(t.indexSymbol),target:"_blank",rel:"noopener noreferrer"},"  ",t.percentChange>0?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}},t.percentChange,"%"):0===t.percentChange?r.a.createElement("span",null,t.percentChange,"%"):r.a.createElement("span",{style:{color:"red",fontWeight:"bold"}},t.percentChange,"%")," ")),r.a.createElement(Qe.a,{align:"left"},"  ",r.a.createElement("span",{style:{color:"green"}},t.advances)," / ",r.a.createElement("span",{style:{color:"red"}},t.declines)," / ",t.unchanged),r.a.createElement(Qe.a,{align:"left"},r.a.createElement(B.a,{variant:"outlined",color:"primary",onClick:function(){return e.getIndicesStocks(t.indexSymbol,a)}},"Refresh")),r.a.createElement(Qe.a,{align:"left",id:"topDate_"+a}),r.a.createElement(Qe.a,{align:"left",id:"top1_"+a}),r.a.createElement(Qe.a,{align:"left",id:"top2_"+a}),r.a.createElement(Qe.a,{align:"left",id:"top3_"+a}),r.a.createElement(Qe.a,{align:"left",id:"top4_"+a}),r.a.createElement(Qe.a,{align:"left",id:"top5_"+a})):"")}):r.a.createElement(gt.a,null))))))}}]),t}(r.a.Component),ka=Object(s.b)(function(e){return{packs:e.packs.packs.data}},{setPackLoaded:Zt})(va),Ta=a(211),La=a.n(Ta);function Ca(e){var t={series:[{data:[{x:new Date(15387786e5),y:[6629.81,6650.5,6623.04,6633.33]},{x:new Date(15387804e5),y:[6632.01,6643.59,6620,6630.11]},{x:new Date(15387822e5),y:[6630.71,6648.95,6623.34,6635.65]},{x:new Date(1538784e6),y:[6635.65,6651,6629.67,6638.24]},{x:new Date(15387858e5),y:[6638.24,6640,6620,6624.47]},{x:new Date(15387876e5),y:[6624.53,6636.03,6621.68,6624.31]},{x:new Date(15387894e5),y:[6624.61,6632.2,6617,6626.02]},{x:new Date(15387912e5),y:[6627,6627.62,6584.22,6603.02]},{x:new Date(1538793e6),y:[6605,6608.03,6598.95,6604.01]},{x:new Date(15387948e5),y:[6604.5,6614.4,6602.26,6608.02]},{x:new Date(15387966e5),y:[6608.02,6610.68,6601.99,6608.91]},{x:new Date(15387984e5),y:[6608.91,6618.99,6608.01,6612]},{x:new Date(15388002e5),y:[6612,6615.13,6605.09,6612]},{x:new Date(1538802e6),y:[6612,6624.12,6608.43,6622.95]},{x:new Date(15388038e5),y:[6623.91,6623.91,6615,6615.67]},{x:new Date(15388056e5),y:[6618.69,6618.74,6610,6610.4]},{x:new Date(15388074e5),y:[6611,6622.78,6610.4,6614.9]},{x:new Date(15388092e5),y:[6614.9,6626.2,6613.33,6623.45]},{x:new Date(1538811e6),y:[6623.48,6627,6618.38,6620.35]},{x:new Date(15388128e5),y:[6619.43,6620.35,6610.05,6615.53]},{x:new Date(15388146e5),y:[6615.53,6617.93,6610,6615.19]},{x:new Date(15388164e5),y:[6615.19,6621.6,6608.2,6620]},{x:new Date(15388182e5),y:[6619.54,6625.17,6614.15,6620]},{x:new Date(153882e7),y:[6620.33,6634.15,6617.24,6624.61]},{x:new Date(15388218e5),y:[6625.95,6626,6611.66,6617.58]},{x:new Date(15388236e5),y:[6619,6625.97,6595.27,6598.86]},{x:new Date(15388254e5),y:[6598.86,6598.88,6570,6587.16]},{x:new Date(15388272e5),y:[6588.86,6600,6580,6593.4]},{x:new Date(1538829e6),y:[6593.99,6598.89,6585,6587.81]},{x:new Date(15388308e5),y:[6587.81,6592.73,6567.14,6578]},{x:new Date(15388326e5),y:[6578.35,6581.72,6567.39,6579]},{x:new Date(15388344e5),y:[6579.38,6580.92,6566.77,6575.96]},{x:new Date(15388362e5),y:[6575.96,6589,6571.77,6588.92]},{x:new Date(1538838e6),y:[6588.92,6594,6577.55,6589.22]},{x:new Date(15388398e5),y:[6589.3,6598.89,6589.1,6596.08]},{x:new Date(15388416e5),y:[6597.5,6600,6588.39,6596.25]},{x:new Date(15388434e5),y:[6598.03,6600,6588.73,6595.97]},{x:new Date(15388452e5),y:[6595.97,6602.01,6588.17,6602]},{x:new Date(1538847e6),y:[6602,6607,6596.51,6599.95]},{x:new Date(15388488e5),y:[6600.63,6601.21,6590.39,6591.02]},{x:new Date(15388506e5),y:[6591.02,6603.08,6591,6591]},{x:new Date(15388524e5),y:[6591,6601.32,6585,6592]},{x:new Date(15388542e5),y:[6593.13,6596.01,6590,6593.34]},{x:new Date(1538856e6),y:[6593.34,6604.76,6582.63,6593.86]},{x:new Date(15388578e5),y:[6593.86,6604.28,6586.57,6600.01]},{x:new Date(15388596e5),y:[6601.81,6603.21,6592.78,6596.25]},{x:new Date(15388614e5),y:[6596.25,6604.2,6590,6602.99]},{x:new Date(15388632e5),y:[6602.99,6606,6584.99,6587.81]},{x:new Date(1538865e6),y:[6587.81,6595,6583.27,6591.96]},{x:new Date(15388668e5),y:[6591.97,6596.07,6585,6588.39]},{x:new Date(15388686e5),y:[6587.6,6598.21,6587.6,6594.27]},{x:new Date(15388704e5),y:[6596.44,6601,6590,6596.55]},{x:new Date(15388722e5),y:[6598.91,6605,6596.61,6600.02]},{x:new Date(1538874e6),y:[6600.55,6605,6589.14,6593.01]},{x:new Date(15388758e5),y:[6593.15,6605,6592,6603.06]},{x:new Date(15388776e5),y:[6603.07,6604.5,6599.09,6603.89]},{x:new Date(15388794e5),y:[6604.44,6604.44,6600,6603.5]},{x:new Date(15388812e5),y:[6603.5,6603.99,6597.5,6603.86]},{x:new Date(1538883e6),y:[6603.85,6605,6600,6604.07]},{x:new Date(15388848e5),y:[6604.98,6606,6604.07,6606]}]}],chart:{type:"candlestick",height:350},title:{text:"CandleStick Chart",align:"left"},colors:{upward:"darkmagenta",downward:"#00cbcb"},xaxis:{type:"datetime"},yaxis:{tooltip:{enabled:!0}}};return new La.a(document.querySelector("#chart"),t).render(),""}var wa=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value)),a.filterOptionChain(e.target.name,e.target.value)},a.toFixedAmount=function(e){if(e)return parseFloat(e).toFixed(2)},a.state={products:[],stopnview:"",curnewdata:"",underlyingValue:"",timestamp:"",totalCOI:0,expiry:"",strike:"",FilteredBY:"",AllspTotalOI:[],PEoi:0,CEoi:0,scrollcount:0},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;x.getFunds().then(function(t){var a=Q(t);a.status&"SUCCESS"===a.message&&(e.setState({fundData:a.data}),localStorage.setItem("netCapital",a.data&&a.data.net))})}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:2,style:{paddingLeft:"5px",paddingRight:"5px",justifyContent:"center"}},r.a.createElement(N.a,{id:"tabledatachart",item:!0,xs:8,sm:4},r.a.createElement(Ct.a,{style:{padding:"25px"}},r.a.createElement(R.a,{variant:"h6"},"Net:   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.net)),r.a.createElement(R.a,{variant:"h6"},"Available Cash :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.availablecash)),r.a.createElement(R.a,{variant:"h6"},"Aailable Intraday payin :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.availableintradaypayin)),r.a.createElement(R.a,{variant:"h6"},"Available limit margin :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.availablelimitmargin)),r.a.createElement(R.a,{variant:"h6"},"Collateral :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.collateral)),r.a.createElement(R.a,{variant:"h6"},"Utilised debits :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.utiliseddebits)),r.a.createElement(R.a,{variant:"h6"},"Utilised exposure :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.utilisedexposure)),r.a.createElement(R.a,{variant:"h6"},"Utilised holding sales :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.utilisedholdingsales)),r.a.createElement(R.a,{variant:"h6"},"Utilised option premium :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.utilisedoptionpremium)),r.a.createElement(R.a,{variant:"h6"},"Utilised payout :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.utilisedpayout)),r.a.createElement(R.a,{variant:"h6"},"Utilised span :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.utilisedspan)),r.a.createElement(R.a,{variant:"h6"},"Utilised turnover :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.utilisedturnover)))),r.a.createElement(N.a,{id:"tabledatachart",item:!0,xs:4,sm:4},r.a.createElement(Ct.a,{style:{padding:"25px"}},r.a.createElement(R.a,{variant:"h6"},"M2M Unrealized  :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.m2munrealized)),r.a.createElement(R.a,{variant:"h6"},"M2M Realized  :   ",this.state.fundData&&this.toFixedAmount(this.state.fundData.m2mrealized)))),r.a.createElement(N.a,{id:"tabledatachart",item:!0,xs:4,sm:4},r.a.createElement(Ct.a,{style:{padding:"25px"}},r.a.createElement(R.a,{variant:"h6"},"Total Capital  :   ",lt.totalCapital),r.a.createElement(R.a,{variant:"h6"},"Per Trade Exposure  :   ",lt.perTradeExposurePer,"%"),r.a.createElement(R.a,{variant:"h6"},"Per Trade Exposure  :   ",(lt.totalCapital*lt.perTradeExposurePer/100).toFixed(2))))))}}]),t}(r.a.Component),xa=Object(s.b)(function(e){return{packs:e.packs.packs.data}},{setPackLoaded:Zt})(wa),Ia=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).getTodayOrder=function(){var e=localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))||[];x.retrieveOrderBook().then(function(t){var n=Q(t,"noPop");if(n&&n.data){var r=n.data;r.sort(function(e,t){return new Date(t.updatetime)-new Date(e.updatetime)}),r.forEach(function(t){var n=e.filter(function(e){return e.tradingsymbol==t.tradingsymbol});n.length>0&&t.tradingsymbol==n[0].tradingsymbol&&(a.setState(Object(y.a)({},"priceTarget_"+t.tradingsymbol,n[0].priceTarget)),a.setState(Object(y.a)({},"priceStopLoss_"+t.tradingsymbol,n[0].priceStopLoss)))}),a.setState({oderbookData:r}),localStorage.setItem("oderbookData",JSON.stringify(r))}})},a.cancelOrderOfSame=function(e,t){var n={variety:t,orderid:e};x.cancelOrder(n).then(function(e){var t=Q(e);t.status&&"SUCCESS"===t.message&&a.getTodayOrder()})},a.modifyOrder=function(e,t){var n={variety:e.variety,orderid:e.orderid,ordertype:0!==a.state.price?"STOPLOSS_LIMIT":"STOPLOSS_MARKET",producttype:e.producttype,duration:e.duration,price:a.state.price,triggerprice:t||a.state.triggerprice,quantity:e.quantity,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,exchange:e.exchange};x.modifyOrder(n).then(function(e){var t=Q(e);t.status&&"SUCCESS"===t.message&&(a.setState({triggerprice:0}),a.getTodayOrder())})},a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value.trim()))},a.onChangePriceStopLoss=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value.trim()));for(var t=e.target.name.split("_")[1],n=localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))||[],r=!1,l=0;l<n.length;l++){var o=n[l];if(o.tradingsymbol===t){o.priceStopLoss=e.target.value.trim(),r=!0;break}}r||n.push({priceStopLoss:e.target.value.trim(),tradingsymbol:t,optiontype:t.substr(t.length-2,t.length-1),name:t.includes("BANKNIFTY")?"BANKNIFTY":"NIFTY"}),localStorage.setItem("trackSLPrice",JSON.stringify(n))},a.onChangePriceTarget=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value.trim()));for(var t=e.target.name.split("_")[1],n=localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))||[],r=!1,l=0;l<n.length;l++){var o=n[l];if(o.tradingsymbol===t){o.priceTarget=e.target.value.trim(),r=!0;break}}r||n.push({priceStopLoss:e.target.value.trim(),tradingsymbol:t,optiontype:t.substr(t.length-2,t.length-1),name:t.includes("BANKNIFTY")?"BANKNIFTY":"NIFTY"}),localStorage.setItem("trackSLPrice",JSON.stringify(n))},a.state={oderbookData:[],listofzones:[],selectedZone:[],zone:"",selectAllzone:"Select All",triggerprice:0,price:0,lotsize:0,firstTimeFlag:!0,trackSLPrice:localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))||[]},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){this.getTodayOrder()}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,"#/position-new"!==window.location.hash?r.a.createElement(Et,null):"",r.a.createElement(N.a,{spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(R.a,{color:"primary",gutterBottom:!0},"Oders Placed (",this.state.oderbookData.length,")")),r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(B.a,{id:"orderRefresh",type:"number",variant:"contained",style:{float:"right"},onClick:function(){return e.getTodayOrder()}},"Refresh"))),r.a.createElement(N.a,{direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(qe.a,{size:"small",style:{width:"100%"},"aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Update time")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Instrument")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Order Type")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Variety")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Ordertype"),"\xa0"),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Qty "),"\xa0"),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"AvgPrice"),"\xa0"),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Price"),"\xa0"),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"TriggerPrice"),"\xa0"),r.a.createElement(Qe.a,{align:"center"},"Action\xa0"),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Status"),"\xa0"),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"SLPrice"),"\xa0"),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"TargetPrice")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Details ")))),r.a.createElement(Ke.a,null,this.state.oderbookData&&this.state.oderbookData?this.state.oderbookData.map(function(t,a){return r.a.createElement(ze.a,{hover:!0,key:a},r.a.createElement(Qe.a,{align:"center"},t.updatetime?new Date(t.updatetime).toString().substring(15,25):""),r.a.createElement(Qe.a,{style:{width:"10%"},align:"center"},t.tradingsymbol),r.a.createElement(Qe.a,{align:"center"},t.transactiontype),r.a.createElement(Qe.a,{align:"center"},t.variety),r.a.createElement(Qe.a,{align:"center"},t.producttype),r.a.createElement(Qe.a,{align:"center"},t.quantity),r.a.createElement(Qe.a,{align:"center"},t.averageprice),r.a.createElement(Qe.a,{align:"center"},"trigger pending"===t.orderstatus?r.a.createElement(Y.a,{style:{textAlign:"center",width:"50px"},id:"price",value:0===e.state.price?t.price:e.state.price,name:"price",onChange:e.onChange}):t.price),r.a.createElement(Qe.a,{align:"center"},"trigger pending"===t.orderstatus||"open"===t.orderstatus?r.a.createElement(Y.a,{type:"number",style:{textAlign:"center",width:"50px"},id:"triggerprice",value:0===e.state.triggerprice?t.triggerprice:e.state.triggerprice,name:"triggerprice",onChange:e.onChange}):t.triggerprice),r.a.createElement(Qe.a,{align:"left"},"trigger pending"===t.orderstatus||"open"===t.orderstatus?r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,{size:"small",type:"number",variant:"contained",color:"primary",style:{marginLeft:"20px"},onClick:function(){return e.modifyOrder(t)}},"Update")):""),r.a.createElement(Qe.a,{style:{fontSize:"11px",width:"10%"},align:"center"},t.orderstatus,r.a.createElement("br",null),"trigger pending"===t.orderstatus||"open"===t.orderstatus?r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,{size:"small",type:"number",variant:"contained",color:"",style:{marginLeft:"20px"},onClick:function(){return e.cancelOrderOfSame(t.orderid,t.variety)}},"Cancel")):""),r.a.createElement(Qe.a,{align:"center"},"trigger pending"===t.orderstatus||"open"===t.orderstatus||"complete"===t.orderstatus?r.a.createElement(Y.a,{type:"number",style:{textAlign:"center",width:"50px"},value:e.state["priceStopLoss_"+t.tradingsymbol],name:"priceStopLoss_"+t.tradingsymbol,onBlur:e.onChangePriceStopLoss}):""),r.a.createElement(Qe.a,{align:"center"},"trigger pending"===t.orderstatus||"open"===t.orderstatus||"complete"===t.orderstatus?r.a.createElement(Y.a,{type:"number",style:{textAlign:"center",width:"50px"},value:e.state["priceTarget_"+t.tradingsymbol],name:"priceTarget_"+t.tradingsymbol,onBlur:e.onChangePriceTarget}):""),r.a.createElement(Qe.a,{style:{fontSize:"11px",width:"15%"},align:"center"},t.text))}):r.a.createElement(gt.a,null)))))))}}]),t}(r.a.Component),Da=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).getTodayTrade=function(){x.retrieveTradeBook().then(function(e){var t=Q(e);console.log("datamy",t),t&&t.data&&a.setState({oderbookData:t.data})})},a.zoneChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value)),e.target.value.includes("Select All")&&(a.setState({selectedZone:a.state.listofzones}),a.setState({selectAllzone:"Remove All"})),e.target.value.includes("Remove All")&&(a.setState({selectedZone:[]}),a.setState({selectAllzone:"Select All"}))},a.addProduct=function(e){console.log(a.props),a.props.history.push("/banner-add")},a.addProduct=a.addProduct.bind(Object(k.a)(a)),a.editProduct=a.editProduct.bind(Object(k.a)(a)),a.convertBool=a.convertBool.bind(Object(k.a)(a)),a.state={oderbookData:[],listofzones:[],selectedZone:[],zone:"",selectAllzone:"Select All"},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){this.getTodayTrade()}},{key:"editProduct",value:function(e){window.localStorage.removeItem("selectedBannerId"),window.localStorage.setItem("selectedBannerId",e),this.props.history.push("/banner-edit")}},{key:"convertBool",value:function(e){return e?"Yes":"No"}},{key:"dateFormat",value:function(e){var t=new Date(e);return t.toLocaleDateString()+" "+t.toTimeString().substring(0,t.toTimeString().indexOf("GMT"))}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement(Ct.a,{style:{padding:"10px",overflow:"auto"}},r.a.createElement(N.a,{spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(R.a,{component:"h2",variant:"h6",color:"primary",gutterBottom:!0},"Today Trades (",this.state.oderbookData.length,")")),r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(B.a,{type:"number",variant:"contained",style:{float:"right"},onClick:function(){return e.getTodayTrade()}},"Refresh"))),r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Orderid"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Product Type"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Type"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Instrument"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Qty "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Price"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Trade value"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Update time"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.oderbookData&&this.state.oderbookData?this.state.oderbookData.map(function(e){return r.a.createElement(ze.a,{key:e.productId},r.a.createElement(Qe.a,{align:"center"},e.orderid),r.a.createElement(Qe.a,{align:"center"},e.tradingsymbol),r.a.createElement(Qe.a,{align:"center"},e.transactiontype),r.a.createElement(Qe.a,{align:"center"},e.producttype),r.a.createElement(Qe.a,{align:"center"},e.fillsize),r.a.createElement(Qe.a,{align:"center"},e.fillprice),r.a.createElement(Qe.a,{align:"center"},e.tradevalue),r.a.createElement(Qe.a,{align:"center"},e.filltime))}):r.a.createElement(gt.a,null)))))}}]),t}(r.a.Component),Oa=(new Dt.w3cwebsocket("wss://smartapisocket.angelbroking.com/websocket"),function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).makeConnection=function(e){var t='{"task":"cn","channel":"NONLM","token":"'+a.state.feedToken+'","user": "'+a.state.clientcode+'","acctid":"'+a.state.clientcode+'"}';e.send(t),a.updateSocketWatch(e)},a.decodeWebsocketData=function(e){var t=[];try{for(var a=0;a<e.length;a++)t.push(String.fromCharCode(e[a]))}catch(n){}return t.join("")},a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));var t=e.target.value;x.autoCompleteSearch(t).then(function(e){var t=e.data;console.log(t),localStorage.setItem("autoSearchTemp",JSON.stringify(t)),a.setState({autoSearchList:t})})},a.myCallback=function(e,t){"START_DATE"===t?a.setState({startDate:e}):"END_DATE"===t&&a.setState({endDate:e})},a.getLTP=function(){var e={exchange:"NSE",tradingsymbol:a.state.tradingsymbol,symboltoken:a.state.symboltoken};x.getLTP(e).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;a.setState({InstrumentLTP:n})})},a.getHistory=function(e){var t=ot.duration("00:50:00"),n=ot(new Date).subtract(t),r={exchange:"NSE",symboltoken:e,interval:"FIFTEEN_MINUTE",fromdate:ot(n).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")};x.getHistoryData(r).then(function(e){var t=Q(e,"noPop");if(console.log(t),t&&t.data){var n=t.data;n&&n.sort(function(e,t){return new Date(t[0])-new Date(e[0])}),n.length>0&&(localStorage.setItem("InstrumentHistroy",JSON.stringify(n)),a.setState({InstrumentHistroy:n,buyPrice:n[0][2]})),a.getLTP()}})},a.updateSocketWatch=function(e){var t=[];a.state.symbolList.forEach(function(e,a){t.push("nse_cm|"+e.token)}),t=t.join("&");var n={task:"sfi",channel:"nse_cm|Nifty 50&nse_cm|Nifty Bank",token:a.state.feedToken,user:a.state.clientcode,acctid:a.state.clientcode};e.send(JSON.stringify(n))},a.updateSocketDetails=function(e){e.onopen=function(t){a.makeConnection(e),a.updateSocketWatch(e)},e.onmessage=function(e){var t=window.atob(e.data),n=a.decodeWebsocketData(Pt.a.inflate(t)),r=JSON.parse(n),l=a.state.symbolList;a.state.symbolList&&a.state.symbolList.forEach(function(e,t){var n=r.filter(function(t){return t.tk==e.name});n.length>0&&n[0].tvalue&&(l[t].tvalue=n[0].tvalue,l[t].cng=n[0].cng,l[t].iv=n[0].iv,l[t].tk=n[0].tk,l[t].nc=n[0].nc,"Nifty Bank"==n[0].tk&&a.props.getBankNiftyLiveLtp(n[0]))}),a.setState({symbolList:l},function(){})},e.onerror=function(e){console.log("socket error",e),a.makeConnection(a.wsClint)},setInterval(function(){console.log("this.wsClint",a.wsClint),1!=a.wsClint.readyState&&a.makeConnection(a.wsClint);var t='{"task":"hb","channel":"","token":"'+a.state.feedToken+'","user": "'+a.state.clientcode+'","acctid":"'+a.state.clientcode+'"}';console.log("Request :- "+t),e.send(t)},59e3)},a.state={symbolList:[{token:"26009",symbol:"Nifty 50",name:"Nifty 50"},{token:"26000",symbol:"Nifty Bank",name:"Nifty Bank"}]},a.myCallback=a.myCallback.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=JSON.parse(localStorage.getItem("userTokens")),t=e&&e.feedToken,a=JSON.parse(localStorage.getItem("userProfile")),n=a&&a.clientcode;this.setState({feedToken:t,clientcode:n},function(){this.wsClint=new Dt.w3cwebsocket("wss://omnefeeds.angelbroking.com/NestHtml5Mobile/socket/stream"),this.updateSocketDetails(this.wsClint)}),localStorage.getItem("watchList")||localStorage.setItem("watchList",[])}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(N.a,{spacing:1,alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:10,sm:12},r.a.createElement(Ct.a,{style:{overflow:"auto"}},r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Index "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Val"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Change"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Time"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.symbolList?this.state.symbolList.map(function(e,t){return r.a.createElement(ze.a,{style:{background:e.nc>0?"chartreuse":"cora"},key:t},r.a.createElement(Qe.a,{align:"center"},e.name),r.a.createElement(Qe.a,{align:"center"},e.iv,"(",e.nc,"%)"),r.a.createElement(Qe.a,{align:"center"},e.cng),r.a.createElement(Qe.a,{align:"center"},e.tvalue))}):""))))))}}]),t}(r.a.Component)),Pa=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})(function(e){var t=e.children,a=e.classes,n=e.onClose,l=Object(He.a)(e,["children","classes","onClose"]);return r.a.createElement(Re.a,Object.assign({disableTypography:!0,className:a.root},l),r.a.createElement(R.a,{variant:"h6"},t),n?r.a.createElement(ie.a,{"aria-label":"close",className:a.closeButton,onClick:n},r.a.createElement(Je.a,null)):null)}),Fa=Object(je.a)(function(e){return{root:{padding:e.spacing(2)}}})(Ue.a),Na=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(1)}}})(_e.a);function Ma(e){var t=r.a.useState(!1),a=Object(ae.a)(t,2),n=a[0],l=a[1],o=r.a.useState({data:[],candledata:{}}),s=Object(ae.a)(o,2),i=(s[0],s[1],function(){l(!1)}),c=localStorage.getItem("multipleChartData")&&JSON.parse(localStorage.getItem("multipleChartData")),m=c&&c.longCandles,u=c&&c.shortCandles;return r.a.createElement("div",null,r.a.createElement(B.a,{variant:"outlined",id:"showMultipleChart",color:"primary",style:{display:"none"},onClick:function(){l(!0)}},"Chart"),r.a.createElement(We.a,{maxWidth:"lg",onClose:i,"aria-labelledby":"customized-dialog-title",open:n},r.a.createElement(Pa,{id:"customized-dialog-title",onClose:i},c&&c.symbol),r.a.createElement(Fa,{dividers:!0},r.a.createElement(R.a,{component:"h3",variant:"h6",color:"primary",gutterBottom:!0},"Longs (",m&&m.length,")"),r.a.createElement(N.a,{justify:"space-between",container:!0,direction:"row"},m?m.map(function(e,t){return r.a.createElement(N.a,{item:!0},r.a.createElement(Xe.a,{options:{chart:{type:"candlestick",height:250},title:{text:e.foundAt.substr(6,10),align:"left"},xaxis:{type:"datetime"},yaxis:{tooltip:{enabled:!0}}},series:[{data:e.candleChartData.reverse()}],type:"candlestick",width:250,height:250}))}):""),r.a.createElement(R.a,{component:"h3",variant:"h6",color:"primary",gutterBottom:!0},"Shorts (",u&&u.length,")"),r.a.createElement(N.a,{justify:"space-between",container:!0,direction:"row"},u?u.map(function(e,t){return r.a.createElement(N.a,{item:!0},r.a.createElement(Xe.a,{options:{chart:{type:"candlestick",height:250},title:{text:e.foundAt.substr(6,10),align:"left"},xaxis:{type:"datetime"},yaxis:{tooltip:{enabled:!0}}},series:[{data:e.candleChartData.reverse()}],type:"candlestick",width:250,height:250}))}):"")),r.a.createElement(Na,null,r.a.createElement(B.a,{autoFocus:!0,onClick:i,color:"primary"},"Close"))))}var Ba=a(104),Aa=a.n(Ba),Ya=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).checkOpenEqualToLow=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=a.state.staticData["NIFTY 100"],a.setState((t={openEqualHighList:[],openEqualLowList:[]},Object(y.a)(t,"openEqualLowList",[]),Object(y.a)(t,"advanceShareCount",0),Object(y.a)(t,"declineShareCount",0),Object(y.a)(t,"UnchangeShareCount",0),Object(y.a)(t,"volumeCrossedList",[]),Object(y.a)(t,"closeingEqualHighList",[]),t)),r=$.a.mark(function e(t){var r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=n[t],o=!1,l=0;l<a.state.positionList.length;l++)a.state.positionList[l].tradingsymbol===r.symbol&&(o=!0);return o||(s={exchange:r.exch_seg,tradingsymbol:r.symbol,symboltoken:r.token},x.getLTP(s).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;if(n){var l=(100*(n.ltp-n.close)/n.close).toFixed(2);if(n.nc=l,n.symbol=r.symbol,n&&n.open===n.low){var o=ot(new Date),s=ot(o,"DD-MM-YYYY").subtract(7,"days"),i={exchange:"NSE",symboltoken:r.token,interval:"ONE_DAY",fromdate:ot(s).format("YYYY-MM-DD HH:mm"),todate:ot(o).format("YYYY-MM-DD HH:mm")};x.getHistoryData(i).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){var l=t.data;l.reverse(),console.log("lastday",r,l[1]);var o=l[1];if(n.ltp>o[2]){var s=o[3]-o[3]/10/100;s=a.getMinPriceAllowTick(s);var i=lt.totalCapital*lt.perTradeExposurePer/100;console.log(r.symbol+"ltp "+n.ltp,"quantity",1,"stopLossPrice",s,"perTradeExposureAmt",i);var c={transactiontype:"BUY",tradingsymbol:r.symbol,symboltoken:r.token,buyPrice:0,quantity:1,stopLossPrice:s};n.ltp>=200&&n.ltp<=1e4&&s&&a.placeOrderMethod(c)}}else console.log(" candle data emply")})}if(n&&n.open===n.high){var c=ot(new Date),m=ot(c,"DD-MM-YYYY").subtract(7,"days");i={exchange:"NSE",symboltoken:r.token,interval:"ONE_DAY",fromdate:ot(m).format("YYYY-MM-DD HH:mm"),todate:ot(c).format("YYYY-MM-DD HH:mm")};x.getHistoryData(i).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){var l=t.data;l.reverse(),console.log("lastday",r,l[1]);var o=l[1];if(n.ltp<o[3]){var s=o[2]+o[2]/10/100;s=a.getMinPriceAllowTick(s);var i=lt.totalCapital*lt.perTradeExposurePer/100;console.log(r.symbol+"ltp "+n.ltp,"quantity",1,"stopLossPrice",s,"perTradeExposureAmt",i);var c={transactiontype:"SELL",tradingsymbol:r.symbol,symboltoken:r.token,buyPrice:0,quantity:1,stopLossPrice:s};n.ltp>=200&&n.ltp<=1e4&&s&&a.placeOrderMethod(c)}}else console.log(" candle data emply")})}}})),e.next=6,new Promise(function(e){return setTimeout(e,210)});case 6:case"end":return e.stop()}},e)}),l=0;case 4:if(!(l<n.length)){e.next=9;break}return e.delegateYield(r(l),"t0",6);case 6:l++,e.next=4;break;case 9:case"end":return e.stop()}},e)})),a.getCandleHistoryAndStore=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s,i;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("getCandleHistoryAndStore called",(new Date).toLocaleTimeString()),(new Date).toLocaleTimeString()>"15:00:00"?clearInterval(a.state.candleHistoryInterval):"",t=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList")),n=ot().isoWeekday(),r="",r=(new Date).toLocaleTimeString()>"10:05:00"?ot.duration("00:50:00"):1===n&&(new Date).toLocaleTimeString()<"10:05:00"?ot.duration("66:00:00"):ot.duration("19:00:00"),r=ot.duration("21:00:00"),"YYYY-MM-DD HH:mm",l=ot(new Date).subtract(r),o=$.a.mark(function e(n){var r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[n],i={exchange:"NSE",symboltoken:r.token,interval:"FIFTEEN_MINUTE",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(i).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){var l=t.data;if(l.reverse(),l&&l.length>=10){var o=l.slice(0,10);console.log("",n+1,r.symbol,"Time",(new Date).toLocaleTimeString()),a.findTweezerTopPatternLive(o,r.symbol),a.findTweezerBottomPatternLive(o,r.symbol)}}else console.log(" candle data emply")}),e.next=5,new Promise(function(e){return setTimeout(e,350)});case 5:case"end":return e.stop()}},e)}),s=0;case 11:if(!(s<t.length)){e.next=16;break}return e.delegateYield(o(s),"t0",13);case 13:s++,e.next=11;break;case 16:case"end":return e.stop()}},e)})),a.findTweezerTopPatternLive=function(e,t){if(e&&e.length>0){for(var n=e[2]&&e[2][2],r=e[2]&&e[2][3],l=3;l<e.length;l++)n<e[l][2]&&(n=e[l][2]),e[l][3]<r&&(r=e[l][3]);var o=e[9][3],s=e[2][2],i={time:e[0]&&e[0][0],open:e[0]&&e[0][1],high:e[0]&&e[0][2],low:e[0]&&e[0][3],close:e[0]&&e[0][4]},c={time:e[1]&&e[1][0],open:e[1]&&e[1][1],high:e[1]&&e[1][2],low:e[1]&&e[1][3],close:e[1]&&e[1][4]},m=100*(s-o)/o;if(m>=1.5&&n<(c.high<i.high?c.high:i.high)&&r<(c.low<i.low?c.low:i.low)&&c.open<c.close&&i.open>i.close&&(Math.round(c.close)==Math.round(i.open)||Math.round(c.open)==Math.round(i.close))){console.log("%c"+t+" perfect twisser top  upside movement"+m+new Date(e[0][0]).toLocaleTimeString(),"background: red; color: #bada55");var u=[];e.forEach(function(e){u.push([e[0],e[1],e[2],e[3],e[4]])});var d={symbol:t,pattenName:"Twisser Top",time:new Date(e[0][0]).toLocaleString(),candleChartData:u},g=localStorage.getItem("foundPatternList")?JSON.parse(localStorage.getItem("foundPatternList")):[];g.push(d),localStorage.setItem("foundPatternList",JSON.stringify(g)),a.setState({foundPatternList:[].concat(Object(ee.a)(a.state.foundPatternList),[d])}),console.log(t,"last10Candle",e)}}},a.findTweezerBottomPatternLive=function(e,t){if(e&&e.length>0){for(var n=e[2]&&e[2][2],r=e[2]&&e[2][3],l=3;l<e.length;l++)n<e[l][2]&&(n=e[l][2]),e[l][3]<r&&(r=e[l][3]);var o=e[9][2],s=e[2][3],i={time:e[0]&&e[0][0],open:e[0]&&e[0][1],high:e[0]&&e[0][2],low:e[0]&&e[0][3],close:e[0]&&e[0][4]},c={time:e[1]&&e[1][0],open:e[1]&&e[1][1],high:e[1]&&e[1][2],low:e[1]&&e[1][3],close:e[1]&&e[1][4]},m=(100*(s-o)/o).toFixed(2);if(m<=-1.5&&(c.high<i.high?c.high:i.high)<n&&(c.low<i.low?c.low:i.low)<r&&c.open>c.close&&i.close>i.open&&(Math.round(c.close)==Math.round(i.open)||Math.round(c.open)==Math.round(i.close))){var u=[];e.forEach(function(e){u.push([e[0],e[1],e[2],e[3],e[4]])}),console.log("%c"+t+" perfect twisser bottom downside movement diff "+m+"% "+new Date(e[0][0]).toLocaleTimeString(),"background: #222; color: #bada55");var d={symbol:t,pattenName:"Twisser bottom",time:new Date(e[0][0]).toLocaleString(),candleChartData:u};a.setState({foundPatternList:[].concat(Object(ee.a)(a.state.foundPatternList),[d])});var g=localStorage.getItem("foundPatternList")?JSON.parse(localStorage.getItem("foundPatternList")):[];g.push(d),localStorage.setItem("foundPatternList",JSON.stringify(g)),console.log(t,"last10Candle",e)}}},a.findNR4PatternLive=Object(te.a)($.a.mark(function e(){var t,n,l,o,s,i,c,m;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("nr4 scaning starting"),a.setState({backTestResult:[],backTestFlag:!1}),t=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))||[],1,n=0,l=$.a.mark(function e(n){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=t[n],"",i=ot.duration("240:00:00"),s=ot(new Date).subtract(i),c=ot.duration("24:00:00"),ot(new Date).subtract(c),m={exchange:"NSE",symboltoken:l.token,interval:"ONE_DAY",fromdate:ot(s).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(m).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){var o=t.data,s=0;o.reverse();var i=o.slice(1,5),c=o.slice(0,5);if(i.length>=4){var m=[],u=[];i.forEach(function(e){m.push(e[2]-e[3])}),c.forEach(function(e){u.push([e[0],e[1],e[2],e[3],e[4]])});var d=m[0];if(m.forEach(function(e){d<=e&&(d=e,s+=1)}),console.log(n+1,l.symbol,s),4==s){console.log(n+1,l.symbol,i,m,s);var g=i[0],h=(g[2]+g[2]/100/10).toFixed(2),p=(g[3]-g[3]/100/10).toFixed(2),f={exchange:"NSE",tradingsymbol:l.symbol,symboltoken:l.token};console.log("nr4 ltp",f),x.getLTP(f).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;if(console.log(n,t),n&&n.ltp){var o,s=r.a.createElement("span",null," ",n.ltp," "),i=0,c=0,m=0;if(n.ltp>h){s=r.a.createElement("span",{style:{color:"green"}}," Long: ",n.ltp," (",(100*(n.ltp-h)/h).toFixed(2),"%) "),a.setState({nr4TotalPer:a.state.nr4TotalPer+100*(n.ltp-h)/h}),a.setState({totelActivatedCount:a.state.totelActivatedCount+1});var d=lt.totalCapital*lt.perTradeExposurePer/100;i=Math.floor(d/h),o=100*(n.ltp-h)/h,c=((n.ltp-h)*i).toFixed(2),m=(h*(o-.06)/100*i).toFixed(2)}if(n.ltp<p){s=r.a.createElement("span",{style:{color:"red"}}," Short: ",n.ltp," (",(100*(n.ltp-p)/p).toFixed(2),"%)"),a.setState({nr4TotalPer:a.state.nr4TotalPer+100*(p-n.ltp)/p}),a.setState({totelActivatedCount:a.state.totelActivatedCount+1});var f=lt.totalCapital*lt.perTradeExposurePer/100;i=Math.floor(f/p),c=((p-n.ltp)*i).toFixed(2),o=100*(p-n.ltp)/p,m=(p*(o-.06)/100*i).toFixed(2)}var y={symbol:l.symbol,token:l.token,pattenName:"NR4",time:new Date(g[0]).toLocaleString(),BuyAt:h,SellAt:p,orderActivated:s,candleChartData:u,quantity:i,brokerageCharges:.06,pnlAmount:c,netPnLAmount:m,perChange:o};console.log("nr4 scaned",y),a.setState({foundPatternList:[].concat(Object(ee.a)(a.state.foundPatternList),[y])});var b=localStorage.getItem("foundPatternList")?JSON.parse(localStorage.getItem("foundPatternList")):[];b.push(y),localStorage.setItem("foundPatternList",JSON.stringify(b))}})}}}else console.log(l.symbol," candle data emply")}),e.next=10,new Promise(function(e){return setTimeout(e,300)});case 10:case"end":return e.stop()}},e)}),o=0;case 6:if(!(o<t.length)){e.next=11;break}return e.delegateYield(l(o),"t0",8);case 8:o++,e.next=6;break;case 11:a.setState({backTestFlag:!0}),console.log("sumPercentage",n);case 13:case"end":return e.stop()}},e)})),a.findNR7PatternLive=Object(te.a)($.a.mark(function e(){var t,n,l,o,s,i,c,m,u;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("nr7 scaning starting"),a.setState({backTestResult:[],backTestFlag:!1}),t=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))||[],1,n=0,l=$.a.mark(function e(n){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=t[n],"",i=ot.duration("288:00:00"),s=ot(new Date).subtract(i),c=ot.duration("24:00:00"),ot(new Date).subtract(c),m={exchange:"NSE",symboltoken:l.token,interval:"ONE_DAY",fromdate:ot(s).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(m).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){var n=t.data;n.reverse();var o=n.slice(1,8),s=n.slice(0,9);if(o.length>=7){var i=[],c=[];o.forEach(function(e){i.push(e[2]-e[3])}),s.forEach(function(e){c.push([e[0],e[1],e[2],e[3],e[4]])});var m=i[0],u=0;if(i.forEach(function(e){m<=e&&(m=e,u+=1)}),console.log(l.symbol,o,i,u),7==u){var d=o[0],g=(d[2]+d[2]/100/10).toFixed(2),h=(d[3]-d[3]/100/10).toFixed(2),p={exchange:"NSE",tradingsymbol:l.symbol,symboltoken:l.token};console.log("nr4 ltp",p),x.getLTP(p).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;if(console.log(n,t),n&&n.ltp){var o,s=r.a.createElement("span",null," ",n.ltp," "),i=0,m=0,u=0;if(n.ltp>g){s=r.a.createElement("span",{style:{color:"green"}}," Long: ",n.ltp," (",(100*(n.ltp-g)/g).toFixed(2),"%) "),a.setState({nr4TotalPer:a.state.nr4TotalPer+100*(n.ltp-g)/g}),a.setState({totelActivatedCount:a.state.totelActivatedCount+1});var p=lt.totalCapital*lt.perTradeExposurePer/100;i=Math.floor(p/g),o=100*(n.ltp-g)/g,m=((n.ltp-g)*i).toFixed(2),u=(g*(o-.06)/100*i).toFixed(2)}if(n.ltp<h){s=r.a.createElement("span",{style:{color:"red"}}," Short: ",n.ltp," (",(100*(n.ltp-h)/h).toFixed(2),"%)"),a.setState({nr4TotalPer:a.state.nr4TotalPer+100*(h-n.ltp)/h}),a.setState({totelActivatedCount:a.state.totelActivatedCount+1});var f=lt.totalCapital*lt.perTradeExposurePer/100;i=Math.floor(f/h),m=((h-n.ltp)*i).toFixed(2),o=100*(h-n.ltp)/h,u=(h*(o-.06)/100*i).toFixed(2)}var y={symbol:l.symbol,token:l.token,pattenName:"NR7",time:new Date(d[0]).toLocaleString(),BuyAt:g,SellAt:h,orderActivated:s,candleChartData:c,quantity:i,brokerageCharges:.06,pnlAmount:m,netPnLAmount:u,perChange:o};console.log("nr7 scaned",y),a.setState({foundPatternList:[].concat(Object(ee.a)(a.state.foundPatternList),[y])});var b=localStorage.getItem("foundPatternList")?JSON.parse(localStorage.getItem("foundPatternList")):[];b.push(y),localStorage.setItem("foundPatternList",JSON.stringify(b))}})}}}else console.log(l.symbol," candle data emply")}),u=n+1+". "+l.symbol,a.setState({stockTesting:u}),e.next=12,new Promise(function(e){return setTimeout(e,300)});case 12:case"end":return e.stop()}},e)}),o=0;case 6:if(!(o<t.length)){e.next=11;break}return e.delegateYield(l(o),"t0",8);case 8:o++,e.next=6;break;case 11:a.setState({backTestFlag:!0}),console.log("sumPercentage",n);case 13:case"end":return e.stop()}},e)})),a.refreshCandleChartManually=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=ot("9:15am","h:mma"),r=ot.duration("12:00:00"),ot(new Date).subtract(r),l={exchange:"NSE",symboltoken:t.symboltoken,interval:"FIVE_MINUTE",fromdate:ot(n).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(l).then(function(e){var a=Q(e,"noPop");if(a&&a.data&&a.data.length){var n=[];a.data.forEach(function(e){n.push([e[0],e[1],e[2],e[3],e[4]])}),localStorage.setItem("candleChangeShow",(100*(t.ltp-t.close)/t.close).toFixed(2)),localStorage.setItem("candleChartData",JSON.stringify(n)),localStorage.setItem("cadleChartSymbol",t.symbolname),document.getElementById("showCandleChart").click()}else console.log(t.symboltoken,"  emply candle found")}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),z.showError(t.symboltoken+" candle failed!")});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.showCandleChart=function(e,t){e=e&&e.reverse(),localStorage.setItem("candleChartData",JSON.stringify(e)),localStorage.setItem("cadleChartSymbol",t),document.getElementById("showCandleChart").click()},a.showMultipleCandleChart=function(e){localStorage.setItem("multipleChartData",JSON.stringify(e)),document.getElementById("showMultipleChart").click()},a.refreshLtpOnFoundPattern=Object(te.a)($.a.mark(function e(){var t,n,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({nr4TotalPer:0,totalBrokerChargesNR4:0,totalNetProfit:0,totelActivatedCount:0,pnlAmountTotal:0,perHighLowTotal:0,netPnLAmountOnHighlowTotal:0}),t=a.state.foundPatternList,a.setState({foundPatternList:[]}),n=localStorage.getItem("FoundPatternList")?JSON.parse(localStorage.getItem("FoundPatternList")):[],l=$.a.mark(function e(n){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(l=t[n])&&"NR4"==l.pattenName&&(s={exchange:"NSE",tradingsymbol:l.symbol,symboltoken:l.token},x.getLTP(s).then(function(e){var t=Q(e,"noPop"),n=t&&t.data,o=0,s=0,i=0,c=.06,m=0,u=0,d=0;if(n&&n.ltp){var g=r.a.createElement("span",null," ",n.ltp," ");if(n.ltp>l.BuyAt)m=100*(n.ltp-l.BuyAt)/l.BuyAt,g=r.a.createElement("span",{style:{color:"green"}}," Long: ",m.toFixed(2),"% "),o=Math.floor(1e4/l.BuyAt),i=(s=(n.ltp-l.BuyAt)*o)-(c=l.BuyAt*o*c/100*2),a.setState({nr4TotalPer:a.state.nr4TotalPer+m}),a.setState({totalBrokerChargesNR4:a.state.totalBrokerChargesNR4+c,totalNetProfit:a.state.totalNetProfit+i}),a.setState({totelActivatedCount:a.state.totelActivatedCount+1,pnlAmountTotal:a.state.pnlAmountTotal+s}),u=100*(n.high-l.BuyAt)/l.BuyAt,d=(n.high-l.BuyAt)*o-c,a.setState({perHighLowTotal:a.state.perHighLowTotal+u,netPnLAmountOnHighlowTotal:a.state.netPnLAmountOnHighlowTotal+d});if(n.ltp<l.SellAt)m=100*(l.SellAt-n.ltp)/l.SellAt,g=r.a.createElement("span",{style:{color:"red"}}," Short: ",m.toFixed(2),"%"),o=Math.floor(1e4/l.SellAt),i=(s=(l.SellAt-n.ltp)*o)-(c=l.SellAt*o*c/100*2),a.setState({nr4TotalPer:a.state.nr4TotalPer+m}),a.setState({totelActivatedCount:a.state.totelActivatedCount+1,pnlAmountTotal:a.state.pnlAmountTotal+s}),a.setState({totalBrokerChargesNR4:a.state.totalBrokerChargesNR4+c,totalNetProfit:a.state.totalNetProfit+i}),u=100*(l.SellAt-n.low)/l.SellAt,d=(l.SellAt-n.low)*o-c,a.setState({perHighLowTotal:a.state.perHighLowTotal+u,netPnLAmountOnHighlowTotal:a.state.netPnLAmountOnHighlowTotal+d});var h=100*(n.ltp-n.close)/n.close,p=[new Date,n.open,n.high,n.low,n.ltp];l.candleChartData.push(p);var f={symbol:l.symbol,symbolUpdated:n.ltp+"("+h.toFixed(2)+"%)",token:l.token,pattenName:"NR4",OnHighLowActivated:o?u.toFixed(2)+"% | "+d.toFixed(2):"",time:(new Date).toLocaleTimeString(),BuyAt:l.BuyAt,SellAt:l.SellAt,foundAt:l.foundAt,orderActivated:g,candleChartData:l.candleChartData,quantity:o||"",brokerageCharges:o?c.toFixed(2):"",pnlAmount:s?s.toFixed(2):"",netPnLAmount:i?i.toFixed(2):"",perChange:m,todayChange:h,pastPerferm:l.pastPerferm};console.log("nr4 updated",f),a.setState({foundPatternList:[].concat(Object(ee.a)(a.state.foundPatternList),[f])});var y=a.state.foundPatternList;y.sort(function(e,t){return t.perChange-e.perChange}),a.setState({foundPatternList:y});var b=localStorage.getItem("foundPatternList")?JSON.parse(localStorage.getItem("foundPatternList")):[];b.push(f),localStorage.setItem("foundPatternList",JSON.stringify(b))}}).catch(function(e){z.showError(l.symbol+" ltd data not found!")})),e.next=4,new Promise(function(e){return setTimeout(e,101)});case 4:case"end":return e.stop()}},e)}),o=0;case 6:if(!(o<n.length)){e.next=11;break}return e.delegateYield(l(o),"t0",8);case 8:o++,e.next=6;break;case 11:case"end":return e.stop()}},e)})),a.getStoplossFromOrderbook=function(e){var t=localStorage.getItem("oderbookData");t=JSON.parse(t);for(var a={},n=0;n<t.length;n++){var r=t[n];if("trigger pending"===r.status&&r.symboltoken===e.symboltoken){e.netqty>0?(a.stopLoss=r.triggerprice+"("+(100*(r.triggerprice-e.buyavgprice)/e.buyavgprice).toFixed(2)+"%)",a.maxLossAmount=((r.triggerprice-e.buyavgprice)*parseInt(e.netqty)).toFixed(2)):e.netqty<0&&(console.log(e.tradingsymbol,"sellage",e.sellavgprice,"trigger",r.triggerprice),a.stopLoss=r.triggerprice+"("+(100*(r.triggerprice-e.sellavgprice)/e.sellavgprice).toFixed(2)+"%)",a.maxLossAmount=((r.triggerprice-e.sellavgprice)*parseInt(e.netqty)).toFixed(2));break}}return a},a.getStoplossForSELLFromOrderbook=function(e){var t=localStorage.getItem("oderbookData");t=JSON.parse(t);var a={};return t.forEach(function(t){"trigger pending"===t.status&&t.symboltoken===e.symboltoken&&(a.stopLoss=t.triggerprice+"("+(100*(e.buyavgprice-t.triggerprice)/e.buyavgprice).toFixed(2)+"%)",a.maxLossAmount=((t.triggerprice-e.buyavgprice)*parseInt(e.netqty)).toFixed(2))}),a},a.getHighLowPercentage=Object(te.a)($.a.mark(function e(){var t,n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({showHighLowWisePer:!0}),a.state.positionList.length||z.showError("First Refresh Position"),t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("DELIVERY"!=(n=a.state.positionList[t]).producttype){e.next=3;break}return e.abrupt("return",{v:""});case 3:return r={exchange:"NSE",tradingsymbol:n.tradingsymbol,symboltoken:n.symboltoken},x.getLTP(r).then(function(e){var n=Q(e,"noPop"),r=n&&n.data;r&&r.ltp&&(a.state.positionList[t].high=r.high,a.state.positionList[t].low=r.low)}),e.next=7,new Promise(function(e){return setTimeout(e,125)});case 7:a.setState({positionList:a.state.positionList});case 8:case"end":return e.stop()}},e)}),n=0;case 4:if(!(n<a.state.positionList.length)){e.next=12;break}return e.delegateYield(t(n),"t0",6);case 6:if("object"!==typeof(l=e.t0)){e.next=9;break}return e.abrupt("return",l.v);case 9:n++,e.next=4;break;case 12:case"end":return e.stop()}},e)})),a.tagPatternWhichTaken=function(e){for(var t=localStorage.getItem("orderTagToPosition")&&JSON.parse(localStorage.getItem("orderTagToPosition"))||[],a="",n=0;n<t.length;n++){var r=t[n];if(e==r.token){a=r.pattenName;break}}return a},a.calculateTradeExpence=function(e){var t=0===parseFloat(e.totalbuyvalue)?parseFloat(e.totalsellvalue):parseFloat(e.totalbuyvalue),a=.25*parseFloat(t)/100;(a>20||"CE"==e.optiontype||"PE"==e.optiontype)&&(a=20);var n=0===parseFloat(e.totalsellvalue)?parseFloat(e.totalbuyvalue):parseFloat(e.totalsellvalue),r=.25*parseFloat(n)/100;(r>20||"CE"==e.optiontype||"PE"==e.optiontype)&&(r=20);var l=t+n,o=a+r,s=.025;"CE"!=e.optiontype&&"PE"!=e.optiontype||(s=.05);var i=n*s/100,c=.00335*l/100,m=.003*t/100,u=10*l/1e7,d=18*(o+c+u)/100,g=o+i+c+m+u+d;return{tradeExpence:g,expenceInfo:"Brokerage: "+o.toFixed(2)+" \nSTT: "+i.toFixed(2)+" \nTransaction: "+c.toFixed(2)+" \nStamp Duty: "+m.toFixed(2)+" \nSebi: "+u.toFixed(2)+" \nGST: "+d.toFixed(2)+" \n\nTotal: "+g.toFixed(2)}},a.refreshBasedAmount=function(){var e=0,t=0,n=0;a.state.positionList.forEach(function(r){var l=a.state.checkAmountPer?a.state.checkAmountPer:r.percentPnL;r.checkAmount=(a.state.checkAmount*l/100).toFixed(2),e+=parseFloat(r.checkAmount);var o=Math.floor(a.state.checkAmount/r.buyavgprice);r.checkQty=o,r.totalbuyvalue=o*r.buyavgprice,r.totalsellvalue=o*r.sellavgprice,r.checkExpence=a.calculateTradeExpence(r),r.checkExpence&&(r.checkNet=r.checkAmount-r.checkExpence.tradeExpence,n+=r.checkExpence.tradeExpence,t+=parseFloat(r.checkNet)),console.log(r)}),a.setState({totCheckAmount:e.toFixed(2),checkTotalNet:t.toFixed(2),totCheckExp:n.toFixed(2),positionList:a.state.positionList})},a.checkSLOrTarget=function(e){var t=localStorage.getItem("trackSLPrice")?JSON.parse(localStorage.getItem("trackSLPrice")):[];if(t.length>0)for(var n=0;n<t.length;n++){var r=t[n];"EQ"==r.optiontype&&r.tradingsymbol==e.tradingsymbol&&(e.ltp<parseFloat(r.priceStopLoss)||e.ltp>=parseFloat(r.priceTarget))&&(console.log("checkSLOrTarget",r,r.tradingsymbol==e.tradingsymbol,e.ltp,e.ltp<parseFloat(r.priceStopLoss)||e.ltp>=parseFloat(r.priceTarget)),a.squareOff(e))}},a.getPositionData=Object(te.a)($.a.mark(function e(){var t;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:0,t=0,localStorage.getItem("trackSLPrice")?JSON.parse(localStorage.getItem("trackSLPrice")):[],x.getPosition().then(function(e){var n=Q(e,"noPop"),r=n&&n.data;if(r&&r.length>0){for(var l=0,o=0,s=0,i=0,c=0,m=0,u=0,d=0,g=[],h=0;h<r.length;h++){var p=r[h];if(g.push(p),l+=parseFloat(p.pnl),o+=parseFloat(p.totalbuyvalue),s+=0===parseFloat(p.totalsellvalue)?parseFloat(p.totalbuyvalue):parseFloat(p.totalsellvalue),i+=parseInt(p.buyqty),c+=parseFloat(p.buyavgprice),m+=parseFloat(p.sellavgprice),0==p.netqty){var f=100*(parseFloat(p.sellavgprice)-parseFloat(p.buyavgprice))/parseFloat(p.buyavgprice);p.percentPnL=f.toFixed(2),u+=parseFloat(f),localStorage.removeItem("firstTimeModify"+p.tradingsymbol),localStorage.removeItem("lastTriggerprice_"+p.tradingsymbol)}p.pattenName=a.tagPatternWhichTaken(p.symboltoken);var y=a.calculateTradeExpence(p);p.tradeExpence=y.tradeExpence.toFixed(2),p.expenceInfo=y.expenceInfo,d+=y.tradeExpence;var b=a.getStoplossFromOrderbook(p);b&&(p.stopLoss=b.stopLoss,p.stopLossAmount=b.maxLossAmount,t+=parseFloat(b.maxLossAmount)?parseFloat(b.maxLossAmount):0),a.checkSLOrTarget(p)}a.setState({todayProfitPnL:l.toFixed(2),totalbuyvalue:o.toFixed(2),totalsellvalue:s.toFixed(2),totalQtyTraded:i}),a.setState({allbuyavgprice:(c/r.length).toFixed(2),allsellavgprice:(m/r.length).toFixed(2),totalPercentage:u});a.setState({totalExpence:d.toFixed(2)}),a.setState({totalTornOver:(o+s).toFixed(2),totalMaxPnL:t.toFixed(2)}),g.sort(function(e,t){return t.netqty-e.netqty}),a.setState({positionList:g})}});case 3:case"end":return e.stop()}},e)})),a.getNSETopStock=function(){(new Date).toLocaleTimeString()>"15:00:00"&&clearInterval(a.state.scaninterval);var e=lt.totalCapital*lt.dailyLossPer/100;e=-Math.abs(e),a.state.todayProfitPnL<e?(console.log("daily loss crossed",e),clearInterval(a.state.scaninterval)):x.getNSETopStock().then(function(e){var t=Q(e,"noPop");if(t.status&&"SUCCESS"===t.message){var n=t.result;if(n&&n.length)for(var r=function(e){o=!1;for(var t=0;t<a.state.positionList.length;t++)a.state.positionList[t].symbolname===n[e].symbolName&&(o=!0);o||localStorage.getItem("NseStock_"+n[e].symbolName)||x.autoCompleteSearch(n[e].symbolName).then(function(t){var r=t.data.filter(function(t){return"NSE"===t.exch_seg&&"1"===t.lotsize&&t.name===n[e].symbolName});r.length&&(console.log(r[0].symbol,"found",r),localStorage.setItem("NseStock_"+n[e].symbolName,"orderdone"),a.historyWiseOrderPlace(r[0].token,r[0].symbol,n[e].symbolName))})},l=0;l<n.length;l++){var o;r(l)}}})},a.getChartInkStock=function(){(new Date).toLocaleTimeString()>"15:00:00"&&clearInterval(a.state.scaninterval);var e=lt.totalCapital*lt.dailyLossPer/100;e=-Math.abs(e),a.state.todayProfitPnL<e?(console.log("daily loss crossed",e),clearInterval(a.state.scaninterval)):x.getChartInkStock().then(function(e){var t,n,r=e.data;r.success&&function(){var e=r.results[0]&&r.results[0].body.data.triggered_at,l=r.results[0]&&r.results[0].body.data.stocks,o=e.split(" "),s=o[0]+o[1];if(t=ot(s,"h:mma"),console.log("last triggered_at ",e,"stock found",l,t.minutes(),(new Date).getMinutes()),t.minutes()==(new Date).getMinutes()){l=l.split(",");for(var i=function(e){n=!1;for(var t=0;t<a.state.positionList.length;t++)a.state.positionList[t].symbolname===l[e].symbolName&&(n=!0);n||localStorage.getItem("NseStock_"+l[e])||x.autoCompleteSearch(l[e]).then(function(t){var n=t.data.filter(function(t){return"NSE"===t.exch_seg&&"1"===t.lotsize&&t.name===l[e]});n.length&&(console.log(n[0].symbol,"found",n),localStorage.setItem("NseStock_"+l[e],"orderdone"),a.historyWiseOrderPlace(n[0].token,n[0].symbol,l[e]))})},c=0;c<l.length;c++)i(c)}}()})},a.longBuiltUpOrder=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=$.a.mark(function e(n){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return!1,l=a.state.positionList.filter(function(e){return e.symbolname===t[n].symbolName}),console.log("index",n,"symbolName",t[n].symbolName,l),l.length||localStorage.getItem("NseStock_"+t[n].symbolName)||x.autoCompleteSearch(t[n].symbolName).then(function(e){var r=e.data.filter(function(e){return"NSE"===e.exch_seg&&"1"===e.lotsize&&e.name===t[n].symbolName});r.length&&(console.log(r[0].symbol,"found",r),localStorage.setItem("NseStock_"+t[n].symbolName,"orderdone"),a.historyWiseOrderPlace(r[0].token,r[0].symbol,t[n].symbolName))}),e.next=6,new Promise(function(e){return setTimeout(e,300)});case 6:case"end":return e.stop()}},e)}),r=0;case 2:if(!(r<t.length)){e.next=7;break}return e.delegateYield(n(r),"t0",4);case 4:r++,e.next=2;break;case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.checkAndPlaceSingleOrder=function(e){x.autoCompleteSearch(e).then(function(e){var t=e.data.filter(function(e){return"NSE"===e.exch_seg&&"1"===e.lotsize});console.log("stockfound",t),t&&t.length&&a.orderWithFlatstoploss(t[0].token,t[0].symbol)})},a.orderWithFlatstoploss=function(e,t){var n={exchange:"NSE",tradingsymbol:t,symboltoken:e};x.getLTP(n).then(function(n){var r=Q(n,"noPop"),l=(r&&r.data).ltp;if(l){var o=l-l*lt.perTradeStopLossPer/100;o=a.getMinPriceAllowTick(o);var s=lt.totalCapital*lt.perTradeExposurePer/100,i=Math.floor(s/l);console.log(t+"ltp "+l,"quantity",i,"stopLossPrice",o,"perTradeExposureAmt",s);var c={transactiontype:"BUY",tradingsymbol:t,symboltoken:e,buyPrice:0,quantity:i,stopLossPrice:o};i&&o&&a.placeOrderMethod(c)}}).catch(function(e){console.log(t,"not found","error",e)})},a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));var t=e.target.value;x.autoCompleteSearch(t).then(function(e){var t=e.data;localStorage.setItem("autoSearchTemp",JSON.stringify(t)),a.setState({autoSearchList:t})})},a.onTrailChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.onAddSLChange=function(e){var t=a.state.addSLInfo;t[e.target.name]=e.target.value.toUpperCase(),a.setState({addSLInfo:t})},a.deleteOptionPriceSL=function(e,t){for(var n=function(n){var r=a.state.positionList[n];if(console.log("squireoffff",r.tradingsymbol,e.tradingsymbol,r.buyqty),r.tradingsymbol==e.tradingsymbol&&r.buyqty>0&&(l=localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice")))&&l.length>0)return l.splice(t,1),localStorage.setItem("trackSLPrice",JSON.stringify(l)),a.setState({trackSLPrice:l},function(){a.squareOff(r,!0)}),"break"},r=0;r<a.state.positionList.length;r++){var l;if("break"===n(r))break}},a.getNiftyLTP=function(){x.getLTP({exchange:"NSE",tradingsymbol:"NIFTY",symboltoken:"26000"}).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;if(n&&n.ltp){var r=100*(n.ltp-n.close)/n.close;document.getElementById("niftySpid")&&(a.state.niftyLtpSec.push({ltp:n.ltp.toFixed(2),time:(new Date).toLocaleTimeString()}),localStorage.setItem("niftyLtpSec",JSON.stringify(a.state.niftyLtpSec)),document.getElementById("niftySpid").innerHTML="<span style='color:red'> Nifty "+n.ltp.toFixed(2)+" ("+r.toFixed(2)+"%)</span>")}var l=localStorage.getItem("trackSLPrice")?JSON.parse(localStorage.getItem("trackSLPrice")):[];if(l.length>0)for(var o=0;o<l.length;o++){var s=l[o];console.log("this.state.trackSLPrice",s),"NIFTY"==s.name&&"CE"==s.optiontype&&(n.ltp<s.priceStopLoss||n.ltp>=s.priceTarget)&&(console.log("deleteOptionPriceSL call sl ",s,o),a.deleteOptionPriceSL(s,o)),"NIFTY"==s.name&&"PE"==s.optiontype&&(n.ltp>s.priceStopLoss||n.ltp<=s.priceTarget)&&(console.log("deleteOptionPriceSL put sl ",s,o),a.deleteOptionPriceSL(s))}})},a.getBankNiftyLTP=function(){x.getLTP({exchange:"NSE",tradingsymbol:"BANKNIFTY",symboltoken:"26009"}).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;if(n&&n.ltp){var r=100*(n.ltp-n.close)/n.close;document.getElementById("bankniftySpid")&&(document.getElementById("bankniftySpid").innerHTML=r>0?"<span style='color:green'> Banknifty "+n.ltp.toFixed(2)+" ("+r.toFixed(2)+"%)</span>":"<span style='color:red'> Banknifty "+n.ltp.toFixed(2)+" ("+r.toFixed(2)+"%)</span>",a.state.bnniftyLtpSec.push({ltp:n.ltp.toFixed(2),time:(new Date).toLocaleTimeString()}),localStorage.setItem("bnniftyLtpSec",JSON.stringify(a.state.bnniftyLtpSec)))}var l=localStorage.getItem("trackSLPrice")?JSON.parse(localStorage.getItem("trackSLPrice")):[];if(l.length>0)for(var o=0;o<l.length;o++){var s=l[o];"BANKNIFTY"==s.name&&"CE"==s.optiontype&&(n.ltp<s.priceStopLoss||n.ltp>=s.priceTarget)&&a.deleteOptionPriceSL(s,o),"BANKNIFTY"==s.name&&"PE"==s.optiontype&&(n.ltp>s.priceStopLoss||n.ltp<=s.priceTarget)&&a.deleteOptionPriceSL(s,o)}})},a.getStopLossPrice=function(){var e=Object(te.a)($.a.mark(function e(t,n){var r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={exchange:"NSE",tradingsymbol:n,symboltoken:t},e.next=3,x.getLTP(r).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;if(n&&n.ltp){var r=parseFloat(n.ltp);r-=.7*r/100;var l=a.getMinPriceAllowTick(r);return a.setState({stoploss:l}),l}});case 3:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.placeOrderMethod=function(e){var t={transactiontype:e.transactiontype,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,quantity:e.quantity,ordertype:0===e.buyPrice?"MARKET":"LIMIT",price:e.buyPrice,producttype:"INTRADAY",duration:"DAY",squareoff:"0",stoploss:"0",exchange:"NSE",variety:"NORMAL"};console.log("place order option",t),x.placeOrder(t).then(function(t){var n=Q(t);n.status&&"SUCCESS"===n.message&&(a.setState({orderid:n.data&&n.data.orderid}),e.stopLossPrice&&a.placeSLMOrder(e))})},a.historyWiseOrderPlace=function(e,t,n){var r={exchange:"NSE",tradingsymbol:t,symboltoken:e};x.getLTP(r).then(function(r){var l=Q(r,"noPop"),o=l&&l.data;console.log(t," ltd data ",o);var s=0;if(o&&o.ltp){var i=lt.totalCapital*lt.perTradeExposurePer/100;s=Math.floor(i/o.ltp)}if(s=s>0?1:0,console.log(t,"  quantity can be order ",s),s){var c="YYYY-MM-DD HH:mm",m=ot("9:15am","h:mma").format(c);console.log("beginningTime",m);var u=ot.duration("21:10:00"),d=ot(new Date).subtract(u),g={exchange:"NSE",symboltoken:e,interval:"FIVE_MINUTE",fromdate:ot(d).format(c),todate:ot(new Date).format(c)};x.getHistoryData(g).then(function(r){var l=Q(r,"noPop");if(l&&l.data&&l.data.length){var o=l.data,i=0,c=0,m=0;if(o.reverse(),m=o[0][3],c=o[0][2],o&&o.length>0){for(var u=0;u<20;u++)o[u]&&(o[u][4],i+=o[u][3],o[u][2]>c&&(console.log(u,c,o[u][2]),c=o[u][2]),o[u][3]<=m&&(m=o[u][3]));var d=o.length>20?20:o.length,g=i/d-3*(c-m)/100,h=100*(c-(g=a.getMinPriceAllowTick(g)))/c;console.log(t+"highestHigh:",c,"lowestLow",m,"stoploss after tick:",g,"stoploss%",h);var p={transactiontype:"BUY",tradingsymbol:t,symboltoken:e,buyPrice:0,quantity:s,stopLossPrice:g};h?a.placeOrderMethod(p):(localStorage.setItem("NseStock_"+n,""),console.log(t+" SL "+h+"% is grater than my SL: 3.5  not fullfilled"))}}else console.log(t+" candle data emply")})}})},a.cancelOrderOfSame=function(e){var t=a.getOpenPeningOrderId(e.symboltoken),n={variety:t.variety,orderid:t.orderId};x.cancelOrder(n).then(function(t){var n=Q(t);n.status&&"SUCCESS"===n.message&&(console.log("cancel order",n),a.deleteOptionPriceSL(e))})},a.squareOff=function(e,t){var n={variety:"NORMAL",tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,transactiontype:e.netqty>0?"SELL":"BUY",exchange:e.exchange,ordertype:"MARKET",producttype:e.producttype,duration:"DAY",price:0,squareoff:"0",stoploss:"0",quantity:Math.abs(e.netqty)};if(console.log("sql",e),t&&(n.price=0),"OPTSTK"==e.instrumenttype&&("PE"==e.optiontype||"CE"==e.optiontype)){var r=e.ltp-.5*e.ltp/100;r=ut.getMinPriceAllowTick(r),n.price=r,n.triggerprice=e.ltp-.05}x.placeOrder(n).then(function(t){var n=Q(t);n.status&&"SUCCESS"===n.message&&(a.setState({orderid:n.data&&n.data.orderid}),a.cancelOrderOfSame(e),document.getElementById("orderRefresh")&&document.getElementById("orderRefresh").click())})},a.updateOrderList=function(){x.retrieveOrderBook().then(function(e){var t=Q(e);if(t&&t.data){var a=t.data;a.sort(function(e,t){return new Date(t.updatetime)-new Date(e.updatetime)}),localStorage.setItem("oderbookData",JSON.stringify(a))}})},a.addSLOrderInfo=function(e){a.setState({addSLInfo:e,enableSLMOrderUi:!0})},a.placeSLMOrderManually=function(){a.state.addSLInfo.netqty=Math.abs(a.state.addSLInfo.netqty),console.log("addSLInfo",a.state.addSLInfo),ut.placeOptionSLMOrder(a.state.addSLInfo)},a.placeSLMOrder=function(e){var t={triggerprice:e.stopLossPrice,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,quantity:e.quantity,transactiontype:"BUY"===e.transactiontype?"SELL":"BUY",exchange:e.exchange?e.exchange:"NSE",producttype:e.producttype?e.producttype:"INTRADAY",duration:"DAY",price:e.price?e.price:0,squareoff:"0",stoploss:"0",ordertype:"STOPLOSS_MARKET",variety:"STOPLOSS"};console.log("SLM option data",t),x.placeOrder(t).then(function(t){var n=Q(t);if(n.status&&"SUCCESS"===n.message){a.setState({orderid:n.data&&n.data.orderid}),a.updateOrderList();var r=new SpeechSynthesisUtterance;r.text=(e.tradingsymbol+" "+e.transactiontype).toLocaleLowerCase(),window.speechSynthesis.speak(r),document.getElementById("orderRefresh")&&document.getElementById("orderRefresh").click()}})},a.getOpenPeningOrderId=function(e){for(var t=localStorage.getItem("oderbookData")&&JSON.parse(localStorage.getItem("oderbookData")),a={},n=0;n<t.length;n++)if(t[n].symboltoken===e&&"STOPLOSS"===t[n].variety){a.orderId=t[n].orderid,a.variety=t[n].variety;break}return a},a.modifyOrderMethod=function(e,t,n){var r=a.getOpenPeningOrderId(e.symboltoken);r.orderId||(e.stopLossPrice=t,e.price=n,e.quantity=Math.abs(e.netqty),"CE"==e.optiontype||"PE"==e.optiontype?e.transactiontype="BUY":e.transactiontype=e.netqty>0?"BUY":"SELL",a.placeSLMOrder(e));var l={variety:r.variety,orderid:r.orderId,ordertype:"STOPLOSS_MARKET",producttype:e.producttype,duration:"DAY",price:n?parseFloat(n):0,triggerprice:parseFloat(t),quantity:Math.abs(e.netqty),tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,exchange:e.exchange};x.modifyOrder(l).then(function(a){var n=Q(a,"noPop"),r=new SpeechSynthesisUtterance;n.status&&"SUCCESS"===n.message&&(r.text=e.symbolname+" trailed ".toLocaleLowerCase(),window.speechSynthesis.speak(r),localStorage.setItem("firstTimeModify"+e.tradingsymbol,"No"),localStorage.setItem("lastTriggerprice_"+e.tradingsymbol,parseFloat(t)),document.getElementById("orderRefresh")&&document.getElementById("orderRefresh").click())})},a.getMinPriceAllowTick=function(e){e=e.toFixed(2);var t=parseInt(e.split(".")[0]),a=parseFloat(e.split(".")[1]);return e=parseFloat(t+"."+(a-a%5))},a.get2DecimalNumber=function(e){return(e=parseFloat(e))?e.toFixed(2):e},a.getSLAndTriggerPrice=function(e){var t=a.getMinPriceAllowTick(e),n=t-1*t/100;return{minTriggerPrice:t,minSLPrice:n=a.getMinPriceAllowTick(n)}},a.getOptionPercentage=function(e){var t=0,n=0;if(e.buyavgprice=parseFloat(e.buyavgprice),t=100*(e.ltp-e.buyavgprice)/e.buyavgprice,!localStorage.getItem("firstTimeModify"+e.tradingsymbol)&&t>=a.state.firstTimeMoveOption){var r=e.buyavgprice+e.buyavgprice*a.state.firstTimeSLMoveOption/100,l=a.getSLAndTriggerPrice(r);localStorage.getItem("lastTriggerprice_"+e.tradingsymbol)!=l.minTriggerPrice&&a.modifyOrderMethod(e,l.minTriggerPrice,l.minSLPrice)}else{var o=parseFloat(localStorage.getItem("lastTriggerprice_"+e.tradingsymbol)),s=100*(e.ltp-o)/o;if(n=s,s>=a.state.nextTimeMoveOption){r=o+o*a.state.nextTimeSLMoveOption/100;var i=a.getSLAndTriggerPrice(r);localStorage.getItem("lastTriggerprice_"+e.tradingsymbol)!=i.minTriggerPrice&&a.modifyOrderMethod(e,i.minTriggerPrice,i.minSLPrice)}}return n?t.toFixed(2)+"% | Trailing "+n.toFixed(2)+"%":t.toFixed(2)+"%"},a.getPercentage=function(e){var t=0,n=0;if(e.netqty>0)if(e.buyavgprice=parseFloat(e.buyavgprice),t=100*(e.ltp-e.buyavgprice)/e.buyavgprice,!localStorage.getItem("firstTimeModify"+e.tradingsymbol)&&t>=a.state.firstTimeMove){var r=e.buyavgprice+e.buyavgprice*a.state.firstTimeSLMove/100;r=a.getMinPriceAllowTick(r),localStorage.getItem("lastTriggerprice_"+e.tradingsymbol)!=r&&a.modifyOrderMethod(e,r)}else{var l=parseFloat(localStorage.getItem("lastTriggerprice_"+e.tradingsymbol));n=o=100*(e.ltp-l)/l,o>=a.state.nextTimeMove&&(r=l+l*a.state.nextTimeSLMove/100,r=a.getMinPriceAllowTick(r),localStorage.getItem("lastTriggerprice_"+e.tradingsymbol)!=r&&a.modifyOrderMethod(e,r))}if(e.netqty<0)if(e.sellavgprice=parseFloat(e.sellavgprice),t=100*(e.ltp-e.sellavgprice)/e.sellavgprice,!localStorage.getItem("firstTimeModify"+e.tradingsymbol)&&t<=-Math.abs(a.state.firstTimeMove)){r=e.sellavgprice-e.sellavgprice*a.state.firstTimeSLMove/100;r=a.getMinPriceAllowTick(r),a.modifyOrderMethod(e,r)}else{var o;l=parseFloat(localStorage.getItem("lastTriggerprice_"+e.tradingsymbol));n=o=100*(e.ltp-l)/l,console.log("perchngfromTriggerPrice",e.tradingsymbol,o),o<=-Math.abs(a.state.nextTimeMove)&&(r=l-l*a.state.nextTimeSLMove/100,r=a.getMinPriceAllowTick(r),a.modifyOrderMethod(e,r))}return n?t.toFixed(2)+"% | Trailing "+n.toFixed(2)+"%":t.toFixed(2)+"%"},a.state={positionList:[],autoSearchList:[],InstrumentLTP:{},autoSearchTemp:[],foundPatternList:[],symboltoken:"",tradingsymbol:"",buyPrice:0,quantity:1,producttype:"DELIVERY",nr4TotalPer:0,pnlAmountTotal:0,totalNetProfit:0,totelActivatedCount:0,totalBrokerChargesNR4:0,stockTesting:"",perHighLowTotal:0,netPnLAmountOnHighlowTotal:0,firstTimeMove:.6,firstTimeSLMove:.5,nextTimeMove:.6,nextTimeSLMove:.3,firstTimeMoveOption:6,firstTimeSLMoveOption:3,nextTimeMoveOption:6,nextTimeSLMoveOption:3,staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},trackSLPrice:localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))||[],enableSLMOrderUi:!1,addSLInfo:{},niftyLtpSec:[],bnniftyLtpSec:[]},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.updateOrderList();var t=ot("9:15am","h:mma"),a=ot("3:30pm","h:mma"),n=ot(new Date,"h:mma"),r=ot().isoWeekday();if(r<=5&&n.isBetween(t,a)){this.setState({positionInterval:setInterval(function(){e.getPositionData()},1e3)}),this.setState({bankNiftyInterval:setInterval(function(){e.getNiftyLTP(),e.getBankNiftyLTP()},1e3)});var l=setInterval(function(){var t=ot("3:14pm","h:mma"),a=ot("3:15pm","h:mma");ot(new Date,"h:mma").isBetween(t,a)&&e.state.positionList.forEach(function(t,a){(t.netqty>0||t.netqty<0)&&e.squareOff(t),e.state.positionList.length==a+1&&(clearInterval(l),console.log("squireInterval ended"))})},5e3)}else clearInterval(this.state.positionInterval);var o=ot("3:30pm","h:mma");r<=5&&n.isBetween(t,o);var s=localStorage.getItem("FoundPatternList")?JSON.parse(localStorage.getItem("FoundPatternList")):[];this.setState({foundPatternList:s})}},{key:"componentWillUnmount",value:function(){}},{key:"getMySelectedStock",value:function(){var e=this,t=((new Date).toLocaleTimeString()>"15:00:00"&&clearInterval(this.state.selectedStockInteval),lt.totalCapital*lt.dailyLossPer/100);t=-Math.abs(t),this.state.todayProfitPnL<t?(console.log("daily loss crossed",t),clearInterval(this.state.scaninterval)):x.getSelectedStockFromDb().then(function(t){var a=Q(t,"noPop");if(a.status&&"SUCCESS"===a.message)for(var n=a.result,r=function(t){o=!1;for(var a=0;a<e.state.positionList.length;a++)e.state.positionList[a].symbolname===n[t].symbol&&(o=!0);o||localStorage.getItem("NseStock_"+n[t].symbolName)||x.autoCompleteSearch(n[t].symbolName).then(function(e){var a=e.data.filter(function(e){return"NSE"===e.exch_seg&&"1"===e.lotsize&&e.name===n[t].symbolName});if(a.length){var r=localStorage.getItem("selectedStockwatchList")?JSON.parse(localStorage.getItem("selectedStockwatchList")):[];r.push(a[0]),localStorage.setItem("selectedStockwatchList",JSON.stringify(r))}})},l=0;l<n.length;l++){var o;r(l)}})}},{key:"getStockOnebyOne",value:function(){var e=this,t=lt.totalCapital*lt.dailyLossPer/100;t=-Math.abs(t),this.state.todayProfitPnL<t?(console.log("daily loss crossed",t),clearInterval(this.state.scaninterval)):(console.log("still ok"),x.getAutoScanStock().then(function(t){var a=Q(t,"noPop");if(a.status&&"SUCCESS"===a.message){var n=a.result;if(n&&n.length>0){var r=n[n.length-1].symbolName;localStorage.setItem("scannedStocks",JSON.stringify(n));for(var l=!1,o=0;o<e.state.positionList.length;o++)e.state.positionList[o].symbolname===r&&(l=!0);if(!l&&!localStorage.getItem("scannedstock_"+r)){console.log("found new",r);var s=new SpeechSynthesisUtterance;s.text="hey Vijay, "+r,window.speechSynthesis.speak(s),localStorage.setItem("scannedstock_"+r,"orderdone"),e.checkAndPlaceSingleOrder(r)}}}}))}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement("br",null),r.a.createElement(rt,null)," ",r.a.createElement(Ma,null),r.a.createElement(N.a,{style:{padding:"5px"},justify:"space-between",direction:"row",container:!0},r.a.createElement(N.a,{item:!0},r.a.createElement(R.a,{color:"primary",gutterBottom:!0},"Positions (",this.state.positionList&&this.state.positionList.length,")    ",r.a.createElement("span",{id:"niftySpid"}," Nifty "),"  \xa0\xa0  ",r.a.createElement("span",{id:"bankniftySpid"},"Banknifty "))),r.a.createElement(N.a,{item:!0},r.a.createElement(R.a,{component:"h3"},r.a.createElement("b",{style:{color:"red"}},"Expn: ",this.state.totalExpence," "))),r.a.createElement(N.a,{item:!0},r.a.createElement(R.a,{component:"h3"},r.a.createElement("b",null,"  P/L: ")," ",r.a.createElement("b",{style:{color:this.state.todayProfitPnL>0?"green":"red"}},this.state.todayProfitPnL," "))),r.a.createElement(N.a,{item:!0},r.a.createElement(R.a,Object.assign({component:"h3"},window.document.title="PnL:"+(this.state.todayProfitPnL-this.state.totalExpence).toFixed(2)),r.a.createElement("b",null," Net P/L: ")," ",r.a.createElement("b",{style:{color:this.state.todayProfitPnL-this.state.totalExpence>0?"green":"red"}},this.state.totalExpence?(this.state.todayProfitPnL-this.state.totalExpence).toFixed(2):""," "))),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{type:"number",variant:"contained",style:{float:"right"},onClick:function(){return e.getPositionData()}},"Refresh")),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{type:"number",variant:"contained",style:{float:"right"},onClick:function(){return e.getHighLowPercentage()}},r.a.createElement(Aa.a,null)," H/L"))),r.a.createElement(N.a,{style:{padding:"5px"},spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{overflow:"auto",padding:"5px"}},r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap",backgroundColor:""},variant:"head"},r.a.createElement(ze.a,{key:"1",variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{style:{paddingLeft:"3px"},className:"TableHeadFormat",align:"left"},"\xa0Symbol",r.a.createElement(B.a,{type:"number",onClick:function(){return e.checkOpenEqualToLow()}},"O=H/L"),r.a.createElement("input",{style:{width:"50px"},type:"number",step:1e4,placeholder:"25000",name:"checkAmount",onChange:this.onTrailChange,onBlur:function(){return e.refreshBasedAmount()}}),r.a.createElement("input",{style:{width:"30px"},type:"number",step:.1,placeholder:"0.5",name:"checkAmountPer",onChange:this.onTrailChange,onBlur:function(){return e.refreshBasedAmount()}})),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Type"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"BuyAvg"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"SellAvg"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"QT"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"NetQty"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Exp"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"SL"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"MD"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"P/L "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Chng % "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"LTP"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Action"),this.state.checkAmount?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Qty Cpl"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"CExp"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"CNet")):"",this.state.showHighLowWisePer?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"High"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Low")):"")),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.positionList?this.state.positionList.map(function(t){return"DELIVERY1"!==t.producttype?r.a.createElement(ze.a,{hover:!0,key:t.symboltoken,style:{background:"0"!==t.netqty?"lightgray":""}},r.a.createElement(Qe.a,{align:"left",style:{width:"250px"}},r.a.createElement(B.a,{style:{color:100*(t.ltp-t.close)/t.close>0?"green":"red"},size:"small",variant:"contained",title:"Candle refresh",onClick:function(){return e.refreshCandleChartManually(t)}},t.tradingsymbol," ",t.ltp," (",(100*(t.ltp-t.close)/t.close).toFixed(2),"%) ",r.a.createElement(Ce.a,null))),r.a.createElement(Qe.a,{align:"left"},t.producttype),r.a.createElement(Qe.a,{align:"left"},r.a.createElement(B.a,{onClick:function(){return e.addSLOrderInfo(t)}}," ",t.totalbuyavgprice," "),"  "),r.a.createElement(Qe.a,{align:"left"},t.totalsellavgprice),r.a.createElement(Qe.a,{align:"left"},t.buyqty||t.sellqty),r.a.createElement(Qe.a,{align:"left"},t.netqty),r.a.createElement(Qe.a,{style:{cursor:"help"},title:t.expenceInfo,align:"left"},t.tradeExpence),r.a.createElement(Qe.a,{align:"left"}," ",t.stopLoss),r.a.createElement(Qe.a,{align:"left"}," ",t.stopLossAmount),r.a.createElement(Qe.a,{align:"left",style:{color:parseFloat(t.pnl)>0?"green":"red"}},r.a.createElement("b",null,t.pnl)),r.a.createElement(Qe.a,{align:"left"},"0"!==t.netqty&&""==t.optiontype?e.getPercentage(t):"",("CE"==t.optiontype||"PE"==t.optiontype)&&t.netqty>0?e.getOptionPercentage(t):"",t.percentPnL?t.percentPnL+"%":""),r.a.createElement(Qe.a,{align:"left"},t.ltp),r.a.createElement(Qe.a,{align:"left"},"0"!==t.netqty?r.a.createElement(B.a,{size:"small",type:"number",variant:"contained",color:"Secondary",onClick:function(){return e.squareOff(t)}},"Square Off"):""),e.state.checkAmount?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{align:"left"},r.a.createElement("i",{title:"Buy value:"+t.totalbuyvalue+" | Sell value:"+t.totalsellvalue},"  ",t.checkQty)," \xa0 ",t.checkAmount," "),r.a.createElement(Qe.a,{align:"left",title:t.checkExpence&&t.checkExpence.expenceInfo},"  ",t.checkExpence&&t.checkExpence.tradeExpence&&t.checkExpence.tradeExpence.toFixed(2)),r.a.createElement(Qe.a,{align:"left"},t.checkNet&&t.checkNet.toFixed(2))):"",e.state.showHighLowWisePer?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{align:"left"},t.high),r.a.createElement(Qe.a,{align:"left"},t.low)):""):""}):"",r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold",backgroundColor:""}},r.a.createElement(Qe.a,{align:"left"},"Stock Trail%: \xa0 F.Move",r.a.createElement("input",{name:"firstTimeMove",type:"number",step:"0.1",onChange:this.onTrailChange,value:this.state.firstTimeMove,style:{width:"30px",textAlign:"center"}}),"\xa0SL Move",r.a.createElement("input",{name:"firstTimeSLMove",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.firstTimeSLMove,style:{width:"30px",textAlign:"center"}}),"\xa0Next ",r.a.createElement("input",{name:"nextTimeMove",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.nextTimeMove,style:{width:"30px",textAlign:"center"}}),"\xa0SL Move",r.a.createElement("input",{name:"nextTimeSLMove",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.nextTimeSLMove,style:{width:"30px",textAlign:"center"}})),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"}),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.allbuyavgprice),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.allsellavgprice),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.totalQtyTraded),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"}),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"}),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"}),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.totalMaxPnL),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left",style:{color:parseFloat(this.state.todayProfitPnL)>0?"green":"red"}},this.state.todayProfitPnL," "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.totalPercentage&&this.state.totalPercentage.toFixed(2)+"%"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"}),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"}),this.state.checkAmount?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.totCheckAmount),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.totCheckExp),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.checkTotalNet)):"",r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"})),r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{colSpan:15,align:"left"},"Option Trail%: F.Move",r.a.createElement("input",{name:"firstTimeMoveOption",type:"number",step:"0.1",onChange:this.onTrailChange,value:this.state.firstTimeMoveOption,style:{width:"30px",textAlign:"center"}}),"\xa0SL Move",r.a.createElement("input",{name:"firstTimeSLMoveOption",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.firstTimeSLMoveOption,style:{width:"30px",textAlign:"center"}}),"\xa0Next ",r.a.createElement("input",{name:"nextTimeMoveOption",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.nextTimeMoveOption,style:{width:"30px",textAlign:"center"}}),"\xa0SL Move",r.a.createElement("input",{name:"nextTimeSLMoveOption",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.nextTimeSLMoveOption,style:{width:"30px",textAlign:"center"}}))),this.state.enableSLMOrderUi?r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{className:"TableHeadFormat",colSpan:15,align:"center"},"Stoploss \xa0",r.a.createElement("input",{placeholder:"Symbol",name:"tradingsymbol",onChange:this.onAddSLChange,value:this.state.addSLInfo&&this.state.addSLInfo.tradingsymbol,style:{width:"200px",textAlign:"center"}}),"\xa0",r.a.createElement("input",{placeholder:"Price",name:"stopLossPrice",type:"number",step:"0.1",onChange:this.onAddSLChange,value:this.state.addSLInfo&&this.state.addSLInfo.stopLossPrice,style:{width:"100px",textAlign:"center"}}),"\xa0",r.a.createElement("input",{placeholder:"Trigger Price",name:"stopLossTriggerPrice",step:"0.1",type:"number",onChange:this.onAddSLChange,value:this.state.addSLInfo&&this.state.addSLInfo.price,style:{width:"100px",textAlign:"center"}}),"\xa0 ",r.a.createElement(B.a,{size:"small",type:"number",variant:"contained",onClick:function(){return e.placeSLMOrderManually()}},"Place SL"))):"")))),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ia,null)),r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{height:"100%",overflow:"auto"}},"no"==localStorage.getItem("isOpenInNewPage")?r.a.createElement(ca,null):""),this.state.foundPatternList&&this.state.foundPatternList.length?r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{overflow:"auto",padding:"5px"}},r.a.createElement(N.a,{justify:"space-between",container:!0},r.a.createElement(N.a,{item:!0},r.a.createElement(R.a,{component:"h2",variant:"h6",color:"primary",gutterBottom:!0},"Patterns Founds (",this.state.foundPatternList&&this.state.foundPatternList.length,")",r.a.createElement("span",{id:"stockTesting",style:{fontSize:"18px",color:"gray"}}," ",this.state.stockTesting," "))),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{variant:"contained",style:{marginLeft:"20px"},onClick:function(){return e.refreshLtpOnFoundPattern()}},"Live Refresh"))),r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{key:"1",variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Symbol | Activated(",this.state.totelActivatedCount,")"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Performance 6M"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"OnLtp (",this.state.nr4TotalPer.toFixed(2),")%  "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Qty"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"PnL(",this.state.pnlAmountTotal.toFixed(2),")"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Fee(",this.state.totalBrokerChargesNR4.toFixed(2),")"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"NetPnL(",this.state.totalNetProfit.toFixed(2),")"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"OnH/L(",this.state.perHighLowTotal.toFixed(2),"% | ",this.state.netPnLAmountOnHighlowTotal.toFixed(2),")  "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Patten"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"FoundAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"BuyAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"SellAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"UpdatedAt"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.foundPatternList?this.state.foundPatternList.map(function(t){return r.a.createElement(ze.a,{hover:!0,key:t.symboltoken},r.a.createElement(Qe.a,{align:"left"}," ",r.a.createElement(B.a,{variant:"contained",style:{color:t.todayChange?t.todayChange>0?"green":"red":""},onClick:function(){return e.showCandleChart(t.candleChartData,t.symbol)}},t.symbol," ",t.symbolUpdated," ",r.a.createElement(xe.a,null)," ")),r.a.createElement(Qe.a,{title:t.symbol+" : Open all chart",align:"left",style:{fontSize:"9px",cursor:"pointer"},onClick:function(){return e.showMultipleCandleChart(t)}},t.pastPerferm?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{style:{background:t.pastPerferm.totalLongPer/t.pastPerferm.totalLongs>=1?"#92f192":""}},t.pastPerferm.totalLongs,"L(",t.pastPerferm.totalLongPer,"%) | Avg:",(t.pastPerferm.totalLongPer/t.pastPerferm.totalLongs).toFixed(2),"%")," ",r.a.createElement("br",null),r.a.createElement("span",null,t.pastPerferm.totalLongs,"LH(",t.pastPerferm.totalLongHighPer,"%) | Avg: ",(t.pastPerferm.totalLongHighPer/t.pastPerferm.totalLongs).toFixed(2),"%")," ",r.a.createElement("br",null),r.a.createElement("span",{style:{background:t.pastPerferm.totalShortPer/t.pastPerferm.totalShort>=1?"#e87b7b":""}},t.pastPerferm.totalShort,"S:",t.pastPerferm.totalShortPer,"% | Avg:",(t.pastPerferm.totalShortPer/t.pastPerferm.totalShort).toFixed(2),"%")," ",r.a.createElement("br",null),r.a.createElement("span",null,t.pastPerferm.totalShort,"SL:",t.pastPerferm.totalShortLowPer,"% | Avg:",(t.pastPerferm.totalShortLowPer/t.pastPerferm.totalShort).toFixed(2),"%")," ",r.a.createElement("br",null)):""),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,t.orderActivated," ")),r.a.createElement(Qe.a,{align:"left"},t.quantity),r.a.createElement(Qe.a,{align:"left"},t.pnlAmount),r.a.createElement(Qe.a,{align:"left"},t.brokerageCharges),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,t.netPnLAmount," ")),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("b",null,t.OnHighLowActivated," ")),r.a.createElement(Qe.a,{align:"left"},t.pattenName),r.a.createElement(Qe.a,{align:"left"},t.foundAt&&t.foundAt.substr(0,15)),r.a.createElement(Qe.a,{align:"left"},t.BuyAt),r.a.createElement(Qe.a,{align:"left"},t.SellAt),r.a.createElement(Qe.a,{align:"left"},t.time))}):"")))):""))}}]),t}(r.a.Component),Ha=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).getOptionStockLiveLtp=Object(te.a)($.a.mark(function e(){var t,n,r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.activeStockOptions[t],r={exchange:n.exch_seg,tradingsymbol:n.symbol,symboltoken:n.token},x.getLTP(r).then(function(e){var t=Q(e,"noPop"),r=t&&t.data;if(r&&r.ltp){n.ltp=r.ltp,n.perChange=(100*(r.ltp-r.close)/r.close).toFixed(2),console.log("element",n);var l=a.state.positionList.filter(function(e){return e.symbolname==n.symbol});if(l[0]){if("CE"===l.optiontype&&(r.ltp<n.optionStockStoploss||r.ltp>=n.optionStockTarget))a.deleteActiveOptionStock(n);if("PE"===l.optiontype&&(r.ltp>n.optionStockStoploss||r.ltp<=n.optionStockTarget))a.deleteActiveOptionStock(n)}}a.setState({activeStockOptions:a.state.activeStockOptions})}),e.next=5,new Promise(function(e){return setTimeout(e,100)});case 5:case"end":return e.stop()}},e)}),n=0;case 2:if(!(n<a.state.activeStockOptions.length)){e.next=7;break}return e.delegateYield(t(n),"t0",4);case 4:n++,e.next=2;break;case 7:case"end":return e.stop()}},e)})),a.deleteActiveOptionStock=function(e){for(var t=!1,n=0;n<a.state.activeStockOptions.length;n++){var r=a.state.activeStockOptions[n];if(e.name==r.name){a.state.activeStockOptions.splice(n,1)[0].name==e.name&&(t=!0),a.setState({activeStockOptions:a.state.activeStockOptions});break}}return t},a.refreshCandleChartManually=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=ot("9:15am","h:mma"),r=ot.duration("12:00:00"),ot(new Date).subtract(r),l={exchange:"NSE",symboltoken:t.symboltoken,interval:"FIVE_MINUTE",fromdate:ot(n).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(l).then(function(e){var a=Q(e,"noPop");if(a&&a.data&&a.data.length){var n=[];a.data.forEach(function(e){n.push([e[0],e[1],e[2],e[3],e[4]])}),localStorage.setItem("candleChangeShow",(100*(t.ltp-t.close)/t.close).toFixed(2)),localStorage.setItem("candleChartData",JSON.stringify(n)),localStorage.setItem("cadleChartSymbol",t.symbolname),document.getElementById("showCandleChart").click()}else console.log(t.symboltoken,"  emply candle found")}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),z.showError(t.symboltoken+" candle failed!")});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.showCandleChart=function(e,t){e=e&&e.reverse(),localStorage.setItem("candleChartData",JSON.stringify(e)),localStorage.setItem("cadleChartSymbol",t),document.getElementById("showCandleChart").click()},a.showMultipleCandleChart=function(e){localStorage.setItem("multipleChartData",JSON.stringify(e)),document.getElementById("showMultipleChart").click()},a.refreshLtpOnFoundPattern=Object(te.a)($.a.mark(function e(){var t,n,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({nr4TotalPer:0,totalBrokerChargesNR4:0,totalNetProfit:0,totelActivatedCount:0,pnlAmountTotal:0,perHighLowTotal:0,netPnLAmountOnHighlowTotal:0}),t=a.state.foundPatternList,a.setState({foundPatternList:[]}),n=localStorage.getItem("FoundPatternList")?JSON.parse(localStorage.getItem("FoundPatternList")):[],l=$.a.mark(function e(n){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(l=t[n])&&"NR4"==l.pattenName&&(s={exchange:"NSE",tradingsymbol:l.symbol,symboltoken:l.token},x.getLTP(s).then(function(e){var t=Q(e,"noPop"),n=t&&t.data,o=0,s=0,i=0,c=.06,m=0,u=0,d=0;if(n&&n.ltp){var g=r.a.createElement("span",null," ",n.ltp," ");if(n.ltp>l.BuyAt)m=100*(n.ltp-l.BuyAt)/l.BuyAt,g=r.a.createElement("span",{style:{color:"green"}}," Long: ",m.toFixed(2),"% "),o=Math.floor(1e4/l.BuyAt),i=(s=(n.ltp-l.BuyAt)*o)-(c=l.BuyAt*o*c/100*2),a.setState({nr4TotalPer:a.state.nr4TotalPer+m}),a.setState({totalBrokerChargesNR4:a.state.totalBrokerChargesNR4+c,totalNetProfit:a.state.totalNetProfit+i}),a.setState({totelActivatedCount:a.state.totelActivatedCount+1,pnlAmountTotal:a.state.pnlAmountTotal+s}),u=100*(n.high-l.BuyAt)/l.BuyAt,d=(n.high-l.BuyAt)*o-c,a.setState({perHighLowTotal:a.state.perHighLowTotal+u,netPnLAmountOnHighlowTotal:a.state.netPnLAmountOnHighlowTotal+d});if(n.ltp<l.SellAt)m=100*(l.SellAt-n.ltp)/l.SellAt,g=r.a.createElement("span",{style:{color:"red"}}," Short: ",m.toFixed(2),"%"),o=Math.floor(1e4/l.SellAt),i=(s=(l.SellAt-n.ltp)*o)-(c=l.SellAt*o*c/100*2),a.setState({nr4TotalPer:a.state.nr4TotalPer+m}),a.setState({totelActivatedCount:a.state.totelActivatedCount+1,pnlAmountTotal:a.state.pnlAmountTotal+s}),a.setState({totalBrokerChargesNR4:a.state.totalBrokerChargesNR4+c,totalNetProfit:a.state.totalNetProfit+i}),u=100*(l.SellAt-n.low)/l.SellAt,d=(l.SellAt-n.low)*o-c,a.setState({perHighLowTotal:a.state.perHighLowTotal+u,netPnLAmountOnHighlowTotal:a.state.netPnLAmountOnHighlowTotal+d});var h=100*(n.ltp-n.close)/n.close,p=[new Date,n.open,n.high,n.low,n.ltp];l.candleChartData.push(p);var f={symbol:l.symbol,symbolUpdated:n.ltp+"("+h.toFixed(2)+"%)",token:l.token,pattenName:"NR4",OnHighLowActivated:o?u.toFixed(2)+"% | "+d.toFixed(2):"",time:(new Date).toLocaleTimeString(),BuyAt:l.BuyAt,SellAt:l.SellAt,foundAt:l.foundAt,orderActivated:g,candleChartData:l.candleChartData,quantity:o||"",brokerageCharges:o?c.toFixed(2):"",pnlAmount:s?s.toFixed(2):"",netPnLAmount:i?i.toFixed(2):"",perChange:m,todayChange:h,pastPerferm:l.pastPerferm};console.log("nr4 updated",f),a.setState({foundPatternList:[].concat(Object(ee.a)(a.state.foundPatternList),[f])});var y=a.state.foundPatternList;y.sort(function(e,t){return t.perChange-e.perChange}),a.setState({foundPatternList:y});var b=localStorage.getItem("foundPatternList")?JSON.parse(localStorage.getItem("foundPatternList")):[];b.push(f),localStorage.setItem("foundPatternList",JSON.stringify(b))}}).catch(function(e){z.showError(l.symbol+" ltd data not found!")})),e.next=4,new Promise(function(e){return setTimeout(e,101)});case 4:case"end":return e.stop()}},e)}),o=0;case 6:if(!(o<n.length)){e.next=11;break}return e.delegateYield(l(o),"t0",8);case 8:o++,e.next=6;break;case 11:case"end":return e.stop()}},e)})),a.getStoplossFromOrderbook=function(e){var t=localStorage.getItem("oderbookData");t=JSON.parse(t);for(var a={},n=0;n<t.length;n++){var r=t[n];if("trigger pending"===r.status&&r.symboltoken===e.symboltoken){e.netqty>0?(a.stopLoss=r.triggerprice+"("+(100*(r.triggerprice-e.buyavgprice)/e.buyavgprice).toFixed(2)+"%)",a.maxLossAmount=((r.triggerprice-e.buyavgprice)*parseInt(e.netqty)).toFixed(2)):e.netqty<0&&(console.log(e.tradingsymbol,"sellage",e.sellavgprice,"trigger",r.triggerprice),a.stopLoss=r.triggerprice+"("+(100*(r.triggerprice-e.sellavgprice)/e.sellavgprice).toFixed(2)+"%)",a.maxLossAmount=((r.triggerprice-e.sellavgprice)*parseInt(e.netqty)).toFixed(2));break}}return a},a.getStoplossForSELLFromOrderbook=function(e){var t=localStorage.getItem("oderbookData");t=JSON.parse(t);var a={};return t.forEach(function(t){"trigger pending"===t.status&&t.symboltoken===e.symboltoken&&(a.stopLoss=t.triggerprice+"("+(100*(e.buyavgprice-t.triggerprice)/e.buyavgprice).toFixed(2)+"%)",a.maxLossAmount=((t.triggerprice-e.buyavgprice)*parseInt(e.netqty)).toFixed(2))}),a},a.getHighLowPercentage=Object(te.a)($.a.mark(function e(){var t,n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({showHighLowWisePer:!0}),a.state.positionList.length||z.showError("First Refresh Position"),t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("DELIVERY"!=(n=a.state.positionList[t]).producttype){e.next=3;break}return e.abrupt("return",{v:""});case 3:return r={exchange:"NSE",tradingsymbol:n.tradingsymbol,symboltoken:n.symboltoken},x.getLTP(r).then(function(e){var n=Q(e,"noPop"),r=n&&n.data;r&&r.ltp&&(a.state.positionList[t].high=r.high,a.state.positionList[t].low=r.low)}),e.next=7,new Promise(function(e){return setTimeout(e,125)});case 7:a.setState({positionList:a.state.positionList});case 8:case"end":return e.stop()}},e)}),n=0;case 4:if(!(n<a.state.positionList.length)){e.next=12;break}return e.delegateYield(t(n),"t0",6);case 6:if("object"!==typeof(l=e.t0)){e.next=9;break}return e.abrupt("return",l.v);case 9:n++,e.next=4;break;case 12:case"end":return e.stop()}},e)})),a.tagPatternWhichTaken=function(e){for(var t=localStorage.getItem("orderTagToPosition")&&JSON.parse(localStorage.getItem("orderTagToPosition"))||[],a="",n=0;n<t.length;n++){var r=t[n];if(e==r.token){a=r.pattenName;break}}return a},a.calculateTradeExpence=function(e){var t=0===parseFloat(e.totalbuyvalue)?parseFloat(e.totalsellvalue):parseFloat(e.totalbuyvalue),a=.25*parseFloat(t)/100;(a>20||"CE"==e.optiontype||"PE"==e.optiontype)&&(a=20);var n=0===parseFloat(e.totalsellvalue)?parseFloat(e.totalbuyvalue):parseFloat(e.totalsellvalue),r=.25*parseFloat(n)/100;(r>20||"CE"==e.optiontype||"PE"==e.optiontype)&&(r=20);var l=t+n,o=a+r,s=.025;"CE"!=e.optiontype&&"PE"!=e.optiontype||(s=.05);var i=n*s/100,c=.00335*l/100,m=.003*t/100,u=10*l/1e7,d=18*(o+c+u)/100,g=o+i+c+m+u+d;return{tradeExpence:g,expenceInfo:"Brokerage: "+o.toFixed(2)+" \nSTT: "+i.toFixed(2)+" \nTransaction: "+c.toFixed(2)+" \nStamp Duty: "+m.toFixed(2)+" \nSebi: "+u.toFixed(2)+" \nGST: "+d.toFixed(2)+" \n\nTotal: "+g.toFixed(2)}},a.refreshBasedAmount=function(){var e=0,t=0,n=0;a.state.positionList.forEach(function(r){var l=a.state.checkAmountPer?a.state.checkAmountPer:r.percentPnL;r.checkAmount=(a.state.checkAmount*l/100).toFixed(2),e+=parseFloat(r.checkAmount);var o=Math.floor(a.state.checkAmount/r.buyavgprice);r.checkQty=o,r.totalbuyvalue=o*r.buyavgprice,r.totalsellvalue=o*r.sellavgprice,r.checkExpence=a.calculateTradeExpence(r),r.checkExpence&&(r.checkNet=r.checkAmount-r.checkExpence.tradeExpence,n+=r.checkExpence.tradeExpence,t+=parseFloat(r.checkNet)),console.log(r)}),a.setState({totCheckAmount:e.toFixed(2),checkTotalNet:t.toFixed(2),totCheckExp:n.toFixed(2),positionList:a.state.positionList})},a.checkSLOrTarget=function(e){var t=localStorage.getItem("trackSLPrice")?JSON.parse(localStorage.getItem("trackSLPrice")):[];if(t.length>0)for(var n=0;n<t.length;n++){var r=t[n];"EQ"!=r.optiontype&&""!=r.optiontype||r.tradingsymbol==e.tradingsymbol&&(e.ltp<parseFloat(r.priceStopLoss)||e.ltp>=parseFloat(r.priceTarget))&&a.squareOff(e)}},a.getPositionData=Object(te.a)($.a.mark(function e(){var t;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:0,t=0,localStorage.getItem("trackSLPrice")?JSON.parse(localStorage.getItem("trackSLPrice")):[],x.getPosition().then(function(e){var n=Q(e,"noPop"),r=n&&n.data;if(r&&r.length>0){for(var l=0,o=0,s=0,i=0,c=0,m=0,u=0,d=0,g=[],h=function(e){var n=r[e];if(g.push(n),l+=parseFloat(n.pnl),o+=parseFloat(n.totalbuyvalue),s+=0===parseFloat(n.totalsellvalue)?parseFloat(n.totalbuyvalue):parseFloat(n.totalsellvalue),i+=parseInt(n.buyqty),c+=parseFloat(n.buyavgprice),m+=parseFloat(n.sellavgprice),0==n.netqty){var h=100*(parseFloat(n.sellavgprice)-parseFloat(n.buyavgprice))/parseFloat(n.buyavgprice);n.percentPnL=h.toFixed(2),u+=parseFloat(h),localStorage.removeItem("firstTimeModify"+n.tradingsymbol),localStorage.removeItem("lastTriggerprice_"+n.tradingsymbol)}n.pattenName=a.tagPatternWhichTaken(n.symboltoken);var p=a.calculateTradeExpence(n);if(n.tradeExpence=p.tradeExpence.toFixed(2),n.expenceInfo=p.expenceInfo,d+=p.tradeExpence,(f=a.getStoplossFromOrderbook(n))&&(n.stopLoss=f.stopLoss,n.stopLossAmount=f.maxLossAmount,t+=parseFloat(f.maxLossAmount)?parseFloat(f.maxLossAmount):0),a.checkSLOrTarget(n),("CE"==n.optiontype||"PE"==n.optiontype)&&n.netqty>0){var y=a.state.activeStockOptions.filter(function(e){return e.name==n.symbolname});n.optionStockName=n.symbolname,n.optiontype=n.optiontype;var b=ut.getStockTokenDetails(n.symbolname);b.optiontype=n.optiontype,b.netqty=n.netqty,b.tradingsymbol=n.tradingsymbol,y[0]?(n.optionStockLtp=y[0]&&y[0].ltp,n.optionStockChange=y[0]&&y[0].perChange):a.setState({activeStockOptions:[].concat(Object(ee.a)(a.state.activeStockOptions),[b])})}},p=0;p<r.length;p++){var f;h(p)}a.setState({todayProfitPnL:l.toFixed(2),totalbuyvalue:o.toFixed(2),totalsellvalue:s.toFixed(2),totalQtyTraded:i}),a.setState({allbuyavgprice:(c/r.length).toFixed(2),allsellavgprice:(m/r.length).toFixed(2),totalPercentage:u});a.setState({totalExpence:d.toFixed(2)}),a.setState({totalTornOver:(o+s).toFixed(2),totalMaxPnL:t.toFixed(2)}),g.sort(function(e,t){return t.netqty-e.netqty}),a.setState({positionList:g})}});case 3:case"end":return e.stop()}},e)})),a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));var t=e.target.value;x.autoCompleteSearch(t).then(function(e){var t=e.data;localStorage.setItem("autoSearchTemp",JSON.stringify(t)),a.setState({autoSearchList:t})})},a.optionStockStoplossChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));for(var t=0;t<a.state.activeStockOptions.length;t++){var n=a.state.activeStockOptions[t];if(e.target.name===n.name){n.optionStockStoploss=e.target.value;break}}},a.optionStockTargetChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));for(var t=0;t<a.state.activeStockOptions.length;t++){var n=a.state.activeStockOptions[t];if(e.target.name===n.name){n.optionStockTarget=e.target.value;break}}},a.onTrailChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.onAddSLChange=function(e){var t=a.state.addSLInfo;t[e.target.name]=e.target.value.toUpperCase(),a.setState({addSLInfo:t})},a.deleteOptionPriceSL=function(e,t){for(var n=function(n){var r=a.state.positionList[n];if(console.log("squireoffff",r.tradingsymbol,e.tradingsymbol,r.buyqty),r.tradingsymbol==e.tradingsymbol&&r.buyqty>0&&(l=localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice")))&&l.length>0)return l.splice(t,1),localStorage.setItem("trackSLPrice",JSON.stringify(l)),a.setState({trackSLPrice:l},function(){a.squareOff(r,!0)}),"break"},r=0;r<a.state.positionList.length;r++){var l;if("break"===n(r))break}},a.deleteIndexOption=function(e,t){for(var n=function(n){var r=a.state.positionList[n];if(r.tradingsymbol==e.tradingsymbol&&r.netqty>0&&a.state.activeStockOptions&&a.state.activeStockOptions.length>0)return a.state.activeStockOptions.splice(t,1),a.setState({activeStockOptions:a.state.activeStockOptions},function(){a.squareOff(r,!0)}),"break"},r=0;r<a.state.positionList.length;r++){if("break"===n(r))break}},a.getNiftyLTP=function(){x.getLTP({exchange:"NSE",tradingsymbol:"NIFTY",symboltoken:"26000"}).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;if(n&&n.ltp){var r=100*(n.ltp-n.close)/n.close;document.getElementById("niftySpid")&&(document.getElementById("niftySpid").innerHTML="<span style='color:red'> Nifty "+n.ltp.toFixed(2)+" ("+r.toFixed(2)+"%)</span>")}var l=localStorage.getItem("trackSLPrice")?JSON.parse(localStorage.getItem("trackSLPrice")):[];if(l.length>0)for(var o=0;o<l.length;o++){var s=l[o];console.log("this.state.trackSLPrice",s),"NIFTY"==s.name&&"CE"==s.optiontype&&(n.ltp<s.priceStopLoss||n.ltp>=s.priceTarget)&&(console.log("deleteOptionPriceSL call sl ",s,o),a.deleteOptionPriceSL(s,o)),"NIFTY"==s.name&&"PE"==s.optiontype&&(n.ltp>s.priceStopLoss||n.ltp<=s.priceTarget)&&(console.log("deleteOptionPriceSL put sl ",s,o),a.deleteOptionPriceSL(s))}})},a.getBankNiftyLTP=function(){x.getLTP({exchange:"NSE",tradingsymbol:"BANKNIFTY",symboltoken:"26009"}).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;if(n&&n.ltp){var r=100*(n.ltp-n.close)/n.close;document.getElementById("bankniftySpid")&&(document.getElementById("bankniftySpid").innerHTML=r>0?"<span style='color:green'> Banknifty "+n.ltp.toFixed(2)+" ("+r.toFixed(2)+"%)</span>":"<span style='color:red'> Banknifty "+n.ltp.toFixed(2)+" ("+r.toFixed(2)+"%)</span>")}var l=localStorage.getItem("trackSLPrice")?JSON.parse(localStorage.getItem("trackSLPrice")):[];if(l.length>0)for(var o=0;o<l.length;o++){var s=l[o];"BANKNIFTY"==s.name&&"CE"==s.optiontype&&(n.ltp<s.priceStopLoss||n.ltp>=s.priceTarget)&&a.deleteOptionPriceSL(s,o),"BANKNIFTY"==s.name&&"PE"==s.optiontype&&(n.ltp>s.priceStopLoss||n.ltp<=s.priceTarget)&&a.deleteOptionPriceSL(s,o)}})},a.getBankNiftyLiveLtp=function(e){if(e&&e.iv){var t=e.nc;document.getElementById("bankniftySpid")&&(document.getElementById("bankniftySpid").innerHTML=t>0?"<span style='color:green'> Banknifty "+e.iv+" ("+t+"%)</span> <span>  "+e.cng+"</span> "+ot(e.tvalue).format("h:mm:ss A"):"<span style='color:red'> Banknifty "+e.iv+" ("+t+"%)</span> <span> "+e.cng+" </span> "+ot(e.tvalue).format("h:mm:ss A"))}if(console.log("this.state.activeStockOptions",a.state.activeStockOptions),a.state.activeStockOptions.length>0)for(var n=0;n<a.state.activeStockOptions.length;n++){var r=a.state.activeStockOptions[n];"BANKNIFTY"==r.name&&"CE"==r.optiontype&&r.netqty>0&&(e.iv<r.optionStockStoploss||e.iv>=r.optionStockTarget)&&a.deleteIndexOption(r,n),"BANKNIFTY"==r.name&&"PE"==r.optiontype&&r.netqty>0&&(e.iv>r.optionStockStoploss||e.iv<=r.optionStockTarget)&&a.deleteIndexOption(r,n)}},a.placeOrderMethod=function(e){var t={transactiontype:e.transactiontype,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,quantity:e.quantity,ordertype:0===e.buyPrice?"MARKET":"LIMIT",price:e.buyPrice,producttype:"INTRADAY",duration:"DAY",squareoff:"0",stoploss:"0",exchange:"NSE",variety:"NORMAL"};console.log("place order option",t),x.placeOrder(t).then(function(t){var n=Q(t);n.status&&"SUCCESS"===n.message&&(a.setState({orderid:n.data&&n.data.orderid}),e.stopLossPrice&&a.placeSLMOrder(e))})},a.cancelOrderOfSame=function(e){var t=a.getOpenPeningOrderId(e.symboltoken),n={variety:t.variety,orderid:t.orderId};x.cancelOrder(n).then(function(e){var t=Q(e);t.status&&"SUCCESS"===t.message&&console.log("cancel order",t)})},a.squareOff=function(e,t){a.cancelOrderOfSame(e);var n={variety:"NORMAL",tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,transactiontype:e.netqty>0?"SELL":"BUY",exchange:e.exchange,ordertype:t?"MARKET":"LIMIT",producttype:e.producttype,duration:"DAY",price:0,squareoff:"0",stoploss:"0",quantity:Math.abs(e.netqty)};t&&(n.price=0),"OPTSTK"!=e.instrumenttype||"PE"!=e.optiontype&&"CE"!=e.optiontype||(n.price=ut.getMinPriceAllowTick(e.ltp-.5*e.ltp/100),n.triggerprice=ut.getMinPriceAllowTick(e.ltp-.1*e.ltp/100)),x.placeOrder(n).then(function(e){var t=Q(e);t.status&&"SUCCESS"===t.message&&(a.setState({orderid:t.data&&t.data.orderid}),document.getElementById("orderRefresh")&&document.getElementById("orderRefresh").click())})},a.updateOrderList=function(){x.retrieveOrderBook().then(function(e){var t=Q(e);if(t&&t.data){var a=t.data;a.sort(function(e,t){return new Date(t.updatetime)-new Date(e.updatetime)}),localStorage.setItem("oderbookData",JSON.stringify(a))}})},a.addSLOrderInfo=function(e){a.setState({addSLInfo:e,enableSLMOrderUi:!0})},a.placeSLMOrderManually=function(){a.state.addSLInfo.netqty=Math.abs(a.state.addSLInfo.netqty),console.log("addSLInfo",a.state.addSLInfo),ut.placeOptionSLMOrder(a.state.addSLInfo)},a.placeSLMOrder=function(e){var t={triggerprice:e.stopLossPrice,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,quantity:e.quantity,transactiontype:"BUY"===e.transactiontype?"SELL":"BUY",exchange:e.exchange?e.exchange:"NSE",producttype:e.producttype?e.producttype:"INTRADAY",duration:"DAY",price:e.price?e.price:0,squareoff:"0",stoploss:"0",ordertype:"STOPLOSS_MARKET",variety:"STOPLOSS"};console.log("SLM option data",t),x.placeOrder(t).then(function(t){var n=Q(t);if(n.status&&"SUCCESS"===n.message){a.setState({orderid:n.data&&n.data.orderid}),a.updateOrderList();var r=new SpeechSynthesisUtterance;r.text=(e.tradingsymbol+" "+e.transactiontype).toLocaleLowerCase(),window.speechSynthesis.speak(r),document.getElementById("orderRefresh")&&document.getElementById("orderRefresh").click()}})},a.getOpenPeningOrderId=function(e){for(var t=localStorage.getItem("oderbookData")&&JSON.parse(localStorage.getItem("oderbookData")),a={},n=0;n<t.length;n++)if(t[n].symboltoken===e&&"STOPLOSS"===t[n].variety){a.orderId=t[n].orderid,a.variety=t[n].variety;break}return a},a.modifyOrderMethod=function(e,t,n){var r=a.getOpenPeningOrderId(e.symboltoken);r.orderId||(e.stopLossPrice=t,e.price=n,e.quantity=Math.abs(e.netqty),"CE"==e.optiontype||"PE"==e.optiontype?e.transactiontype="BUY":e.transactiontype=e.netqty>0?"BUY":"SELL",a.placeSLMOrder(e));var l={variety:r.variety,orderid:r.orderId,ordertype:"STOPLOSS_MARKET",producttype:e.producttype,duration:"DAY",price:n?parseFloat(n):0,triggerprice:parseFloat(t),quantity:Math.abs(e.netqty),tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,exchange:e.exchange};x.modifyOrder(l).then(function(a){var n=Q(a,"noPop"),r=new SpeechSynthesisUtterance;n.status&&"SUCCESS"===n.message&&(r.text=e.symbolname+" trailed ".toLocaleLowerCase(),window.speechSynthesis.speak(r),localStorage.setItem("firstTimeModify"+e.tradingsymbol,"No"),localStorage.setItem("lastTriggerprice_"+e.tradingsymbol,parseFloat(t)),document.getElementById("orderRefresh")&&document.getElementById("orderRefresh").click())})},a.getMinPriceAllowTick=function(e){e=e.toFixed(2);var t=parseInt(e.split(".")[0]),a=parseFloat(e.split(".")[1]);return e=parseFloat(t+"."+(a-a%5))},a.get2DecimalNumber=function(e){return(e=parseFloat(e))?e.toFixed(2):e},a.getSLAndTriggerPrice=function(e){var t=a.getMinPriceAllowTick(e),n=t-1*t/100;return{minTriggerPrice:t,minSLPrice:n=a.getMinPriceAllowTick(n)}},a.getOptionPercentage=function(e){var t=0,n=0;if(e.buyavgprice=parseFloat(e.buyavgprice),t=100*(e.ltp-e.buyavgprice)/e.buyavgprice,!localStorage.getItem("firstTimeModify"+e.tradingsymbol)&&t>=a.state.firstTimeMoveOption){var r=e.buyavgprice+e.buyavgprice*a.state.firstTimeSLMoveOption/100,l=a.getSLAndTriggerPrice(r);localStorage.getItem("lastTriggerprice_"+e.tradingsymbol)!=l.minTriggerPrice&&a.modifyOrderMethod(e,l.minTriggerPrice,l.minSLPrice)}else{var o=parseFloat(localStorage.getItem("lastTriggerprice_"+e.tradingsymbol)),s=100*(e.ltp-o)/o;if(n=s,s>=a.state.nextTimeMoveOption){r=o+o*a.state.nextTimeSLMoveOption/100;var i=a.getSLAndTriggerPrice(r);localStorage.getItem("lastTriggerprice_"+e.tradingsymbol)!=i.minTriggerPrice&&a.modifyOrderMethod(e,i.minTriggerPrice,i.minSLPrice)}}return n?t.toFixed(2)+"% | Trailing "+n.toFixed(2)+"%":t.toFixed(2)+"%"},a.getPercentage=function(e){var t=0,n=0;if(e.netqty>0)if(e.buyavgprice=parseFloat(e.buyavgprice),t=100*(e.ltp-e.buyavgprice)/e.buyavgprice,!localStorage.getItem("firstTimeModify"+e.tradingsymbol)&&t>=a.state.firstTimeMove){var r=e.buyavgprice+e.buyavgprice*a.state.firstTimeSLMove/100;r=a.getMinPriceAllowTick(r),localStorage.getItem("lastTriggerprice_"+e.tradingsymbol)!=r&&a.modifyOrderMethod(e,r)}else{var l=parseFloat(localStorage.getItem("lastTriggerprice_"+e.tradingsymbol));n=o=100*(e.ltp-l)/l,o>=a.state.nextTimeMove&&(r=l+l*a.state.nextTimeSLMove/100,r=a.getMinPriceAllowTick(r),localStorage.getItem("lastTriggerprice_"+e.tradingsymbol)!=r&&a.modifyOrderMethod(e,r))}if(e.netqty<0)if(e.sellavgprice=parseFloat(e.sellavgprice),t=100*(e.ltp-e.sellavgprice)/e.sellavgprice,!localStorage.getItem("firstTimeModify"+e.tradingsymbol)&&t<=-Math.abs(a.state.firstTimeMove)){r=e.sellavgprice-e.sellavgprice*a.state.firstTimeSLMove/100;r=a.getMinPriceAllowTick(r),a.modifyOrderMethod(e,r)}else{var o;l=parseFloat(localStorage.getItem("lastTriggerprice_"+e.tradingsymbol));n=o=100*(e.ltp-l)/l,console.log("perchngfromTriggerPrice",e.tradingsymbol,o),o<=-Math.abs(a.state.nextTimeMove)&&(r=l-l*a.state.nextTimeSLMove/100,r=a.getMinPriceAllowTick(r),a.modifyOrderMethod(e,r))}return n?t.toFixed(2)+"% | Trailing "+n.toFixed(2)+"%":t.toFixed(2)+"%"},a.state={positionList:[],autoSearchList:[],InstrumentLTP:{},autoSearchTemp:[],foundPatternList:[],symboltoken:"",tradingsymbol:"",buyPrice:0,quantity:1,producttype:"DELIVERY",nr4TotalPer:0,pnlAmountTotal:0,totalNetProfit:0,totelActivatedCount:0,totalBrokerChargesNR4:0,stockTesting:"",perHighLowTotal:0,netPnLAmountOnHighlowTotal:0,firstTimeMove:.6,firstTimeSLMove:.5,nextTimeMove:.6,nextTimeSLMove:.3,firstTimeMoveOption:10,firstTimeSLMoveOption:3,nextTimeMoveOption:5,nextTimeSLMoveOption:3,staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},trackSLPrice:localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))||[],enableSLMOrderUi:!1,addSLInfo:{},niftyLtpSec:[],activeStockOptions:[]},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.updateOrderList();var t=ot("9:15am","h:mma"),a=ot("3:30pm","h:mma"),n=ot(new Date,"h:mma");if(ot().isoWeekday()<=5&&n.isBetween(t,a)){this.setState({positionInterval:setInterval(function(){e.getPositionData()},1e3)});this.state.activeStockOptions.length>10&&110*this.state.activeStockOptions.length;var r=setInterval(function(){var t=ot("3:14pm","h:mma"),a=ot("3:15pm","h:mma");ot(new Date,"h:mma").isBetween(t,a)&&e.state.positionList.forEach(function(t,a){(t.netqty>0||t.netqty<0)&&e.squareOff(t),e.state.positionList.length==a+1&&(clearInterval(r),console.log("squireInterval ended"))})},5e3)}else clearInterval(this.state.positionInterval)}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement("br",null),r.a.createElement(Oa,{getBankNiftyLiveLtp:this.getBankNiftyLiveLtp}),r.a.createElement(rt,null)," ",r.a.createElement(Ma,null),r.a.createElement(N.a,{style:{padding:"5px"},justify:"space-between",direction:"row",container:!0},r.a.createElement(N.a,{item:!0},r.a.createElement(R.a,{color:"primary",gutterBottom:!0},r.a.createElement("span",{id:"bankniftySpid"},"Banknifty "))),r.a.createElement(N.a,{item:!0},r.a.createElement(R.a,{component:"h3"},r.a.createElement("b",{style:{color:"red"}},"Expn: ",this.state.totalExpence," "))),r.a.createElement(N.a,{item:!0},r.a.createElement(R.a,{component:"h3"},r.a.createElement("b",null,"  P/L: ")," ",r.a.createElement("b",{style:{color:this.state.todayProfitPnL>0?"green":"red"}},this.state.todayProfitPnL," "))),r.a.createElement(N.a,{item:!0},r.a.createElement(R.a,Object.assign({component:"h3"},window.document.title="PnL:"+(this.state.todayProfitPnL-this.state.totalExpence).toFixed(2)),r.a.createElement("b",null," Net P/L: ")," ",r.a.createElement("b",{style:{color:this.state.todayProfitPnL-this.state.totalExpence>0?"green":"red"}},this.state.totalExpence?(this.state.todayProfitPnL-this.state.totalExpence).toFixed(2):""," "))),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{type:"number",variant:"contained",style:{float:"right"},onClick:function(){return e.getPositionData()}},"Refresh")),r.a.createElement(N.a,{item:!0},r.a.createElement(B.a,{type:"number",variant:"contained",style:{float:"right"},onClick:function(){return e.getHighLowPercentage()}},r.a.createElement(Aa.a,null)," H/L"))),r.a.createElement(N.a,{style:{padding:"5px"},spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{overflow:"auto",padding:"5px"}},r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap",backgroundColor:""},variant:"head"},r.a.createElement(ze.a,{key:"1",variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Trading Symbol"),r.a.createElement(Qe.a,{style:{paddingLeft:"3px"},className:"TableHeadFormat",align:"left"},"\xa0Spot Name"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Spot Stoploss"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Spot Target"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"BuyAvg"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"SellAvg"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"QT"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"NetQty"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Exp"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"SL"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"MD"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"P/L "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Chng % "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"LTP"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Action"),this.state.checkAmount?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Qty Cpl"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"CExp"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"CNet")):"",this.state.showHighLowWisePer?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"High"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},"Low")):"")),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.positionList?this.state.positionList.map(function(t){return"DELIVERY1"!==t.producttype?r.a.createElement(ze.a,{hover:!0,key:t.symboltoken,style:{background:"0"!==t.netqty?"lightgray":""}},r.a.createElement(Qe.a,{align:"left"},r.a.createElement(B.a,{style:{color:100*(t.ltp-t.close)/t.close>0?"green":"red"},size:"small",variant:"contained",title:"Candle refresh",onClick:function(){return e.refreshCandleChartManually(t)}},t.tradingsymbol," ",t.ltp," (",(100*(t.ltp-t.close)/t.close).toFixed(2),"%) ",r.a.createElement(Ce.a,null))),r.a.createElement(Qe.a,{align:"left"},r.a.createElement("p",{style:{color:t.optionStockChange>0?"green":"red"},size:"small",variant:"contained",title:"Candle refresh",onClick:function(){return e.refreshCandleChartManually(t)}},"\xa0  ",t.netqty&&t.optionStockName?"".concat(t.optionStockName," ").concat(t.optionStockLtp," (").concat(t.optionStockChange,"%)"):"-")),r.a.createElement(Qe.a,{align:"left"},t.netqty&&t.optionStockName?r.a.createElement("input",{step:"0.5",style:{width:"40%",textAlign:"center"},type:"number",value:t.optionStockStoploss,name:t.optionStockName,onChange:e.optionStockStoplossChange}):"-"),r.a.createElement(Qe.a,{align:"left"},t.netqty&&t.optionStockName?r.a.createElement("input",{step:"0.5",style:{width:"40%",textAlign:"center"},type:"number",value:t.optionStockTarget,name:t.optionStockName,onChange:e.optionStockTargetChange}):"-"),r.a.createElement(Qe.a,{align:"left"},r.a.createElement(B.a,{onClick:function(){return e.addSLOrderInfo(t)}}," ",t.totalbuyavgprice," "),"  "),r.a.createElement(Qe.a,{align:"left"},t.totalsellavgprice),r.a.createElement(Qe.a,{align:"left"},t.buyqty||t.sellqty),r.a.createElement(Qe.a,{align:"left"},t.netqty),r.a.createElement(Qe.a,{style:{cursor:"help"},title:t.expenceInfo,align:"left"},t.tradeExpence),r.a.createElement(Qe.a,{align:"left"}," ",t.stopLoss),r.a.createElement(Qe.a,{align:"left"}," ",t.stopLossAmount),r.a.createElement(Qe.a,{align:"left",style:{color:parseFloat(t.pnl)>0?"green":"red"}},r.a.createElement("b",null,t.pnl)),r.a.createElement(Qe.a,{align:"left"},"0"!==t.netqty&&""==t.optiontype?e.getPercentage(t):"",("CE"==t.optiontype||"PE"==t.optiontype)&&t.netqty>0?e.getOptionPercentage(t):"",t.percentPnL?t.percentPnL+"%":""),r.a.createElement(Qe.a,{align:"left"},t.ltp),r.a.createElement(Qe.a,{align:"left"},"0"!==t.netqty?r.a.createElement(B.a,{size:"small",type:"number",variant:"contained",color:"Secondary",onClick:function(){return e.squareOff(t)}},"Square Off"):""),e.state.checkAmount?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{align:"left"},r.a.createElement("i",{title:"Buy value:"+t.totalbuyvalue+" | Sell value:"+t.totalsellvalue},"  ",t.checkQty)," \xa0 ",t.checkAmount," "),r.a.createElement(Qe.a,{align:"left",title:t.checkExpence&&t.checkExpence.expenceInfo},"  ",t.checkExpence&&t.checkExpence.tradeExpence&&t.checkExpence.tradeExpence.toFixed(2)),r.a.createElement(Qe.a,{align:"left"},t.checkNet&&t.checkNet.toFixed(2))):"",e.state.showHighLowWisePer?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{align:"left"},t.high),r.a.createElement(Qe.a,{align:"left"},t.low)):""):""}):"",r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold",backgroundColor:""}},r.a.createElement(Qe.a,{className:"TableHeadFormat",colSpan:7,align:"left"}),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"}),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"}),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"}),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.totalMaxPnL),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left",style:{color:parseFloat(this.state.todayProfitPnL)>0?"green":"red"}},this.state.todayProfitPnL," "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.totalPercentage&&this.state.totalPercentage.toFixed(2)+"%"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"}),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"}),this.state.checkAmount?r.a.createElement(r.a.Fragment,null,r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.totCheckAmount),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.totCheckExp),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"},this.state.checkTotalNet)):"",r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"left"})),this.state.enableSLMOrderUi?r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{className:"TableHeadFormat",colSpan:15,align:"center"},"Stoploss \xa0",r.a.createElement("input",{placeholder:"Symbol",name:"tradingsymbol",onChange:this.onAddSLChange,value:this.state.addSLInfo&&this.state.addSLInfo.tradingsymbol,style:{width:"200px",textAlign:"center"}}),"\xa0",r.a.createElement("input",{placeholder:"Price",name:"stopLossPrice",type:"number",step:"0.1",onChange:this.onAddSLChange,value:this.state.addSLInfo&&this.state.addSLInfo.stopLossPrice,style:{width:"100px",textAlign:"center"}}),"\xa0",r.a.createElement("input",{placeholder:"Trigger Price",name:"stopLossTriggerPrice",step:"0.1",type:"number",onChange:this.onAddSLChange,value:this.state.addSLInfo&&this.state.addSLInfo.price,style:{width:"100px",textAlign:"center"}}),"\xa0 ",r.a.createElement(B.a,{size:"small",type:"number",variant:"contained",onClick:function(){return e.placeSLMOrderManually()}},"Place SL"))):"")),r.a.createElement("hr",null),r.a.createElement(N.a,{style:{padding:"5px",background:"lightgray"},justify:"space-between",direction:"row",container:!0},r.a.createElement(N.a,null,"Stoploss Trail Setting: Stock \xa0 F.Move",r.a.createElement("input",{name:"firstTimeMove",type:"number",step:"0.1",onChange:this.onTrailChange,value:this.state.firstTimeMove,style:{width:"30px",textAlign:"center"}}),"\xa0SL Move",r.a.createElement("input",{name:"firstTimeSLMove",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.firstTimeSLMove,style:{width:"30px",textAlign:"center"}}),"\xa0Next ",r.a.createElement("input",{name:"nextTimeMove",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.nextTimeMove,style:{width:"30px",textAlign:"center"}}),"\xa0SL Move",r.a.createElement("input",{name:"nextTimeSLMove",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.nextTimeSLMove,style:{width:"30px",textAlign:"center"}})),r.a.createElement(N.a,null,"\xa0 \xa0 \xa0 Option Trail%: F.Move",r.a.createElement("input",{name:"firstTimeMoveOption",type:"number",step:"0.1",onChange:this.onTrailChange,value:this.state.firstTimeMoveOption,style:{width:"30px",textAlign:"center"}}),"\xa0SL Move",r.a.createElement("input",{name:"firstTimeSLMoveOption",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.firstTimeSLMoveOption,style:{width:"30px",textAlign:"center"}}),"\xa0Next ",r.a.createElement("input",{name:"nextTimeMoveOption",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.nextTimeMoveOption,style:{width:"30px",textAlign:"center"}}),"\xa0SL Move",r.a.createElement("input",{name:"nextTimeSLMoveOption",step:"0.1",type:"number",onChange:this.onTrailChange,value:this.state.nextTimeSLMoveOption,style:{width:"30px",textAlign:"center"}}))))),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ia,null)),r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{width:"90%",height:"100%",overflow:"auto"}},"no"==localStorage.getItem("isOpenInNewPage")?r.a.createElement(ca,null):"")))}}]),t}(r.a.Component),ja=function(){onmessage=function(e){console.log("message received",e.data);var t=e.data,a=t.chunkCandleData,n=t.stock,r={};if(a.length>0){var l=a;r.name=n.name,r.symbol=n.symbol,r.token=n.token,r.entryPrice=l[0][4],r.foundAt=ot(l[0][0]).format("YYYY-MM-DD HH:mm");for(var o=[],s=1;s<l.length;s++){var i=100*(l[s][4]-r.entryPrice)/r.entryPrice,c=ot(l[s][0]).format("h:mma");o.push({perChange:i.toFixed(2),close:l[s][4],datetime:c})}r.candleData=o}console.log("message prepared ",r),postMessage(r)}}.toString();ja=ja.substring(ja.indexOf("{")+1,ja.lastIndexOf("}"));var Wa=new Blob([ja],{type:"application/javascript"}),Ra=URL.createObjectURL(Wa),Ua=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).state={cursor:0},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=new Worker(Ra);e.onmessage=function(e){console.log("msg from worker: ",e.data)},e.postMessage({arr:[{name:"vijay"}],no:10})}},{key:"render",value:function(){this.state.cursor;return r.a.createElement(_.a,null)}}]),t}(r.a.Component),_a=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.readCsv=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.state.addtowatchlist,n=JSON.parse(t),console.log(n.length),r=[],l=$.a.mark(function e(t){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=n[t],console.log(l),x.autoCompleteSearch(l.SYMBOL).then(function(e){var n=e.data.filter(function(e){return"NSE"===e.exch_seg&&"1"===e.lotsize&&e.name===l.SYMBOL});if(n.length){r.push(n[0]);var o=localStorage.getItem("watchList")?JSON.parse(localStorage.getItem("watchList")):[];o.filter(function(e){return e&&e.token===n[0]&&n[0].token}).length?(a.setState({watchlistCount:o.length}),a.setState({resMessage:[].concat(Object(ee.a)(a.state.resMessage),[t+". Already in List:  "+l.SYMBOL])})):(a.setState({resMessage:[].concat(Object(ee.a)(a.state.resMessage),[t+". ======================> New Symbol:  "+l.SYMBOL])}),a.setState({watchlistCount:o.length,counter:a.state.counter+1}),o.push(n[0]),localStorage.setItem("watchList",JSON.stringify(o)),console.log("fdaata"))}a.state.resMessage&&a.state.resMessage.length&&a.setState({resMessage:Object(ee.a)(a.state.resMessage.reverse())})}),e.next=5,new Promise(function(e){return setTimeout(e,500)});case 5:case"end":return e.stop()}},e)}),o=0;case 6:if(!(o<n.length)){e.next=11;break}return e.delegateYield(l(o),"t0",8);case 8:o++,e.next=6;break;case 11:s={listName:n[0].SYMBOL,listItem:r},console.log("newjosnlist:",s),x.addIntoStaticData(s).then(function(e){var t=Q(e,"noPop");a.setState({listName:t.listName,listCount:t.count})});case 14:case"end":return e.stop()}},e)})),a.resetCsv=function(){a.setState({addtowatchlist:"",resMessage:""})},a.state={products:[],stopnview:"",curnewdata:"",underlyingValue:"",timestamp:"",totalCOI:0,expiry:"",strike:"",FilteredBY:"",AllspTotalOI:[],PEoi:0,CEoi:0,scrollcount:0,resMessage:[],counter:0,listCount:0},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;x.getStaticData().then(function(t){var a=t.data;localStorage.setItem("staticData",JSON.stringify(a));var n=Object.keys(a);e.setState({totalWatchlist:n}),localStorage.setItem("totalWatchlist",JSON.stringify(n)),e.setState({staticData:a});var r=[];n.forEach(function(e){a[e].forEach(function(e){r.filter(function(t){return t.token===e.token}).length||r.push(e)})}),localStorage.setItem("watchList",JSON.stringify(r))});var t=localStorage.getItem("watchList")?JSON.parse(localStorage.getItem("watchList")):[];this.setState({watchlistCount:t.length})}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement(Ct.a,{style:{padding:"25px"}},r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:2,style:{paddingLeft:"5px",paddingRight:"5px",justifyContent:"center"}},r.a.createElement(N.a,{item:!0,xs:12,sm:8},r.a.createElement(R.a,{variant:"h6"},"Current Watchlist Count   ",this.state.watchlistCount,"\xa0 \xa0   \xa0 \xa0   \xa0 \xa0",r.a.createElement(B.a,{onClick:function(){localStorage.setItem("watchList",[]),window.location.reload()}},"Delete All"),r.a.createElement("br",null)),r.a.createElement(Y.a,{variant:"outlined",multiline:!0,rows:10,fullwidth:!0,style:{width:"90%",height:"50%"},label:"Paste only JSON to add into watchlist",value:this.state.addtowatchlist,name:"addtowatchlist",onChange:this.onChange})),r.a.createElement(N.a,{item:!0,xs:8,sm:8},r.a.createElement(B.a,{variant:"contained",color:"primary",onClick:function(){return e.readCsv()}}," Add to Watchlist"),"    \xa0 \xa0",r.a.createElement(B.a,{variant:"contained",color:"secondary",onClick:function(){return e.resetCsv()}},"Reset"),"\xa0 \xa0   ",r.a.createElement("b",null,"Total Added to Watchlist : ",this.state.counter),"\xa0 \xa0   ",r.a.createElement("b",null," Static Data Update: ",this.state.listName,"(",this.state.listCount,")")),r.a.createElement(N.a,{item:!0,xs:8,sm:8},this.state.resMessage?this.state.resMessage.map(function(e){return r.a.createElement(r.a.Fragment,null,"  ",r.a.createElement("span",null," ",e," "),"  ",r.a.createElement("br",null)," ")}):""))))}}]),t}(r.a.Component),Va=Object(s.b)(function(e){return{packs:e.packs.packs.data}},{setPackLoaded:Zt})(_a),Ja=a(565),qa=new Dt.w3cwebsocket("wss://omnefeeds.angelbroking.com/NestHtml5Mobile/socket/stream"),za=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).getTodayOrder=function(){x.retrieveOrderBook().then(function(e){var t=Q(e,"noPop");if(t&&t.data){var a=t.data;a.sort(function(e,t){return new Date(t.updatetime)-new Date(e.updatetime)}),localStorage.setItem("oderbookData",JSON.stringify(a))}})},a.placeSLMOrder=function(e){var t={triggerprice:e.stopLossPrice,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,quantity:e.quantity,transactiontype:"BUY"===e.transactiontype?"SELL":"BUY",exchange:"NSE",producttype:"INTRADAY",duration:"DAY",price:0,squareoff:"0",stoploss:"0",ordertype:"STOPLOSS_MARKET",variety:"STOPLOSS"};console.log("SLM option data",t),x.placeOrder(t).then(function(t){var n=Q(t);n.status&&"SUCCESS"===n.message&&(a.setState({orderid:n.data&&n.data.orderid}),a.speckIt("hey Vijay, "+e.tradingsymbol+" buy order placed"),a.getTodayOrder(),document.getElementById("orderRefresh")&&document.getElementById("orderRefresh").click())})},a.placeOrderMethod=function(e){var t={transactiontype:e.transactiontype,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,quantity:e.quantity,ordertype:0===e.buyPrice?"MARKET":"LIMIT",price:e.buyPrice,producttype:"INTRADAY",duration:"DAY",squareoff:"0",stoploss:"0",exchange:"NSE",variety:"NORMAL"};console.log("place order option",t),x.placeOrder(t).then(function(t){var n=Q(t);n.status&&"SUCCESS"===n.message&&(a.speckIt(e.tradingsymbol+" Added"),a.setState({orderid:n.data&&n.data.orderid}),e.stopLossPrice&&a.placeSLMOrder(e))})},a.getMinPriceAllowTick=function(e){e=e.toFixed(2);var t=parseInt(e.split(".")[0]),a=parseFloat(e.split(".")[1]);return e=parseFloat(t+"."+(a-a%5))},a.historyWiseOrderPlace=function(e,t,n,r){a.setState(Object(y.a)({},r,!0));var l=e.token,o=e.symbol;if("Automatic"==n||window.confirm(t+" "+o+" Are you sure ? ")){var s={exchange:"NSE",tradingsymbol:o,symboltoken:l};x.getLTP(s).then(function(e){var n=Q(e,"noPop"),s=n&&n.data;console.log(o," ltd data ",s);var i=0;if(s&&s.ltp){var c=lt.totalCapital*lt.perTradeExposurePer/100;i=Math.floor(c/s.ltp)}if(i=i>0?1:0,console.log(o,"  quantity can be order ",i),i){var m="YYYY-MM-DD HH:mm",u=ot("9:15am","h:mma").format(m);console.log("beginningTime",u);var d=ot.duration("54:10:00"),g=ot(new Date).subtract(d),h={exchange:"NSE",symboltoken:l,interval:"FIVE_MINUTE",fromdate:ot(g).format(m),todate:ot(new Date).format(m)};x.getHistoryData(h).then(function(e){var n=Q(e,"noPop");if(n&&n.data&&n.data.length){var c=n.data,m=0,u=0,d=0,g=0,h=0;if(c.reverse(),g=c[0][3],d=c[0][2],c&&c.length>0){for(var p=0;p<20;p++)c[p]&&(m+=c[p][4],u+=c[p][3],h+=c[p][2],c[p][2]>d&&(console.log(p,d,c[p][2]),d=c[p][2]),c[p][3]<=g&&(g=c[p][3]));var f=c.length>20?20:c.length,b=m/f,E=u/f,S=h/f,v=0,k=0;"BUY"==t&&(v=E-3*(d-g)/100,v=a.getMinPriceAllowTick(v),k=100*(s.ltp-v)/s.ltp,console.log(o,t," LTP ",s.ltp),console.log(o+"highestHigh:",d,"lowestLow",g,"stoploss after tick:",v,"stoploss%",k),console.log(o+"  close avg middle ",b,"lowerest avg",E,"bbhigerValue",S)),"SELL"==t&&(v=S+3*(d-g)/100,k=100*((v=a.getMinPriceAllowTick(v))-s.ltp)/s.ltp,console.log(o,t," LTP ",s.ltp),console.log(o+"highestHigh:",d,"lowestLow",g,"stoploss after tick:",v,"stoploss%",k),console.log(o+"  close avg middle ",b,"lowerest avg",E,"bbhigerValue",S));var T={transactiontype:t,tradingsymbol:o,symboltoken:l,buyPrice:0,quantity:i,stopLossPrice:v};i?(a.placeOrderMethod(T),a.setState(Object(y.a)({},r,!1))):(z.showError(o+" stoploss is > 1.5% Rejected"),console.log(o+" its not fullfilled"))}}else z.showError(o+" candle data emply"),console.log(o+" candle data emply"),a.setState(Object(y.a)({},r,!0))})}else z.showError(i+"  quantity |  "+o+" "+t+" Rejected"),a.setState(Object(y.a)({},r,!1))}).catch(function(e){this.setState(Object(y.a)({},r,!0))})}},a.updateLTPMannually=function(e){var t=a.state.staticData[e];a.refreshSectorLtp(t,e)},a.refreshSectorLtp=function(){var e=Object(te.a)($.a.mark(function e(t,n){var r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({stockUpdate:n}),a.setState({refreshFlag:!1,failedCount:0}),r=[],a.state.sectorStockList,l=$.a.mark(function e(n){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s={exchange:"NSE",tradingsymbol:t[n].symbol,symboltoken:t[n].token},x.getLTP(s).then(function(e){var a=Q(e,"noPop"),l=a&&a.data;if(l.symboltoken==t[n].token){var o=100*(l.ltp-l.close)/l.close,s=t[n];s.ltp=l.ltp,s.nc=o,s.cng=l.ltp-l.close,s.ltt=(new Date).toLocaleString(),r.push(s)}}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),console.log(t[n].symbol,e)}),e.next=4,new Promise(function(e){return setTimeout(e,101)});case 4:case"end":return e.stop()}},e)}),o=0;case 6:if(!(o<t.length)){e.next=11;break}return e.delegateYield(l(o),"t0",8);case 8:o++,e.next=6;break;case 11:n&&a.state.sectorList.forEach(function(e,t){if(e.index==n)return a.state.sectorList[t].stockList=r,a.state.sectorList[t].isStocksLtpUpdted=!0,void a.setState({sectorList:a.state.sectorList})}),a.setState({refreshFlag:!0});case 13:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.checkLast5MinMovement=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l,o,s,i;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=a.state.staticData[t],a.setState({refreshFlagCandle:!1}),console.log("sectorStockList",t),r=$.a.mark(function e(t){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ot("9:15am","h:mma"),o=ot.duration("00:06:00"),s=ot(new Date).subtract(o),i={exchange:"NSE",symboltoken:n[t].token,interval:"ONE_MINUTE",fromdate:ot(s).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},a.setState({stockCandleUpdate:t+1+". "+n&&n[t].symbol}),x.getHistoryData(i).then(function(e){var a=Q(e,"noPop");if(a&&a.data&&a.data.length){console.log(n[t].symbol,"candle history",a.data);var r=a.data,l=[],o=[],s=[],i=[],c=[],m=[],u=[];r.forEach(function(e,t){l.push([e[0],e[1],e[2],e[3],e[4]]),o.push([e[5],(e[2]+e[3]+e[4])/3]),s.push(e[4]),i.push(e[2]),c.push(e[3]),m.push(e[3]),u.push(e[5])}),console.log(n[t].symbol,n[t])}else console.log(n[t].symbol,"  emply candle found")}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),z.showError(n[t].symbol+" candle failed!")}),e.next=8,new Promise(function(e){return setTimeout(e,350)});case 8:case"end":return e.stop()}},e)}),l=0;case 5:if(!(l<n.length)){e.next=10;break}return e.delegateYield(r(l),"t0",7);case 7:l++,e.next=5;break;case 10:t&&a.state.sectorList.forEach(function(e,r){if(e.index==t)return a.state.sectorList[r].stockList=n,void a.setState({sectorList:a.state.sectorList})}),a.setState({refreshFlagCandle:!0}),console.log("sectorStockswithcandle",n);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.refreshSectorCandleManually=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l,o,s,i;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=a.state.staticData[t],a.setState({refreshFlagCandle:!1}),console.log("sectorStockList",t),r=$.a.mark(function e(t){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ot("9:15am","h:mma"),o=ot.duration("22:00:00"),s=ot(new Date).subtract(o),i={exchange:"NSE",symboltoken:n[t].token,interval:"FIFTEEN_MINUTE",fromdate:ot(s).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},a.setState({stockCandleUpdate:t+1+". "+n&&n[t].symbol}),x.getHistoryData(i).then(function(e){var a=Q(e,"noPop");if(a&&a.data&&a.data.length){var r=a.data,l=[],o=[],s=[],i=[],c=[],m=[],u=[],d=[];r.forEach(function(e,t){l.push([e[0],e[1],e[2],e[3],e[4]]),o.push([e[5],(e[2]+e[3]+e[4])/3]),s.push(e[4]),i.push(e[2]),c.push(e[3]),m.push(e[3]),u.push(e[5]),d.push((e[2]+e[3]+e[4])/3)});var g={values:s,period:14},h=st.a.calculate(g);console.log(n[t].symbol,"lastRsiValue",h[h.length-1]);var p={open:m,high:i,low:c,close:s,volume:u},f={period:20,values:d,stdDev:2},y=it.a.calculate(f);console.log(n[t].symbol,"BB",f,y),r.length>0&&(n[t].candleChartData=l,n[t].vwapValue=mt()(o),n[t].vwapDataChart=Ja.a.calculate(p),n[t].lastRsiValue=h[h.length-1]),console.log(n[t].symbol,n[t])}else console.log(n[t].symbol,"  emply candle found")}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),z.showError(n[t].symbol+" candle failed!")}),e.next=8,new Promise(function(e){return setTimeout(e,350)});case 8:case"end":return e.stop()}},e)}),l=0;case 5:if(!(l<n.length)){e.next=10;break}return e.delegateYield(r(l),"t0",7);case 7:l++,e.next=5;break;case 10:t&&a.state.sectorList.forEach(function(e,r){if(e.index==t)return a.state.sectorList[r].stockList=n,void a.setState({sectorList:a.state.sectorList})}),a.setState({refreshFlagCandle:!0}),console.log("sectorStockswithcandle",n);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.refreshSectorCandle=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({refreshFlagCandle:!1}),t=a.state.sectorStockList,console.log("sectorStockList",a.state.sectorStockList.length),n=$.a.mark(function e(n){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=ot("9:15am","h:mma"),o=ot.duration("61:00:00"),ot(new Date).subtract(o),s={exchange:"NSE",symboltoken:a.state.sectorStockList[n].token,interval:"FIVE_MINUTE",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},a.setState({stockCandleUpdate:n+1+". "+a.state.sectorStockList&&a.state.sectorStockList[n].symbol}),x.getHistoryData(s).then(function(e){var r=Q(e,"noPop");if(r&&r.data&&r.data.length){var l=r.data,o=[];if(l.forEach(function(e){o.push([e[0],e[1],e[2],e[3],e[4]])}),l.length>0){t[n].candleChartData=o;var s=a.state.sectorList;a.state.sectorList&&a.state.sectorList.forEach(function(e,a){e.stockList&&e.stockList.forEach(function(e,n){var r=t.filter(function(t){return t.token==e.token});r.length&&(s[a].stockList[n].candleChartData=r[0].candleChartData)})}),a.setState({sectorList:s}),localStorage.setItem("sectorList",JSON.stringify(s))}}else console.log(a.state.sectorStockList[n].symbol,"  emply candle found")}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),z.showError(a.state.sectorStockList[n].symbol+" candle failed!")}),e.next=8,new Promise(function(e){return setTimeout(e,350)});case 8:case"end":return e.stop()}},e)}),r=0;case 5:if(!(r<a.state.sectorStockList.length)){e.next=10;break}return e.delegateYield(n(r),"t0",7);case 7:r++,e.next=5;break;case 10:a.setState({refreshFlagCandle:!0});case 11:case"end":return e.stop()}},e)})),a.decodeWebsocketData=function(e){var t=[];try{for(var a=0;a<e.length;a++)t.push(String.fromCharCode(e[a]))}catch(n){}return t.join("")},a.makeConnection=function(){var e='{"task":"cn","channel":"NONLM","token":"'+a.state.feedToken+'","user": "'+a.state.clientcode+'","acctid":"'+a.state.clientcode+'"}';console.log("Connection sectior top firstTime_req :- "+e),qa&&(qa.send(e),a.updateSocketWatch())},a.showCandleChart=function(e,t,a,n,r){localStorage.setItem("candleChartData",JSON.stringify(e)),localStorage.setItem("cadleChartSymbol",t),localStorage.setItem("candlePriceShow",a),localStorage.setItem("candleChangeShow",n),localStorage.setItem("vwapDataChart",r),e&&e.length>0&&document.getElementById("showCandleChart").click()},a.updateSocketWatch=function(){var e=[];if(a.state.sectorList.forEach(function(t){t.percentChange>=.75&&t.stockList&&t.stockList.forEach(function(t){e.push("nse_cm|"+t.token)})}),e&&e.length){var t={task:"mw",channel:e.join("&"),token:a.state.feedToken,user:a.state.clientcode,acctid:a.state.clientcode};console.log("update watch channel",t),qa.send(JSON.stringify(t))}},a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.speckIt=function(e){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)},a.getPercentageColor=function(e){return"rgb("+((e*=100)<50?255:Math.floor(255-255*(2*e-100)/100))+","+(e>50?255:Math.floor(2*e*255/100))+",0)"},a.get2DecimalNumber=function(e){return e?e.toFixed(2):e},a.state={stopnview:"",indexTimeStamp:"",refreshFlag:!0,topGLCount:0,refreshFlagCandle:!0,sectorStockList:localStorage.getItem("sectorStockList")&&JSON.parse(localStorage.getItem("sectorStockList"))||[],sectorList:localStorage.getItem("sectorList")&&JSON.parse(localStorage.getItem("sectorList"))||[],watchList:localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))||[],staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{}},a.refreshSectorCandle=a.refreshSectorCandle.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=JSON.parse(localStorage.getItem("userTokens")),a=t&&t.feedToken,n=JSON.parse(localStorage.getItem("userProfile")),r=n&&n.clientcode;this.setState({feedToken:a,clientcode:r});var l=ot("9:15am","h:mma"),o=ot("3:30pm","h:mma"),s=ot(new Date,"h:mma");ot().isoWeekday()<=5&&s.isBetween(l,o)&&(qa.onopen=function(e){},qa.onmessage=function(t){var a=window.atob(t.data),n=e.decodeWebsocketData(Pt.a.inflate(a)),r=JSON.parse(n);window.document.title="Sector Live WS: "+r.length,e.state.sectorList&&e.state.sectorList.forEach(function(t,a){t.stockList&&t.stockList.forEach(function(t,n){var l=r.filter(function(e){return e.tk==t.token});l.length>0&&l[0].ltp&&l[0].nc&&(e.state.sectorList[a].stockList[n].ltp=l[0].ltp,e.state.sectorList[a].stockList[n].nc=l[0].nc,e.state.sectorList[a].stockList[n].cng=l[0].cng,e.state.sectorList[a].stockList[n].ltt=l[0].ltt,e.state.sectorList[a].isStocksLtpUpdted=!0)})}),e.setState({sectorList:e.state.sectorList})},qa.onerror=function(e){console.log("socket error",e),window.location.reload()},setInterval(function(){e.loadIndexesList()},12e4))}},{key:"loadIndexesList",value:function(){var e=this;this.setState({indexTimeStamp:"",refreshFlag:!1,failedCount:0,topGLCount:0}),x.allIndicesDirectJSON().then(function(t){if(t.data){var a=function(e){return new Promise(function(t){return setTimeout(t,e)})},n=(t.data&&t.data.data).sort(function(e,t){return t.percChange-e.percChange});console.log(n),e.setState({sectorList:[]}),function(){var t=Object(te.a)($.a.mark(function t(n,r){var l,o,s,i;return $.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:l=[],o=0;case 2:if(!(o<r.length)){t.next=13;break}return s=1,i=e.state.staticData[r[o].indexName],e.setState({stockUpdate:o+1+". "+r[o].indexName}),console.log(r[o].index,r[o].percChange,r[o]),r[o].percChange>=.75||r[o].percChange<=-.75?i&&i.length&&(r[o].stockList=i,s=i.length,i&&i.length&&n.refreshSectorLtp(i,r[o].indexName),e.setState({sectorList:[].concat(Object(ee.a)(e.state.sectorList),[r[o]]),topGLCount:e.state.topGLCount+1})):i&&i.length>=1&&(r[o].stockList=i,l.push(r[o])),t.next=10,a(s/10*150);case 10:o++,t.next=2;break;case 13:l.forEach(function(t){e.setState({sectorList:[].concat(Object(ee.a)(e.state.sectorList),[t])})});case 14:case"end":return t.stop()}},t)}));return function(e,a){return t.apply(this,arguments)}}()(e,n)}}).catch(function(e){}),this.setState({refreshFlag:!0})}},{key:"render",value:function(){var e=this;this.state.sectorList&&this.state.sectorList.forEach(function(e,t){e.stockList&&e.stockList.sort(function(e,t){return t.nc-e.nc})});var t=ot("9:15am","h:mma"),a=ot("03:30pm","h:mma");return ot(new Date,"h:mma").isBetween(t,a)&&this.state.sectorList&&this.state.sectorList.forEach(function(t,a){t.percentChange>.75&&t.isStocksLtpUpdted&&t.stockList&&t.stockList.forEach(function(t,a){if(a<2){var n=localStorage.getItem("autoTradeTopList")&&JSON.parse(localStorage.getItem("autoTradeTopList"))||[];n.filter(function(e){return e.token===t.token}).length||(t.foundAt=(new Date).toLocaleString(),n.push(t),localStorage.setItem("autoTradeTopList",JSON.stringify(n)),console.log(t.name+" is on top  "+(a+1)+(new Date).toLocaleString()),e.speckIt(t.name+" is on top  "+(a+1)))}})}),r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement(rt,null),r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:1,style:{paddingLeft:"5px",paddingRight:"5px"}},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(R.a,{component:"h3",variant:"h6",color:"primary"},"Top Gainer/Looser Sectors(",this.state.topGLCount,") at ",this.state.indexTimeStamp,this.state.refreshFlag?r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.loadIndexesList()}},"Live Ltp"):r.a.createElement(r.a.Fragment,null," ",r.a.createElement(B.a,null," ",r.a.createElement(gt.a,null)," \xa0 ",this.state.stockUpdate,"  ")," "),this.state.failedCount?this.state.failedCount+"Failed":"","\xa0")),this.state.sectorList?this.state.sectorList.map(function(t,a){return r.a.createElement(N.a,{item:!0,xs:12,sm:e.state.topGLCount<=2?6:3==e.state.topGLCount?4:3},r.a.createElement(Ct.a,{style:{padding:"10px",background:"lightgray",textAlign:"center"}},r.a.createElement(B.a,{size:"small",variant:"contained",title:"update ltp",onClick:function(){return e.updateLTPMannually(t.index)}},r.a.createElement("b",null," ",a+1,". ",t.index||t.indexName+" "+t.last,"(",t.percentChange||t.percChange,"%) ")),"\xa0",r.a.createElement(B.a,{size:"small",variant:"contained",title:"Candle refresh",onClick:function(){return e.refreshSectorCandleManually(t.index)}},r.a.createElement(Ce.a,null)),r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:1},t.stockList&&t.stockList.map(function(a,n){return r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(Ct.a,{style:{textAlign:"center"}},r.a.createElement(R.a,{style:{background:e.getPercentageColor(a.cng),fontSize:"14px"}},n+1,". ",a.name," ",a.ltp," (",e.get2DecimalNumber(a.nc),"%)"),a.candleChartData?r.a.createElement("span",{style:{cursor:"pointer"},onClick:function(){return e.showCandleChart(a.candleChartData,a.name,a.ltp,a.nc,a.vwapDataChart)}},r.a.createElement($e,{candleChartData:a.candleChartData,percentChange:a.nc,vwapDataChart:a.vwapDataChart})):"",a.vwapValue?r.a.createElement(R.a,null,a.vwapValue?r.a.createElement("span",{style:{background:a.ltp>a.vwapValue?"#00ff00":"red",fontSize:"14px"}},"VWAP:",r.a.createElement("b",null,a.vwapValue&&a.vwapValue.toFixed(2))," "):"","\xa0",a.lastRsiValue?r.a.createElement("span",{title:"OB means 'Overbought'",style:{background:a.lastRsiValue>=60?"#00ff00":a.lastRsiValue>=40&&a.lastRsiValue<60?"lightgray":"red",fontSize:"14px"}},"RSI:",r.a.createElement("b",null,a.lastRsiValue)," ",a.lastRsiValue>80?"OB":a.lastRsiValue>=60&&a.lastRsiValue<=80?"Buy":a.lastRsiValue>=40&&a.lastRsiValue<60?"NoTrade":"Sell"," "):""):"",r.a.createElement(N.a,{direction:"row",style:{padding:"5px"},container:!0,className:"flexGrow",justify:"space-between"},r.a.createElement(N.a,{item:!0},e.state["buyButtonClicked"+t.index+n]?r.a.createElement(gt.a,null):r.a.createElement(B.a,{size:"small",variant:"contained",color:"primary",onClick:function(){return e.historyWiseOrderPlace(a,"BUY","","buyButtonClicked"+t.index+n)}},"Buy")),r.a.createElement(N.a,{item:!0},a.ltt&&new Date(a.ltt).toLocaleTimeString()),r.a.createElement(N.a,{item:!0},e.state["sellButtonClicked"+t.index+n]?r.a.createElement(gt.a,null):r.a.createElement(B.a,{size:"small",variant:"contained",color:"secondary",onClick:function(){return e.historyWiseOrderPlace(a,"SELL","","sellButtonClicked"+t.index+n)}},"Sell")))))}))))}):r.a.createElement(gt.a,null)))}}]),t}(r.a.Component),Qa=Object(s.b)(function(e){return{packs:e.packs.packs.data}},{setPackLoaded:Zt})(za),Ka=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})(function(e){var t=e.children,a=e.classes,n=e.onClose,l=Object(He.a)(e,["children","classes","onClose"]);return r.a.createElement(Re.a,Object.assign({disableTypography:!0,className:a.root},l),r.a.createElement(R.a,{variant:"h6"},t),n?r.a.createElement(ie.a,{"aria-label":"close",className:a.closeButton,onClick:n},r.a.createElement(Je.a,null)):null)}),Ga=Object(je.a)(function(e){return{root:{padding:e.spacing(2)}}})(Ue.a),Xa=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(1)}}})(_e.a);function Za(e){var t=r.a.useState(!1),a=Object(ae.a)(t,2),n=a[0],l=a[1],o=r.a.useState({data:[],candledata:{}}),s=Object(ae.a)(o,2),i=(s[0],s[1],function(){l(!1)});return r.a.createElement("div",null,r.a.createElement(B.a,{variant:"outlined",id:"showLightCandleChart",color:"primary",style:{display:"none"},onClick:function(){l(!0)}},"Chart"),r.a.createElement(We.a,{maxWidth:"lg",onClose:i,"aria-labelledby":"customized-dialog-title",open:n},r.a.createElement(Ka,{id:"customized-dialog-title",onClose:i,style:{color:e.LightChartData.InstrumentLTP&&e.LightChartData.InstrumentLTP.change>0?"green":"red"}},e.LightChartData.selectedSymbol,"  ",e.LightChartData.InstrumentLTP&&e.LightChartData.InstrumentLTP.ltp,"    (",e.LightChartData.InstrumentLTP&&e.LightChartData.InstrumentLTP.change.toFixed(2),"%)",r.a.createElement("br",null)),r.a.createElement(Ga,{dividers:!0,id:"chart"},r.a.createElement(N.a,{style:{display:"visible"},spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement("br",null),e.LightChartData&&e.LightChartData.InstrumentLTP?r.a.createElement(N.a,{item:!0,xs:12,sm:3,style:{background:"#00000014"}},r.a.createElement("div",{style:{background:"#bdbdbd"}},r.a.createElement("b",null,"  Daily: ",e.LightChartData.selectedSymbol)," ",r.a.createElement("br",null),r.a.createElement("span",{title:"20SMA",item:!0,xs:12,sm:12,style:{color:e.LightChartData.InstrumentLTP.ltp>e.LightChartData.DailyBulishStatus?"green":"red",fontWeight:"bold"}},"Daily Avg Price: ",e.LightChartData.DailyBulishStatus&&e.LightChartData.DailyBulishStatus.toFixed(0)," ",e.LightChartData.DailyBulishStatus?e.LightChartData.InstrumentLTP.ltp>e.LightChartData.DailyBulishStatus?"BUY":"SELL":""),r.a.createElement("br",null),r.a.createElement("span",{title:"averge of showed candle volume",item:!0,xs:12,sm:12},r.a.createElement("b",null,"Daily Avg Volume:"),"  ",(e.LightChartData.dailyAvgValume/1e5).toFixed(2),"L"),r.a.createElement("br",null),r.a.createElement("span",{title:"averge of showed candle volume",item:!0,xs:12,sm:12},e.LightChartData.todayCurrentVolume>e.LightChartData.dailyAvgValume?r.a.createElement("b",{title:"if cossed avg volume then its green",style:{color:"green"}},"Today Volume: ",(e.LightChartData.todayCurrentVolume/1e5).toFixed(2),"L "):"Today Volume:"+(e.LightChartData.todayCurrentVolume/1e5).toFixed(2)+"L")),r.a.createElement("br",null),r.a.createElement("b",null,"  Intraday: ",e.LightChartData.timeFrame," : ",e.LightChartData.tradingsymbol)," ",r.a.createElement("br",null),e.LightChartData.bblastValue?r.a.createElement("span",{item:!0,xs:12,sm:12},r.a.createElement("span",{title:"Green color mean price running above upper bb band",style:{color:e.LightChartData.InstrumentLTP.ltp>=e.LightChartData.bblastValue.upper?"green":"",fontWeight:"bold"}},"BB Upper: ",e.LightChartData.bblastValue.upper.toFixed(2)),r.a.createElement("br",null),"BB Middle(20 SMA): ",e.LightChartData.bblastValue.middle.toFixed(2),r.a.createElement("br",null),r.a.createElement("span",{title:"Green red mean price running below lower bb band",style:{color:e.LightChartData.InstrumentLTP.ltp<=e.LightChartData.bblastValue.lower?"red":"",fontWeight:"bold"}},"BB Lower: ",e.LightChartData.bblastValue.lower.toFixed(2)),r.a.createElement("br",null)):"",r.a.createElement("span",{item:!0,xs:12,sm:12,style:{color:e.LightChartData.InstrumentLTP.ltp>e.LightChartData.vwapvalue?"green":"red",fontWeight:"bold"}},"VWAP:  ",e.LightChartData.vwapvalue&&e.LightChartData.vwapvalue.toFixed(2)),r.a.createElement("br",null),r.a.createElement("b",null," RSI: "),e.LightChartData.rsiValues&&e.LightChartData.rsiValues.map(function(e,t){return e>=60?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}}," ",e," \xa0"):r.a.createElement("span",{style:{color:e<=40?"red":"",fontWeight:"bold"}}," ",e," \xa0")}),r.a.createElement("br",null),r.a.createElement("b",null,"Vol:")," ",e.LightChartData.valumeData&&e.LightChartData.valumeData.map(function(t,a){return r.a.createElement("span",{style:{color:t>e.LightChartData.dailyAvgValume?"green":"",fontWeight:t>e.LightChartData.dailyAvgValume?"bold":""}}," ",(t/1e5).toFixed(2),"L \xa0")}),r.a.createElement("br",null),"  ",r.a.createElement("br",null)):"",r.a.createElement(N.a,{item:!0,xs:12,sm:9},localStorage.getItem("candleChartData")?r.a.createElement(Xe.a,{options:{chart:{type:"candlestick",height:350},title:{text:"",align:"left"},xaxis:{type:"datetime"},yaxis:{tooltip:{enabled:!0}}},series:[{data:e.LightChartData.chartStaticData}],type:"candlestick",width:500,height:350}):""))),r.a.createElement(Xa,null,r.a.createElement(B.a,{autoFocus:!0,onClick:i,color:"primary"},"Close"))))}var $a=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).getTodayOrder=function(){x.retrieveOrderBook().then(function(e){var t=Q(e,"noPop");if(t&&t.data){var n=t.data;n.sort(function(e,t){return new Date(t.updatetime)-new Date(e.updatetime)}),a.setState({oderbookData:n}),localStorage.setItem("oderbookData",JSON.stringify(n))}})},a.onChangeWatchlist=function(e){clearInterval(a.state.findlast5minMovementInterval),a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.checkLiveBids()})},a.onChangeBackDate=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.getByDateBidHistory()})},a.backupData=function(){console.log(a.state.backupDeleverydata),x.saveDeliveryData({backupDeleverydata:a.state.backupDeleverydata}).then(function(e){console.log("storeRes",(new Date).toLocaleTimeString(),e)})},a.updatebidHistory=function(e){console.log("storeResData",e),a.state.liveBidsList.forEach(function(t){var a=e.length&&e.filter(function(e){return e.symbol==t.symbol}),n=[],r=[],l=0,o=0;a.forEach(function(e,t){l&&n.push((100*(e.totalBuyBid-l)/l).toFixed(2)),o&&r.push((100*(e.totalSellBid-o)/o).toFixed(2)),l=e.totalBuyBid,o=e.totalSellBid}),t.buybidHistory=n,t.sellbidHistory=r}),a.setState({liveBidsList:a.state.liveBidsList})},a.storeBidData=function(){console.log(a.state.backupBidata);var e={backupBiddata:a.state.backupBidata,dbUpdateTime:ot(new Date).format("YYYY-MM-DD HH:mm:ss")};x.saveBidData(e).then(function(e){var t=Q(e,"noPop");a.updatebidHistory(t.result)})},a.checkLiveBids=Object(te.a)($.a.mark(function e(){var t,n,r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.state.staticData[a.state.selectedWatchlist],a.setState({liveBidsList:[],backupDeleverydata:[],backupBidata:[]}),console.log("watchList",a.state.staticData),[],n=$.a.mark(function e(n){var r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[n],x.checkLiveBids(r.name).then(function(e){if(e.data&&e.data.data.length){var r=e.data.data[0],l={quantityTraded:parseFloat(r.quantityTraded.split(",").join("")),deliveryQuantity:parseFloat(r.deliveryQuantity.split(",").join("")),deliveryToTradedQuantity:parseFloat(r.deliveryToTradedQuantity.split(",").join("")),symbol:r.symbol,todayChange:r.pChange,ltp:parseFloat(r.lastPrice.split(",").join("")),datetime:ot(r.secDate).format("YYYY-MM-DD HH:mm:ss"),averagePrice:parseFloat(r.averagePrice.split(",").join(""))},o={symbol:r.symbol,priceChangePer:r.pChange,ltp:parseFloat(r.lastPrice.split(",").join("")),updatedTime:ot(r.secDate).format("YYYY-MM-DD HH:mm:ss"),totalBuyBid:parseFloat(r.totalBuyQuantity.split(",").join(""))?parseFloat(r.totalBuyQuantity.split(",").join("")):0,totalSellBid:parseFloat(r.totalSellQuantity.split(",").join(""))?parseFloat(r.totalSellQuantity.split(",").join("")):0,quantityTraded:"-"!=r.quantityTraded?parseFloat(r.quantityTraded.split(",").join("")):0,deliveryToTradedQuantity:parseFloat(r.deliveryToTradedQuantity.split(",").join("")),deliveryQuantity:parseFloat(r.deliveryQuantity.split(",").join("")),averagePrice:parseFloat(r.averagePrice.split(",").join("")),buyPrice1:parseFloat(r.buyPrice1.split(",").join("")),buyPrice2:parseFloat(r.buyPrice2.split(",").join("")),buyPrice3:parseFloat(r.buyPrice3.split(",").join("")),buyPrice4:parseFloat(r.buyPrice4.split(",").join("")),buyPrice5:parseFloat(r.buyPrice5.split(",").join("")),buyQuantity1:parseFloat(r.buyQuantity1.split(",").join("")),buyQuantity2:parseFloat(r.buyQuantity2.split(",").join("")),buyQuantity3:parseFloat(r.buyQuantity3.split(",").join("")),buyQuantity4:parseFloat(r.buyQuantity4.split(",").join("")),buyQuantity5:parseFloat(r.buyQuantity5.split(",").join("")),sellPrice1:parseFloat(r.sellPrice1.split(",").join("")),sellPrice2:parseFloat(r.sellPrice2.split(",").join("")),sellPrice3:parseFloat(r.sellPrice3.split(",").join("")),sellPrice4:parseFloat(r.sellPrice4.split(",").join("")),sellPrice5:parseFloat(r.sellPrice5.split(",").join("")),sellQuantity1:parseFloat(r.sellQuantity1.split(",").join("")),sellQuantity2:parseFloat(r.sellQuantity2.split(",").join("")),sellQuantity3:parseFloat(r.sellQuantity3.split(",").join("")),sellQuantity4:parseFloat(r.sellQuantity4.split(",").join("")),sellQuantity5:parseFloat(r.sellQuantity5.split(",").join(""))};a.setState({backupBidata:[].concat(Object(ee.a)(a.state.backupBidata),[o])}),n===t.length-1&&setTimeout(function(){console.log("last loaggged"),a.storeBidData()},1e3),a.setState({backupDeleverydata:[].concat(Object(ee.a)(a.state.backupDeleverydata),[l])}),r.quantityTraded="-"!=r.quantityTraded?parseFloat(r.quantityTraded.split(",").join("")):"0",r.deliveryQuantity="-"!=r.deliveryQuantity?parseFloat(r.deliveryQuantity.split(",").join("")):"0",r.totalBuyQuantity="-"!=r.totalBuyQuantity?parseFloat(r.totalBuyQuantity.split(",").join("")):"0",r.totalSellQuantity="-"!=r.totalSellQuantity?parseFloat(r.totalSellQuantity.split(",").join("")):"0",r.totalTradedVolume="-"!=r.totalTradedVolume?parseFloat(r.totalTradedVolume.split(",").join("")):"0",r.totalTradedValue="-"!=r.totalTradedValue?parseFloat(r.totalTradedValue.split(",").join("")):"0",r.buytosellTime=r.totalBuyQuantity/r.totalSellQuantity,r.selltobuyTime=r.totalSellQuantity/r.totalBuyQuantity,a.state.liveBidsList.sort(function(e,t){return t.pChange-e.pChange}),r.totalBuyQuantity/r.totalSellQuantity>1.25&&(r.highlightbuy=!0),r.totalSellQuantity/r.totalBuyQuantity>1.25&&(r.highlightsell=!0),a.setState({liveBidsList:[].concat(Object(ee.a)(a.state.liveBidsList),[r]),lastUpdateTime:e.data.lastUpdateTime},function(){localStorage.setItem("liveBidsList",JSON.stringify(this.state.liveBidsList)),window.document.title="Del: "+this.state.liveBidsList[0].symbol})}}),e.next=4,new Promise(function(e){return setTimeout(e,200)});case 4:case"end":return e.stop()}},e)}),r=0;case 6:if(!(r<t.length)){e.next=11;break}return e.delegateYield(n(r),"t0",8);case 8:r++,e.next=6;break;case 11:case"end":return e.stop()}},e)})),a.getDeliveryHistory=function(){for(var e=function(e){var t=a.state.liveBidsList[e];x.getDeliveryDataFromDb(t.symbol).then(function(e){var n=Q(e,"noPop");if(console.log("hist data",n.result),n&&n.result){var r=n.result;t.delHistory=r,console.log(t.symbol,r),a.setState({liveBidsList:a.state.liveBidsList})}})},t=0;t<a.state.liveBidsList.length;t++)e(t)},a.getByDateBidHistory=function(){a.setState({liveBidsList:[]});var e=a.state.staticData[a.state.selectedWatchlist],t=[];e.forEach(function(e){t.push("'"+e.name+"'")}),x.getBidDataFromDb(a.state.backDate,t.join(","),t.length).then(function(e){var t=Q(e,"noPop");if(console.log("hist bidHistoty",t.result),t&&t.result){for(var n=t.result,r=0;r<n.length;r++){var l=n[r],o={quantityTraded:l.quantityTraded,deliveryQuantity:l.deliveryQuantity,totalBuyQuantity:l.totalBuyBid,totalSellQuantity:l.totalSellBid,lastPrice:l.ltp,pChange:l.priceChangePer,symbol:l.symbol,updatedTime:l.updatedTime};o.buytosellTime=l.totalBuyBid/l.totalSellBid,o.selltobuyTime=l.totalSellBid/l.totalBuyBid,l.totalBuyBid/l.totalSellBid>1.25&&(o.highlightbuy=!0),l.totalSellBid/l.totalBuyBid>1.25&&(o.highlightsell=!0),a.setState({liveBidsList:[].concat(Object(ee.a)(a.state.liveBidsList),[o]),lastUpdateTime:a.state.backDate},function(){this.state.liveBidsList.sort(function(e,t){return t.pChange-e.pChange})})}a.updatebidHistory(t.bidHistoty)}})},a.getBackUpDate=function(){x.getBackUpdateList().then(function(e){var t=Q(e,"noPop");if(console.log(t),t&&t.result){var n=[];t.result.forEach(function(e){e.dbUpdateTime&&n.push(ot(e.dbUpdateTime).format("YYYY-MM-DD HH:mm:ss"))}),a.setState({backupDateList:n},function(){})}})},a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value.trim()))},a.convertToFloat=function(e){if(!isNaN(e))return"("+(e/1e5).toFixed(2)+"L)"},a.getPercentageColor=function(e){return"rgb("+((e*=100)<50?255:Math.floor(255-255*(2*e-100)/100))+","+(e>50?255:Math.floor(2*e*255/100))+",0)"},a.sortByColumn=function(e){a.state.liveBidsList.sort(function(t,a){return a[e]-t[e]}),a.setState({liveBidsList:a.state.liveBidsList,sortedType:e})},a.state={oderbookData:[],listofzones:[],selectedZone:[],zone:"",selectAllzone:"Select All",triggerprice:0,price:0,lotsize:0,firstTimeFlag:!0,staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],selectedWatchlist:localStorage.getItem("clickedIndexName")?localStorage.getItem("clickedIndexName"):"NIFTY BANK",totalStockToWatch:0,timeFrame:"TEN_MINUTE",chartStaticData:[],qtyToTake:"",BBBlastType:"BBBlastOnly",liveBidsList:[],sortedType:"pChange",backupDeleverydata:[],backupBidata:[],backupDateList:[],backDate:""},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=ot("9:15am","h:mma"),a=ot("3:30pm","h:mma"),n=ot(new Date,"h:mma");ot().isoWeekday()<=5&&n.isBetween(t,a)&&(console.log("setInterval"),setInterval(function(){e.checkLiveBids()},3e5)),this.checkLiveBids(),this.getBackUpDate(),console.log("ddd",this.state.selectedWatchlist)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,"#/delivery"===window.location.hash?r.a.createElement(Et,null):"",r.a.createElement(N.a,{direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(N.a,{justify:"space-between",container:!0,spacing:1},r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(R.a,{component:"h2",variant:"h6",color:"primary",gutterBottom:!0},this.state.selectedWatchlist," (",this.state.liveBidsList.length,") updated at ",this.state.lastUpdateTime),r.a.createElement("span",null,"Sorted By:  ",this.state.sortedType," ")),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:en.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),r.a.createElement(ft.a,{value:this.state.selectedWatchlist,name:"selectedWatchlist",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"selectall"},"Select All"),this.state.totalWatchlist&&this.state.totalWatchlist.map(function(e){return r.a.createElement(yt.a,{value:e},e)})))),r.a.createElement(N.a,{item:!0,xs:12,sm:3},r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.checkLiveBids()}},"Refresh")),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.backupData()}},"BackUp")),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,{style:en.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Back Date"),r.a.createElement(ft.a,{value:this.state.backDate,name:"backDate",onChange:this.onChangeBackDate},r.a.createElement(yt.a,{value:""},"Select Date"),this.state.backupDateList&&this.state.backupDateList.map(function(e){return r.a.createElement(yt.a,{value:e},e)}))))),r.a.createElement(qe.a,{size:"small",style:{width:"100%"},"aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"left"},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("pChange")}}," Symbol")," "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("buytosellTime")}},"buyTosell"),"  "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("selltobuyTime")}},"sellTobuy"),"  "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("totalBuyQuantity")}}," Total Buy Quantity"),"  "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("totalSellQuantity")}}," Total Sell Quantity"),"  "),r.a.createElement(Qe.a,{align:"center"},"Average Price"),r.a.createElement(Qe.a,{align:"center"},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("quantityTraded")}}," Quantity Traded"),"  "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("deliveryQuantity")}}," Delivery Quantity"),"  "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement(B.a,{title:"Delivery To Traded Quantity",onClick:function(){return e.sortByColumn("deliveryToTradedQuantity")}}," Del To Traded Qty%"),"  "),r.a.createElement(Qe.a,{align:"center"},r.a.createElement(B.a,{onClick:function(){return e.getDeliveryHistory()}},"Delivery History"),"  "))),r.a.createElement(Ke.a,null,this.state.liveBidsList?this.state.liveBidsList.map(function(t,a){return r.a.createElement(ze.a,{hover:!0,key:a,style:{background:e.getPercentageColor(t.pChange)}},r.a.createElement(Qe.a,{align:"left"},t.symbol," ",t.lastPrice," (",t.pChange,"%)"),r.a.createElement(Qe.a,{style:{background:t.highlightbuy?"lightgray":""},align:"center"},t.buytosellTime.toFixed(2)," time buy"),r.a.createElement(Qe.a,{style:{background:t.highlightsell?"lightgray":""},align:"center"},t.selltobuyTime.toFixed(2)," time sell"),r.a.createElement(Qe.a,{align:"center",style:{background:"#eceff1"}},t.buybidHistory&&t.buybidHistory.map(function(e){return r.a.createElement("span",{style:{color:e>0?"green":"red"}}," ",e,"% ")}),r.a.createElement("br",null),t.totalBuyQuantity," ",e.convertToFloat(t.totalBuyQuantity)),r.a.createElement(Qe.a,{align:"center",style:{background:"#eceff1"}},t.sellbidHistory&&t.sellbidHistory.map(function(e){return r.a.createElement("span",{style:{color:e>0?"green":"red"}}," ",e,"% ")}),r.a.createElement("br",null),t.totalSellQuantity," ",e.convertToFloat(t.totalSellQuantity)),r.a.createElement(Qe.a,{align:"left"},t.averagePrice),r.a.createElement(Qe.a,{align:"center"},t.quantityTraded," ",e.convertToFloat(t.quantityTraded)),r.a.createElement(Qe.a,{align:"center"},t.deliveryQuantity," ",e.convertToFloat(t.deliveryQuantity)),r.a.createElement(Qe.a,{align:"center"},t.deliveryToTradedQuantity,"%"),r.a.createElement(Qe.a,{style:{background:"#eceff1"},align:"center"},t.delHistory&&t.delHistory.map(function(e){return r.a.createElement("span",null," ",new Date(e.datetime).toLocaleDateString(),"  \xa0",r.a.createElement("span",{title:"quantityTraded "+e.quantityTraded}," ",(e.quantityTraded/1e5).toFixed(2),"L  "),"  \xa0",r.a.createElement("span",{title:"deliveryToTradedQuantity"}," ",e.deliveryToTradedQuantity,"%  "),"  \xa0",r.a.createElement("span",{title:"deliveryQuantity "+e.deliveryQuantity}," ",(e.deliveryQuantity/1e5).toFixed(2),"L  "),"  \xa0",r.a.createElement("span",{style:{color:e.todayChange>0?"green":"red"}}," (",e.todayChange,"%)   "),"\xa0  ",r.a.createElement("br",null))})))}):r.a.createElement(gt.a,null)))))))}}]),t}(r.a.Component),en={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},tn=$a;var an=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).componentDidMount=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.document.title="Index Charts",t=a.state.staticData[a.state.selectedWatchlist],a.setState({totalStockToWatch:t&&t.length}),n=ot("9:15am","h:mma"),r=ot("3:30pm","h:mma"),5,l=ot(new Date,"h:mma"),o=ot().isoWeekday(),s=setInterval(function(){var e=new Date;e.getMinutes()%10===0&&(console.log("search method call in with setTimeout 70sec",e.toLocaleTimeString()),setTimeout(function(){a.find10MinBBBlast()},7e4),a.setState({stop10bbSearch:setInterval(function(){console.log("search method call in with setInterval in 10min",e.toLocaleTimeString()),o<=5&&l.isBetween(n,r)&&a.find10MinBBBlast()},67e4)}),clearInterval(s))},1e3),a.find10MinBBBlast();case 10:case"end":return e.stop()}},e)})),a.stopSearching=function(){console.log("stop the search"),clearInterval(a.state.findlast5minMovementInterval),clearInterval(a.state.stop10bbSearch)},a.showCandleChart=function(e,t,a,n){localStorage.setItem("candleChartData",JSON.stringify(e)),localStorage.setItem("cadleChartSymbol",t),localStorage.setItem("candlePriceShow",a),localStorage.setItem("candleChangeShow",n.toFixed(2)),document.getElementById("showCandleChart").click()},a.onChangeWatchlist=function(e){clearInterval(a.state.findlast5minMovementInterval),a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.find10MinBBBlast()})},a.onChangeQty=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.getTimeFrameValue=function(e){switch(e){case"ONE_MINUTE":return"200:00:00";case"FIVE_MINUTE":return"1000:00:00";case"TEN_MINUTE":return"1500:00:00";case"FIFTEEN_MINUTE":return"2160:00:00";case"THIRTY_MINUTE":return"4320:00:00";case"ONE_HOUR":return"8320:00:00";case"ONE_DAY":return"15000:00:00"}},a.calculateSMA=function(e,t){for(var a=function(e){for(var t=0,a=0;a<e.length;a++)t+=e[a].close;return t/e.length},n=[],r=t-1,l=e.length;r<l;r++){var o=a(e.slice(r-t+1,r));n.push({time:e[r].time,value:o})}return n},a.getRSIBBString=function(e){var t="";return e.BB&&(e.ltp>=e.BB.upper?t+='<span style="color:green">BBupr:'+e.BB.upper+"</span>":t+='<span style="color:red">BBupr:'+e.BB.upper+"</span>",e.ltp<=e.BB.lower?t+=' <span style="color:green">BBlwr:'+e.BB.lower+"</span>":t+=' <span style="color:red">BBlwr:'+e.BB.lower+"</span>"),t+="<br/>RSI:",e.RSI.forEach(function(e){t+=e>=60?' <span style="color:green">'+e+"</span>":e>=40&&e<=59?' <span style="color:black">'+e+"</span>":' <span style="color:red">'+e+"</span>"}),t},a.createMultpleChart=function(e){var t=document.createElement("div");t.style.display="block",t.style.padding="10px",t.style.marginLeft="10px",t.style.marginTop="10px",t.style.border="2px solid "+ut.getPercentageColor(e.perChange);var n=document.createElement("div");t.appendChild(n),n.style.display="block",n.style.left="3px",n.style.top="3px",e.perChange>0?n.style.color="green":n.style.color="red",n.innerHTML=e.name+" "+e.ltp+" ("+e.perChange+"%) <br />";var r=document.createElement("div");t.appendChild(r),r.style.fontSize="10px";var l=Object(It.a)(t,{width:a.state.chartSize,height:a.state.chartSize,timeVisible:!0,secondsVisible:!0});l.addCandlestickSeries({upColor:"green",downColor:"red",borderDownColor:"red",borderUpColor:"green",wickDownColor:"red",wickUpColor:"green"}).setData(e.lightChartData);var o=a.calculateSMA(e.lightChartData,20);l.addLineSeries({color:"rgba(4, 111, 232, 1)",lineWidth:2}).setData(o),l.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}}).setData(e.volumeSeriesData);n=document.createElement("div");t.append(n),n.style.display="block",n.innerHTML=a.getRSIBBString(e),document.getElementById("allchart")&&document.getElementById("allchart").append(t),l.subscribeCrosshairMove(function(e){var t=e.seriesPrices[Symbol.iterator](),a="",n="",l=!0,o=!1,s=void 0;try{for(var i,c=t[Symbol.iterator]();!(l=(i=c.next()).done);l=!0){var m=i.value;"object"==typeof m[1]?(a+=" O: <b>"+m[1].open+"</b>",a+=" H: <b>"+m[1].high+"</b>",a+=" L: <b>"+m[1].low+"</b>",a+=" C: <b>"+m[1].close+"</b>",a+=" CH: <b>"+(n=100*(m[1].close-m[1].open)/m[1].open).toFixed(2)+"%</b><br />"):a+=" "+m[1].toFixed(2)+" "}}catch(d){o=!0,s=d}finally{try{l||null==c.return||c.return()}finally{if(o)throw s}}e.time&&(a+=" Time:<b> "+new Date(e.time).toLocaleString()+"</b>");var u="<span style=color:green>"+a+"</span> ";n<0&&(u="<span style=color:red>"+a+"</span> "),r.innerHTML=u}),a.sortTheChart()},a.sortTheChart=function(){var e=document.getElementById("allchart"),t=[];function n(a){document.querySelector("#allchart").childNodes.forEach(function(n){n.innerText&&n.innerText.split(" ")[0]==a&&(console.log("item",a,n.innerText.split(" ")[0],n),e.appendChild(n),t.push(n))})}for(var r=0;r<a.state.findlast5minMovement.length;r++)n(a.state.findlast5minMovement[r].name)},a.updateToLocalStorage=function(e){var t=new Date(e.foundAt).toLocaleString(),n=a.state.fastMovementList.filter(function(a){return a.token==e.token&&a.foundAt==t});if(console.log("isfound",n),n.length)return!1;var r={token:e.token,foundAt:t,ltp:e.ltp,symbol:e.symbol,nc:e.perChange.toFixed(2),orderType:e.orderType};return a.state.fastMovementList.push(r),localStorage.setItem("fastMovementList",JSON.stringify(a.state.fastMovementList)),!0},a.find10MinBBBlast=Object(te.a)($.a.mark(function e(){var t,n,r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(document.getElementById("allchart")&&(document.getElementById("allchart").innerHTML=""),a.setState({findlast5minMovementUpdate:"",findlast5minMovement:[]}),t=a.state.staticData[a.state.selectedWatchlist],"gainerList"==a.state.selectedWatchlist&&(t=localStorage.getItem("gainerList")&&JSON.parse(localStorage.getItem("gainerList"))),"looserList"==a.state.selectedWatchlist&&(t=localStorage.getItem("looserList")&&JSON.parse(localStorage.getItem("looserList"))),"selectall"==a.state.selectedWatchlist&&(t=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))),a.setState({totalStockToWatch:t&&t.length}),!t||!t.length){e.next=17;break}n=$.a.mark(function e(n){var r,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({findlast5minMovementUpdate:n+1+". "+t[n].symbol+" At "+(new Date).toLocaleTimeString()}),r="YYYY-MM-DD HH:mm",ot("9:15am","h:mma").format(r),s=a.getTimeFrameValue(a.state.timeFrame),ot.duration("1000:00:00"),l=ot(new Date).subtract(s),o={exchange:t[n].exch_seg,symboltoken:t[n].token,interval:a.state.timeFrame,fromdate:ot(l).format(r),todate:ot(new Date).format(r)},x.getHistoryData(o).then(function(e){var r=Q(e,"noPop");if(r&&r.data&&r.data.length){var l=r.data,o=[],s=[],i=[],c=[],m=[],u=[],d=[],g=[],h=[];l.forEach(function(e,t){o.push([e[0],e[1],e[2],e[3],e[4]]),s.push([e[5],(e[2]+e[3]+e[4])/3]),i.push(e[4]),c.push(e[2]),m.push(e[3]),u.push(e[3]),d.push(e[5]),g.push((e[2]+e[3]+e[4])/3),h.push({time:new Date(e[0]).getTime(),value:e[5],color:"rgba(211, 211, 211, 1)"})});Ft.a.calculate({period:20,values:i});var p={values:i,period:14},f=st.a.calculate(p),y={open:u,high:c,low:m,close:i,volume:d},b={period:20,values:g,stdDev:2},E=it.a.calculate(b),S=(s=Ja.a.calculate(y),E[E.length-1]);S&&(S.upper=S.upper.toFixed(2),S.middle=S.middle.toFixed(2),S.lower=S.lower.toFixed(2));var v=l.map(function(e){return{time:new Date(e[0]).getTime(),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4])}}),k={exchange:"NSE",tradingsymbol:t[n].symbol,symboltoken:t[n].token};x.getLTP(k).then(function(e){var r=Q(e,"noPop"),i=r&&r.data;if(i&&i.ltp){var c={symbol:t[n].symbol,token:t[n].token,RSIValue:f[f.length-1],RSI:f.slice(Math.max(f.length-8,1)),valumeData:d.slice(Math.max(d.length-8,1)),VWAP:s[s.length-1],BB:S,candleChartData:o,foundAt:l&&new Date(l[l.length-1][0]).toLocaleString(),name:t[n].name,lightChartData:v,volumeSeriesData:h};c.perChange=(100*(i.ltp-i.close)/i.close).toFixed(2),c.ltp=i.ltp,a.setState({findlast5minMovement:[].concat(Object(ee.a)(a.state.findlast5minMovement),[c])},function(){this.state.findlast5minMovement&&this.state.findlast5minMovement.sort(function(e,t){return t.perChange-e.perChange}),this.createMultpleChart(c)})}})}else console.log(t[n].symbol,"  emply candle found")}),e.next=10,new Promise(function(e){return setTimeout(e,600)});case 10:case"end":return e.stop()}},e)}),r=0;case 10:if(!(r<t.length)){e.next=15;break}return e.delegateYield(n(r),"t0",12);case 12:r++,e.next=10;break;case 15:e.next=18;break;case 17:z.showError("No Stock Found");case 18:case"end":return e.stop()}},e)})),a.callbackAfterOrderDone=function(e){console.log("order executed",e)},a.handleClick=function(e,t,n){if(console.log(e),e.token&&e.symbol){if("BUY"==t){a.setState(Object(y.a)({},n,!0));var r={token:e.token,symbol:e.symbol,qtyToTake:a.state.qtyToTake};console.log(r),ut.historyWiseOrderPlace(r,"BUY","no",a.callbackAfterOrderDone),a.setState(Object(y.a)({},n,!1))}if("SELL"==t){a.setState(Object(y.a)({},n,!0));r={token:e.token,symbol:e.symbol,qtyToTake:a.state.qtyToTake};console.log(r),ut.historyWiseOrderPlace(r,"SELL","no",a.callbackAfterOrderDone),a.setState(Object(y.a)({},n,!1))}}else z.showError(" Symbol Not found!!!")},a.state={staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],selectedWatchlist:localStorage.getItem("clickedIndexName")?localStorage.getItem("clickedIndexName"):"NIFTY BANK",totalStockToWatch:0,chartSize:300,timeFrame:"FIFTEEN_MINUTE",chartStaticData:[],BBBlastType:"BBStrongBreakout",qtyToTake:"",fastMovementList:localStorage.getItem("fastMovementList")&&JSON.parse(localStorage.getItem("fastMovementList"))||[],findlast5minMovement:[],gainerList:localStorage.getItem("gainerList")&&JSON.parse(localStorage.getItem("gainerList"))||[],looserList:localStorage.getItem("looserList")&&JSON.parse(localStorage.getItem("looserList"))||[]},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentWillUnmount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t,a){return e}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,"#/index-charts"===window.location.hash?r.a.createElement(Et,null):"",r.a.createElement("br",null),r.a.createElement(rt,null)," ",r.a.createElement(Ma,null),r.a.createElement(N.a,{justify:"space-between",container:!0,spacing:1},r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(R.a,{component:"h2",variant:"h6",color:"primary",gutterBottom:!0},"\xa0 ",this.state.selectedWatchlist," Stocks (",this.state.findlast5minMovement&&this.state.findlast5minMovement.length,")",r.a.createElement("span",{id:"stockTesting",style:{fontSize:"18px",color:"gray"}}," ",this.state.findlast5minMovementUpdate," "))),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,{style:nn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Chart Size"),r.a.createElement(ft.a,{value:this.state.chartSize,name:"chartSize",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:250},"250px"),r.a.createElement(yt.a,{value:300},"300px"),r.a.createElement(yt.a,{value:350},"350px"),r.a.createElement(yt.a,{value:450},"450px"),r.a.createElement(yt.a,{value:550},"550px"),r.a.createElement(yt.a,{value:650},"650px")))),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:nn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),r.a.createElement(ft.a,{value:this.state.selectedWatchlist,name:"selectedWatchlist",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"gainerList"},"Gainer List ("+this.state.gainerList.length+")"),r.a.createElement(yt.a,{value:"looserList"},"Looser List ("+this.state.looserList.length+")"),r.a.createElement(yt.a,{value:"selectall"},"Select All"),this.state.totalWatchlist&&this.state.totalWatchlist.map(function(e){return r.a.createElement(yt.a,{value:e},e)})))),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,{style:nn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Time"),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1 Min"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5 Min"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10 Min"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15 Min"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30 Min"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1 Hour"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1 Day")))),r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.find10MinBBBlast()}},"Start"),r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.stopSearching()}},"Stop"))),r.a.createElement(N.a,{container:!0,spacing:2,style:{padding:"10px"},id:"allchart"}))}}]),t}(r.a.Component),nn={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},rn=an,ln=(Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})(function(e){var t=e.children,a=e.classes,n=e.onClose,l=Object(He.a)(e,["children","classes","onClose"]);return r.a.createElement(Re.a,Object.assign({disableTypography:!0,className:a.root},l),r.a.createElement(R.a,{variant:"h6"},t),n?r.a.createElement(ie.a,{"aria-label":"close",className:a.closeButton,onClick:n},r.a.createElement(Je.a,null)):null)}),Object(je.a)(function(e){return{root:{padding:e.spacing(2)}}})(Ue.a)),on=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(1)}}})(_e.a);function sn(e){var t=r.a.useState(!1),a=Object(ae.a)(t,2),n=a[0],l=a[1],o=r.a.useState({data:[],candledata:{}}),s=Object(ae.a)(o,2),i=(s[0],s[1],function(){l(!1)});return r.a.createElement("div",null,r.a.createElement(B.a,{variant:"outlined",id:"showCandleChart",color:"primary",style:{display:"visible"},onClick:function(){l(!0)}},"Add to OW"),r.a.createElement(We.a,{onClose:i,"aria-labelledby":"customized-dialog-title",open:n},r.a.createElement(ln,{dividers:!0,id:"chart"},r.a.createElement(ca,null)),r.a.createElement(on,null,r.a.createElement(B.a,{autoFocus:!0,onClick:i,color:"primary"},"Close"))))}var cn=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).componentDidMount=Object(te.a)($.a.mark(function e(){var t;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.document.title="Index Charts",t=a.state.staticData[a.state.selectedWatchlist],a.setState({totalStockToWatch:t&&t.length}),ot("9:15am","h:mma"),ot("3:30pm","h:mma"),5,ot(new Date,"h:mma"),ot().isoWeekday();case 8:case"end":return e.stop()}},e)})),a.stopSearching=function(){clearInterval(a.state.strongChartListInterval),clearInterval(a.state.stop10bbSearch),a.setState({stopChart:!0})},a.showCandleChart=function(e,t,a,n){localStorage.setItem("candleChartData",JSON.stringify(e)),localStorage.setItem("cadleChartSymbol",t),localStorage.setItem("candlePriceShow",a),localStorage.setItem("candleChangeShow",n.toFixed(2)),document.getElementById("showCandleChart").click()},a.onChangeWatchlist=function(e){clearInterval(a.state.strongChartListInterval),a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.findStrongCharts()})},a.onChangeQty=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.getTimeFrameValue=function(e){switch(e){case"ONE_MINUTE":return"200:00:00";case"FIVE_MINUTE":return"1000:00:00";case"TEN_MINUTE":return"1500:00:00";case"FIFTEEN_MINUTE":return"2160:00:00";case"THIRTY_MINUTE":return"4320:00:00";case"ONE_HOUR":return"8320:00:00";case"ONE_DAY":return"15000:00:00"}},a.calculateSMA=function(e,t){for(var a=function(e){for(var t=0,a=0;a<e.length;a++)t+=e[a].close;return t/e.length},n=[],r=t-1,l=e.length;r<l;r++){var o=a(e.slice(r-t+1,r));n.push({time:e[r].time,value:o})}return n},a.getRSIBBString=function(e){var t="";return e.BB&&(e.ltp>=e.BB.upper?t+='<span style="color:green">BBupr:'+e.BB.upper+"</span>":t+='<span style="color:red">BBupr:'+e.BB.upper+"</span>",e.ltp<=e.BB.lower?t+=' <span style="color:green">BBlwr:'+e.BB.lower+"</span>":t+=' <span style="color:red">BBlwr:'+e.BB.lower+"</span>"),t+="<br/>RSI:",e.RSI.forEach(function(e){t+=e>=60?' <span style="color:green">'+e+"</span>":e>=40&&e<=59?' <span style="color:black">'+e+"</span>":' <span style="color:red">'+e+"</span>"}),t},a.createMultpleChart=function(e){var t=document.createElement("div");t.style.display="block",t.style.padding="10px",t.style.marginLeft="10px",t.style.marginTop="10px",t.style.border="2px solid "+ut.getPercentageColor(e.perChange);var n=document.createElement("div");t.appendChild(n),n.style.display="block",n.style.left="3px",n.style.top="3px",e.perChange>0?n.style.color="green":n.style.color="red";var r=e.name+" "+e.ltp+" (<b>"+e.perChange+'%</b>)  &nbsp;&nbsp; <b title="previous volume broken count" >VBC:  '+e.candleVolBrokenCount+" </b><br />";r+='<span style="color:black">Emotions: </span> ',e.strongPer&&(e.strongPer>=75?r+='<span style="color:green"><b>Buying :'+e.strongPer.toFixed(2)+"%</b></span>":r+='<span  style="color:black">Buying:'+e.strongPer.toFixed(2)+"% </span>"),e.strongPer&&(e.strongPer<=25?r+='<span style="color:red"><b> Selling :'+(100-e.strongPer).toFixed(2)+"%</b></span>":r+='<span  style="color:black"> Selling:'+(100-e.strongPer).toFixed(2)+"%</span>"),r+="<br />",n.innerHTML=r;var l=document.createElement("div");t.appendChild(l),l.style.fontSize="10px";var o=Object(It.a)(t,{width:a.state.chartSize,height:a.state.chartSize,timeVisible:!0,secondsVisible:!0});o.addCandlestickSeries({upColor:"green",downColor:"red",borderDownColor:"red",borderUpColor:"green",wickDownColor:"red",wickUpColor:"green"}).setData(e.lightChartData);var s=a.calculateSMA(e.lightChartData,20);o.addLineSeries({color:"rgba(4, 111, 232, 1)",lineWidth:2}).setData(s),o.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}}).setData(e.volumeSeriesData);n=document.createElement("div");t.append(n),n.style.display="block",n.innerHTML=a.getRSIBBString(e),document.getElementById("allchart")&&document.getElementById("allchart").append(t),o.subscribeCrosshairMove(function(e){var t=e.seriesPrices[Symbol.iterator](),a="",n="",r=!0,o=!1,s=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var m=i.value;"object"==typeof m[1]?(a+=" O: <b>"+m[1].open+"</b>",a+=" H: <b>"+m[1].high+"</b>",a+=" L: <b>"+m[1].low+"</b>",a+=" C: <b>"+m[1].close+"</b>",a+=" CH: <b>"+(n=100*(m[1].close-m[1].open)/m[1].open).toFixed(2)+"%</b><br />"):a+=" "+m[1].toFixed(2)+" "}}catch(d){o=!0,s=d}finally{try{r||null==c.return||c.return()}finally{if(o)throw s}}e.time&&(a+=" Time:<b> "+ot(e.time).format("DD-MM-YYYY hh:mm A")+"</b>");var u="<span style=color:green>"+a+"</span> ";n<0&&(u="<span style=color:red>"+a+"</span> "),l.innerHTML=u})},a.sortTheChart=function(){var e=document.getElementById("allchart"),t=[];function n(a){document.querySelector("#allchart").childNodes.forEach(function(n){n.innerText&&n.innerText.split(" ")[0]==a&&(e.appendChild(n),t.push(n))})}for(var r=0;r<a.state.strongChartList.length;r++)n(a.state.strongChartList[r].name)},a.shortByVolume=function(e,t){a.state.strongChartList.sort(function(a,n){return"selling"===t?a[e]-n[e]:n[e]-a[e]}),a.setState({strongChartList:a.state.strongChartList,sortBy:e},function(){document.getElementById("allchart")&&(document.getElementById("allchart").innerHTML="");for(var e=0;e<this.state.strongChartList.length;e++){var t=this.state.strongChartList[e];this.createMultpleChart(t)}}),"strongPer"===e&&"selling"===t?a.setState({sortBy:"Selling%"}):"strongPer"===e&&a.setState({sortBy:"Buying%"}),a.setState({filterByCount:a.state.strongChartList.length+" Stocks Found"})},a.getUpdateIndexData=function(){a.setState({softedIndexList:[]}),x.allIndicesDirectJSON().then(function(e){if(e.data){var t=e.data&&e.data.data;t.sort(function(e,t){return t.percChange-e.percChange});for(var n=0;n<t.length;n++){var r=t[n];a.state.sluglist[r.indexName]&&a.setState({softedIndexList:[].concat(Object(ee.a)(a.state.softedIndexList),[r])},function(){})}a.findStrongCharts()}}).catch(function(e){}).finally(function(e){})},a.filterByVolumePrice=function(e){document.getElementById("allchart")&&(document.getElementById("allchart").innerHTML="");for(var t=[],n=0;n<a.state.strongChartList.length;n++){var r=a.state.strongChartList[n],l=r.candleChartData;if(r.candleChartData.length>=1){var o=l[l.length-1];if(o)var s=100*(o[4]-o[1])/o[1];var i=l[l.length-2];if(i)var c=100*(i[4]-i[1])/i[1];"Buy V+P"===e&&(console.log("Buy V+P section"),r.candleVolBrokenCount>9&&s>=.5&&(t.push(r),console.log(r.name,r.candleVolBrokenCount,s,c))),"Sell V+P"===e&&(console.log("Sell V+P section",s),r.candleVolBrokenCount>9&&s<=-.5&&(t.push(r),console.log(r.name,e,r.candleVolBrokenCount,s,c)))}}console.log("filteredList",t);for(var m=0;m<t.length;m++){var u=t[m];a.createMultpleChart(u)}a.setState({filterBy:e,filterByCount:t.length+" Stocks Found"})},a.updateToLocalStorage=function(e){var t=new Date(e.foundAt).toLocaleString();if(a.state.fastMovementList.filter(function(a){return a.token==e.token&&a.foundAt==t}).length)return!1;var n={token:e.token,foundAt:t,ltp:e.ltp,symbol:e.symbol,nc:e.perChange.toFixed(2),orderType:e.orderType};return a.state.fastMovementList.push(n),localStorage.setItem("fastMovementList",JSON.stringify(a.state.fastMovementList)),!0},a.findStrongCharts=Object(te.a)($.a.mark(function e(){var t,n,r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(document.getElementById("allchart")&&(document.getElementById("allchart").innerHTML=""),a.setState({strongChartListUpdate:"",strongChartList:[]}),t=a.state.staticData[a.state.selectedWatchlist],"gainerList"==a.state.selectedWatchlist&&(t=localStorage.getItem("gainerList")&&JSON.parse(localStorage.getItem("gainerList"))),"looserList"==a.state.selectedWatchlist&&(t=localStorage.getItem("looserList")&&JSON.parse(localStorage.getItem("looserList"))),"selectall"==a.state.selectedWatchlist&&(t=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))),a.setState({totalStockToWatch:t&&t.length,stopChart:!1}),console.log("select wathlist",t),!t||!t.length){e.next=21;break}n=$.a.mark(function e(n){var r,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.setState({strongChartListUpdate:n+1+". "+t[n].symbol+" At "+(new Date).toLocaleTimeString()}),r="YYYY-MM-DD HH:mm",ot("9:15am","h:mma").format(r),s=a.getTimeFrameValue(a.state.timeFrame),ot.duration("1000:00:00"),l=ot(new Date).subtract(s),!a.state.stopChart){e.next=8;break}return e.abrupt("return","break");case 8:return o={exchange:t[n].exch_seg,symboltoken:t[n].token,interval:a.state.timeFrame,fromdate:ot(l).format(r),todate:ot(new Date).format(r)},x.getHistoryData(o).then(function(e){var r=Q(e,"noPop");if(r&&r.data&&r.data.length){var l=r.data,o=[],s=[],i=[],c=[],m=[],u=[],d=[],g=[],h=[],p=l[l.length-1],f=(p[4],p[1],p[1],p[2]-p[3]),y=100*(p[4]-p[3])/f;l.forEach(function(e,t){o.push([e[0],e[1],e[2],e[3],e[4]]),s.push([e[5],(e[2]+e[3]+e[4])/3]),i.push(e[4]),c.push(e[2]),m.push(e[3]),u.push(e[3]),d.push(e[5]),g.push((e[2]+e[3]+e[4])/3),h.push({time:new Date(e[0]).getTime(),value:e[5],color:"rgba(211, 211, 211, 1)"})});Ft.a.calculate({period:20,values:i});var b={values:i,period:14},E=st.a.calculate(b),S={open:u,high:c,low:m,close:i,volume:d},v={period:20,values:g,stdDev:2},k=it.a.calculate(v),T=(s=Ja.a.calculate(S),k[k.length-1]);T&&(T.upper=T.upper.toFixed(2),T.middle=T.middle.toFixed(2),T.lower=T.lower.toFixed(2));var L=l.map(function(e){return{time:new Date(e[0]).getTime(),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4])}}),C=0,w=d[d.length-1];if(d&&d.length){d.reverse();for(var I=1;I<d.length;I++){if(!(d[I]<w))break;C++}}var D={exchange:"NSE",tradingsymbol:t[n].symbol,symboltoken:t[n].token};x.getLTP(D).then(function(e){var r=Q(e,"noPop"),i=r&&r.data;if(i&&i.ltp){var c={symbol:t[n].symbol,token:t[n].token,RSIValue:E[E.length-1],RSI:E.slice(Math.max(E.length-8,1)),valumeData:d.slice(Math.max(d.length-8,1)),VWAP:s[s.length-1],BB:T,candleChartData:o,foundAt:l&&new Date(l[l.length-1][0]).toLocaleString(),name:t[n].name,lightChartData:L,volumeSeriesData:h,strongPer:y,candleVolBrokenCount:C};c.perChange=(100*(i.ltp-i.close)/i.close).toFixed(2),c.ltp=i.ltp;var m=a.state.sortBy;a.setState({strongChartList:[].concat(Object(ee.a)(a.state.strongChartList),[c])},function(){this.state.strongChartList&&this.state.strongChartList.sort(function(e,t){return t[m]-e[m]}),this.createMultpleChart(c)})}})}else console.log(t[n].symbol,"  emply candle found")}),e.next=12,new Promise(function(e){return setTimeout(e,600)});case 12:case"end":return e.stop()}},e)}),r=0;case 11:if(!(r<t.length)){e.next=19;break}return e.delegateYield(n(r),"t0",13);case 13:if("break"!==e.t0){e.next=16;break}return e.abrupt("break",19);case 16:r++,e.next=11;break;case 19:e.next=22;break;case 21:z.showError("No Stock Found");case 22:case"end":return e.stop()}},e)})),a.callbackAfterOrderDone=function(e){console.log("order executed",e)},a.handleClick=function(e,t,n){if(e.token&&e.symbol){if("BUY"==t){a.setState(Object(y.a)({},n,!0));var r={token:e.token,symbol:e.symbol,qtyToTake:a.state.qtyToTake};ut.historyWiseOrderPlace(r,"BUY","no",a.callbackAfterOrderDone),a.setState(Object(y.a)({},n,!1))}if("SELL"==t){a.setState(Object(y.a)({},n,!0));r={token:e.token,symbol:e.symbol,qtyToTake:a.state.qtyToTake};ut.historyWiseOrderPlace(r,"SELL","no",a.callbackAfterOrderDone),a.setState(Object(y.a)({},n,!1))}}else z.showError(" Symbol Not found!!!")},a.state={staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],selectedWatchlist:localStorage.getItem("clickedIndexName")?localStorage.getItem("clickedIndexName"):"NIFTY BANK",totalStockToWatch:0,chartSize:300,timeFrame:"ONE_DAY",chartStaticData:[],BBBlastType:"BBStrongBreakout",qtyToTake:"",fastMovementList:localStorage.getItem("fastMovementList")&&JSON.parse(localStorage.getItem("fastMovementList"))||[],strongChartList:[],gainerList:localStorage.getItem("gainerList")&&JSON.parse(localStorage.getItem("gainerList"))||[],looserList:localStorage.getItem("looserList")&&JSON.parse(localStorage.getItem("looserList"))||[],sortBy:"perChange",softedIndexList:[],sluglist:{"NIFTY 50":"nifty","NIFTY AUTO":"cnxAuto","NIFTY BANK":"bankNifty","NIFTY ENERGY":"cnxEnergy","NIFTY FIN SERVICE":"cnxFinance","NIFTY FMCG":"cnxFMCG","NIFTY IT":"cnxit","NIFTY MEDIA":"cnxMedia","NIFTY METAL":"cnxMetal","NIFTY PHARMA":"cnxPharma","NIFTY PSU BANK":"cnxPSU","NIFTY REALTY":"cnxRealty","NIFTY PVT BANK":"niftyPvtBank","NIFTY CONSUMPTION":"cnxConsumption","NIFTY CPSE":"cpse","NIFTY INFRA":"cnxInfra","NIFTY MNC":"cnxMNC","NIFTY PSE":"cnxPSE"}},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentWillUnmount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t,a){return e}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement("br",null),r.a.createElement(N.a,{justify:"space-between",container:!0,spacing:1},r.a.createElement(N.a,{item:!0,xs:12,sm:5},r.a.createElement(R.a,{color:"primary"},"\xa0 ",this.state.selectedWatchlist," (",this.state.strongChartList&&this.state.strongChartList.length,") \xa0 Sorted: ",r.a.createElement("span",{style:{color:"blue"}},this.state.sortBy," "),"\xa0 Filter: ",r.a.createElement("span",{style:{color:"blue"}},this.state.filterBy," "),r.a.createElement("span",{id:"stockTesting",style:{color:"gray"}}," ",this.state.strongChartListUpdate," ")),r.a.createElement(B.a,{style:{marginRight:"20px"},onClick:function(){return e.shortByVolume("perChange")}},"Chng%"),r.a.createElement(B.a,{title:"previous volume broken count",style:{marginRight:"20px"},onClick:function(){return e.shortByVolume("candleVolBrokenCount")}},"VBC"),r.a.createElement(B.a,{title:"Emotions: Buying%",style:{marginRight:"20px"},onClick:function(){return e.shortByVolume("strongPer")}},"Buying%"),r.a.createElement(B.a,{title:"Emotions: Selling%",style:{marginRight:"20px"},onClick:function(){return e.shortByVolume("strongPer","selling")}},"Selling%"),r.a.createElement(B.a,{title:" 9 or more candles volume with price >= 0.3 breakout ",style:{marginRight:"20px"},onClick:function(){return e.filterByVolumePrice("Buy V+P")}},"Buy V+P"),r.a.createElement(B.a,{title:" 9 or more candles volume with price <= -0.3 breakout ",style:{marginRight:"20px"},onClick:function(){return e.filterByVolumePrice("Sell V+P")}},"Sell V+P"),r.a.createElement("span",{style:{fontStyle:"italic",fontSize:"smaller",color:"gray"}},this.state.filterByCount)),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(sn,null)),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,{style:mn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Chart Size"),r.a.createElement(ft.a,{value:this.state.chartSize,name:"chartSize",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:250},"250px"),r.a.createElement(yt.a,{value:300},"300px"),r.a.createElement(yt.a,{value:350},"350px"),r.a.createElement(yt.a,{value:450},"450px"),r.a.createElement(yt.a,{value:550},"550px"),r.a.createElement(yt.a,{value:650},"650px")))),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:mn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),r.a.createElement(ft.a,{value:this.state.selectedWatchlist,name:"selectedWatchlist",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"gainerList"},"Gainer List ("+this.state.gainerList.length+")"),r.a.createElement(yt.a,{value:"looserList"},"Looser List ("+this.state.looserList.length+")"),this.state.softedIndexList&&this.state.softedIndexList.map(function(e){return r.a.createElement(yt.a,{style:{color:e.percChange>0?"green":"red"},value:e.indexName},e.indexName," (",e.percChange,"%)")}),this.state.totalWatchlist&&this.state.totalWatchlist.map(function(e){return r.a.createElement(yt.a,{value:e},e)}),r.a.createElement(yt.a,{value:"Securities in F&O"},"Securities in F&O")))),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,{style:mn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Time"),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1 Min"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5 Min"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10 Min"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15 Min"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30 Min"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1 Hour"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1 Day")))),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.getUpdateIndexData()}},"Start"),r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.stopSearching()}},"Stop"))),r.a.createElement(N.a,{container:!0,spacing:2,style:{padding:"10px"},id:"allchart"}))}}]),t}(r.a.Component),mn={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},un=cn,dn=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})(function(e){var t=e.children,a=e.classes,n=e.onClose,l=Object(He.a)(e,["children","classes","onClose"]);return r.a.createElement(Re.a,Object.assign({disableTypography:!0,className:a.root},l),r.a.createElement(R.a,{variant:"h6"},t),n?r.a.createElement(ie.a,{"aria-label":"close",className:a.closeButton,onClick:n},r.a.createElement(Je.a,null)):null)}),gn=Object(je.a)(function(e){return{root:{padding:e.spacing(2)}}})(Ue.a),hn=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(1)}}})(_e.a);function pn(e){var t=r.a.useState(!1),a=Object(ae.a)(t,2),n=a[0],l=a[1],o=r.a.useState({data:[],candledata:{}}),s=Object(ae.a)(o,2),i=(s[0],s[1],function(){l(!1)});return r.a.createElement("div",null,r.a.createElement(B.a,{variant:"outlined",id:"fullModelId",color:"primary",style:{display:"none"},onClick:function(){l(!0)}},"Chart"),r.a.createElement(We.a,{fullScreen:!0,onClose:i,"aria-labelledby":"customized-dialog-title",open:n},r.a.createElement(dn,{id:"customized-dialog-title",onClose:i,onClick:i},r.a.createElement(B.a,{fullWidth:!0,autoFocus:!0,onClick:i,color:"primary"},localStorage.getItem("clickedIndexName")," ",localStorage.getItem("clickedIndexType"))),r.a.createElement(gn,{dividers:!0,id:"chart"},"Charts"==localStorage.getItem("clickedIndexType")?r.a.createElement(un,null):r.a.createElement(tn,null)),r.a.createElement(hn,null,r.a.createElement(B.a,{autoFocus:!0,onClick:i,color:"primary"},"Close"))))}var fn=new Dt.w3cwebsocket("wss://omnefeeds.angelbroking.com/NestHtml5Mobile/socket/stream"),yn=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).getTodayOrder=function(){x.retrieveOrderBook().then(function(e){var t=Q(e,"noPop");if(t&&t.data){var a=t.data;a.sort(function(e,t){return new Date(t.updatetime)-new Date(e.updatetime)}),localStorage.setItem("oderbookData",JSON.stringify(a))}})},a.updateTokenSymbol=function(e){e=localStorage.getItem("gainerList")&&JSON.parse(localStorage.getItem("gainerList"))||[];for(var t=function(t){var a=e[t];a.token||a.symbol||x.autoCompleteSearch(a.name).then(function(t){var n=t.data;if(n.length){var r=a.name.toUpperCase()+"-EQ",l=a.name.toUpperCase()+"-BE",o=n.filter(function(e){return e.name===a.name&&(e.symbol===r||e.symbol===l)});o.length&&(a.symbol=o[0].symbol,a.token=o[0].token,a.exch_seg=o[0].exch_seg,localStorage.setItem("gainerList",JSON.stringify(e)))}})},a=0;a<e.length;a++)t(a);var n=localStorage.getItem("looserList")&&JSON.parse(localStorage.getItem("looserList"))||[],r=function(e){var t=n[e];t.token||t.symbol||x.autoCompleteSearch(t.name).then(function(e){var a=e.data;if(a.length){var r=t.name.toUpperCase()+"-EQ",l=t.name.toUpperCase()+"-BE",o=a.filter(function(e){return e.name===t.name&&(e.symbol===r||e.symbol===l)});o.length&&(t.symbol=o[0].symbol,t.token=o[0].token,t.exch_seg=o[0].exch_seg,localStorage.setItem("looserList",JSON.stringify(n)))}})};for(a=0;a<n.length;a++)r(a)},a.updateLTPMannually=function(e){var t=a.state.staticData[e];a.refreshSectorLtp(t,e)},a.refreshSectorLtp=function(){var e=Object(te.a)($.a.mark(function e(t,n){var r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({stockUpdate:n}),a.setState({refreshFlag:!1,failedCount:0}),r=[],a.state.sectorStockList,l=$.a.mark(function e(n){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s={exchange:"NSE",tradingsymbol:t[n].symbol,symboltoken:t[n].token},x.getLTP(s).then(function(e){var a=Q(e,"noPop"),l=a&&a.data;if(l.symboltoken==t[n].token){var o=100*(l.ltp-l.close)/l.close,s=t[n];s.ltp=l.ltp,s.nc=o,s.cng=l.ltp-l.close,s.ltt=(new Date).toLocaleString(),r.push(s)}}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),console.log(t[n].symbol,e)}),e.next=4,new Promise(function(e){return setTimeout(e,101)});case 4:case"end":return e.stop()}},e)}),o=0;case 6:if(!(o<t.length)){e.next=11;break}return e.delegateYield(l(o),"t0",8);case 8:o++,e.next=6;break;case 11:n&&a.state.sectorList.forEach(function(e,t){if(e.index==n)return a.state.sectorList[t].stockList=r,a.state.sectorList[t].isStocksLtpUpdted=!0,void a.setState({sectorList:a.state.sectorList})}),a.setState({refreshFlag:!0});case 13:case"end":return e.stop()}},e)}));return function(t,a){return e.apply(this,arguments)}}(),a.checkLast5MinMovement=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l,o,s,i;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=a.state.staticData[t],a.setState({refreshFlagCandle:!1}),console.log("sectorStockList",t),r=$.a.mark(function e(t){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ot("9:15am","h:mma"),o=ot.duration("00:06:00"),s=ot(new Date).subtract(o),i={exchange:"NSE",symboltoken:n[t].token,interval:"ONE_MINUTE",fromdate:ot(s).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},a.setState({stockCandleUpdate:t+1+". "+n&&n[t].symbol}),x.getHistoryData(i).then(function(e){var a=Q(e,"noPop");if(a&&a.data&&a.data.length){console.log(n[t].symbol,"candle history",a.data);var r=a.data,l=[],o=[],s=[],i=[],c=[],m=[],u=[];r.forEach(function(e,t){l.push([e[0],e[1],e[2],e[3],e[4]]),o.push([e[5],(e[2]+e[3]+e[4])/3]),s.push(e[4]),i.push(e[2]),c.push(e[3]),m.push(e[3]),u.push(e[5])}),console.log(n[t].symbol,n[t])}else console.log(n[t].symbol,"  emply candle found")}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),z.showError(n[t].symbol+" candle failed!")}),e.next=8,new Promise(function(e){return setTimeout(e,350)});case 8:case"end":return e.stop()}},e)}),l=0;case 5:if(!(l<n.length)){e.next=10;break}return e.delegateYield(r(l),"t0",7);case 7:l++,e.next=5;break;case 10:t&&a.state.sectorList.forEach(function(e,r){if(e.index==t)return a.state.sectorList[r].stockList=n,void a.setState({sectorList:a.state.sectorList})}),a.setState({refreshFlagCandle:!0}),console.log("sectorStockswithcandle",n);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.refreshSectorCandleManually=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l,o,s,i;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=a.state.staticData[t],a.setState({refreshFlagCandle:!1}),console.log("sectorStockList",t),r=$.a.mark(function e(t){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return ot("9:15am","h:mma"),o=ot.duration("22:00:00"),s=ot(new Date).subtract(o),i={exchange:"NSE",symboltoken:n[t].token,interval:"FIFTEEN_MINUTE",fromdate:ot(s).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},a.setState({stockCandleUpdate:t+1+". "+n&&n[t].symbol}),x.getHistoryData(i).then(function(e){var a=Q(e,"noPop");if(a&&a.data&&a.data.length){var r=a.data,l=[],o=[],s=[],i=[],c=[],m=[],u=[],d=[];r.forEach(function(e,t){l.push([e[0],e[1],e[2],e[3],e[4]]),o.push([e[5],(e[2]+e[3]+e[4])/3]),s.push(e[4]),i.push(e[2]),c.push(e[3]),m.push(e[3]),u.push(e[5]),d.push((e[2]+e[3]+e[4])/3)});var g={values:s,period:14},h=st.a.calculate(g);console.log(n[t].symbol,"lastRsiValue",h[h.length-1]);var p={open:m,high:i,low:c,close:s,volume:u},f={period:20,values:d,stdDev:2},y=it.a.calculate(f);console.log(n[t].symbol,"BB",f,y),r.length>0&&(n[t].candleChartData=l,n[t].vwapValue=mt()(o),n[t].vwapDataChart=Ja.a.calculate(p),n[t].lastRsiValue=h[h.length-1]),console.log(n[t].symbol,n[t])}else console.log(n[t].symbol,"  emply candle found")}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),z.showError(n[t].symbol+" candle failed!")}),e.next=8,new Promise(function(e){return setTimeout(e,350)});case 8:case"end":return e.stop()}},e)}),l=0;case 5:if(!(l<n.length)){e.next=10;break}return e.delegateYield(r(l),"t0",7);case 7:l++,e.next=5;break;case 10:t&&a.state.sectorList.forEach(function(e,r){if(e.index==t)return a.state.sectorList[r].stockList=n,void a.setState({sectorList:a.state.sectorList})}),a.setState({refreshFlagCandle:!0}),console.log("sectorStockswithcandle",n);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.refreshSectorCandle=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({refreshFlagCandle:!1}),t=a.state.sectorStockList,console.log("sectorStockList",a.state.sectorStockList.length),n=$.a.mark(function e(n){return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=ot("9:15am","h:mma"),o=ot.duration("61:00:00"),ot(new Date).subtract(o),s={exchange:"NSE",symboltoken:a.state.sectorStockList[n].token,interval:"FIVE_MINUTE",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},a.setState({stockCandleUpdate:n+1+". "+a.state.sectorStockList&&a.state.sectorStockList[n].symbol}),x.getHistoryData(s).then(function(e){var r=Q(e,"noPop");if(r&&r.data&&r.data.length){var l=r.data,o=[];if(l.forEach(function(e){o.push([e[0],e[1],e[2],e[3],e[4]])}),l.length>0){t[n].candleChartData=o;var s=a.state.sectorList;a.state.sectorList&&a.state.sectorList.forEach(function(e,a){e.stockList&&e.stockList.forEach(function(e,n){var r=t.filter(function(t){return t.token==e.token});r.length&&(s[a].stockList[n].candleChartData=r[0].candleChartData)})}),a.setState({sectorList:s}),localStorage.setItem("sectorList",JSON.stringify(s))}}else console.log(a.state.sectorStockList[n].symbol,"  emply candle found")}).catch(function(e){a.setState({failedCount:a.state.failedCount+1}),z.showError(a.state.sectorStockList[n].symbol+" candle failed!")}),e.next=8,new Promise(function(e){return setTimeout(e,350)});case 8:case"end":return e.stop()}},e)}),r=0;case 5:if(!(r<a.state.sectorStockList.length)){e.next=10;break}return e.delegateYield(n(r),"t0",7);case 7:r++,e.next=5;break;case 10:a.setState({refreshFlagCandle:!0});case 11:case"end":return e.stop()}},e)})),a.decodeWebsocketData=function(e){var t=[];try{for(var a=0;a<e.length;a++)t.push(String.fromCharCode(e[a]))}catch(n){}return t.join("")},a.showCandleChart=function(e,t,a,n,r){localStorage.setItem("candleChartData",JSON.stringify(e)),localStorage.setItem("cadleChartSymbol",t),localStorage.setItem("candlePriceShow",a),localStorage.setItem("candleChangeShow",n),localStorage.setItem("vwapDataChart",r),e&&e.length>0&&document.getElementById("showCandleChart").click()},a.getTimeFrameValue=function(e){switch(e){case"ONE_MINUTE":return(new Date).toLocaleTimeString()<"10:05:00"?"19:00:00":"01:00:00";case"FIVE_MINUTE":return(new Date).toLocaleTimeString()<"11:00:00"?"23:00:00":"03:00:00";case"TEN_MINUTE":return(new Date).toLocaleTimeString()<"12:35:00"?"24:21:00":"07:00:00";case"FIFTEEN_MINUTE":return(new Date).toLocaleTimeString()<"14:15:00"?"28:01:00":"10:01:00";case"THIRTY_MINUTE":return"100:01:00";case"ONE_HOUR":return"200:01:00";case"ONE_DAY":return"1000:01:00"}},a.dailyBasisInfoCheck=function(e,t){var n=a.getTimeFrameValue("ONE_DAY"),r=ot.duration(n),l=ot(new Date).subtract(r),o={exchange:"NSE",symboltoken:e,interval:"ONE_DAY",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")};x.getHistoryData(o).then(function(n){var r=Q(n,"noPop"),l="";if(r&&r.data&&r.data.length){for(var o=r.data,s=[],i=0,c=o.length-20;c<o.length;c++){var m=o[c];m&&(s.push(m[4]),i+=m[5])}l=Ft.a.calculate({period:20,values:s}),a.setState({dailyAvgValume:i/20});var u=l&&l[l.length-1];console.log(e,"DSMA",u),u&&a.setState({DailyBulishStatus:u,todayCurrentVolume:o[o.length-1][5]}),o[o.length-1][5]>i/20&&console.log("crosssed voliue",t)}})},a.showCandleChartPopUp=function(e){var t=(localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))||[]).filter(function(t){return t.name===e});if(t&&t.length){var n=t[0];a.dailyBasisInfoCheck(n.token);var r=ot("9:15am","h:mma"),l=(ot.duration("22:00:00"),{exchange:"NSE",symboltoken:n.token,interval:a.state.timeFrame,fromdate:ot(r).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")});x.getHistoryData(l).then(function(e){var t=Q(e,"noPop");if(console.log("candledata",t),t&&t.data){(y=t.data).map(function(e){return{time:new Date(e[0]).getTime(),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4])}});var r=[],l=[],o=[],s=[],i=[],c=[],m=[],u=[],d=[];y.forEach(function(e,t){r.push([e[0],e[1],e[2],e[3],e[4]]),l.push([e[5],(e[2]+e[3]+e[4])/3]),o.push(e[4]),s.push(e[2]),i.push(e[3]),c.push(e[3]),m.push(e[5]),u.push((e[2]+e[3]+e[4])/3),d.push({time:new Date(e[0]).getTime(),value:e[5],color:"rgba(211, 211, 211, 1)"})});var g={period:20,values:u,stdDev:2},h=it.a.calculate(g);console.log(n.symbol,"Bolinger band",g,h);h=it.a.calculate(g);console.log(n.symbol,"Bolinger band",g,h);var p={values:o,period:14},f=st.a.calculate(p);console.log(n.symbol,"Rsi",p,f),console.log(n.symbol,"vwap",l,mt()(l));var y={exchange:n.exch_seg,tradingsymbol:n.symbol,symboltoken:n.token};x.getLTP(y).then(function(e){var t=Q(e,"noPop"),l=t&&t.data;l.change=100*(l.ltp-l.close)/l.close,a.showCandleChart(r,n.symbol,l.ltp,l.change)})}})}},a.updateSocketWatch=function(){var e=[];if(a.state.sectorList.forEach(function(t){t.percentChange>=.75&&t.stockList&&t.stockList.forEach(function(t){e.push("nse_cm|"+t.token)})}),e&&e.length){var t={task:"mw",channel:e.join("&"),token:a.state.feedToken,user:a.state.clientcode,acctid:a.state.clientcode};console.log("update watch channel",t),fn.send(JSON.stringify(t))}},a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.speckIt=function(e){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)},a.getPercentageColor=function(e){return"rgb("+((e*=100)<50?255:Math.floor(255-255*(2*e-100)/100))+","+(e>50?255:Math.floor(2*e*255/100))+",0)"},a.get2DecimalNumber=function(e){return e?e.toFixed(2):e},a.switchToListView=function(){a.setState({switchToListViewFlag:!a.state.switchToListViewFlag})},a.get5DaysMoveCount=function(e){var t=a.state.slowMotionStockList.filter(function(t){return t.name===e});return t.length?"SM: "+t[0].bigCandleCount:""},a.getDeliveryInfo=function(e){x.getDeliveryData(e).then(function(e){if(e&&e.data&&e.data.length)return"D2T%: "+e.data[0].deliveryToTradedQuantity})},a.showDeliveryData=function(e){localStorage.setItem("clickedIndexName",e),localStorage.setItem("clickedIndexType","Depth"),document.getElementById("fullModelId").click()},a.showAllChart=function(e){localStorage.setItem("clickedIndexName",e),localStorage.setItem("clickedIndexType","Charts"),document.getElementById("fullModelId").click()},a.state={sluglist:{"NIFTY 50":"nifty","NIFTY AUTO":"cnxAuto","NIFTY BANK":"bankNifty","NIFTY ENERGY":"cnxEnergy","NIFTY FIN SERVICE":"cnxFinance","NIFTY FMCG":"cnxFMCG","NIFTY IT":"cnxit","NIFTY MEDIA":"cnxMedia","NIFTY METAL":"cnxMetal","NIFTY PHARMA":"cnxPharma","NIFTY PSU BANK":"cnxPSU","NIFTY REALTY":"cnxRealty","NIFTY PVT BANK":"niftyPvtBank","NIFTY CONSUMPTION":"cnxConsumption","NIFTY CPSE":"cpse","NIFTY INFRA":"cnxInfra","NIFTY MNC":"cnxMNC","NIFTY PSE":"cnxPSE"},stopnview:"",indexTimeStamp:"",refreshFlag:!0,topGLCount:0,refreshFlagCandle:!0,switchToListViewFlag:!0,slowMotionStockList:localStorage.getItem("slowMotionStockList")&&JSON.parse(localStorage.getItem("slowMotionStockList"))||[],sectorStockList:localStorage.getItem("sectorStockList")&&JSON.parse(localStorage.getItem("sectorStockList"))||[],sectorList:localStorage.getItem("sectorList")&&JSON.parse(localStorage.getItem("sectorList"))||[],watchList:localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))||[],staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},gainerList:localStorage.getItem("gainerList")&&JSON.parse(localStorage.getItem("gainerList"))||[],looserList:localStorage.getItem("looserList")&&JSON.parse(localStorage.getItem("looserList"))||[],timeFrame:"FIFTEEN_MINUTE"},a.refreshSectorCandle=a.refreshSectorCandle.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.document.title="Hit Map2",this.loadIndexesList();var t=localStorage.getItem("userTokens")&&JSON.parse(localStorage.getItem("userTokens")),a=t&&t.feedToken,n=localStorage.getItem("userProfile")&&JSON.parse(localStorage.getItem("userProfile")),r=n&&n.clientcode;this.setState({feedToken:a,clientcode:r});var l=ot("9:15am","h:mma"),o=ot("3:30pm","h:mma"),s=ot(new Date,"h:mma");ot().isoWeekday()<=5&&s.isBetween(l,o)&&(fn.onopen=function(e){},fn.onmessage=function(t){var a=window.atob(t.data),n=e.decodeWebsocketData(Pt.a.inflate(a)),r=JSON.parse(n);window.document.title="Sector Live WS: "+r.length,e.state.sectorList&&e.state.sectorList.forEach(function(t,a){t.stockList&&t.stockList.forEach(function(t,n){var l=r.filter(function(e){return e.tk==t.token});l.length>0&&l[0].ltp&&l[0].nc&&(e.state.sectorList[a].stockList[n].ltp=l[0].ltp,e.state.sectorList[a].stockList[n].nc=l[0].nc,e.state.sectorList[a].stockList[n].cng=l[0].cng,e.state.sectorList[a].stockList[n].ltt=l[0].ltt,e.state.sectorList[a].isStocksLtpUpdted=!0)})}),e.setState({sectorList:e.state.sectorList})},fn.onerror=function(e){console.log("socket error",e),window.location.reload()},setInterval(function(){e.loadIndexesList()},12e4))}},{key:"loadIndexesList",value:function(){var e=this;this.setState({indexTimeStamp:"",refreshFlag:!1,failedCount:0,topGLCount:0}),x.allIndicesDirectJSON().then(function(t){if(t.data){var a=t.data&&t.data.data;a.sort(function(e,t){return t.percChange-e.percChange}),e.setState({indexTimeStamp:a[0].timeVal});for(var n=[],r=[],l=function(t){var l=a[t];s=e.state.sluglist[l.indexName],console.log("element",s,l.percChange),s&&(console.log("secName",l.indexName,s),x.checkSectorApiOther(s).then(function(o){if(console.log(l.indexName,o.data.data),a[t].stockList=o.data&&o.data.data,a[t].time=o.data&&o.data.time,e.setState({sectorList:a}),l.percChange>=.75||"NIFTY 50"==a[t].indexName&&l.percChange>=.25)for(var s=function(e){var r=o.data.data[e];m={name:r.symbol,ltp:r.ltP,nc:r.iislPercChange,sector:a[t].indexName,foundAt:(new Date).toLocaleString()};var l=localStorage.getItem("gainerList")&&JSON.parse(localStorage.getItem("gainerList"))||[];u=l.filter(function(e){return e.name==r.symbol}),console.log(r.symbol,u),u.length||(n.push(m),localStorage.setItem("gainerList",JSON.stringify(n)))},i=0;i<o.data.data.length-3;i++){s(i)}if(l.percChange<=-.75||"NIFTY 50"==a[t].indexName&&l.percChange<=-.25){o.data.data.reverse();var c=function(e){var n=o.data.data[e];m={name:n.symbol,ltp:n.ltP,nc:n.iislPercChange,sector:a[t].indexName,foundAt:(new Date).toLocaleString()};var l=localStorage.getItem("looserList")&&JSON.parse(localStorage.getItem("looserList"))||[];u=l.filter(function(e){return e.name==n.symbol}),console.log("looseer",n.symbol,u),u.length||(r.push(m),localStorage.setItem("looserList",JSON.stringify(r)))};for(i=0;i<o.data.data.length-5;i++){var m,u;c(i)}}}).catch(function(e){console.log("list fetch error",e)}))},o=0;o<a.length;o++){var s;l(o)}}}).catch(function(e){}).finally(function(t){setTimeout(function(){e.updateTokenSymbol("ok")},5e3)}),this.setState({refreshFlag:!0})}},{key:"render",value:function(){var e=this,t=ot("9:15am","h:mma"),a=ot("03:30pm","h:mma");return ot(new Date,"h:mma").isBetween(t,a)&&this.state.sectorList&&this.state.sectorList.forEach(function(t,a){t.percentChange>.75&&t.isStocksLtpUpdted&&t.stockList&&t.stockList.forEach(function(t,a){if(a<2){var n=localStorage.getItem("autoTradeTopList")&&JSON.parse(localStorage.getItem("autoTradeTopList"))||[];n.filter(function(e){return e.token===t.token}).length||(t.foundAt=(new Date).toLocaleString(),n.push(t),localStorage.setItem("autoTradeTopList",JSON.stringify(n)),console.log(t.name+" is on top  "+(a+1)+(new Date).toLocaleString()),e.speckIt(t.name+" is on top  "+(a+1)))}})}),r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement(rt,null),r.a.createElement(pn,{indexName:this.state.clickedIndexName}),r.a.createElement(Za,{LightChartData:{InstrumentLTP:this.state.InstrumentLTP,DailyBulishStatus:this.state.DailyBulishStatus,todayCurrentVolume:this.state.todayCurrentVolume,selectedSymbol:this.state.selectedSymbol,chartStaticData:this.state.chartStaticData,bblastValue:this.state.bblastValue,vwapvalue:this.state.vwapvalue,rsiValues:this.state.rsiValues,valumeData:this.state.valumeData}}),r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:1,style:{paddingLeft:"5px",paddingRight:"5px"}},r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(R.a,{component:"h3",variant:"h6",color:"primary"},"Sectors HitMap (",Object.keys(this.state.sluglist).length,") at ",this.state.indexTimeStamp,"\xa0",r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.loadIndexesList()}},"Refresh"),"\xa0",r.a.createElement(B.a,{onClick:function(){return e.switchToListView()}},"switch to list view"))),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:{minWidth:"100%"}},r.a.createElement(M.a,{htmlFor:"gender"},"Select Time"),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onChange},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1 Min"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5 Min"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10 Min"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15 Min"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30 Min"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1 Hour"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1 Day")))),!this.state.switchToListViewFlag&&this.state.sectorList?this.state.sectorList.map(function(t,a){return t.stockList?r.a.createElement(N.a,{item:!0,xs:12,sm:3},r.a.createElement(Ct.a,{style:{padding:"10px",background:"lightgray",textAlign:"center"}},r.a.createElement(R.a,{variant:"body1"},r.a.createElement("b",null," ",a+1,". ",t.index||t.indexName+" "+t.last,"(",t.percentChange||t.percChange,"%)")," \xa0 ",t.time.substr(13,8)),r.a.createElement(N.a,{direction:"row",container:!0,className:"flexGrow",spacing:1},t.stockList&&t.stockList.map(function(t,a){return r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(Ct.a,{style:{textAlign:"center"}},r.a.createElement(R.a,{style:{background:e.getPercentageColor(t.iislPercChange),fontSize:"14px"}},a+1,". ",t.symbol," ",t.ltP," (",t.iislPercChange,"%)"),t.candleChartData?r.a.createElement("span",{style:{cursor:"pointer"},onClick:function(){return e.showCandleChart(t.candleChartData,t.name,t.ltp,t.nc,t.vwapDataChart)}},r.a.createElement($e,{candleChartData:t.candleChartData,percentChange:t.nc,vwapDataChart:t.vwapDataChart})):"",t.vwapValue?r.a.createElement(R.a,null,t.vwapValue?r.a.createElement("span",{style:{background:t.ltp>t.vwapValue?"#00ff00":"red",fontSize:"14px"}},"VWAP:",r.a.createElement("b",null,t.vwapValue&&t.vwapValue.toFixed(2))," "):"","\xa0",t.lastRsiValue?r.a.createElement("span",{title:"OB means 'Overbought'",style:{background:t.lastRsiValue>=60?"#00ff00":t.lastRsiValue>=40&&t.lastRsiValue<60?"lightgray":"red",fontSize:"14px"}},"RSI:",r.a.createElement("b",null,t.lastRsiValue)," ",t.lastRsiValue>80?"OB":t.lastRsiValue>=60&&t.lastRsiValue<=80?"Buy":t.lastRsiValue>=40&&t.lastRsiValue<60?"NoTrade":"Sell"," "):""):""))})))):""}):"",r.a.createElement(qe.a,{id:"tabledata","aria-label":"a dense table",stickyHeader:!0,size:"small"},r.a.createElement(Ke.a,{hover:!0,style:{whiteSpace:"nowrap"}},this.state.switchToListViewFlag&&this.state.sectorList?this.state.sectorList.map(function(t,a){return t.stockList?r.a.createElement(ze.a,{hover:!0,key:a},r.a.createElement(Qe.a,{style:{background:"#0068ff45"}},r.a.createElement(B.a,{style:{background:e.getPercentageColor(t.percChange)},variant:"contained",onClick:function(){return e.showAllChart(t.indexName)}},t.indexName+" "+t.last,"(",t.percChange,"%)",r.a.createElement(xe.a,null)),"\xa0",r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.showDeliveryData(t.indexName)}},"Depth")),t.stockList&&t.stockList.map(function(t,a){return r.a.createElement(Qe.a,{style:{textAlign:"left"}},r.a.createElement(B.a,{onClick:function(){return e.showCandleChartPopUp(t.symbol)}},r.a.createElement("span",{style:{background:e.getPercentageColor(t.iislPercChange)}},"  ",r.a.createElement("b",null,a+1,".")," ",t.symbol," ",t.ltP," (",t.iislPercChange,"%) "),r.a.createElement("span",{title:"last 5 days 5min big movement  maximum count"},"\xa0",e.get5DaysMoveCount(t.symbol),"  ")))})):""}):""))))}}]),t}(r.a.Component),bn=Object(s.b)(function(e){return{packs:e.packs.packs.data}},{setPackLoaded:Zt})(yn),En=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).stopSearching=function(){console.log("stop the search"),clearInterval(a.state.findlast5minMovementInterval),clearInterval(a.state.stop10bbSearch)},a.onChangeQty=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.showCandleChart=function(e,t,a,n){localStorage.setItem("candleChartData",JSON.stringify(e)),localStorage.setItem("cadleChartSymbol",t),localStorage.setItem("candlePriceShow",a),localStorage.setItem("candleChangeShow",n.toFixed(2)),document.getElementById("showCandleChart").click()},a.speckIt=function(e){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)},a.onChangeWatchlist=function(e){clearInterval(a.state.findlast5minMovementInterval),a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.find10MinBBBlast()})},a.startSearching=function(){console.log("Starting the search");var e=ot("9:15am","h:mma"),t=ot("3:30pm","h:mma"),n=ot(new Date,"h:mma");if(ot().isoWeekday()<=5&&n.isBetween(e,t)){var r=6e4;a.state.totalStockToWatch>180&&(r=333*a.state.totalStockToWatch),a.setState({findlast5minMovementInterval:setInterval(function(){a.findlast5minMovement()},r)})}},a.getTimeFrameValue=function(e){switch(e){case"ONE_MINUTE":return(new Date).toLocaleTimeString()<"10:05:00"?"18:21:00":"00:21:00";case"FIVE_MINUTE":return(new Date).toLocaleTimeString()<"11:00:00"?"19:41:00":"01:41:00";case"TEN_MINUTE":return(new Date).toLocaleTimeString()<"12:35:00"?"21:21:00":"03:21:00";case"FIFTEEN_MINUTE":return(new Date).toLocaleTimeString()<"14:15:00"?"23:01:00":"05:01:00";case"THIRTY_MINUTE":return"84:01:00";case"ONE_HOUR":return"168:01:00";case"ONE_DAY":return"744:01:00"}},a.updateToLocalStorage=function(e){var t=new Date(e.foundAt).toLocaleString(),n=a.state.fastMovementList.filter(function(a){return a.token==e.token&&a.foundAt==t});if(console.log("isfound",n),!n.length){var r={token:e.token,foundAt:t,ltp:e.ltp,symbol:e.symbol,nc:e.perChange.toFixed(2),orderType:e.orderType};a.state.fastMovementList.push(r),localStorage.setItem("fastMovementList",JSON.stringify(a.state.fastMovementList))}},a.find10MinBBBlast=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s,i;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({findlast5minMovementUpdate:"",findlast5minMovement:[]}),t=a.state.staticData[a.state.selectedWatchlist],"selectall"==a.state.selectedWatchlist&&(t=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))),a.setState({totalStockToWatch:t.length}),n=[],r=$.a.mark(function e(r){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()}),l="YYYY-MM-DD HH:mm",ot("9:15am","h:mma").format(l),a.getTimeFrameValue(a.state.timeFrame),o=ot.duration("100:00:00"),s=ot(new Date).subtract(o),i={exchange:t[r].exch_seg,symboltoken:t[r].token,interval:a.state.timeFrame,fromdate:ot(s).format(l),todate:ot(new Date).format(l)},x.getHistoryData(i).then(function(e){var o=Q(e,"noPop");if(o&&o.data&&o.data.length){var s=o.data,i=[],c=[],m=[],u=[],d=[],g=[],h=[],p=[],f=[];s.forEach(function(e,t){i.push([e[0],e[1],e[2],e[3],e[4]]);new Date(e[0]).getFullYear(),new Date(e[0]).getMonth(),new Date(e[0]).getDate();c.push({x:new Date(e[0]).getTime(),y:(e[2]+e[3]+e[4])/3}),m.push([e[5],(e[2]+e[3]+e[4])/3]),u.push(e[4]),d.push(e[2]),g.push(e[3]),h.push(e[3]),p.push(e[5]),f.push((e[2]+e[3]+e[4])/3)});var y=Ft.a.calculate({period:20,values:u});console.log(t[r].symbol,"SMA",y);var b={values:u,period:14},E=st.a.calculate(b);console.log(t[r].symbol,"Rsi",b,E),console.log(t[r].symbol,"vwap",m,mt()(m));var S={period:20,values:f,stdDev:2},v=it.a.calculate(S);console.log(t[r].symbol,"Bolinger band",S,v);var k=v[v.length-1];k&&(k.upper=k.upper.toFixed(2),k.middle=k.middle.toFixed(2),k.lower=k.lower.toFixed(2));var T={exchange:"NSE",tradingsymbol:t[r].symbol,symboltoken:t[r].token};x.getLTP(T).then(function(e){var o=Q(e,"noPop"),u=o&&o.data;if(u&&u.ltp){E=E.slice(E.length-6,E.length);var d=0,g=0,h=E[2],f=E[2];E.forEach(function(e,t){t>2&&e>=55&&e<=65&&h<=e&&(h=e,d+=1),t>2&&e>=35&&e<=45&&e<=f&&(f=e,g+=1)});var y=p[2];if(p.forEach(function(e,t){t>2&&y<e&&(y=e,1)}),console.log(t[r].symbol,"valumeData",p),console.log(t[r].symbol,"last continue rsi",d),a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" RSI rising :"+d}),d>=2||g>=2)if("BBBlastOnly"==a.state.BBBlastType){if(k&&u.ltp>=k.upper){var b=100*(u.ltp-u.close)/u.close,S={symbol:t[r].symbol,token:t[r].token,ltp:u.ltp,perChange:b,RSIValue:E[E.length-1],RSI:E,VWAP:mt()(m),BB:k,candleChartData:i,lightcandleChartData:c,foundAt:s&&s[s.length-1][0],orderType:"BUY",name:t[r].name};n.push(S),a.setState({findlast5minMovement:n}),a.updateToLocalStorage(S),a.speckIt(t[r].symbol+" BB  buy"),window.document.title="FM: Buy "+t[r].symbol}if(k&&u.ltp<=k.lower){b=100*(u.ltp-u.close)/u.close;var v={symbol:t[r].symbol,token:t[r].token,ltp:u.ltp,perChange:b,RSIValue:E[E.length-1],RSI:E,VWAP:mt()(m),BB:k,candleChartData:i,lightcandleChartData:c,foundAt:s&&s[s.length-1][0],orderType:"SELL",name:t[r].name};n.push(v),a.setState({findlast5minMovement:n}),a.updateToLocalStorage(v),a.speckIt(t[r].symbol+" BB sell"),window.document.title="FM: Sell "+t[r].symbol}}else{var T=a.getTimeFrameValue("ONE_DAY"),L=ot.duration(T),C=ot(new Date).subtract(L),w={exchange:t[r].exch_seg,symboltoken:t[r].token,interval:"ONE_DAY",fromdate:ot(C).format(l),todate:ot(new Date).format(l)};x.getHistoryData(w).then(function(e){var l=Q(e,"noPop"),o="";if(l&&l.data&&l.data.length){var d=l.data,g=[];d.forEach(function(e,t){g.push(e[4])});var h=(o=Ft.a.calculate({period:20,values:g}))&&o[o.length-1];if(console.log(t[r].symbol,"DSMA",h),u.ltp>h&&k&&u.ltp>=k.upper){var p=100*(u.ltp-u.close)/u.close,f={symbol:t[r].symbol,token:t[r].token,ltp:u.ltp,perChange:p,RSIValue:E[E.length-1],RSI:E,VWAP:mt()(m),BB:k,DSMALastValue:h,candleChartData:i,lightcandleChartData:c,foundAt:s&&s[s.length-1][0],orderType:"BUY",name:t[r].name};n.push(f),a.setState({findlast5minMovement:n}),a.updateToLocalStorage(f),a.speckIt(t[r].symbol+" BB  buy"),window.document.title="FM: Buy "+t[r].symbol}if(u.ltp<h&&k&&u.ltp<=k.lower){p=100*(u.ltp-u.close)/u.close;var y={symbol:t[r].symbol,token:t[r].token,ltp:u.ltp,perChange:p,RSIValue:E[E.length-1],RSI:E,VWAP:mt()(m),BB:k,DSMALastValue:h,candleChartData:i,lightcandleChartData:c,foundAt:s&&s[s.length-1][0],orderType:"SELL",name:t[r].name};n.push(y),a.setState({findlast5minMovement:n}),a.updateToLocalStorage(y),a.speckIt(t[r].symbol+" BB sell"),window.document.title="FM: Sell "+t[r].symbol}}})}}})}else console.log(t[r].symbol,"  emply candle found")}),e.next=10,new Promise(function(e){return setTimeout(e,600)});case 10:case"end":return e.stop()}},e)}),l=0;case 7:if(!(l<t.length)){e.next=12;break}return e.delegateYield(r(l),"t0",9);case 9:l++,e.next=7;break;case 12:case"end":return e.stop()}},e)})),a.findlast5minMovement=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s,i,c;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.setState({findlast5minMovementUpdate:""}),t=ot.duration("00:05:00"),"YYYY-MM-DD HH:mm",n=ot(new Date).subtract(t),r=a.state.staticData[a.state.selectedWatchlist],"selectall"==a.state.selectedWatchlist&&(r=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))),console.log("watchList",a.state.selectedWatchlist,r),a.setState({totalStockToWatch:r.length}),l=[],!r||!r.length){e.next=17;break}o=$.a.mark(function e(t){var o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=r[t],i={exchange:"NSE",symboltoken:o.token,interval:"ONE_MINUTE",fromdate:ot(n).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},c=t+1+". "+o.symbol,a.setState({findlast5minMovementUpdate:c}),window.document.title="FM: "+c,x.getHistoryData(i).then(function(e){var n=Q(e,"noPop");if(n&&n.data&&n.data.length){var o=[];n.data.forEach(function(e){var t=100*(e[4]-e[1])/e[1];t>=.3&&(1,o.push("<span style='color:green'>"+t.toFixed(2)+"% At "+new Date(e[0]).toLocaleTimeString().substr(0,5)+"</span>")),t<=-.3&&(1,o.push("<span style='color:red'>"+t.toFixed(2)+"% At "+new Date(e[0]).toLocaleTimeString().substr(0,5)+"</span>"))});var s=[];if(n.data.forEach(function(e){s.push([e[0],e[1],e[2],e[3],e[4]])}),o.length){var i={exchange:"NSE",tradingsymbol:r[t].symbol,symboltoken:r[t].token};x.getLTP(i).then(function(e){var n=Q(e,"noPop"),i=n&&n.data;if(i&&i.ltp){var c=100*(i.ltp-i.close)/i.close;l.push({symbol:r[t].symbol,ltp:i.ltp,perChange:c,percentChangeList:o.join(" | "),candleChartData:s}),console.log("foundData",l),a.setState({findlast5minMovement:l})}})}}else console.log(" candle data emply")}),e.next=8,new Promise(function(e){return setTimeout(e,333)});case 8:case"end":return e.stop()}},e)}),s=0;case 12:if(!(s<r.length)){e.next=17;break}return e.delegateYield(o(s),"t0",14);case 14:s++,e.next=12;break;case 17:case"end":return e.stop()}},e)})),a.callbackAfterOrderDone=function(e){console.log("order executed",e)},a.handleClick=function(e,t,n){if(console.log(e),e.token&&e.symbol){if("BUY"==t){a.setState(Object(y.a)({},n,!0));var r={token:e.token,symbol:e.symbol,qtyToTake:a.state.qtyToTake};ut.historyWiseOrderPlace(r,"BUY","no",a.callbackAfterOrderDone),a.setState(Object(y.a)({},n,!1))}if("SELL"==t){a.setState(Object(y.a)({},n,!0));r={token:e.token,symbol:e.symbol,qtyToTake:a.state.qtyToTake};ut.historyWiseOrderPlace(r,"SELL","no",a.callbackAfterOrderDone),a.setState(Object(y.a)({},n,!1))}}else z.showError(" Symbol Not found!!!")},a.state={staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],selectedWatchlist:"NIFTY 50",totalStockToWatch:0,timeFrame:"TEN_MINUTE",chartStaticData:[],qtyToTake:"",BBBlastType:"BBBlastOnly",fastMovementList:localStorage.getItem("fastMovementList")&&JSON.parse(localStorage.getItem("fastMovementList"))||[]},a.findlast5minMovement=a.findlast5minMovement.bind(Object(k.a)(a)),a.startSearching=a.startSearching.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.document.title="Fast Movement";var t=this.state.staticData[this.state.selectedWatchlist];this.setState({totalStockToWatch:t.length});var a=ot("9:15am","h:mma"),n=ot("3:30pm","h:mma"),r=ot(new Date,"h:mma"),l=ot().isoWeekday(),o=setInterval(function(){var t=new Date;console.log("set interval 1sec min/10==0 ",t.toLocaleTimeString()),t.getMinutes()%5===0&&(console.log("search method call in with setTimeout 70sec",t.toLocaleTimeString()),setTimeout(function(){e.find10MinBBBlast()},7e4),e.setState({stop10bbSearch:setInterval(function(){console.log("search method call in with setInterval in 10min",t.toLocaleTimeString()),l<=5&&r.isBetween(a,n)&&e.find10MinBBBlast()},37e4)}),clearInterval(o))},1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.state.findlast5minMovementInterval),clearInterval(this.state.stop10bbSearch)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement("br",null),r.a.createElement(rt,null)," ",r.a.createElement(Ma,null),r.a.createElement(N.a,{justify:"space-between",container:!0,spacing:1},r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(R.a,{component:"h2",variant:"h6",color:"primary",gutterBottom:!0},"\xa0BB Blast (",this.state.findlast5minMovement&&this.state.findlast5minMovement.length,")",r.a.createElement("span",{id:"stockTesting",style:{fontSize:"18px",color:"gray"}}," ",this.state.findlast5minMovementUpdate," "))),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:Sn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),r.a.createElement(ft.a,{value:this.state.selectedWatchlist,name:"selectedWatchlist",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"selectall"},"Select All"),this.state.totalWatchlist&&this.state.totalWatchlist.map(function(e){return r.a.createElement(yt.a,{value:e},e)})))),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,{style:Sn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Time"),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1 Min"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5 Min"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10 Min"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15 Min"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30 Min"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1 Hour"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1 Day")))),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,{style:Sn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Time"),r.a.createElement(ft.a,{value:this.state.BBBlastType,name:"BBBlastType",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"BBBlastOnly"},"BB Blast"),r.a.createElement(yt.a,{value:"BBBlastDaily"},"BB Blast Daily")))),r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.find10MinBBBlast()}},"Start"),r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.stopSearching()}},"Stop"))),r.a.createElement(N.a,{container:!0,spacing:2},this.state.findlast5minMovement?this.state.findlast5minMovement.map(function(t,a){return r.a.createElement(N.a,{item:!0,xs:12,sm:3},r.a.createElement(Ct.a,{style:{overflow:"auto",padding:"10px"}},r.a.createElement(R.a,{style:{color:t.perChange>0?"green":"red"}}," ",t.symbol," ",t.ltp," ",r.a.createElement("b",null,"(",t.perChange.toFixed(2),"%) ")),t.candleChartData.length>0?r.a.createElement(Xe.a,{options:{chart:{type:"candlestick",height:250},title:{text:"",align:"left"},xaxis:{type:"datetime"},yaxis:{tooltip:{enabled:!0}}},series:[{data:t.candleChartData.slice(Math.max(t.candleChartData.length-10,1))}],type:"candlestick",width:350,height:250}):"",r.a.createElement(N.a,{direction:"row",style:{padding:"5px"},container:!0,className:"flexGrow",justify:"space-between"},t.DSMALastValue?r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{color:t.ltp>t.DSMALastValue?"green":"red",fontWeight:"bold"}},"Daily SMA: ",t.DSMALastValue," ",t.ltp>t.DSMALastValue?"BUY":"SELL"):"",r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{color:t.ltp>t.VWAP?"green":"red",fontWeight:"bold"}},"VWAP:  ",t.VWAP),r.a.createElement(N.a,{item:!0,xs:12,sm:12},"RSI: ",t.RSI.map(function(e,t){return e>=60?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}}," ",e," \xa0"):r.a.createElement("span",{style:{color:e<=40?"red":"",fontWeight:"bold"}}," ",e," \xa0")})),r.a.createElement(N.a,{item:!0,xs:12,sm:12},"BB \xa0 ",r.a.createElement("span",{style:{color:t.ltp>=t.BB.upper?"green":"",fontWeight:"bold"}},"Upper: ",t.BB.upper),"\xa0 Middle: ",t.BB.middle,"\xa0 ",r.a.createElement("span",{style:{color:t.ltp<=t.BB.lower?"red":"",fontWeight:"bold"}}," Lower: ",t.BB.lower))),r.a.createElement(N.a,{direction:"row",style:{padding:"5px"},container:!0,className:"flexGrow",justify:"space-between"},r.a.createElement(N.a,{item:!0},e.state["buyButtonClicked"+t.symbol+a]?r.a.createElement(gt.a,null):r.a.createElement(B.a,{size:"small",variant:"contained",color:"primary",onClick:function(){return e.handleClick(t,"BUY","buyButtonClicked"+t.symbol+a)}},"BUY")),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"Qty",type:"number",name:"qtyToTake",value:e.state.qtyToTake,onChange:e.onChangeQty})),r.a.createElement(N.a,{item:!0},e.state["sellButtonClicked"+t.symbol+a]?r.a.createElement(gt.a,null):r.a.createElement(B.a,{size:"small",variant:"contained",color:"Secondary",onClick:function(){return e.handleClick(t,"SELL","sellButtonClicked"+t.symbol+a)}},"SELL")))))}):""))}}]),t}(r.a.Component),Sn={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},vn=En,kn=a(580),Tn=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).stopSearching=function(){console.log("stop the search"),clearInterval(a.state.findlast5minMovementInterval),clearInterval(a.state.stop10bbSearch)},a.showCandleChart=function(e,t,a,n){localStorage.setItem("candleChartData",JSON.stringify(e)),localStorage.setItem("cadleChartSymbol",t),localStorage.setItem("candlePriceShow",a),localStorage.setItem("candleChangeShow",n.toFixed(2)),document.getElementById("showCandleChart").click()},a.speckIt=function(e){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)},a.onChangeWatchlist=function(e){clearInterval(a.state.findlast5minMovementInterval),a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.find10MinBBBlast()})},a.onChangeQty=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.startSearching=function(){console.log("Starting the search");var e=ot("9:15am","h:mma"),t=ot("3:30pm","h:mma"),n=ot(new Date,"h:mma");if(ot().isoWeekday()<=5&&n.isBetween(e,t)){var r=6e4;a.state.totalStockToWatch>180&&(r=333*a.state.totalStockToWatch),a.setState({findlast5minMovementInterval:setInterval(function(){a.findlast5minMovement()},r)})}},a.getTimeFrameValue=function(e){switch(e){case"ONE_MINUTE":return(new Date).toLocaleTimeString()<"10:05:00"?"18:21:00":"00:21:00";case"FIVE_MINUTE":return(new Date).toLocaleTimeString()<"11:00:00"?"19:41:00":"01:41:00";case"TEN_MINUTE":return(new Date).toLocaleTimeString()<"12:35:00"?"21:21:00":"03:21:00";case"FIFTEEN_MINUTE":return(new Date).toLocaleTimeString()<"14:15:00"?"23:01:00":"05:01:00";case"THIRTY_MINUTE":return"84:01:00";case"ONE_HOUR":return"168:01:00";case"ONE_DAY":return"744:01:00"}},a.updateToLocalStorage=function(e){var t=new Date(e.foundAt).toLocaleString(),n=a.state.fastMovementList.filter(function(a){return a.token==e.token&&a.foundAt==t});if(console.log("isfound",n),n.length)return!1;var r={token:e.token,foundAt:t,ltp:e.ltp,symbol:e.symbol,nc:e.perChange.toFixed(2),orderType:e.orderType};return a.state.fastMovementList.push(r),localStorage.setItem("fastMovementList",JSON.stringify(a.state.fastMovementList)),!0},a.find10MinBBBlast=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s,i;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({findlast5minMovementUpdate:"",findlast5minMovement:[]}),t=a.state.staticData[a.state.selectedWatchlist],"selectall"==a.state.selectedWatchlist&&(t=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))),a.setState({totalStockToWatch:t.length}),n=[],r=$.a.mark(function e(r){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" Scaning"}),l="YYYY-MM-DD HH:mm",ot("9:15am","h:mma").format(l),a.getTimeFrameValue(a.state.timeFrame),o=ot.duration("100:00:00"),s=ot(new Date).subtract(o),i={exchange:t[r].exch_seg,symboltoken:t[r].token,interval:a.state.timeFrame,fromdate:ot(s).format(l),todate:ot(new Date).format(l)},x.getHistoryData(i).then(function(e){var l=Q(e,"noPop");if(l&&l.data&&l.data.length){var o=l.data,s=[],i=[],c=[],m=[],u=[],d=[],g=[],h=[],p=[];o.forEach(function(e,t){s.push([e[0],e[1],e[2],e[3],e[4]]);new Date(e[0]).getFullYear(),new Date(e[0]).getMonth(),new Date(e[0]).getDate();i.push({x:new Date(e[0]).getTime(),y:(e[2]+e[3]+e[4])/3}),c.push([e[5],(e[2]+e[3]+e[4])/3]),m.push(e[4]),u.push(e[2]),d.push(e[3]),g.push(e[3]),h.push(e[5]),p.push((e[2]+e[3]+e[4])/3)});Ft.a.calculate({period:20,values:m});var f={values:m,period:14},y=st.a.calculate(f),b={period:20,values:p,stdDev:2},E=it.a.calculate(b),S=E[E.length-1];S&&(S.upper=S.upper.toFixed(2),S.middle=S.middle.toFixed(2),S.lower=S.lower.toFixed(2));var v={values:m,fastPeriod:12,slowPeriod:26,signalPeriod:9,SimpleMAOscillator:!1,SimpleMASignal:!1},k=kn.a.calculate(v),T=k[k.length-1];T&&T.MACD>=T.signal&&console.log("macd",t[r].symbol,T);var L={exchange:"NSE",tradingsymbol:t[r].symbol,symboltoken:t[r].token};x.getLTP(L).then(function(e){var l=Q(e,"noPop"),m=l&&l.data;if(m&&m.ltp){y=y.slice(y.length-6,y.length),a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" Searching"});if("BBStrongBreakout"==a.state.BBBlastType)if(S&&m.ltp>=S.upper&&o[o.length-1][2]==o[o.length-1][4]){var u=100*(m.ltp-m.close)/m.close,d={symbol:t[r].symbol,token:t[r].token,ltp:m.ltp,perChange:u,RSIValue:y[y.length-1],RSI:y,VWAP:mt()(c),BB:S,candleChartData:s,lightcandleChartData:i,foundAt:o&&o[o.length-1][0],orderType:"BUY",name:t[r].name};a.updateToLocalStorage(d)&&(n.push(d),a.setState({findlast5minMovement:n}),a.speckIt(t[r].symbol+" BB  buy"),window.document.title="FM2: Buy "+t[r].symbol,a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" BUY Eligible"}))}else if(S&&m.ltp<=S.lower&&o[o.length-1][3]==o[o.length-1][4]){u=100*(m.ltp-m.close)/m.close;var g={symbol:t[r].symbol,token:t[r].token,ltp:m.ltp,perChange:u,RSIValue:y[y.length-1],RSI:y,VWAP:mt()(c),BB:S,candleChartData:s,lightcandleChartData:i,foundAt:o&&o[o.length-1][0],orderType:"SELL",name:t[r].name};a.updateToLocalStorage(g)&&(n.push(g),a.setState({findlast5minMovement:n}),a.speckIt(t[r].symbol+" BB sell"),window.document.title="FM2: Sell "+t[r].symbol,a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" SELL Eligible"}))}else a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" Not Eligible"});if("findRange"==a.state.BBBlastType){var h=o[0][3],p=o[0][2],f=0;o[0][0],o[0][0];console.log("candleData",t[r].symbol,o);for(var b=0;b<o.length-1;b++){var E=o[b],v=E[2],k=E[3];f<=1&&(k<h&&(h=k,E[0]),p<v&&(p=v,E[0]),f++)}if(1==f){var T=o.slice(0,25),L=20*(p-h)/100;h-=L,p+=L,a.findRange(T,h,p,t[r].symbol),f=0,h=o[1][3],p=o[1][2]}}}})}else console.log(t[r].symbol,"  emply candle found")}),e.next=10,new Promise(function(e){return setTimeout(e,600)});case 10:case"end":return e.stop()}},e)}),l=0;case 7:if(!(l<t.length)){e.next=12;break}return e.delegateYield(r(l),"t0",9);case 9:l++,e.next=7;break;case 12:case"end":return e.stop()}},e)})),a.findlast5minMovement=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s,i,c;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.setState({findlast5minMovementUpdate:""}),t=ot.duration("00:05:00"),"YYYY-MM-DD HH:mm",n=ot(new Date).subtract(t),r=a.state.staticData[a.state.selectedWatchlist],"selectall"==a.state.selectedWatchlist&&(r=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))),console.log("watchList",a.state.selectedWatchlist,r),a.setState({totalStockToWatch:r.length}),l=[],!r||!r.length){e.next=17;break}o=$.a.mark(function e(t){var o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=r[t],i={exchange:"NSE",symboltoken:o.token,interval:"ONE_MINUTE",fromdate:ot(n).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},c=t+1+". "+o.symbol,a.setState({findlast5minMovementUpdate:c}),window.document.title="FM: "+c,x.getHistoryData(i).then(function(e){var n=Q(e,"noPop");if(n&&n.data&&n.data.length){var o=[];n.data.forEach(function(e){var t=100*(e[4]-e[1])/e[1];t>=.3&&(1,o.push("<span style='color:green'>"+t.toFixed(2)+"% At "+new Date(e[0]).toLocaleTimeString().substr(0,5)+"</span>")),t<=-.3&&(1,o.push("<span style='color:red'>"+t.toFixed(2)+"% At "+new Date(e[0]).toLocaleTimeString().substr(0,5)+"</span>"))});var s=[];if(n.data.forEach(function(e){s.push([e[0],e[1],e[2],e[3],e[4]])}),o.length){var i={exchange:"NSE",tradingsymbol:r[t].symbol,symboltoken:r[t].token};x.getLTP(i).then(function(e){var n=Q(e,"noPop"),i=n&&n.data;if(i&&i.ltp){var c=100*(i.ltp-i.close)/i.close;l.push({symbol:r[t].symbol,ltp:i.ltp,perChange:c,percentChangeList:o.join(" | "),candleChartData:s}),console.log("foundData",l),a.setState({findlast5minMovement:l})}})}}else console.log(" candle data emply")}),e.next=8,new Promise(function(e){return setTimeout(e,333)});case 8:case"end":return e.stop()}},e)}),s=0;case 12:if(!(s<r.length)){e.next=17;break}return e.delegateYield(o(s),"t0",14);case 14:s++,e.next=12;break;case 17:case"end":return e.stop()}},e)})),a.callbackAfterOrderDone=function(e){console.log("order executed",e)},a.handleClick=function(e,t,n){if(console.log(e),e.token&&e.symbol){if("BUY"==t){a.setState(Object(y.a)({},n,!0));var r={token:e.token,symbol:e.symbol,qtyToTake:a.state.qtyToTake,producttype:"DELIVERY"};console.log(r),ut.historyWiseOrderPlace(r,"BUY","no",a.callbackAfterOrderDone),a.setState(Object(y.a)({},n,!1))}if("SELL"==t){a.setState(Object(y.a)({},n,!0));r={token:e.token,symbol:e.symbol,qtyToTake:a.state.qtyToTake,producttype:"DELIVERY"};console.log(r),ut.historyWiseOrderPlace(r,"SELL","no",a.callbackAfterOrderDone),a.setState(Object(y.a)({},n,!1))}}else z.showError(" Symbol Not found!!!")},a.state={staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],selectedWatchlist:"NIFTY BANK",totalStockToWatch:0,timeFrame:"FIFTEEN_MINUTE",chartStaticData:[],BBBlastType:"BBStrongBreakout",qtyToTake:"",fastMovementList:localStorage.getItem("fastMovementList")&&JSON.parse(localStorage.getItem("fastMovementList"))||[]},a.findlast5minMovement=a.findlast5minMovement.bind(Object(k.a)(a)),a.startSearching=a.startSearching.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.document.title="FM2";var t=this.state.staticData[this.state.selectedWatchlist];this.setState({totalStockToWatch:t.length});var a=ot("9:15am","h:mma"),n=ot("3:30pm","h:mma"),r=ot(new Date,"h:mma"),l=ot().isoWeekday(),o=setInterval(function(){var t=new Date;console.log("set interval 1sec min/10==0 ",t.toLocaleTimeString()),t.getMinutes()%2===0&&(console.log("search method call in with setTimeout 70sec",t.toLocaleTimeString()),setTimeout(function(){e.find10MinBBBlast()},7e4),e.setState({stop10bbSearch:setInterval(function(){console.log("search method call in with setInterval in 10min",t.toLocaleTimeString()),l<=5&&r.isBetween(a,n)&&e.find10MinBBBlast()},19e4)}),clearInterval(o))},1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.state.findlast5minMovementInterval),clearInterval(this.state.stop10bbSearch)}},{key:"findRange",value:function(e,t,a,n){for(var r=0,l=a-t,o=0;o<e.length;o++){var s=e[o];if(!(s[2]<=a&&s[3]>=t))break;r++}r>=3&&console.log(r,n,t,a,l,new Date(e[0][0]).toLocaleString())}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement("br",null),r.a.createElement(rt,null)," ",r.a.createElement(Ma,null),r.a.createElement(N.a,{justify:"space-between",container:!0,spacing:1},r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(R.a,{component:"h2",variant:"h6",color:"primary",gutterBottom:!0},"\xa0BB Blast (",this.state.findlast5minMovement&&this.state.findlast5minMovement.length,")",r.a.createElement("span",{id:"stockTesting",style:{fontSize:"18px",color:"gray"}}," ",this.state.findlast5minMovementUpdate," "))),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:Ln.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),r.a.createElement(ft.a,{value:this.state.selectedWatchlist,name:"selectedWatchlist",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"selectall"},"Select All"),this.state.totalWatchlist&&this.state.totalWatchlist.map(function(e){return r.a.createElement(yt.a,{value:e},e)})))),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,{style:Ln.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Time"),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1 Min"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5 Min"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10 Min"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15 Min"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30 Min"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1 Hour"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1 Day")))),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,{style:Ln.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Time"),r.a.createElement(ft.a,{value:this.state.BBBlastType,name:"BBBlastType",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"BBBlastOnly"},"BB Blast"),r.a.createElement(yt.a,{value:"BBBlastDaily"},"BB Blast Daily"),r.a.createElement(yt.a,{value:"BBStrongBreakout"},"BB Strong Breakout"),r.a.createElement(yt.a,{value:"findRange"},"Find Range")))),r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.find10MinBBBlast()}},"Start"),r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.stopSearching()}},"Stop"))),r.a.createElement(N.a,{container:!0,spacing:2},this.state.findlast5minMovement?this.state.findlast5minMovement.map(function(t,a){return r.a.createElement(N.a,{item:!0,xs:12,sm:3},r.a.createElement(Ct.a,{style:{overflow:"auto",padding:"10px"}},r.a.createElement(R.a,{style:{color:t.perChange>0?"green":"red"}}," ",t.symbol," ",t.ltp," ",r.a.createElement("b",null,"(",t.perChange.toFixed(2),"%) ")),t.candleChartData.length>0?r.a.createElement(Xe.a,{options:{chart:{type:"candlestick",height:250},title:{text:"",align:"left"},xaxis:{type:"datetime"},yaxis:{tooltip:{enabled:!0}}},series:[{data:t.candleChartData.slice(Math.max(t.candleChartData.length-10,1))}],type:"candlestick",width:350,height:250}):"",r.a.createElement(N.a,{direction:"row",style:{padding:"5px"},container:!0,className:"flexGrow",justify:"space-between"},t.DSMALastValue?r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{color:t.ltp>t.DSMALastValue?"green":"red",fontWeight:"bold"}},"Daily SMA: ",t.DSMALastValue," ",t.ltp>t.DSMALastValue?"BUY":"SELL"):"",r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{color:t.ltp>t.VWAP?"green":"red",fontWeight:"bold"}},"VWAP:  ",t.VWAP),r.a.createElement(N.a,{item:!0,xs:12,sm:12},"RSI: ",t.RSI.map(function(e,t){return e>=60?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}}," ",e," \xa0"):r.a.createElement("span",{style:{color:e<=40?"red":"",fontWeight:"bold"}}," ",e," \xa0")})),r.a.createElement(N.a,{item:!0,xs:12,sm:12},"BB \xa0 ",r.a.createElement("span",{style:{color:t.ltp>=t.BB.upper?"green":"",fontWeight:"bold"}},"Upper: ",t.BB.upper),"\xa0 Middle: ",t.BB.middle,"\xa0 ",r.a.createElement("span",{style:{color:t.ltp<=t.BB.lower?"red":"",fontWeight:"bold"}}," Lower: ",t.BB.lower))),r.a.createElement(N.a,{direction:"row",style:{padding:"5px"},container:!0,className:"flexGrow",justify:"space-between"},r.a.createElement(N.a,{item:!0},e.state["buyButtonClicked"+t.symbol+a]?r.a.createElement(gt.a,null):r.a.createElement(B.a,{size:"small",variant:"contained",color:"primary",onClick:function(){return e.handleClick(t,"BUY","buyButtonClicked"+t.symbol+a)}},"BUY")),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"Qty",type:"number",name:"qtyToTake",value:e.state.qtyToTake,onChange:e.onChangeQty})),r.a.createElement(N.a,{item:!0},e.state["sellButtonClicked"+t.symbol+a]?r.a.createElement(gt.a,null):r.a.createElement(B.a,{size:"small",variant:"contained",color:"Secondary",onClick:function(){return e.handleClick(t,"SELL","sellButtonClicked"+t.symbol+a)}},"SELL")))))}):""))}}]),t}(r.a.Component),Ln={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},Cn=Tn,wn=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).stopSearching=function(){console.log("stop the search"),clearInterval(a.state.findlast5minMovementInterval),clearInterval(a.state.stop10bbSearch)},a.showCandleChart=function(e,t,a,n){localStorage.setItem("candleChartData",JSON.stringify(e)),localStorage.setItem("cadleChartSymbol",t),localStorage.setItem("candlePriceShow",a),localStorage.setItem("candleChangeShow",n.toFixed(2)),document.getElementById("showCandleChart").click()},a.speckIt=function(e){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)},a.onChangeWatchlist=function(e){clearInterval(a.state.findlast5minMovementInterval),a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.find10MinBBBlast()})},a.onChangeQty=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.startSearching=function(){console.log("Starting the search");var e=ot("9:15am","h:mma"),t=ot("3:30pm","h:mma"),n=ot(new Date,"h:mma");if(ot().isoWeekday()<=5&&n.isBetween(e,t)){var r=6e4;a.state.totalStockToWatch>180&&(r=333*a.state.totalStockToWatch),a.setState({findlast5minMovementInterval:setInterval(function(){a.findlast5minMovement()},r)})}},a.getTimeFrameValue=function(e){switch(e){case"ONE_MINUTE":return(new Date).toLocaleTimeString()<"10:05:00"?"18:21:00":"00:21:00";case"FIVE_MINUTE":return(new Date).toLocaleTimeString()<"11:00:00"?"19:41:00":"01:41:00";case"TEN_MINUTE":return(new Date).toLocaleTimeString()<"12:35:00"?"21:21:00":"03:21:00";case"FIFTEEN_MINUTE":return(new Date).toLocaleTimeString()<"14:15:00"?"23:01:00":"05:01:00";case"THIRTY_MINUTE":return"84:01:00";case"ONE_HOUR":return"168:01:00";case"ONE_DAY":return"744:01:00"}},a.updateToLocalStorage=function(e){var t=new Date(e.foundAt).toLocaleString(),n=a.state.fastMovementList.filter(function(a){return a.token==e.token&&a.foundAt==t});if(console.log("isfound",n),n.length)return!1;var r={token:e.token,foundAt:t,ltp:e.ltp,symbol:e.symbol,nc:e.perChange.toFixed(2),orderType:e.orderType};return a.state.fastMovementList.push(r),localStorage.setItem("fastMovementList",JSON.stringify(a.state.fastMovementList)),!0},a.find10MinBBBlast=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s,i;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({findlast5minMovementUpdate:"",findlast5minMovement:[]}),t=a.state.staticData[a.state.selectedWatchlist],"selectall"==a.state.selectedWatchlist&&(t=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))),a.setState({totalStockToWatch:t.length}),n=[],r=$.a.mark(function e(r){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" Scaning"}),l="YYYY-MM-DD HH:mm",ot("9:15am","h:mma").format(l),a.getTimeFrameValue(a.state.timeFrame),o=ot.duration("100:00:00"),s=ot(new Date).subtract(o),i={exchange:t[r].exch_seg,symboltoken:t[r].token,interval:a.state.timeFrame,fromdate:ot(s).format(l),todate:ot(new Date).format(l)},x.getHistoryData(i).then(function(e){var l=Q(e,"noPop");if(l&&l.data&&l.data.length){var o=l.data,s=[],i=[],c=[],m=[],u=[],d=[],g=[],h=[],p=[];o.forEach(function(e,t){s.push([e[0],e[1],e[2],e[3],e[4]]);new Date(e[0]).getFullYear(),new Date(e[0]).getMonth(),new Date(e[0]).getDate();i.push({x:new Date(e[0]).getTime(),y:(e[2]+e[3]+e[4])/3}),c.push([e[5],(e[2]+e[3]+e[4])/3]),m.push(e[4]),u.push(e[2]),d.push(e[3]),g.push(e[3]),h.push(e[5]),p.push((e[2]+e[3]+e[4])/3)});Ft.a.calculate({period:20,values:m});var f={values:m,period:14},y=st.a.calculate(f),b={period:20,values:p,stdDev:2},E=it.a.calculate(b),S=E[E.length-1];S&&(S.upper=S.upper.toFixed(2),S.middle=S.middle.toFixed(2),S.lower=S.lower.toFixed(2));var v={values:m,fastPeriod:12,slowPeriod:26,signalPeriod:9,SimpleMAOscillator:!1,SimpleMASignal:!1},k=kn.a.calculate(v),T=k[k.length-1];T&&T.MACD>=T.signal&&console.log("macd",t[r].symbol,T);var L={exchange:"NSE",tradingsymbol:t[r].symbol,symboltoken:t[r].token};x.getLTP(L).then(function(e){var l=Q(e,"noPop"),m=l&&l.data;if(m&&m.ltp){y=y.slice(y.length-6,y.length),a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" Searching"});if("selectAll"==a.state.BBBlastType||"macdCrossOver"==a.state.BBBlastType)if(T&&T.MACD>=T.signal){var u=100*(m.ltp-m.close)/m.close,d={symbol:t[r].symbol,token:t[r].token,ltp:m.ltp,perChange:u,RSIValue:y[y.length-1],RSI:y,VWAP:mt()(c),BB:S,candleChartData:s,lightcandleChartData:i,foundAt:o&&o[o.length-1][0],orderType:"BUY",name:t[r].name,macdData:k.slice(Math.max(k.length-6,1)),patternName:"MACD Cossed Up"};a.updateToLocalStorage(d)&&(n.push(d),a.setState({findlast5minMovement:n}),a.speckIt(t[r].symbol+" macd  buy"),window.document.title="macd: Buy "+t[r].symbol,a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" BUY Eligible"}))}else if(T&&T.MACD<=T.signal){u=100*(m.ltp-m.close)/m.close;var g={symbol:t[r].symbol,token:t[r].token,ltp:m.ltp,perChange:u,RSIValue:y[y.length-1],RSI:y,VWAP:mt()(c),BB:S,candleChartData:s,lightcandleChartData:i,foundAt:o&&o[o.length-1][0],orderType:"SELL",name:t[r].name,macdData:k.slice(Math.max(k.length-6,1)),patternName:"MACD Cossed Down"};a.updateToLocalStorage(g)&&(n.push(g),a.setState({findlast5minMovement:n}),a.speckIt(t[r].symbol+" macd sell"),window.document.title="macd: Sell "+t[r].symbol,a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" SELL Eligible"}))}else a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" Not Eligible"});if("selectAll"==a.state.BBBlastType||"BBStrongBreakout"==a.state.BBBlastType)if(S&&m.ltp>=S.upper&&o[o.length-1][2]==o[o.length-1][4]){u=100*(m.ltp-m.close)/m.close;var h={symbol:t[r].symbol,token:t[r].token,ltp:m.ltp,perChange:u,RSIValue:y[y.length-1],RSI:y,VWAP:mt()(c),BB:S,candleChartData:s,lightcandleChartData:i,foundAt:o&&o[o.length-1][0],orderType:"BUY",name:t[r].name,patternName:"BB Strong Buy"};a.updateToLocalStorage(h)&&(n.push(h),a.setState({findlast5minMovement:n}),a.speckIt(t[r].symbol+" BB  buy"),window.document.title="FM2: Buy "+t[r].symbol,a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" BUY Eligible"}))}else if(S&&m.ltp<=S.lower&&o[o.length-1][3]==o[o.length-1][4]){u=100*(m.ltp-m.close)/m.close;var p={symbol:t[r].symbol,token:t[r].token,ltp:m.ltp,perChange:u,RSIValue:y[y.length-1],RSI:y,VWAP:mt()(c),BB:S,candleChartData:s,lightcandleChartData:i,foundAt:o&&o[o.length-1][0],orderType:"SELL",name:t[r].name,patternName:"BB Strong Sell"};a.updateToLocalStorage(p)&&(n.push(p),a.setState({findlast5minMovement:n}),a.speckIt(t[r].symbol+" BB sell"),window.document.title="FM2: Sell "+t[r].symbol,a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" SELL Eligible"}))}else a.setState({findlast5minMovementUpdate:r+1+". "+t[r].symbol+" At "+(new Date).toLocaleTimeString()+" Not Eligible"})}})}else console.log(t[r].symbol,"  emply candle found")}),e.next=10,new Promise(function(e){return setTimeout(e,600)});case 10:case"end":return e.stop()}},e)}),l=0;case 7:if(!(l<t.length)){e.next=12;break}return e.delegateYield(r(l),"t0",9);case 9:l++,e.next=7;break;case 12:case"end":return e.stop()}},e)})),a.findlast5minMovement=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s,i,c;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.setState({findlast5minMovementUpdate:""}),t=ot.duration("00:05:00"),"YYYY-MM-DD HH:mm",n=ot(new Date).subtract(t),r=a.state.staticData[a.state.selectedWatchlist],"selectall"==a.state.selectedWatchlist&&(r=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))),console.log("watchList",a.state.selectedWatchlist,r),a.setState({totalStockToWatch:r.length}),l=[],!r||!r.length){e.next=17;break}o=$.a.mark(function e(t){var o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=r[t],i={exchange:"NSE",symboltoken:o.token,interval:"ONE_MINUTE",fromdate:ot(n).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},c=t+1+". "+o.symbol,a.setState({findlast5minMovementUpdate:c}),window.document.title="FM: "+c,x.getHistoryData(i).then(function(e){var n=Q(e,"noPop");if(n&&n.data&&n.data.length){var o=[];n.data.forEach(function(e){var t=100*(e[4]-e[1])/e[1];t>=.3&&(1,o.push("<span style='color:green'>"+t.toFixed(2)+"% At "+new Date(e[0]).toLocaleTimeString().substr(0,5)+"</span>")),t<=-.3&&(1,o.push("<span style='color:red'>"+t.toFixed(2)+"% At "+new Date(e[0]).toLocaleTimeString().substr(0,5)+"</span>"))});var s=[];if(n.data.forEach(function(e){s.push([e[0],e[1],e[2],e[3],e[4]])}),o.length){var i={exchange:"NSE",tradingsymbol:r[t].symbol,symboltoken:r[t].token};x.getLTP(i).then(function(e){var n=Q(e,"noPop"),i=n&&n.data;if(i&&i.ltp){var c=100*(i.ltp-i.close)/i.close;l.push({symbol:r[t].symbol,ltp:i.ltp,perChange:c,percentChangeList:o.join(" | "),candleChartData:s}),console.log("foundData",l),a.setState({findlast5minMovement:l})}})}}else console.log(" candle data emply")}),e.next=8,new Promise(function(e){return setTimeout(e,333)});case 8:case"end":return e.stop()}},e)}),s=0;case 12:if(!(s<r.length)){e.next=17;break}return e.delegateYield(o(s),"t0",14);case 14:s++,e.next=12;break;case 17:case"end":return e.stop()}},e)})),a.callbackAfterOrderDone=function(e){console.log("order executed",e)},a.handleClick=function(e,t,n){if(console.log(e),e.token&&e.symbol){if("BUY"==t){a.setState(Object(y.a)({},n,!0));var r={token:e.token,symbol:e.symbol,qtyToTake:a.state.qtyToTake};console.log(r),ut.historyWiseOrderPlace(r,"BUY","no",a.callbackAfterOrderDone),a.setState(Object(y.a)({},n,!1))}if("SELL"==t){a.setState(Object(y.a)({},n,!0));r={token:e.token,symbol:e.symbol,qtyToTake:a.state.qtyToTake};console.log(r),ut.historyWiseOrderPlace(r,"SELL","no",a.callbackAfterOrderDone),a.setState(Object(y.a)({},n,!1))}}else z.showError(" Symbol Not found!!!")},a.state={staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],selectedWatchlist:"NIFTY 50",totalStockToWatch:0,timeFrame:"FIFTEEN_MINUTE",chartStaticData:[],BBBlastType:"selectAll",qtyToTake:"",fastMovementList:localStorage.getItem("fastMovementList")&&JSON.parse(localStorage.getItem("fastMovementList"))||[]},a.findlast5minMovement=a.findlast5minMovement.bind(Object(k.a)(a)),a.startSearching=a.startSearching.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.document.title="FM2";var t=this.state.staticData[this.state.selectedWatchlist];this.setState({totalStockToWatch:t.length});var a=ot("9:15am","h:mma"),n=ot("3:30pm","h:mma"),r=ot(new Date,"h:mma"),l=ot().isoWeekday(),o=setInterval(function(){var t=new Date;console.log("set interval 1sec min/10==0 ",t.toLocaleTimeString()),t.getMinutes()%2===0&&(console.log("search method call in with setTimeout 70sec",t.toLocaleTimeString()),setTimeout(function(){e.find10MinBBBlast()},7e4),e.setState({stop10bbSearch:setInterval(function(){console.log("search method call in with setInterval in 10min",t.toLocaleTimeString()),l<=5&&r.isBetween(a,n)&&e.find10MinBBBlast()},19e4)}),clearInterval(o))},1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.state.findlast5minMovementInterval),clearInterval(this.state.stop10bbSearch)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement("br",null),r.a.createElement(rt,null)," ",r.a.createElement(Ma,null),r.a.createElement(N.a,{justify:"space-between",container:!0,spacing:1},r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(R.a,{component:"h2",variant:"h6",color:"primary",gutterBottom:!0},"\xa0BB Blast (",this.state.findlast5minMovement&&this.state.findlast5minMovement.length,")",r.a.createElement("span",{id:"stockTesting",style:{fontSize:"18px",color:"gray"}}," ",this.state.findlast5minMovementUpdate," "))),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:xn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),r.a.createElement(ft.a,{value:this.state.selectedWatchlist,name:"selectedWatchlist",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"selectall"},"Select All"),this.state.totalWatchlist&&this.state.totalWatchlist.map(function(e){return r.a.createElement(yt.a,{value:e},e)})))),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,{style:xn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Time"),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1 Min"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5 Min"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10 Min"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15 Min"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30 Min"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1 Hour"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1 Day")))),r.a.createElement(N.a,{item:!0,xs:12,sm:1},r.a.createElement(pt.a,{style:xn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Time"),r.a.createElement(ft.a,{value:this.state.BBBlastType,name:"BBBlastType",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"selectAll"},"Select All"),r.a.createElement(yt.a,{value:"BBStrongBreakout"},"BB Strong Breakout"),r.a.createElement(yt.a,{value:"macdCrossOver"},"Macd Cross Over")))),r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.find10MinBBBlast()}},"Start"),r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.stopSearching()}},"Stop"))),r.a.createElement(N.a,{container:!0,spacing:2},this.state.findlast5minMovement?this.state.findlast5minMovement.map(function(t,a){return r.a.createElement(N.a,{item:!0,xs:12,sm:3},r.a.createElement(Ct.a,{style:{overflow:"auto",padding:"10px"}},r.a.createElement(R.a,{style:{color:t.perChange>0?"green":"red"}}," ",t.symbol," ",t.ltp," ",r.a.createElement("b",null,"(",t.perChange.toFixed(2),"%) ")," \xa0\xa0 ",t.patternName),t.candleChartData.length>0?r.a.createElement(Xe.a,{options:{chart:{type:"candlestick",height:250},title:{text:"",align:"left"},xaxis:{type:"datetime"},yaxis:{tooltip:{enabled:!0}}},series:[{data:t.candleChartData.slice(Math.max(t.candleChartData.length-10,1))}],type:"candlestick",width:350,height:250}):"",r.a.createElement(N.a,{direction:"row",style:{padding:"5px"},container:!0,className:"flexGrow",justify:"space-between"},t.DSMALastValue?r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{color:t.ltp>t.DSMALastValue?"green":"red",fontWeight:"bold"}},"Daily SMA: ",t.DSMALastValue," ",t.ltp>t.DSMALastValue?"BUY":"SELL"):"",r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{color:t.ltp>t.VWAP?"green":"red",fontWeight:"bold"}},"VWAP:  ",t.VWAP),r.a.createElement(N.a,{item:!0,xs:12,sm:12},"RSI: ",t.RSI.map(function(e,t){return e>=60?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}}," ",e," \xa0"):r.a.createElement("span",{style:{color:e<=40?"red":"",fontWeight:"bold"}}," ",e," \xa0")})),r.a.createElement(N.a,{item:!0,xs:12,sm:12},"BB \xa0 ",r.a.createElement("span",{style:{color:t.ltp>=t.BB.upper?"green":"",fontWeight:"bold"}},"Upper: ",t.BB.upper),"\xa0 Middle: ",t.BB.middle,"\xa0 ",r.a.createElement("span",{style:{color:t.ltp<=t.BB.lower?"red":"",fontWeight:"bold"}}," Lower: ",t.BB.lower)),r.a.createElement(N.a,{item:!0,xs:12,sm:12},"MACD: ",t.macdData.map(function(e,t){return r.a.createElement("span",null," ",e.MACD&&e.MACD.toFixed(2)," \xa0")}),r.a.createElement("br",null),"MACD Signal: ",t.macdData.map(function(e,t){return r.a.createElement("span",null," ",e.signal&&e.signal.toFixed(2)," \xa0")}),r.a.createElement("br",null),"MACD histogram: ",t.macdData.map(function(e,t){return r.a.createElement("span",null," ",e.histogram&&e.histogram.toFixed(2)," \xa0")}))),r.a.createElement(N.a,{direction:"row",style:{padding:"5px"},container:!0,className:"flexGrow",justify:"space-between"},r.a.createElement(N.a,{item:!0},e.state["buyButtonClicked"+t.symbol+a]?r.a.createElement(gt.a,null):r.a.createElement(B.a,{size:"small",variant:"contained",color:"primary",onClick:function(){return e.handleClick(t,"BUY","buyButtonClicked"+t.symbol+a)}},"BUY")),r.a.createElement(N.a,{item:!0},r.a.createElement(Y.a,{label:"Qty",type:"number",name:"qtyToTake",value:e.state.qtyToTake,onChange:e.onChangeQty})),r.a.createElement(N.a,{item:!0},e.state["sellButtonClicked"+t.symbol+a]?r.a.createElement(gt.a,null):r.a.createElement(B.a,{size:"small",variant:"contained",color:"Secondary",onClick:function(){return e.handleClick(t,"SELL","sellButtonClicked"+t.symbol+a)}},"SELL")))))}):""))}}]),t}(r.a.Component),xn={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},In=wn,Dn=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(2)},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}})(function(e){var t=e.children,a=e.classes,n=e.onClose,l=Object(He.a)(e,["children","classes","onClose"]);return r.a.createElement(Re.a,Object.assign({disableTypography:!0,className:a.root},l),r.a.createElement(R.a,{variant:"h6"},t),n?r.a.createElement(ie.a,{"aria-label":"close",className:a.closeButton,onClick:n},r.a.createElement(Je.a,null)):null)}),On=Object(je.a)(function(e){return{root:{padding:e.spacing(2)}}})(Ue.a),Pn=Object(je.a)(function(e){return{root:{margin:0,padding:e.spacing(1)}}})(_e.a);function Fn(e){var t=e.chartData.chartStaticData;console.log("lightChartData",t);var a=r.a.useState(!1),n=Object(ae.a)(a,2),l=n[0],o=n[1],s=r.a.useState({data:[],candledata:{},timeFrame:"FIVE_MINUTE"}),i=Object(ae.a)(s,2),c=(i[0],i[1],function(){o(!1)});return r.a.createElement("div",null,r.a.createElement(B.a,{variant:"outlined",id:"showLightChart",color:"primary",style:{display:"none"},onClick:function(){o(!0)}},"Chart"),r.a.createElement(We.a,{maxWidth:"lg",onClose:c,"aria-labelledby":"customized-dialog-title",open:l},r.a.createElement(Dn,{id:"customized-dialog-title",onClose:c},"\xa0",t.name,"   ",t.ltp,"  (",t.change,"%)"),r.a.createElement(On,{dividers:!0,id:"chart"},r.a.createElement(et,{chartData:{candleSeries:t.lightChartData,volumeSeries:t.volumeSeriesData}})),r.a.createElement(Pn,null,r.a.createElement(B.a,{autoFocus:!0,onClick:c,color:"primary"},"Close"))))}var Nn=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).onChangeWatchlist=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.checkSlowMotion()})},a.checkSlowMotion=Object(te.a)($.a.mark(function e(){var t,n,r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.state.staticData[a.state.selectedWatchlist],"selectall"==a.state.selectedWatchlist&&(t=localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))),a.setState({scanUpdate:""}),n=$.a.mark(function e(n){var r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t[n],a.state.slowMotionStockList.filter(function(e){return e.token==r.token}).length){e.next=6;break}return a.checkSlowMotionStock(r.token,r,n+1),e.next=6,new Promise(function(e){return setTimeout(e,310)});case 6:case"end":return e.stop()}},e)}),r=0;case 5:if(!(r<t.length)){e.next=10;break}return e.delegateYield(n(r),"t0",7);case 7:r++,e.next=5;break;case 10:case"end":return e.stop()}},e)})),a.getTimeFrameValue=function(e){switch(e){case"ONE_MINUTE":return"720:00:00";case"FIVE_MINUTE":case"TEN_MINUTE":case"FIFTEEN_MINUTE":return"2160:00:00";case"THIRTY_MINUTE":case"ONE_HOUR":return"4320:00:00";case"ONE_DAY":return"8760:00:00"}},a.updateTimeFrameChart=function(e,t){console.log(e,t);var n=a.getTimeFrameValue(t),r=ot(new Date).subtract(n),l={exchange:"NSE",symboltoken:e,interval:t,fromdate:ot(r).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")};x.getHistoryData(l).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){for(var n=t.data,r=[],l=0;l<n.length;l++){var o=n[l];r.push({time:new Date(o[0]).getTime(),value:o[5],color:"rgba(211, 211, 211, 1)"})}var s=n.map(function(e){return{time:new Date(e[0]).getTime(),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4])}}),i=localStorage.getItem("lightChartData")&&JSON.parse(localStorage.getItem("lightChartData"));i.lightChartData=s,i.volumeSeriesData=r,a.setState({chartStaticData:i})}})},a.checkSlowMotionStock=function(e,t,n){ot("9:15am","h:mma");var r=ot.duration("240:00:00"),l=ot(new Date).subtract(r),o={exchange:"NSE",symboltoken:e,interval:"FIVE_MINUTE",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")};x.getHistoryData(o).then(function(r){var l=Q(r,"noPop");if(l&&l.data&&l.data.length){for(var o=l.data,s=[],i=0,c=o.length-375;c<o.length;c++){var m=o[c];if(m){var u=100*(m[4]-m[1])/m[1];u>=.4&&(i+=1),u<=-.4&&(i+=1)}s.push({time:new Date(m[0]).getTime(),value:m[5],color:"rgba(211, 211, 211, 1)"})}if(console.log("Totalcount",t.name,i,s),a.setState({scanUpdate:"Scan: "+n+". "+t.name+" maxCount: "+i}),i<=15)if(!a.state.slowMotionStockList.filter(function(t){return t.token==e}).length){t.bigCandleCount=i,t.sectorName=a.state.selectedWatchlist;var d=[];o.forEach(function(e){d.push([e[0],e[1],e[2],e[3],e[4]])});var g=o.map(function(e){return{time:new Date(e[0]).getTime(),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4])}});t.candleChartData=d,t.lightChartData=g,t.volumeSeriesData=s,a.setState({slowMotionStockList:[].concat(Object(ee.a)(a.state.slowMotionStockList),[t])},function(){})}}})},a.checkSlowMotionCheckLive=Object(te.a)($.a.mark(function e(){var t,n,r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=a.state.slowMotionStockList[t]).isActivated){e.next=10;break}return"YYYY-MM-DD HH:mm",r=ot.duration("50:00:00"),l=ot(new Date).subtract(r),ot("9:15am","h:mma"),o={exchange:"NSE",symboltoken:n.token,interval:"FIVE_MINUTE",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(o).then(function(e){var r=Q(e,"noPop");if(r&&r.data&&r.data.length){for(var l=r.data,o=0,s=0,i=0,c="",m=0,u=l.length-3;u<l.length;u++){var d=l[u];if(d){var g=100*(d[4]-d[1])/d[1];g>=1&&(o+=1,m=d[2],c=new Date(d[0]).toLocaleString()),g>=.5&&(s+=1,m=d[2],c=new Date(d[0]).toLocaleString()),g>=0&&(i+=1)}}var h=[];l.forEach(function(e){h.push([e[0],e[1],e[2],e[3],e[4]])}),n.candleChartData=h;var p=Object(ea.a)("Update: "+(t+1)+"."+n.name+" large(1%): <b>"+o+"</b> &nbsp;mid(0.5%): <b>"+s+"</b> &nbsp;small(>0%): <b>"+i+"</b>");a.setState({scanUpdate:p}),console.log(n.symbol,o,s,i);var f="large(1%): <b>"+o+"</b> &nbsp;mid(0.5%): <b>"+s+"</b> &nbsp;small(>0%): <b>"+i+"</b> at "+new Date(l[l.length-1][0]).toLocaleTimeString();n.update=f,(o>=1||s>=1&&i>=2)&&(n.isActivated=!0,n.activationTime=c,n.activationPrice=m,window.document.title="SM: "+n.symbol,console.log("hey, slow motion stock"+n.symbol+" broken"),a.speckIt("hey, slow motion stock"+n.symbol+" broken"),a.setState({slowMotionStockList:a.state.slowMotionStockList},function(){this.sortByColumn("isActivated")}))}}),e.next=10,new Promise(function(e){return setTimeout(e,310)});case 10:case"end":return e.stop()}},e)}),n=0;case 2:if(!(n<a.state.slowMotionStockList.length)){e.next=7;break}return e.delegateYield(t(n),"t0",4);case 4:n++,e.next=2;break;case 7:case"end":return e.stop()}},e)})),a.activationToLtpChange=Object(te.a)($.a.mark(function e(){var t,n,r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.slowMotionStockList[t],r={exchange:"NSE",tradingsymbol:n.symbol,symboltoken:n.token},x.getLTP(r).then(function(e){var t=Q(e,"noPop"),r=t&&t.data;r&&r.ltp&&(n.ltp=r.ltp,n.change=(100*(r.ltp-r.close)/r.close).toFixed(2),n.activationPrice&&(n.AtoltpChng=(100*(r.ltp-n.activationPrice)/n.activationPrice).toFixed(2)),a.setState({slowMotionStockList:a.state.slowMotionStockList},function(){localStorage.setItem("slowMotionStockList",JSON.stringify(this.state.slowMotionStockList))}))}),e.next=5,new Promise(function(e){return setTimeout(e,125)});case 5:case"end":return e.stop()}},e)}),n=0;case 2:if(!(n<a.state.slowMotionStockList.length)){e.next=7;break}return e.delegateYield(t(n),"t0",4);case 4:n++,e.next=2;break;case 7:case"end":return e.stop()}},e)})),a.showLightChart=function(e){console.log("row",e),e.lightChartData.length>0&&(localStorage.setItem("lightChartData",JSON.stringify(e)),a.setState({chartStaticData:e},function(){document.getElementById("showLightChart").click()}))},a.deleteAllScan=function(){window.confirm("Are you sure to delete all scan stocks?")&&(a.setState({slowMotionStockList:[]}),localStorage.setItem("slowMotionStockList",[]))},a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value.trim()))},a.convertToFloat=function(e){if(!isNaN(e))return"("+(e/1e5).toFixed(2)+"L)"},a.speckIt=function(e){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)},a.getPercentageColor=function(e){return"rgb("+((e*=100)<50?255:Math.floor(255-255*(2*e-100)/100))+","+(e>50?255:Math.floor(2*e*255/100))+",0)"},a.sortByColumn=function(e){a.state.slowMotionStockList.sort(function(t,a){return"isActivated"==e&&t.isActivated?t.isActivated===a.isActivated?0:t?-1:1:a[e]-t[e]}),a.setState({slowMotionStockList:a.state.slowMotionStockList,sortedType:e})},a.state={oderbookData:[],listofzones:[],selectedZone:[],zone:"",selectAllzone:"Select All",triggerprice:0,price:0,lotsize:0,firstTimeFlag:!0,staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],selectedWatchlist:"NIFTY BANK",totalStockToWatch:0,timeFrame:"TEN_MINUTE",qtyToTake:"",BBBlastType:"BBBlastOnly",fastMovementList:localStorage.getItem("fastMovementList")&&JSON.parse(localStorage.getItem("fastMovementList"))||[],sortedType:"isActivated",slowMotionStockList:localStorage.getItem("slowMotionStockList")&&JSON.parse(localStorage.getItem("slowMotionStockList"))||[]},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=ot("9:15am","h:mma"),a=ot("3:30pm","h:mma"),n=ot(new Date,"h:mma");if(ot().isoWeekday()<=5&&n.isBetween(t,a))var r=setInterval(function(){(new Date).getMinutes()%5===0&&(setTimeout(function(){e.checkSlowMotionCheckLive()},7e4),setInterval(function(){e.checkSlowMotionCheckLive(),e.activationToLtpChange()},37e4),clearInterval(r))},1e3)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,"#/position"!==window.location.hash?r.a.createElement(Et,null):"",r.a.createElement(rt,null),this.state.chartStaticData?r.a.createElement(Fn,{chartData:{updateTimeFrameChart:this.updateTimeFrameChart,chartStaticData:this.state.chartStaticData}}):"",r.a.createElement(N.a,{direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(N.a,{justify:"space-between",container:!0,spacing:1},r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(R.a,{component:"h2",variant:"h6",color:"primary",gutterBottom:!0},"Slow Motion (",this.state.slowMotionStockList.length,")  ",r.a.createElement(Gt.a,{onClick:function(){return e.deleteAllScan()}}),"  found at ",(new Date).toLocaleString()),this.state.sortedType?r.a.createElement(r.a.Fragment,null," ",r.a.createElement("b",null," Sorted By: ")," ",this.state.sortedType,"  "):""),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:Mn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),r.a.createElement(ft.a,{value:this.state.selectedWatchlist,name:"selectedWatchlist",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"selectall"},"Select All"),this.state.totalWatchlist&&this.state.totalWatchlist.map(function(e){return r.a.createElement(yt.a,{value:e},e)})))),r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.checkSlowMotion()}},"Scan"),this.state.scanUpdate?r.a.createElement(r.a.Fragment,null,this.state.scanUpdate,"  "):""),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(B.a,{variant:"contained",style:{marginRight:"20px"},onClick:function(){return e.checkSlowMotionCheckLive()}},"Refresh"))),r.a.createElement(qe.a,{size:"small",style:{width:"100%"},"aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"left"},"Sr."),r.a.createElement(Qe.a,{align:"left"},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("pchange")}},"Symbol")," "),r.a.createElement(Qe.a,{align:"center"},"Sector"),r.a.createElement(Qe.a,{align:"center"},"Max Count"),r.a.createElement(Qe.a,{align:"center"},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("isActivated")}},"Is Activated")),r.a.createElement(Qe.a,{align:"center"},"Activate Time"),r.a.createElement(Qe.a,{align:"center"},"Activation Price"),r.a.createElement(Qe.a,{align:"center"},"Last Update"),r.a.createElement(Qe.a,{align:"center"},r.a.createElement(B.a,{onClick:function(){return e.activationToLtpChange()}},"A.toLtpChng")))),r.a.createElement(Ke.a,null,this.state.slowMotionStockList?this.state.slowMotionStockList.map(function(t,a){return r.a.createElement(ze.a,{hover:!0,key:a,style:{background:t.isActivated?"lightgray":""}},r.a.createElement(Qe.a,{align:"left"},a+1),r.a.createElement(Qe.a,{align:"left"}," ",r.a.createElement(B.a,{size:"small",variant:"contained",style:{color:t.change?t.change>0?"green":"red":""},onClick:function(){return e.showLightChart(t)}}," ",t.name," ",t.ltp,"  ",t.change?"("+t.change+"%)":"","  ",r.a.createElement(xe.a,null)," ")),r.a.createElement(Qe.a,{align:"center"},t.sectorName),r.a.createElement(Qe.a,{align:"center"},t.bigCandleCount),r.a.createElement(Qe.a,{align:"center"},t.isActivated?"Yes":"No"),r.a.createElement(Qe.a,{align:"center"},t.activationTime),r.a.createElement(Qe.a,{align:"center"},t.activationPrice),r.a.createElement(Qe.a,{align:"center"},t.update?Object(ea.a)(t.update):""),r.a.createElement(Qe.a,{align:"center"},t.ltp," ",t.AtoltpChng?"("+t.AtoltpChng+"%)":""))}):r.a.createElement(gt.a,null)))))))}}]),t}(r.a.Component),Mn={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},Bn=Nn,An=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).makeConnection=function(e){var t='{"task":"cn","channel":"NONLM","token":"'+a.state.feedToken+'","user": "'+a.state.clientcode+'","acctid":"'+a.state.clientcode+'"}';e.send(t),a.updateSocketWatch(e)},a.decodeWebsocketData=function(e){var t=[];try{for(var a=0;a<e.length;a++)t.push(String.fromCharCode(e[a]))}catch(n){}return t.join("")},a.updateSocketWatch=function(e){var t=a.state.symbolList.map(function(e){return"nse_cm|"+e.token}),n={task:"mw",channel:t=t.join("&"),token:a.state.feedToken,user:a.state.clientcode,acctid:a.state.clientcode};e.send(JSON.stringify(n))},a.takeAction=function(e,t){if(!(a.state.actionList.length&&a.state.actionList.filter(function(t){return t.symbol===e})).length){var n={symbol:e,action:t,updateTime:(new Date).toLocaleTimeString()};a.setState({actionList:[].concat(Object(ee.a)(a.state.actionList),[n])},function(){localStorage.setItem("actionList",JSON.stringify(this.state.actionList)),this.speckIt(e+" "+t),console.log(n.symbol+" "+n.action+" "+n.updateTime),this.setState({lastUpdateAction:n.symbol+" "+n.action+" "+n.updateTime})})}},a.updateSocketDetails=function(e){e.onopen=function(t){a.makeConnection(e),a.updateSocketWatch(e)},e.onmessage=function(e){var t=window.atob(e.data),n=a.decodeWebsocketData(Pt.a.inflate(t)),r=JSON.parse(n),l=a.state.symbolList;a.state.symbolList&&a.state.symbolList.forEach(function(e,t){var n=r.filter(function(t){return t.tk==e.token});n.length>0&&n[0].ltp&&n[0].nc&&(console.log(n[0]),l[t].ltp=n[0].ltp,l[t].pChange=n[0].nc,l[t].totalBuyQuantity=n[0].tbq,l[t].totalSellQuantity=n[0].tsq,l[t].totalTradedVolume=n[0].v,l[t].averagePrice=n[0].ap,l[t].lowPrice=n[0].lo,l[t].highPrice=n[0].h,l[t].openPrice=n[0].op,l[t].bestbuyquantity=n[0].bq,l[t].bestbuyprice=n[0].bp,l[t].bestsellquantity=n[0].bs,l[t].bestsellprice=n[0].sp,l[t].buytosellTime=(n[0].tbq/n[0].tsq).toFixed(2),l[t].selltobuyTime=(n[0].tsq/n[0].tbq).toFixed(2),n[0].tbq/n[0].tsq>2?(l[t].highlightbuy=!0,a.takeAction(e.symbol," buying")):l[t].highlightbuy=!1,n[0].tsq/n[0].tbq>2?(l[t].highlightsell=!0,a.takeAction(e.symbol," selling")):l[t].highlightsell=!1)});var o=a.state.sortedType;l&&l.sort(function(e,t){return t[o]-e[o]}),a.setState({symbolList:l})},e.onerror=function(e){console.log("socket error",e)},setInterval(function(){var t='{"task":"hb","channel":"","token":"'+a.state.feedToken+'","user": "'+a.state.clientcode+'","acctid":"'+a.state.clientcode+'"}';console.log("Request :- "+t),e.send(t)},59e3)},a.getUpdateIndexData=function(){a.setState({softedIndexList:[]}),x.allIndicesDirectJSON().then(function(e){if(e.data){var t=e.data&&e.data.data;t.sort(function(e,t){return t.percChange-e.percChange});for(var n=0;n<t.length;n++){var r=t[n];a.state.sluglist[r.indexName]&&a.setState({softedIndexList:[].concat(Object(ee.a)(a.state.softedIndexList),[r])})}a.makeConnection(a.wsClint)}}).catch(function(e){}).finally(function(e){})},a.speckIt=function(e){if(a.state.isSpeek){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)}},a.getPercentageColor=function(e){return"rgb("+((e*=100)<50?255:Math.floor(255-255*(2*e-100)/100))+","+(e>50?255:Math.floor(2*e*255/100))+",0)"},a.onChangeWatchlist=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){var e=this,t=this.state.staticData[this.state.selectedWatchlist];this.setState({symbolList:t},function(){return e.updateSocketWatch(e.wsClint)})})},a.sortByColumn=function(e){a.state.symbolList.sort(function(t,a){return a[e]-t[e]}),a.setState({symbolList:a.state.symbolList,sortedType:e})},a.convertToDecimal=function(e){return isNaN(e)?e:e.toFixed(2)},a.convertToFloat=function(e){if(!isNaN(e))return"("+(e/1e5).toFixed(2)+"L)"},a.onInputChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.showStaticChart()})},a.handleKeyDown=function(e,t){console.log("key",e,t),38===e.keyCode&&a.state.cursor>0?a.setState(function(e){return{cursor:e.cursor-1}}):40===e.keyCode&&a.state.cursor<a.state.symbolList.length-1&&a.setState(function(e){return{cursor:e.cursor+1}}),setTimeout(function(){a.showStaticChart()},100)},a.handleChange=function(e){localStorage.setItem("isSpeek",e.target.checked),a.setState({isSpeek:e.target.checked},function(){console.log("isSpeek",a.state.isSpeek,e.target.checked)})},a.calculateSMA=function(e,t){for(var a=function(e){for(var t=0,a=0;a<e.length;a++)t+=e[a].close;return t/e.length},n=[],r=t-1,l=e.length;r<l;r++){var o=a(e.slice(r-t+1,r));n.push({time:e[r].time,value:o})}return n},a.showStaticChart=function(e,t){e&&a.setState({chartStaticData:"",lightChartSymbol:t,token:e},function(){console.log("reset done",e)});var n=ot("9:15am","h:mma");if("ONE_MINUTE"==a.state.timeFrame){var r=ot.duration("00:60:00");n=ot(new Date).subtract(r)}var l={exchange:"NSE",symboltoken:e||a.state.token,interval:a.state.timeFrame,fromdate:ot(n).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")};x.getHistoryData(l).then(function(e){var t=Q(e,"noPop");if(t&&t.data){var n=t.data,r=n.map(function(e){return{time:new Date(e[0]).getTime(),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4])}}),l=[],o=[],s=[],i=[],c=[],m=[],u=[],d=[],g=[];n.forEach(function(e,t){l.push([e[0],e[1],e[2],e[3],e[4]]),o.push([e[5],(e[2]+e[3]+e[4])/3]),s.push(e[4]),i.push(e[2]),c.push(e[3]),m.push(e[3]),u.push(e[5]),d.push((e[2]+e[3]+e[4])/3),g.push({time:new Date(e[0]).getTime(),value:e[5],color:"rgba(211, 211, 211, 1)"})});var h={period:20,values:d,stdDev:2},p=it.a.calculate(h),f=(p=it.a.calculate(h),{values:s,period:14}),y=st.a.calculate(f);if(a.setState({chartStaticData:r,bblastValue:p[p.length-1],vwapvalue:mt()(o),rsiValues:y.slice(Math.max(u.length-19,1)),valumeData:u.slice(Math.max(u.length-5,1))},function(){this.state.candleSeries.setData(this.state.chartStaticData),this.state.volumeSeries.setData(g);var e=this.calculateSMA(this.state.chartStaticData,20);this.state.smaLineSeries.setData(e),this.state.chart.subscribeCrosshairMove(function(e){var t=e.seriesPrices[Symbol.iterator](),a="",n="",r=!0,l=!1,o=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var c=s.value;"object"==typeof c[1]?(a+=" Open: <b>"+c[1].open+"</b>",a+=" High: <b>"+c[1].high+"</b>",a+=" Low: <b>"+c[1].low+"</b>",a+=" Close: <b>"+c[1].close+"</b>",a+=" Chng: <b>"+(n=100*(c[1].close-c[1].open)/c[1].open).toFixed(2)+"%</b>"):a+=" &nbsp; "+c[1].toFixed(2)+" "}}catch(u){l=!0,o=u}finally{try{r||null==i.return||i.return()}finally{if(l)throw o}}e.time?a+=" Time: <b>"+new Date(e.time).toLocaleString()+"</b>":a+=" <b>Time: </b>";var m="<span style=color:green>"+a+"</span> ";n<0&&(m="<span style=color:red>"+a+"</span> "),document.getElementById("showChartTitle").innerHTML=m})}),n&&n.sort(function(e,t){return new Date(t[0])-new Date(e[0])}),n.length>0){localStorage.setItem("InstrumentHistroy",JSON.stringify(n)),a.setState({InstrumentHistroy:n});var b=0,E=0;n.forEach(function(e){var t=100*(e[4]-e[1])/e[1];t>=.3&&(b+=1),t<=-.3&&(E+=1),t}),a.setState({downMoveCount:E,upsideMoveCount:b})}}})},a.state={totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},selectedWatchlist:"NIFTY BANK",symbolList:[],actionList:localStorage.getItem("actionList")&&JSON.parse(localStorage.getItem("actionList"))||[],timeFrame:"FIFTEEN_MINUTE",softedIndexList:[],cursor:"",isSpeek:"true"===localStorage.getItem("isSpeek"),sortedType:"pChange",sluglist:{"NIFTY 50":"nifty","NIFTY AUTO":"cnxAuto","NIFTY BANK":"bankNifty","NIFTY ENERGY":"cnxEnergy","NIFTY FIN SERVICE":"cnxFinance","NIFTY FMCG":"cnxFMCG","NIFTY IT":"cnxit","NIFTY MEDIA":"cnxMedia","NIFTY METAL":"cnxMetal","NIFTY PHARMA":"cnxPharma","NIFTY PSU BANK":"cnxPSU","NIFTY REALTY":"cnxRealty","NIFTY PVT BANK":"niftyPvtBank","NIFTY CONSUMPTION":"cnxConsumption","NIFTY CPSE":"cpse","NIFTY INFRA":"cnxInfra","NIFTY MNC":"cnxMNC","NIFTY PSE":"cnxPSE","NIFTY NEXT 50":"juniorNifty","NIFTY MIDCAP 50":"niftyMidcap50","NIFTY HEALTHCARE":"notfound","NIFTY OIL AND GAS":"notfound","NIFTY 100":"notfound","NIFTY CONSR DURBL":"notfond"}},a.updateSocketWatch=a.updateSocketWatch.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.document.title="WS Bid Live",this.setState({symbolList:this.state.staticData[this.state.selectedWatchlist]});var t=JSON.parse(localStorage.getItem("userTokens")),a=t&&t.feedToken,n=JSON.parse(localStorage.getItem("userProfile")),r=n&&n.clientcode;this.setState({feedToken:a,clientcode:r},function(){this.wsClint=new Dt.w3cwebsocket("wss://omnefeeds.angelbroking.com/NestHtml5Mobile/socket/stream"),this.updateSocketDetails(this.wsClint)});var l=document.getElementById("tvchart");document.getElementById("tvchart").innerHTML="";var o=window.innerWidth,s=Object(It.a)(l,{width:o/2,height:400,timeVisible:!0,secondsVisible:!0}),i=s.addCandlestickSeries(),c=s.addLineSeries({color:"rgba(4, 111, 232, 1)",lineWidth:2}),m=s.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}});this.setState({chart:s,candleSeries:i,smaLineSeries:c,volumeSeries:m}),this.getUpdateIndexData(),setInterval(function(){e.state.token&&e.showStaticChart()},1e3)}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,{LoadSymbolDetails:this.LoadSymbolDetails}),r.a.createElement(N.a,{direction:"row",container:!0},r.a.createElement(N.a,{item:!0,xs:6,sm:6},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(N.a,{justify:"space-between",container:!0,spacing:1},r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement("span",null,"Sorted By:  ",this.state.sortedType," ")," ",r.a.createElement("br",null),r.a.createElement("span",null,"Update: ",this.state.lastUpdateAction," ")),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:Yn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),r.a.createElement(ft.a,{value:this.state.selectedWatchlist,name:"selectedWatchlist",onChange:this.onChangeWatchlist},this.state.softedIndexList&&this.state.softedIndexList.map(function(e){return r.a.createElement(yt.a,{style:{color:e.percChange>0?"green":"red"},value:e.indexName},e.indexName," (",e.percChange,"%)")}),this.state.totalWatchlist&&this.state.totalWatchlist.map(function(e){return r.a.createElement(yt.a,{value:e},e)}),"\u03c0",r.a.createElement(yt.a,{value:"Securities in F&O"},"Securities in F&O"))))),r.a.createElement(qe.a,{size:"small",style:{width:"100%"},"aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,null,r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("buytosellTime")}}," T B Q"),"  "),r.a.createElement(Qe.a,{align:"left"},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("pChange")}}," Symbol")," "),r.a.createElement(Qe.a,null,r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("selltobuyTime")}}," T S Q"),"  ")))),r.a.createElement("div",{style:{overflow:"auto",maxHeight:"720px"}},r.a.createElement(qe.a,{size:"small",style:{width:"100%"},"aria-label":"sticky table"},r.a.createElement(Ke.a,null,this.state.symbolList?this.state.symbolList.map(function(t,a){return r.a.createElement(ze.a,{selected:e.state.cursor===a?"active":null,style:{cursor:"pointer"},hover:!0,key:a,onClick:function(){return e.showStaticChart(t.token,t.symbol)}},r.a.createElement(Qe.a,{title:"total buying bids qty",style:{background:t.highlightbuy?"#FFFF00":""}},t.buytosellTime?"B: ".concat(t.buytosellTime):"",e.convertToFloat(t.totalBuyQuantity)),r.a.createElement(Qe.a,{align:"left",style:{background:e.getPercentageColor(t.pChange)}},"    ",t.name," ",t.ltp," ",t.pChange?"(".concat(t.pChange,"%)"):""," "),r.a.createElement(Qe.a,{title:"Average Price",style:{height:"25px",background:t.ltp?t.ltp>=t.averagePrice?"green":"red":"white"}},"AP:",t.averagePrice),r.a.createElement(Qe.a,{title:"total selling bid qty",style:{background:t.highlightsell?"#FFFF00":""}},t.selltobuyTime?"S: ".concat(t.selltobuyTime):"",e.convertToFloat(t.totalSellQuantity)),r.a.createElement(Qe.a,{title:"Open Price"},"O:",t.openPrice),r.a.createElement(Qe.a,{title:"High Price"},"H:",t.highPrice),r.a.createElement(Qe.a,{title:"Low Price"},"L:",t.lowPrice))}):r.a.createElement(gt.a,null)))))),r.a.createElement(N.a,{item:!0,xs:6,sm:6},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(N.a,{style:{display:"visible"},spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(N.a,{spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:10},r.a.createElement(R.a,null,r.a.createElement("b",null," ",this.state.lightChartSymbol," "))),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,Object(y.a)({style:Yn.selectStyle},"style",{marginTop:"10px"}),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onInputChange},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1M"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5M"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10M"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15M"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30M"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1H"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1D"))))),r.a.createElement("div",{id:"showChartTitle"}),r.a.createElement("div",{id:"tvchart"})),r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{overflowY:"scroll",height:"40vh"}},r.a.createElement(R.a,null," ",r.a.createElement("b",null," ",this.state.lightChartSymbol," ")," "),r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Symbol",r.a.createElement("b",{style:{color:"#20d020"}}," UP(",this.state.upsideMoveCount,")")," | ",r.a.createElement("b",{style:{color:"red"}}," Down(",this.state.downMoveCount,")")," "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Timestamp"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Chng% "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Open"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"High"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Low"),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Close "),r.a.createElement(Qe.a,{className:"TableHeadFormat",align:"center"},"Volume"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.InstrumentHistroy&&this.state.InstrumentHistroy?this.state.InstrumentHistroy.map(function(t,a){return r.a.createElement(ze.a,{key:a,style:{background:100*(t[4]-t[1])/t[1]>=.3?"#20d020":100*(t[4]-t[1])/t[1]<=-.3?"#e66e6e":"none"}},r.a.createElement(Qe.a,{align:"center"},e.state.tradingsymbol),r.a.createElement(Qe.a,{align:"center"},new Date(t[0]).toLocaleString()),r.a.createElement(Qe.a,{align:"center"}," ",r.a.createElement("b",null,100*(t[4]-t[1])/t[1]&&(100*(t[4]-t[1])/t[1]).toFixed(2),"%")),r.a.createElement(Qe.a,{align:"center"},t[1]),r.a.createElement(Qe.a,{align:"center"},t[2]),r.a.createElement(Qe.a,{align:"center"},t[3]),r.a.createElement(Qe.a,{align:"center"},t[4]),r.a.createElement(Qe.a,{align:"center"},t[5]))}):""))))))))}}]),t}(r.a.Component),Yn={selectStyle:{minWidth:"100%",marginBottom:"10px"}},Hn=An,jn=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).makeConnection=function(e){var t='{"task":"cn","channel":"NONLM","token":"'+a.state.feedToken+'","user": "'+a.state.clientcode+'","acctid":"'+a.state.clientcode+'"}';e.send(t),a.updateSocketWatch(e)},a.decodeWebsocketData=function(e){var t=[];try{for(var a=0;a<e.length;a++)t.push(String.fromCharCode(e[a]))}catch(n){}return t.join("")},a.updateSocketWatch=function(e){var t=a.state.symbolList.map(function(e){return"nse_cm|"+e.token}),n={task:"mw",channel:t=t.join("&"),token:a.state.feedToken,user:a.state.clientcode,acctid:a.state.clientcode};e.send(JSON.stringify(n))},a.takeAction=function(e,t){if(!(a.state.actionList.length&&a.state.actionList.filter(function(t){return t.symbol===e})).length){var n={symbol:e,action:t,updateTime:(new Date).toLocaleTimeString()};a.setState({actionList:[].concat(Object(ee.a)(a.state.actionList),[n])},function(){localStorage.setItem("actionList",JSON.stringify(this.state.actionList)),console.log(n.symbol+" "+n.action+" "+n.updateTime),this.setState({lastUpdateAction:n.symbol+" "+n.action+" "+n.updateTime}),window.document.title=n.symbol+" "+n.action+" "+n.updateTime})}},a.updateSocketDetails=function(e){e.onopen=function(t){a.makeConnection(e),a.updateSocketWatch(e)},e.onmessage=function(e){var t=window.atob(e.data),n=a.decodeWebsocketData(Pt.a.inflate(t)),r=JSON.parse(n),l=a.state.symbolList;a.state.symbolList&&a.state.symbolList.forEach(function(e,t){var n=r.filter(function(t){return t.tk==e.token});if(n.length>0&&n[0].ltp&&n[0].nc){l[t].ltp=n[0].ltp,l[t].pChange=n[0].nc,l[t].totalBuyQuantity=n[0].tbq,l[t].totalSellQuantity=n[0].tsq,l[t].totalTradedVolume=n[0].v,l[t].averagePrice=n[0].ap,l[t].lowPrice=n[0].lo,l[t].highPrice=n[0].h,l[t].openPrice=n[0].op,l[t].volume=n[0].v,l[t].bestbuyquantity=n[0].bq,l[t].bestbuyprice=n[0].bp,l[t].bestsellquantity=n[0].bs,l[t].bestsellprice=n[0].sp,l[t].ltt=ot(n[0].ltt,"YYYY-MM-DD HH:mm:ss").toString(),l[t].buytosellTime=(n[0].tbq/n[0].tsq).toFixed(2),l[t].selltobuyTime=(n[0].tsq/n[0].tbq).toFixed(2);var o=a.comparePreviousVolume(e.symbol,n[0].v,n[0].ltp,e.token,e.name),s=a.updateHighLow(e.name,n[0].ltp,n[0].v,e.token);if(l[t].high=s&&s.high,l[t].low=s&&s.low,l[t].highupdated=s&&s.highupdated,l[t].lowupdated=s&&s.lowupdated,l[t].volBreakoutCount=o.brokenCount,l[t].priceVolBreakout=o.priceVolBreakout,l[t].rsi=o.rsi,console.log("high",e.high20Candle,"ltp",n[0].ltp,(new Date).toLocaleTimeString()),n[0].ltp>e.high20Candle?(e.high20Candle=n[0].ltp,e.high20CandleFlag=!0,a.speckIt(e.symbol+" higher "),document.title=e.symbol+" higher "):e.high20CandleFlag=!1,n[0].tbq/n[0].tsq>2?(l[t].highlightbuy=!0,a.takeAction(e.symbol," buying")):l[t].highlightbuy=!1,n[0].tsq/n[0].tbq>2?(l[t].highlightsell=!0,a.takeAction(e.symbol," selling")):l[t].highlightsell=!1,a.state.token==e.token&&a.setState({livePrice:n[0].ltp,livePChange:n[0].nc}),o.priceVolBreakout&&n[0].ltp>=200&&n[0].ltp<=1e4&&(new Date).getHours()>10&&(new Date).getHours()<15&&!localStorage.getItem(l[t].symbol)){localStorage.setItem(l[t].symbol,"found at "+(new Date).toLocaleTimeString()),a.speckIt((l[t].symbol+" price volume Breakout ").toLocaleLowerCase()),console.log(l[t].name,n[0].ltp," price volume Breakout");var i={token:l[t].token,symbol:l[t].symbol,qtyToTake:1,producttype:"INTRADAY"};ut.historyWiseOrderPlace(i,"BUY","no",a.callbackAfterOrderDone)}localStorage.setItem(l[t].symbol,"ok")}});var o=a.state.sortedType;l&&l.sort(function(e,t){return t[o]-e[o]}),a.setState({symbolList:l},function(){})},e.onerror=function(e){console.log("socket error",e),a.makeConnection(a.wsClint)},setInterval(function(){console.log("this.wsClint",a.wsClint),1!=a.wsClint.readyState&&a.makeConnection(a.wsClint);var t='{"task":"hb","channel":"","token":"'+a.state.feedToken+'","user": "'+a.state.clientcode+'","acctid":"'+a.state.clientcode+'"}';console.log("Request :- "+t),e.send(t)},59e3)},a.calculateRSI=function(e){var t=[];e.forEach(function(e){t.push(e.p)});var a={values:t,period:14};return st.a.calculate(a)},a.comparePreviousVolume=function(e,t,n,r,l){var o=(localStorage.getItem("liveCandleHistory")&&JSON.parse(localStorage.getItem("liveCandleHistory"))||[]).filter(function(t){return t.s==e});if(o.length>0){var s,i=t-o[o.length-1].v,c=0,m=0;if(s=a.calculateRSI(o),i>o[o.length-1].cv){for(var u=o.length-1;u>0&&i>o[u].cv;u--)c++;var d=100*(n-o[o.length-1].p)/o[o.length-1].p;d.toFixed(2);if(c>=5&&d>=.45){if(!localStorage.getItem(e)){a.speckIt(g);var g="price and volume breakout in "+e+" with "+c+" candles with "+d.toFixed(2)+"%";console.log(g,o[o.length-1],i,(new Date).toLocaleTimeString()),a.setState({volumePriceBONames:a.state.volumePriceBONames+" VP Buy"+l+"at"+(new Date).toLocaleTimeString()+"\n"}),a.showStaticChart(r,l,0)}m=1}}return{cv:i,brokenCount:c,priceVolBreakout:m,dayPriceVolBreakout:0,rsi:s[s.length-1]}}return{cv:t,brokenCount:0,priceVolBreakout:0,dayPriceVolBreakout:0,rsi:0}},a.updateHighLow=function(e,t,n,r){var l=localStorage.getItem("OriginalHist")&&JSON.parse(localStorage.getItem("OriginalHist"))||[],o=l.filter(function(t){return t.s==e}),s=o.length?o[0].d:[],i=s[s.length-1],c=!1,m=!1;if(0!=9e5-Date.now()%9e5-1e3){if(i){t>i[2]&&(i[2]=t),t<i[3]&&(i[3]=t);for(var u=0,d=0,g=s[0][3],h=0;h<s.length;h++){var p=s[h];new Date(p[0]).getDate()==(new Date).getDate()&&(u+=p[5],p[2]>d&&(d=p[2]),p[3]<g&&(g=p[3]))}t>d&&(c=!0,console.log("higher high updated",e,t,d),a.setState({dayhighLow:[].concat(Object(ee.a)(a.state.dayhighLow),[{name:e,token:r,type:"dayhigh",time:(new Date).toLocaleTimeString()}])}),a.showStaticChart(r,e,0),a.speckIt(e+" at day high")),t<g&&(m=!0,a.setState({dayhighLow:[].concat(Object(ee.a)(a.state.dayhighLow),[{name:e,token:r,type:"daylow",time:(new Date).toLocaleTimeString()}])}),console.log("lower low updated",e,t,g),a.showStaticChart(r,e,0),a.speckIt(e+" at day low")),i[5]=n-u}return localStorage.setItem("OriginalHist",JSON.stringify(l)),{high:i&&i[2],low:i&&i[3],lowupdated:m,highupdated:c}}s.push([ot(new Date).format("YYYY-MM-DDTHH:mm:ss+05:30"),t,t,t,t,0])},a.calculateCandleVolume=function(e){a.state.symbolList.forEach(function(t){var n=a.comparePreviousVolume(t.symbol,t.volume,t.ltp,t.token,t.name),r={s:t.symbol,t:new Date,v:t.volume,cv:n.cv,p:t.ltp,ch:t.pChange};t.volBreakoutCount=n.brokenCount,t.priceVolBreakout=n.priceVolBreakout,t.rsi=n.rsi,console.log(t.symbol," RSI ",n.rsi,(new Date).toLocaleTimeString()),a.setState({symbolList:a.state.symbolList}),a.setState({liveCandleHistory:[].concat(Object(ee.a)(a.state.liveCandleHistory),[r])},function(){"noSyncVol"!=e&&localStorage.setItem("liveCandleHistory",JSON.stringify(a.state.liveCandleHistory))})})},a.callbackAfterOrderDone=function(e){console.log("order executed",e)},a.storeChartData=function(){var e={dtime:ot(new Date,"YYYY-MM-DD HH:mm:ss").toString(),symbolList:[a.state.symbolList[0]],analysis:!0};x.saveCandleHistory(e).then(function(e){e.data&&console.log(e.data)}).catch(function(e){}).finally(function(e){})},a.getUpdateIndexData=function(){a.setState({softedIndexList:[]}),x.allIndicesDirectJSON().then(function(e){if(e.data){var t=e.data&&e.data.data;t.sort(function(e,t){return t.percChange-e.percChange});for(var n=0;n<t.length;n++){var r=t[n];a.state.sluglist[r.indexName]&&a.setState({softedIndexList:[].concat(Object(ee.a)(a.state.softedIndexList),[r])})}a.makeConnection(a.wsClint)}}).catch(function(e){}).finally(function(e){})},a.speckIt=function(e){if(a.state.isSpeek){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)}},a.getPercentageColor=function(e){return"rgb("+((e*=100)<50?255:Math.floor(255-255*(2*e-100)/100))+","+(e>50?255:Math.floor(2*e*255/100))+",0)"},a.onChangeWatchlist=function(e){var t;a.setState((t={},Object(y.a)(t,e.target.name,e.target.value),Object(y.a)(t,"cursor",0),t),function(){var t=this,a=this.state.staticData[this.state.selectedWatchlist];"gainerList"==this.state.selectedWatchlist&&(a=localStorage.getItem("gainerList")&&JSON.parse(localStorage.getItem("gainerList"))),"looserList"==this.state.selectedWatchlist&&(a=localStorage.getItem("looserList")&&JSON.parse(localStorage.getItem("looserList"))),this.setState({symbolList:a,originalList:a},function(){return a&&t.updateSocketWatch(t.wsClint)}),"candleHistoryFlag"!=e.target.name&&(this.updatePreviousVolume(),this.updateOriginalHist())})},a.updateOriginalHist=Object(te.a)($.a.mark(function e(){var t,n,r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=localStorage.getItem("OriginalHist")&&JSON.parse(localStorage.getItem("OriginalHist"))||[],n=a.state.staticData[a.state.selectedWatchlist],r=$.a.mark(function e(r){var l,s,i;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=n[r],"YYYY-MM-DD HH:mm",s=ot(new Date),i=ot(s,"DD-MM-YYYY").subtract(4,"days"),o={exchange:"NSE",symboltoken:l.token,interval:a.state.timeFrame,fromdate:ot(i).format("YYYY-MM-DD HH:mm"),todate:ot(s).format("YYYY-MM-DD HH:mm")},x.getHistoryData(o).then(function(e){var a=Q(e,"noPop");if(a&&a.data&&a.data.length){var n=a.data.slice(a.data.length-20,a.data.length);if(t.filter(function(e){return e.s==l.name}).length>0)for(var r=0;r<t.length;r++)console.log("OriginalHist",t[r].s,l.name),t[r].s==l.name&&(t[r].d=n);else t.push({s:l.name,d:n});localStorage.setItem("OriginalHist",JSON.stringify(t))}else console.log("candle data emply")}),e.next=8,new Promise(function(e){return setTimeout(e,310)});case 8:case"end":return e.stop()}},e)}),l=0;case 4:if(!(l<n.length)){e.next=9;break}return e.delegateYield(r(l),"t0",6);case 6:l++,e.next=4;break;case 9:case"end":return e.stop()}},e)})),a.updateDayChartHighLow=Object(te.a)($.a.mark(function e(){var t,n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.state.staticData[a.state.selectedWatchlist],n=$.a.mark(function e(n){var r,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[n],"YYYY-MM-DD HH:mm",o=ot(new Date),s=ot(o,"DD-MM-YYYY").subtract(7,"days"),0==a.state.listofHighLow.filter(function(e){return e.symbol==r.symbol}).length&&(l={exchange:"NSE",symboltoken:r.token,interval:"ONE_DAY",fromdate:ot(s).format("YYYY-MM-DD HH:mm"),todate:ot(o).format("YYYY-MM-DD HH:mm")},x.getHistoryData(l).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){var n=t.data;n.reverse(),console.log("lastday",r,n[1]);n[1];var l=n[0][2],o=n[0][3];n[1][2]>l&&(l=n[1][2]),n[1][3]<o&&(o=n[1][3]);var s=ot("9:15am","h:mma"),i=ot("3:30pm","h:mma"),c=ot(new Date,"h:mma");ot().isoWeekday()<=5&&c.isBetween(s,i)&&(l=n[1][2],o=n[1][3],n[2][2]>l&&(l=n[2][2]),n[2][3]<o&&(o=n[2][3]));var m={symbol:r.symbol,high:l,low:o};a.setState({listofHighLow:[].concat(Object(ee.a)(a.state.listofHighLow),[m])},function(){console.log("highlow",this.state.listofHighLow),localStorage.setItem("listofHighLow",JSON.stringify(this.state.listofHighLow))})}else console.log(" candle data emply")})),e.next=8,new Promise(function(e){return setTimeout(e,310)});case 8:case"end":return e.stop()}},e)}),r=0;case 3:if(!(r<t.length)){e.next=8;break}return e.delegateYield(n(r),"t0",5);case 5:r++,e.next=3;break;case 8:case"end":return e.stop()}},e)})),a.updatePreviousVolume=Object(te.a)($.a.mark(function e(){var t,n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.state.staticData[a.state.selectedWatchlist],n=$.a.mark(function e(n){var r,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t[n],"YYYY-MM-DD HH:mm",o=ot(new Date),s=ot(o,"DD-MM-YYYY").subtract(2,"days"),0==a.state.listofHighLow.filter(function(e){return e.symbol==r.symbol}).length&&(l={exchange:"NSE",symboltoken:r.token,interval:a.state.timeFrame,fromdate:ot(s).format("YYYY-MM-DD HH:mm"),todate:ot(o).format("YYYY-MM-DD HH:mm")},x.getHistoryData(l).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){var n=t.data.slice(t.data.length-20,t.data.length);a.deletePrevVolume(r.symbol);for(var l=0,o=JSON.parse(localStorage.getItem("liveCandleHistory"))&&JSON.parse(localStorage.getItem("liveCandleHistory"))||[],s=n[0][2],i=0;i<n.length;i++){var c=n[i];new Date(c[0]).getDate()==(new Date).getDate()&&(l+=c[5]),c[2]>s&&(s=c[2]);var m={s:r.symbol,t:c[0],v:l,cv:c[5],p:c[4],ch:0};o.push(m)}r.high20Candle=s,console.log("high20Candle",r.symbol,s),localStorage.setItem("liveCandleHistory",JSON.stringify(o))}else console.log(" candle data emply")})),e.next=8,new Promise(function(e){return setTimeout(e,310)});case 8:case"end":return e.stop()}},e)}),r=0;case 3:if(!(r<t.length)){e.next=8;break}return e.delegateYield(n(r),"t0",5);case 5:r++,e.next=3;break;case 8:case"end":return e.stop()}},e)})),a.deletePrevVolume=function(e){for(var t=JSON.parse(localStorage.getItem("liveCandleHistory"))&&JSON.parse(localStorage.getItem("liveCandleHistory"))||[],a=[],n=0;n<t.length;n++){var r=t[n];e!=r.s&&a.push(r)}return console.log("delete symbol data",e,a),localStorage.setItem("liveCandleHistory",JSON.stringify(a)),!0},a.sortByColumn=function(e){a.state.symbolList.sort(function(t,a){return a[e]-t[e]}),a.setState({symbolList:a.state.symbolList,sortedType:e})},a.convertToDecimal=function(e){return isNaN(e)?e:e.toFixed(2)},a.convertToFloat=function(e){if(!isNaN(e))return"("+(e/1e5).toFixed(2)+"L)"},a.onInputChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.showStaticChart()})},a.handleKeyDown=function(e){38===e.keyCode&&a.state.cursor>0?a.setState(function(e){return{cursor:e.cursor-1}}):40===e.keyCode&&a.state.cursor<a.state.symbolList.length-1&&a.setState(function(e){return{cursor:e.cursor+1}}),a.state.cursor===a.state.symbolList.length-1&&a.setState({cursor:0}),setTimeout(function(){a.updateCandleOnkey()},100)},a.updateCandleOnkey=function(){var e=localStorage.getItem("selectedKeyRow")&&JSON.parse(localStorage.getItem("selectedKeyRow"));e&&e.token&&e.symbol&&a.setState({tradingsymbol:e.symbol,symboltoken:e.token},function(){this.showStaticChart(e.token,e.symbol,this.state.cursor)})},a.handleChange=function(e){localStorage.setItem("isSpeek",e.target.checked),a.setState({isSpeek:e.target.checked},function(){console.log("isSpeek",a.state.isSpeek,e.target.checked)})},a.calculateSMA=function(e,t){for(var a=function(e){for(var t=0,a=0;a<e.length;a++)t+=e[a].close;return t/e.length},n=[],r=t-1,l=e.length;r<l;r++){var o=a(e.slice(r-t+1,r));n.push({time:e[r].time,value:o})}return n},a.showStaticChart=function(e,t,n){console.log("token, symbol",e,t),e&&a.setState({chartStaticData:"",token:e},function(){console.log("reset done",e)}),console.log("cursor",a.state.cursor,"this.state.symbolList.length",a.state.symbolList.length);var r=ot("9:15am","h:mma");if("ONE_MINUTE"==a.state.timeFrame){var l=ot.duration("00:60:00");r=ot(new Date).subtract(l)}if(a.state.candleHistoryFlag){l=ot.duration("1000:00:00");"ONE_MINUTE"==a.state.timeFrame&&(l=ot.duration("100:00:00")),r=ot(new Date).subtract(l)}var o={exchange:"NSE",symboltoken:e||a.state.token,interval:a.state.timeFrame,fromdate:ot(r).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")};x.getHistoryData(o).then(function(e){var r=Q(e,"noPop");if(r&&r.data){var l=r.data,o=l.map(function(e){return{time:new Date(e[0]).getTime(),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4])}}),s=[],i=[],c=[],m=[],u=[],d=[],g=[],h=[],p=[];l.forEach(function(e,t){s.push([e[0],e[1],e[2],e[3],e[4]]),i.push([e[5],(e[2]+e[3]+e[4])/3]),c.push(e[4]),m.push(e[2]),u.push(e[3]),d.push(e[3]),g.push(e[5]),h.push((e[2]+e[3]+e[4])/3),p.push({time:new Date(e[0]).getTime(),value:e[5],color:"rgba(211, 211, 211, 1)"})});var f={period:20,values:h,stdDev:2},y=it.a.calculate(f),b=(y=it.a.calculate(f),{values:c,period:14}),E=st.a.calculate(b);if(console.log(t,l[l.length-1],"Rsi",b,E),a.setState({lightChartSymbol:t,chartStaticData:o,bblastValue:y[y.length-1],vwapvalue:mt()(i),rsiValues:E.slice(Math.max(g.length-19,1)),valumeData:g.slice(Math.max(g.length-5,1))},function(){this.state.candleSeries.setData(this.state.chartStaticData),this.state.volumeSeries.setData(p);var e=this.calculateSMA(this.state.chartStaticData,20);this.state.smaLineSeries.setData(e),this.state.chart.subscribeCrosshairMove(function(e){var t=e.seriesPrices[Symbol.iterator](),a="",n="",r=!0,l=!1,o=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var c=s.value;"object"==typeof c[1]?(a+=" Chg%: <b>"+(n=100*(c[1].close-c[1].open)/c[1].open).toFixed(2)+"%</b>",a+=" Chg: <b>"+(c[1].close-c[1].open).toFixed(2)+"</b>",a+=" O: <b>"+c[1].open+"</b>",a+=" H: <b>"+c[1].high+"</b>",a+=" L: <b>"+c[1].low+"</b>",a+=" C: <b>"+c[1].close+"</b>"):a+=" &nbsp; "+c[1].toFixed(2)+" "}}catch(u){l=!0,o=u}finally{try{r||null==i.return||i.return()}finally{if(l)throw o}}e.time?a+=" T: <b>"+new Date(e.time).toLocaleString()+"</b>":a+=" <b>Time: </b>";var m="<span style=color:green>"+a+"</span> ";n<0&&(m="<span style=color:red>"+a+"</span> "),document.getElementById("showChartTitle").innerHTML=m})}),l&&l.sort(function(e,t){return new Date(t[0])-new Date(e[0])}),l.length>0){localStorage.setItem("InstrumentHistroy",JSON.stringify(l)),a.setState({InstrumentHistroy:l});var S=0,v=0;l.forEach(function(e){var t=100*(e[4]-e[1])/e[1];t>=.3&&(S+=1),t<=-.3&&(v+=1),t}),a.setState({downMoveCount:v,upsideMoveCount:S,cursor:n})}}})},a.findSymbol=function(e){var t=e.target.value,n=a.state.originalList.filter(function(e){return e.name.includes(t.toUpperCase())});a.setState({symbolList:n}),console.log(t,n),t||a.setState({symbolList:a.state.originalList})},a.copyName=function(e){navigator.clipboard.writeText(e).then(function(){z.showSuccess(e+" copied")}).catch(function(){alert("something went wrong")})},a.state={totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},selectedWatchlist:"NIFTY BANK",symbolList:[],dayhighLow:[],actionList:localStorage.getItem("actionList")&&JSON.parse(localStorage.getItem("actionList"))||[],timeFrame:"FIFTEEN_MINUTE",softedIndexList:[],listofHighLow:localStorage.getItem("listofHighLow")&&JSON.parse(localStorage.getItem("listofHighLow"))||[],gainerList:localStorage.getItem("gainerList")&&JSON.parse(localStorage.getItem("gainerList"))||[],looserList:localStorage.getItem("looserList")&&JSON.parse(localStorage.getItem("looserList"))||[],liveCandleHistory:localStorage.getItem("liveCandleHistory")&&JSON.parse(localStorage.getItem("liveCandleHistory"))||[],cursor:0,volumePriceBONames:"",candleHistoryFlag:!1,lightChartSymbol:"Select Symbol for Chart",isSpeek:"true"===localStorage.getItem("isSpeek"),sortedType:"pChange",sluglist:{"NIFTY 50":"nifty","NIFTY AUTO":"cnxAuto","NIFTY BANK":"bankNifty","NIFTY ENERGY":"cnxEnergy","NIFTY FIN SERVICE":"cnxFinance","NIFTY FMCG":"cnxFMCG","NIFTY IT":"cnxit","NIFTY MEDIA":"cnxMedia","NIFTY METAL":"cnxMetal","NIFTY PHARMA":"cnxPharma","NIFTY PSU BANK":"cnxPSU","NIFTY REALTY":"cnxRealty","NIFTY PVT BANK":"niftyPvtBank","NIFTY CONSUMPTION":"cnxConsumption","NIFTY CPSE":"cpse","NIFTY INFRA":"cnxInfra","NIFTY MNC":"cnxMNC","NIFTY PSE":"cnxPSE","NIFTY NEXT 50":"juniorNifty","NIFTY MIDCAP 50":"niftyMidcap50","NIFTY HEALTHCARE":"notfound","NIFTY OIL AND GAS":"notfound","NIFTY 100":"notfound","HIGH BETA STOCK":"notfound","NIFTY CONSR DURBL":"notfond"}},a.updateSocketWatch=a.updateSocketWatch.bind(Object(k.a)(a)),a.nameInput=r.a.createRef(),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.document.title="WS Bid Live",this.setState({symbolList:this.state.staticData[this.state.selectedWatchlist],originalList:this.state.staticData[this.state.selectedWatchlist]},function(){e.calculateCandleVolume();var t=9e5-Date.now()%9e5;t-=1e3;var a=5;"FIFTEEN_MINUTE"==e.state.timeFrame&&(a=15),"TEN_MINUTE"==e.state.timeFrame?a=10:"FIVE_MINUTE"==e.state.timeFrame?a=5:"ONE_MINUTE"==e.state.timeFrame&&(a=1);var n=1e3*(59-(new Date).getSeconds());console.log("next59Exec",n,"msToNextRounded5Min",t,(new Date).toLocaleTimeString()),setTimeout(function(){setInterval(e.calculateCandleVolume,6e4*a),console.log("nextExeced",(new Date).toLocaleTimeString()),e.calculateCandleVolume()},t)});var t=JSON.parse(localStorage.getItem("userTokens")),a=t&&t.feedToken,n=JSON.parse(localStorage.getItem("userProfile")),r=n&&n.clientcode;this.setState({feedToken:a,clientcode:r},function(){this.wsClint=new Dt.w3cwebsocket("wss://omnefeeds.angelbroking.com/NestHtml5Mobile/socket/stream"),this.updateSocketDetails(this.wsClint)});var l=document.getElementById("tvchart");document.getElementById("tvchart").innerHTML="";var o=window.screen.width/3.1,s=window.screen.height/2;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(o=window.screen.width);var i=Object(It.a)(l,{width:o,height:s,timeVisible:!0,secondsVisible:!0}),c=i.addCandlestickSeries(),m=i.addLineSeries({color:"rgba(4, 111, 232, 1)",lineWidth:2}),u=i.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}});this.setState({chart:i,candleSeries:c,smaLineSeries:m,volumeSeries:u}),this.getUpdateIndexData();var d=ot("9:15am","h:mma"),g=ot("3:30pm","h:mma"),h=ot(new Date,"h:mma");ot().isoWeekday()<=5&&h.isBetween(d,g)&&setInterval(function(){e.state.token&&e.showStaticChart(e.state.token,e.state.lightChartSymbol,0)},5e3),this.updatePreviousVolume()}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,{LoadSymbolDetails:this.LoadSymbolDetails}),r.a.createElement(N.a,{direction:"row",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(N.a,{justify:"space-between",container:!0,spacing:1},r.a.createElement(N.a,{item:!0,xs:8,sm:6},r.a.createElement(pt.a,{style:Wn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),r.a.createElement(ft.a,{value:this.state.selectedWatchlist,name:"selectedWatchlist",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"gainerList"},"Gainer List ("+this.state.gainerList.length+")"),r.a.createElement(yt.a,{value:"looserList"},"Looser List ("+this.state.looserList.length+")"),this.state.softedIndexList&&this.state.softedIndexList.map(function(e){return r.a.createElement(yt.a,{style:{color:e.percChange>0?"green":"red"},value:e.indexName},e.indexName," (",e.percChange,"%)")}),r.a.createElement(yt.a,{value:"Securities in F&O"},"Securities in F&O"),r.a.createElement(yt.a,{value:"High Beta Stock"},"High Beta Stock")))),r.a.createElement(N.a,{item:!0,xs:4,sm:4},r.a.createElement("form",{name:"keyForm"},r.a.createElement("input",{id:"keyid",name:"keyid",placeholder:"Search: tcs",onKeyDown:this.handleKeyDown,onChange:this.findSymbol,autofocus:"true",type:"text"}))),r.a.createElement(N.a,{item:!0,xs:4,sm:2},r.a.createElement(B.a,{variant:"",style:{marginRight:"20px"},onClick:function(){return e.calculateCandleVolume("noSyncVol")}},"Refresh"))),r.a.createElement(qe.a,{size:"small",style:{width:"100%"},"aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{style:{background:"buytosellTime"==this.state.sortedType?"lightgray":""}},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("buytosellTime")}},"Buy Bids"),"  "),r.a.createElement(Qe.a,{style:{background:"pChange"==this.state.sortedType?"lightgray":""},align:"left"},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("pChange")}}," Symbol")," "),r.a.createElement(Qe.a,{style:{background:"selltobuyTime"==this.state.sortedType?"lightgray":""}},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("selltobuyTime")}},"Sell Bids"),"  "),r.a.createElement(Qe.a,{style:{background:"volBreakoutCount"==this.state.sortedType?"lightgray":""}},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("volBreakoutCount")}},"Volume"),"  "),r.a.createElement(Qe.a,{style:{background:"priceVolBreakout"==this.state.sortedType?"lightgray":""}},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("priceVolBreakout")}},"Vol+Price"),"  "),r.a.createElement(Qe.a,{style:{background:"rsi"==this.state.sortedType?"lightgray":""}},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("rsi")}},"RSI"),"  "),r.a.createElement(Qe.a,{style:{background:"highupdated"==this.state.sortedType?"lightgray":""}},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("highupdated")}},"High"),"  "),r.a.createElement(Qe.a,{style:{background:"lowupdated"==this.state.sortedType?"lightgray":""}},r.a.createElement(B.a,{onClick:function(){return e.sortByColumn("lowupdated")}},"Low"),"  "),r.a.createElement(Qe.a,{title:"20 candle high"},"Higher")))),r.a.createElement("div",{style:{overflow:"auto",maxHeight:"650px"}},r.a.createElement(qe.a,{size:"small",style:{width:"100%"},"aria-label":"sticky table"},r.a.createElement(Ke.a,null,this.state.symbolList?this.state.symbolList.map(function(t,a){return r.a.createElement(ze.a,{onKeyDown:e.handleKeyDown,selected:e.state.cursor===a?"active":null,style:{cursor:"pointer"},hover:!0,key:a},e.state.cursor===a?localStorage.setItem("selectedKeyRow",JSON.stringify(t)):"",r.a.createElement(Qe.a,{title:"total buying bids qty",style:{background:t.highlightbuy?"#FFFF00":""}},t.buytosellTime?"".concat(t.buytosellTime):"","x",r.a.createElement("br",null),e.convertToFloat(t.totalBuyQuantity)),r.a.createElement(Qe.a,{align:"left"},r.a.createElement(B.a,{style:{background:e.getPercentageColor(t.pChange)},variant:"contained",onClick:function(){return e.showStaticChart(t.token,t.name,a)}},a+1,".  ",t.name," ",r.a.createElement("br",null)," ",t.ltp," ",t.pChange?"(".concat(t.pChange,"%)"):""),r.a.createElement(B.a,{onClick:function(){return e.copyName(t.name)}}," copy ")),r.a.createElement(Qe.a,{title:"Average Price",style:{height:"25px",background:t.ltp?t.ltp>=t.averagePrice?"green":"red":"white"}},"AP",r.a.createElement("br",null),t.averagePrice),r.a.createElement(Qe.a,{title:"total selling bid qty",style:{background:t.highlightsell?"#FFFF00":""}},t.selltobuyTime?"".concat(t.selltobuyTime):"","x",r.a.createElement("br",null),e.convertToFloat(t.totalSellQuantity)),r.a.createElement(Qe.a,{title:"vbc"}," ",t.volBreakoutCount?"V: "+t.volBreakoutCount:"-","  "),r.a.createElement(Qe.a,{title:"v+P breakout",style:{background:t.priceVolBreakout?"#FFFF00":""}}," ",t.priceVolBreakout?"VP: Yes":"-",t.dayPriceVolBreakout?"Day VP":""),r.a.createElement(Qe.a,{title:"vbc"}," ",t.rsi?"RSI: "+t.rsi:"-"),r.a.createElement(Qe.a,{style:{background:t.highupdated?"green":""},title:e.state.timeFrame+"s high"}," ",t.high?t.high:"-"),r.a.createElement(Qe.a,{style:{background:t.lowupdated?"red":""},title:e.state.timeFrame+"s low"}," ",t.high?t.low:"-"),r.a.createElement(Qe.a,{style:{background:t.high20CandleFlag?"#FFFF00":""},title:"20 candle high"},t.high20Candle))}):r.a.createElement(gt.a,null)))),r.a.createElement("hr",null),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement("span",null,"Sorted By:  ",this.state.sortedType," ")," ",r.a.createElement("br",null),r.a.createElement("span",null,"Update: ",this.state.lastUpdateAction," ")),r.a.createElement(N.a,{item:!0,xs:6,sm:6},r.a.createElement(Be.a,null,r.a.createElement(Me.a,{control:r.a.createElement(Ne.a,{checked:this.state.isSpeek,onChange:this.handleChange,"aria-label":"Speek ON/OFF"}),label:this.state.isSpeek?"Speak Yes":"Speak No"}))))),r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(N.a,{style:{display:"visible"},spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(N.a,{spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:10,sm:8},r.a.createElement(R.a,null," ",this.state.lightChartSymbol," ",this.state.livePrice," ",this.state.livePChange?"(".concat(this.state.livePChange,"%)"):"","  ")),r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement(pt.a,Object(y.a)({style:Wn.selectStyle},"style",{marginTop:"10px"}),r.a.createElement(M.a,{htmlFor:"candleHistoryFlag"},"Time"),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onInputChange},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1M"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5M"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10M"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15M"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30M"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1H"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1D")))),r.a.createElement(N.a,{item:!0,xs:2,sm:2},r.a.createElement(pt.a,{style:Wn.selectStyle},r.a.createElement(M.a,{htmlFor:"candleHistoryFlag"},"History"),r.a.createElement(ft.a,{title:"History",value:this.state.candleHistoryFlag,name:"candleHistoryFlag",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:!0},"Yes"),r.a.createElement(yt.a,{value:!1},"No"))))),r.a.createElement("div",{id:"showChartTitle"}),r.a.createElement("div",{id:"tvchart"})),r.a.createElement(ht.a,{xsDown:!0},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement("b",null," ",this.state.lightChartSymbol)," ",r.a.createElement("br",null),r.a.createElement("b",null," RSI: "),this.state.rsiValues&&this.state.rsiValues.map(function(e,t){return e>=60?r.a.createElement("span",{style:{color:"green",fontWeight:"bold"}}," ",e," \xa0"):r.a.createElement("span",{style:{color:e<=40?"red":"",fontWeight:"bold"}}," ",e," \xa0")}),r.a.createElement("br",null),r.a.createElement("b",null,"Vol:")," ",this.state.valumeData&&this.state.valumeData.map(function(t,a){return r.a.createElement("span",{style:{color:t>e.state.dailyAvgValume?"green":"",fontWeight:t>e.state.dailyAvgValume?"bold":""}}," ",(t/1e5).toFixed(2),"L \xa0")}),r.a.createElement("br",null),this.state.bblastValue?r.a.createElement("span",{item:!0,xs:12,sm:12},r.a.createElement("span",{title:"Green color mean price running above upper bb band",style:{color:this.state.livePrice>=this.state.bblastValue.upper?"green":"",fontWeight:"bold"}},"BB Upper: ",this.state.bblastValue.upper.toFixed(2)),r.a.createElement("br",null),"BB Middle(20 SMA): ",this.state.bblastValue.middle.toFixed(2),r.a.createElement("br",null),r.a.createElement("span",{title:"Green red mean price running below lower bb band",style:{color:this.state.livePrice<=this.state.bblastValue.lower?"red":"",fontWeight:"bold"}},"BB Lower: ",this.state.bblastValue.lower.toFixed(2)),r.a.createElement("br",null)):"",r.a.createElement("span",{item:!0,xs:12,sm:12,style:{color:this.state.livePrice>this.state.vwapvalue?"green":"red",fontWeight:"bold"}},"VWAP:  ",this.state.vwapvalue&&this.state.vwapvalue.toFixed(2)),r.a.createElement("br",null),"  ",r.a.createElement("br",null)),r.a.createElement(Ct.a,{style:{padding:"1"}},r.a.createElement(R.a,null," Vol+Price Breakout"),this.state.volumePriceBONames),r.a.createElement(Ct.a,{style:{padding:"1"}},r.a.createElement(R.a,null," Day high Low"),this.state.dayhighLow&&this.state.dayhighLow.map(function(e,t){return r.a.createElement("span",{style:{color:"dayhigh"==e.type?"green":"red"}},t+1,e.name," ",r.a.createElement("br",null))}))))))))}}]),t}(r.a.Component),Wn={selectStyle:{minWidth:"100%",marginBottom:"10px"}},Rn=jn,Un=a(106),_n=a.n(Un),Vn=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));var t=e.target.value;x.autoCompleteSearch(t).then(function(e){var t=e.data;localStorage.setItem("autoSearchTemp",JSON.stringify(t)),a.setState({autoSearchList:t})})},a.onInputChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.state.tradingsymbol&&this.showStaticChart(this.state.symboltoken)})},a.onChangePattern=function(e){if(a.setState(Object(y.a)({},e.target.name,e.target.value)),"NR4_Daywide_daterage"==e.target.value){var t=localStorage.getItem("backTestResultDateRange")&&JSON.parse(localStorage.getItem("backTestResultDateRange"));a.setState({dateAndTypeKeys:Object.keys(t||{}),backTestResultDateRange:t})}},a.onChangeWatchlist=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));var t=a.state.staticData;a.setState({symbolList:t[e.target.value]},function(){this.setState({cursor:""})}),"selectall"==e.target.value&&a.setState({symbolList:localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))},function(){this.setState({cursor:""})})},a.checkOpenEqualToLow=Object(te.a)($.a.mark(function e(){var t,n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState((t={openEqualHighList:[],openEqualLowList:[]},Object(y.a)(t,"openEqualLowList",[]),Object(y.a)(t,"advanceShareCount",0),Object(y.a)(t,"declineShareCount",0),Object(y.a)(t,"UnchangeShareCount",0),Object(y.a)(t,"volumeCrossedList",[]),Object(y.a)(t,"closeingEqualHighList",[]),t)),n=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.symbolList[t],l={exchange:n.exch_seg,tradingsymbol:n.symbol,symboltoken:n.token},x.getLTP(l).then(function(e){var r=Q(e,"noPop"),l=r&&r.data;if(l){var o=(100*(l.ltp-l.close)/l.close).toFixed(2);if(l.nc=o,l.symbol=n.symbol,a.state.symbolList[t].ltp=l.ltp,a.state.symbolList[t].nc=o,l&&l.open==l.low)console.log("o=l",l),a.state.openEqualLowList.filter(function(e){return e.symboltoken==n.token}).length||a.setState({openEqualLowList:[].concat(Object(ee.a)(a.state.openEqualLowList),[l])});if(console.log(n.symbol,"ltp=newhigh",l.ltp,l.high-.5*l.high/100),l&&l.ltp>=l.high-.5*l.high/100)a.state.closeingEqualHighList.filter(function(e){return e.symboltoken==n.token}).length||a.setState({closeingEqualHighList:[].concat(Object(ee.a)(a.state.closeingEqualHighList),[l])});if(l&&l.open==l.high)console.log("o=h",l),a.state.openEqualHighList.filter(function(e){return e.symboltoken==n.token}).length||a.setState({openEqualHighList:[].concat(Object(ee.a)(a.state.openEqualHighList),[l])});l.perChange>0?a.setState({advanceShareCount:a.state.advanceShareCount+1}):l.perChange<0?a.setState({declineShareCount:a.state.declineShareCount+1}):a.setState({UnchangeShareCount:a.state.UnchangeShareCount+1}),a.state.symbolList&&a.state.symbolList.sort(function(e,t){return t.nc-e.nc}),a.setState({symbolList:a.state.symbolList,tradingsymbol:n.symbol,symboltoken:n.token})}}),e.next=5,new Promise(function(e){return setTimeout(e,310)});case 5:case"end":return e.stop()}},e)}),r=0;case 3:if(!(r<a.state.symbolList.length)){e.next=8;break}return e.delegateYield(n(r),"t0",5);case 5:r++,e.next=3;break;case 8:case"end":return e.stop()}},e)})),a.myCallback=function(e,t){"START_DATE"===t?a.setState({startDate:e}):"END_DATE"===t&&a.setState({endDate:e})},a.getLTP=function(){var e={exchange:"NSE",tradingsymbol:a.state.tradingsymbol,symboltoken:a.state.symboltoken};x.getLTP(e).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;a.setState({InstrumentLTP:n}),n&&n.ltp&&a.setState({InstrumentPerChange:(100*(n.ltp-n.close)/n.close).toFixed(2)})})},a.stopBacktesting=function(){a.setState({stopScaningFlag:!0})},a.backTestAnyPattern=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s,i,c,m,u;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state.patternType+" "+a.state.selectedWatchlist+" "+ot(a.state.startDate).format("YYYY-MM-DD")+" "+ot(a.state.endDate).format("YYYY-MM-DD")+".csv",a.setState({backTestResult:[],backTestFlag:!1,filename:t}),console.log("filename",t),a.state.patternType){e.next=6;break}return z.showError("Select pattern type"),e.abrupt("return");case 6:if("NR4"!==a.state.patternType){e.next=9;break}return a.backTestNR4(),e.abrupt("return");case 9:if("NR4Trail"!==a.state.patternType){e.next=12;break}return a.backTestNR4Trail(),e.abrupt("return");case 12:if("NR4ForNextDay"!==a.state.patternType){e.next=15;break}return a.NR4ForNextDay(),e.abrupt("return");case 15:if("NR4_SameDay"!==a.state.patternType){e.next=18;break}return a.backTestNR4SameDay(),e.abrupt("return");case 18:if("StrongCandle"!==a.state.patternType){e.next=21;break}return a.backtestStrongCandle(),e.abrupt("return");case 21:if("VolumePrice"!==a.state.patternType){e.next=24;break}return a.backtestVolumePrice(),e.abrupt("return");case 24:if("VolumePriceSell"!==a.state.patternType){e.next=27;break}return a.backtestVolumePriceSell(),e.abrupt("return");case 27:if("NR4_Daywide_daterage"!==a.state.patternType){e.next=44;break}n=ot(a.state.startDate),r=ot(a.state.endDate),l=n,o=r;case 32:if(!l.isSameOrBefore(o,"day")){e.next=42;break}if(console.log("Loop at ".concat(l.format("DD-MM-YYYY"))),a.backTestNR4DatewiseRange(l),!a.state.stopScaningFlag){e.next=37;break}return e.abrupt("break",42);case 37:return e.next=39,new Promise(function(e){return setTimeout(e,310*a.state.symbolList.length)});case 39:l.add(1,"days"),e.next=32;break;case 42:return a.setState({backTestFlag:!0,stopScaningFlag:!1}),e.abrupt("return");case 44:a.setState({backTestResult:[],backTestFlag:!1}),console.log("pattername",a.state.patternType),s=a.state.symbolList,i=1,c=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=s[t],u={exchange:"NSE",symboltoken:n.token,interval:"FIFTEEN_MINUTE",fromdate:ot(a.state.startDate).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(u).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length)for(var r=t.data,l=0;l<r.length-35;l++){var o=r.slice(l,l+10),s=r.slice(l+10,l+35);if(console.log("\n"),o.length>=10&&new Date(r[l][0]).toLocaleTimeString()<"14:15:00")switch(a.state.patternType){case"TweezerTop":a.backtestTweezerTop(o,n.symbol,s);break;case"TweezerBottom":a.backtestTweezerBottom(o,n.symbol,s)}i+=r.length}else console.log(" candle data emply")}),e.next=5,new Promise(function(e){return setTimeout(e,300)});case 5:a.setState({stockTesting:t+1+". "+n.symbol,runningTest:i});case 6:case"end":return e.stop()}},e)}),m=0;case 50:if(!(m<s.length)){e.next=55;break}return e.delegateYield(c(m),"t0",52);case 52:m++,e.next=50;break;case 55:case"end":return e.stop()}},e)})),a.NR4ForNextDay=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({FoundPatternList:[],backTestFlag:!1}),t=a.state.symbolList,1,0,n=$.a.mark(function e(n){var r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t[n],!a.state.stopScaningFlag){e.next=3;break}return e.abrupt("return","break");case 3:return a.setState({stockTesting:n+1+". "+r.symbol}),l=ot.duration("240:00:00"),o=ot(a.state.endDate).subtract(l),s={exchange:"NSE",symboltoken:r.token,interval:"ONE_DAY",fromdate:ot(o).format("YYYY-MM-DD HH:mm"),todate:ot(a.state.endDate).format("YYYY-MM-DD HH:mm")},x.getHistoryData(s).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){var n=t.data;n.reverse();var l=n.slice(0,4);if(l.length>=4){var o=[],s=[];l.forEach(function(e){o.push(e[2]-e[3]),s.push([e[0],e[1],e[2],e[3],e[4]])});var i=o[0],c=0;if(o.forEach(function(e){i<=e&&(i=e,c+=1)}),4==c){var m=l[0],u=n[0];console.log(r.symbol,l,o,c,u);var d=(m[2]+m[2]/100/10).toFixed(2),g=(m[3]-m[3]/100/10).toFixed(2),h={foundAt:new Date(m[0]).toString().substr(0,25),symbol:r.symbol,token:r.token,pattenName:"NR4",SellAt:g,high:m[2],low:m[3],BuyAt:d,candleChartData:s,close:m[4]};a.nr4CheckPastPerfommance(r.token,h)}}}else console.log(r.symbol," candle data emply")}).catch(function(e){z.showError(r.symbol+" Candle data not found!")}),e.next=10,new Promise(function(e){return setTimeout(e,350)});case 10:case"end":return e.stop()}},e)}),r=0;case 5:if(!(r<t.length)){e.next=13;break}return e.delegateYield(n(r),"t0",7);case 7:if("break"!==e.t0){e.next=10;break}return e.abrupt("break",13);case 10:r++,e.next=5;break;case 13:a.setState({backTestFlag:!0,stopScaningFlag:!1});case 14:case"end":return e.stop()}},e)})),a.findShortTraadeOnNextDay=function(e,t,n,r){var l=t[3]-t[3]/100/10,o=l+1*l/100,s=[],i=!0,c={},m="",u=r[0][3];if(console.log(e.symbol,"result candle",r),r&&r.length){for(var d=0;d<r.length;d++){var g=r[d];s.push([new Date(g[0]).getTime(),g[1],g[2],g[3],g[4]]),g[2]<u&&(u=g[3])}for(var h=0;h<r.length;h++){m=r[h],i&&m[3]<l&&(console.log(e.symbol,"taken short enty",m[3]),c={foundAt:"Short-"+new Date(m[0]).toLocaleString(),symbol:e.symbol,sellEntyPrice:l,stopLoss:o,brokerageCharges:.06,quantity:Math.floor(1e5/l),candleChartData:n},i=!1);var p=100*(l-m[3])/l;if(console.log(e.symbol,"perChange",p),!i&&p>=1){var f=l-1*l/100;c.buyExitPrice=f,c.perChange=p,c.squareOffAt=new Date(m[0]).toLocaleString(),c.exitStatus="Flat_1%_Booked";break}if(console.log(e.symbol,"high",m[2]),!i&&m[2]>=o){var y=100*(l-o)/l;c.buyExitPrice=o,c.perChange=y,c.squareOffAt=new Date(m[0]).toLocaleString(),c.exitStatus="SL_Hit";break}}if(!i&&!c.sellEntyPrice){y=100*(m[4]-l)/l;c.buyExitPrice=m[4],c.perChange=y,c.squareOffAt=new Date(m[0]).toLocaleString(),c.exitStatus="Market_End"}if(!i&&Math.floor(1e5/l)&&c.buyExitPrice){var b=100*(l-u)/l;c.highAndLow=u,c.perChngOnHighLow=b,c.candleChartDataInside=s,a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[c])})}}},a.findLongsTraadeOnNextDay=function(e,t,n,r){var l=t[2]+t[2]/100/10,o=l-.3*l/100,s=[],i=!0,c=!0,m=0,u={},d="",g=r[0][2];if(r&&r.length){for(var h=0;h<r.length;h++){var p=r[h];s.push([new Date(p[0]).getTime(),p[1],p[2],p[3],p[4]]),g<r[h][2]&&(g=r[h][2])}for(var f=0;f<r.length;f++){d=r[f],i&&d[2]>l&&(u={foundAt:"Long-"+new Date(d[0]).toLocaleString(),symbol:e.symbol,buyExitPrice:l,stopLoss:o,brokerageCharges:.06,quantity:Math.floor(1e5/l),candleChartData:n},i=!1);var y=100*(d[2]-l)/l;if(!i){if(c&&y>=.7){m+=1;var b=l+.1*l/100;u.sellEntyPrice=b,u.perChange=100*(b-l)/l,u.squareOffAt=new Date(d[0]).toLocaleString(),u.exitStatus="Trail by 0.1% "+m+"time",c=!1}else{var E=u.sellEntyPrice,S=(100*(d[2]-E)/E).toFixed(2),v=u.buyExitPrice,k=(100*(d[2]-v)/v).toFixed(2);if(S>.7)m+=1,b=E+.25*E/100,u.sellEntyPrice=b,u.perChange=100*(b-l)/l,u.squareOffAt=new Date(d[0]).toLocaleString(),u.exitStatus="Trail by 0.25% "+m+"time";else if(k>=.3&&k<=.4){m+=1,b=E+.25*E/100,u.sellEntyPrice=b,u.perChange=100*(b-l)/l,u.squareOffAt=new Date(d[0]).toLocaleString(),u.exitStatus="Min range 0.3 -0.4% "+m+"time";break}}if(d[3]<=u.sellEntyPrice){console.log(e.symbol,"trail hit elementInside[3] <= sellEntyPrice",d[3],u.sellEntyPrice,new Date(d[0]).toLocaleString());break}}if(!i&&d[3]<=o){console.log(e.symbol,"SL hit elementInside[3] <= buyentrySL",d[3],o,new Date(d[0]).toLocaleString());var T=100*(o-l)/l;u.sellEntyPrice=o,u.perChange=T,u.squareOffAt=new Date(d[0]).toLocaleString(),u.exitStatus="SL_Hit";break}}if(!i&&!u.sellEntyPrice){T=100*(d[4]-l)/l;u.buyExitPrice=d[4],u.perChange=T,u.squareOffAt=new Date(d[0]).toLocaleString(),u.exitStatus="Market_End"}if(!i&&Math.floor(1e5/l)&&u.buyExitPrice){var L=100*(g-l)/l;u.highAndLow=g,u.perChngOnHighLow=L,u.candleChartDataInside=s,console.log(e.symbol,"longTradeFound",u),a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[u])})}}},a.backTestNR4SameDay=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s,i,c;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({backTestResult:[],backTestFlag:!1,searchFailed:0}),t=a.state.symbolList,n=1,r=0,l=$.a.mark(function e(r){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l=t[r],!a.state.stopScaningFlag){e.next=3;break}return e.abrupt("return","break");case 3:return s=ot.duration("240:00:00"),i=ot(a.state.endDate).subtract(s),c={exchange:"NSE",symboltoken:l.token,interval:"ONE_DAY",fromdate:ot(i).format("YYYY-MM-DD HH:mm"),todate:ot(a.state.endDate).format("YYYY-MM-DD HH:mm")},x.getHistoryData(c).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){var r=t.data;r.reverse();var o=r.slice(1,5);if(o.length>=4){var s=[],i=[];o.forEach(function(e){s.push(e[2]-e[3]),i.push([e[0],e[1],e[2],e[3],e[4]])});var c=s[0],m=0;if(s.forEach(function(e){c<=e&&(c=e,m+=1)}),4==m){var u=o[0],d=r[0];i.unshift([d[0],d[1],d[2],d[3],d[4]]),console.log(l.symbol,o,s,m,d);var g=ot(d[0]).set({hour:9,minute:15}),h=ot(d[0]).set({hour:15,minute:30}),p={exchange:"NSE",symboltoken:l.token,interval:"ONE_MINUTE",fromdate:ot(g).format("YYYY-MM-DD HH:mm"),todate:ot(h).format("YYYY-MM-DD HH:mm")};x.getHistoryData(p).then(function(e){var t=Q(e,"noPop");t=t&&t.data,a.findLongsTraadeOnNextDay(l,u,i,t)}).catch(function(e){z.showError(l.symbol+" FIVE_MINUTE Candle data not found!"),a.setState({searchFailed:a.state.searchFailed+1})})}}n=n+r.length-35}else console.log(l.symbol," candle data emply"),z.showError(l.symbol+" FIVE_MINUTE candle data emply!"),a.setState({searchFailed:a.state.searchFailed+1})}).catch(function(e){z.showError(l.symbol+" 1 day Candle data not found!"),a.setState({searchFailed:a.state.searchFailed+1})}),e.next=9,new Promise(function(e){return setTimeout(e,305)});case 9:a.setState({stockTesting:r+1+". "+l.symbol,runningTest:n});case 10:case"end":return e.stop()}},e)}),o=0;case 5:if(!(o<t.length)){e.next=13;break}return e.delegateYield(l(o),"t0",7);case 7:if("break"!==e.t0){e.next=10;break}return e.abrupt("break",13);case 10:o++,e.next=5;break;case 13:a.setState({backTestFlag:!0,stopScaningFlag:!1}),console.log("sumPercentage",r);case 15:case"end":return e.stop()}},e)})),a.backTestNR4DatewiseRange=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l,o,s,i,c;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({backTestFlag:!1}),n=a.state.symbolList,r=1,0,l=$.a.mark(function e(l){var o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n[l],!a.state.stopScaningFlag){e.next=3;break}return e.abrupt("return","break");case 3:return s=ot.duration("240:00:00"),i=ot(t).subtract(s),c={exchange:"NSE",symboltoken:o.token,interval:"ONE_DAY",fromdate:ot(i).format("YYYY-MM-DD HH:mm"),todate:ot(t).format("YYYY-MM-DD HH:mm")},x.getHistoryData(c).then(function(e){var n=Q(e,"noPop");if(n&&n.data&&n.data.length){var l=n.data;l.reverse();var s=l.slice(1,5);if(s.length>=4){var i=[],c=[];s.forEach(function(e){i.push(e[2]-e[3]),c.push([e[0],e[1],e[2],e[3],e[4]])});var m=i[0],u=0;if(i.forEach(function(e){m<=e&&(m=e,u+=1)}),4==u){var d=s[0],g=l[0];c.unshift([g[0],g[1],g[2],g[3],g[4]]);var h=t.format("DD-MM-YYYY")+" "+a.state.selectedWatchlist,p=localStorage.getItem("backTestResultDateRange")?JSON.parse(localStorage.getItem("backTestResultDateRange")):{},f=p[h]?p[h]:[];console.log(o.symbol,s,i,u,g);var y=(d[2]+d[2]/100/10).toFixed(2);if(g[2]>y){var b=100*(g[4]-y)/y,E=100*(g[2]-y)/y;b,console.log(o.symbol,d[0],"upside","same day high",d[2],"same day low",d[3],"nextdaylow",g[3],"nextdayhigh",g[2],"next day closing",g[4],b+"%");var S={foundAt:"Long - "+new Date(d[0]).toLocaleString(),symbol:o.symbol,sellEntyPrice:g[4],highAndLow:g[2],stopLoss:d[3],buyExitPrice:y,brokerageCharges:.06,perChange:b.toFixed(2),perChngOnHighLow:E.toFixed(2),squareOffAt:new Date(g[0]).toLocaleString(),quantity:Math.floor(1e4/d[2]),candleChartData:c};Math.floor(1e4/d[2])&&(a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[S])}),f.push(S),p[h]=f,localStorage.setItem("backTestResultDateRange",JSON.stringify(p)))}var v=(d[3]-d[3]/100/10).toFixed(2);if(g[3]<v){b=100*(v-g[4])/d[3];var k=100*(v-g[3])/d[3];b,console.log(o.symbol,d[0],"dowside","same day high",d[2],"same day low",d[3],"nextdaylow",g[3],"nextdayhigh",g[2],"next day closing",g[4],b+"%");S={foundAt:"Short - "+new Date(d[0]).toLocaleString(),symbol:o.symbol,sellEntyPrice:v,stopLoss:d[2],buyExitPrice:g[4],highAndLow:g[3],brokerageCharges:.06,perChange:b.toFixed(2),perChngOnHighLow:k.toFixed(2),squareOffAt:new Date(g[0]).toLocaleString(),quantity:Math.floor(1e4/d[3]),candleChartData:c};Math.floor(1e4/d[3])&&(a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[S])}),f.push(S),p[h]=f,console.log("backTestResultDateRange",p),localStorage.setItem("backTestResultDateRange",JSON.stringify(p)),a.setState({dateAndTypeKeys:Object.keys(p),backTestResultDateRange:p}))}}}r=r+l.length-35}else console.log(o.symbol," candle data emply")}),e.next=9,new Promise(function(e){return setTimeout(e,300)});case 9:a.setState({stockTesting:t.format("YYYY-MM-DD")+" "+l+"1. "+o.symbol,runningTest:r});case 10:case"end":return e.stop()}},e)}),o=0;case 5:if(!(o<n.length)){e.next=13;break}return e.delegateYield(l(o),"t0",7);case 7:if("break"!==e.t0){e.next=10;break}return e.abrupt("break",13);case 10:o++,e.next=5;break;case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.backTestNR4=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({backTestResult:[],backTestFlag:!1}),t=a.state.symbolList,n=1,r=0,l=$.a.mark(function e(l){var o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t[l],!a.state.stopScaningFlag){e.next=4;break}return a.setState({stopScaningFlag:!1}),e.abrupt("return","break");case 4:return s={exchange:"NSE",symboltoken:o.token,interval:"ONE_DAY",fromdate:ot(a.state.startDate).format("YYYY-MM-DD HH:mm"),todate:ot(a.state.endDate).format("YYYY-MM-DD HH:mm")},x.getHistoryData(s).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length)for(var l=t.data,s=0;s<l.length-4;s++){var i=l.slice(s,s+4);if(i.length>=4&&new Date(l[s][0]).toLocaleTimeString()<"14:15:00"){i.reverse();var c=[],m=[];i.forEach(function(e){c.push(e[2]-e[3]),m.push([e[0],e[1],e[2],e[3],e[4]])});var u=c[0],d=0;if(c.forEach(function(e){u<=e&&(u=e,d+=1)}),4==d){var g=i[0],h=l[s+4];m.unshift([h[0],h[1],h[2],h[3],h[4]]);var p=(g[2]+g[2]/100/10).toFixed(2),f=(g[3]-g[3]/100/10).toFixed(2);if(h[2]>p){var y=h[a.state.longExitPriceType],b="ME@3:30pm";h[a.state.longExitPriceType]<=f&&(y=f,b="SLHit");var E=100*(y-p)/p,S=100*(h[2]-p)/p;r+=E,console.log(o.symbol,g[0],"upside","same day high",g[2],"same day low",g[3],"nextdaylow",h[3],"nextdayhigh",h[2],"next day closing",h[4],E+"%");var v=(100*(p-f)/p).toFixed(2),k=ot(h[0]).subtract(0,"month").startOf("month").format("MMMM"),T={foundAt:"Long - "+new Date(g[0]).toLocaleString(),monthName:k,symbol:o.symbol,perChange:E.toFixed(2),perChngOnHighLow:S.toFixed(2),brokerageCharges:.06,sellEntyPrice:y,stopLoss:"".concat(f," (").concat(v,"%)"),exitStatus:b,quantity:Math.floor(1e4/g[2]),token:o.token,highAndLow:h[2],buyExitPrice:p,entryAt:g[0],squareOffAt:h[0],candleChartData:m};Math.floor(1e4/g[2])&&(a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[T])}),a.setState({backTestResult:a.state.backTestResult.reverse()}))}var L=(g[3]-g[3]/100/10).toFixed(2);f=(g[2]+g[2]/100/10).toFixed(2);if(h[3]<L){var C=h[a.state.longExitPriceType],w="ME@3:30pm";h[a.state.longExitPriceType]>=f&&(C=f,w="SLHit");E=100*(L-C)/g[3];var x=100*(L-h[3])/g[3];r+=E,console.log(o.symbol,g[0],"dowside","same day high",g[2],"same day low",g[3],"nextdaylow",h[3],"nextdayhigh",h[2],"next day closing",h[4],E+"%");var I=(100*(f-L)/f).toFixed(2);k=ot(h[0]).subtract(0,"month").startOf("month").format("MMMM"),T={foundAt:"Short - "+new Date(g[0]).toLocaleString(),monthName:k,symbol:o.symbol,perChange:E.toFixed(2),perChngOnHighLow:x.toFixed(2),brokerageCharges:.06,sellEntyPrice:L,stopLoss:"".concat(f," (").concat(I,"%)"),exitStatus:w,quantity:Math.floor(1e4/g[3]),token:o.token,highAndLow:h[3],buyExitPrice:C,entryAt:g[0],squareOffAt:h[0],candleChartData:m};Math.floor(1e4/g[3])&&a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[T])})}}}n=n+l.length-35}else console.log(o.symbol," candle data emply")}),e.next=8,new Promise(function(e){return setTimeout(e,300)});case 8:a.setState({stockTesting:l+1+". "+o.symbol,runningTest:n});case 9:case"end":return e.stop()}},e)}),o=0;case 5:if(!(o<t.length)){e.next=13;break}return e.delegateYield(l(o),"t0",7);case 7:if("break"!==e.t0){e.next=10;break}return e.abrupt("break",13);case 10:o++,e.next=5;break;case 13:a.setState({backTestFlag:!0}),console.log("sumPercentage",r);case 15:case"end":return e.stop()}},e)})),a.backtestVolumePrice=Object(te.a)($.a.mark(function e(){var t,n,r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({backTestResult:[],backTestFlag:!1}),t=a.state.symbolList,n=1,0,r=$.a.mark(function e(r){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l=t[r],!a.state.stopScaningFlag){e.next=4;break}return a.setState({stopScaningFlag:!1}),e.abrupt("return","break");case 4:return o={exchange:"NSE",symboltoken:l.token,interval:a.state.timeFrame,fromdate:ot(a.state.startDate).format("YYYY-MM-DD HH:mm"),todate:ot(a.state.endDate).format("YYYY-MM-DD HH:mm")},x.getHistoryData(o).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length)for(var r=t.data,o=0;o<r.length-7;o++){var s,i,c,m=r.slice(o,o+7);if(new Date(r[o][0]).toLocaleTimeString()>"09:30:00"&&new Date(r[o][0]).toLocaleTimeString()<"14:15:00")!function(){s=[];var e=m[m.length-1],t=0,n=e[5];m.forEach(function(e){n>e[5]&&t++,s.push([e[0],e[1],e[2],e[3],e[4]])});var r=e[2]-e[3],o=100*(e[4]-e[3])/r;i=100*(e[4]-e[1])/e[1],t>=4&&o>=80&&i>.5&&(console.log(l.symbol,"backtestCandle",m,"volBreakcount",t),c={foundAt:ot(e[0]).format("DD-MM-YYYY HH:mm"),symbol:l.name,token:l.token,chartDate:e[0],candleChartData:s},a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[c])},function(){var e="";this.state.backTestResult.forEach(function(t){return e+=t.foundAt+"\t"+t.symbol+"\n"}),this.setState({copydata:e})}))}();n=n+r.length-35}else console.log(l.symbol," candle data emply")}),e.next=8,new Promise(function(e){return setTimeout(e,300)});case 8:a.setState({stockTesting:r+1+". "+l.symbol,runningTest:n});case 9:case"end":return e.stop()}},e)}),l=0;case 5:if(!(l<t.length)){e.next=13;break}return e.delegateYield(r(l),"t0",7);case 7:if("break"!==e.t0){e.next=10;break}return e.abrupt("break",13);case 10:l++,e.next=5;break;case 13:a.setState({backTestFlag:!0});case 14:case"end":return e.stop()}},e)})),a.backtestVolumePriceSell=Object(te.a)($.a.mark(function e(){var t,n,r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({backTestResult:[],backTestFlag:!1}),t=a.state.symbolList,n=1,0,r=$.a.mark(function e(r){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l=t[r],!a.state.stopScaningFlag){e.next=4;break}return a.setState({stopScaningFlag:!1}),e.abrupt("return","break");case 4:return o={exchange:"NSE",symboltoken:l.token,interval:a.state.timeFrame,fromdate:ot(a.state.startDate).format("YYYY-MM-DD HH:mm"),todate:ot(a.state.endDate).format("YYYY-MM-DD HH:mm")},x.getHistoryData(o).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length)for(var r=t.data,o=0;o<r.length-7;o++){var s,i,c,m=r.slice(o,o+7);if(new Date(r[o][0]).toLocaleTimeString()>"09:30:00"&&new Date(r[o][0]).toLocaleTimeString()<"14:15:00")!function(){s=[];var e=m[m.length-1],t=0,n=e[5];m.forEach(function(e){n>e[5]&&t++,s.push([e[0],e[1],e[2],e[3],e[4]])});var r=e[2]-e[3],o=100*(e[4]-e[3])/r;i=100*(e[4]-e[1])/e[1],t>=4&&o<=20&&i<-.5&&(console.log(l.symbol,"backtestCandle",m,"volBreakcount",t),c={foundAt:ot(e[0]).format("DD-MM-YYYY HH:mm"),symbol:l.name,token:l.token,chartDate:e[0],candleChartData:s},a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[c])},function(){var e="";this.state.backTestResult.forEach(function(t){return e+=t.foundAt+"\t"+t.symbol+"\n"}),this.setState({copydata:e})}))}();n=n+r.length-35}else console.log(l.symbol," candle data emply")}),e.next=8,new Promise(function(e){return setTimeout(e,300)});case 8:a.setState({stockTesting:r+1+". "+l.symbol,runningTest:n});case 9:case"end":return e.stop()}},e)}),l=0;case 5:if(!(l<t.length)){e.next=13;break}return e.delegateYield(r(l),"t0",7);case 7:if("break"!==e.t0){e.next=10;break}return e.abrupt("break",13);case 10:l++,e.next=5;break;case 13:a.setState({backTestFlag:!0});case 14:case"end":return e.stop()}},e)})),a.backtestStrongCandle=Object(te.a)($.a.mark(function e(){var t,n,r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({backTestResult:[],backTestFlag:!1}),t=a.state.symbolList,n=1,0,r=$.a.mark(function e(r){var l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l=t[r],!a.state.stopScaningFlag){e.next=4;break}return a.setState({stopScaningFlag:!1}),e.abrupt("return","break");case 4:return o={exchange:"NSE",symboltoken:l.token,interval:"FIVE_MINUTE",fromdate:ot(a.state.startDate).format("YYYY-MM-DD HH:mm"),todate:ot(a.state.endDate).format("YYYY-MM-DD HH:mm")},x.getHistoryData(o).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length)for(var r=t.data,o=function(e){i=r.slice(e,e+4),c=[],i.forEach(function(t){c.push([t[0],t[1],t[2],t[3],t[4]]);var n=100*(t[2]-t[3])/t[1];if(t[1]==t[3]&&t[2]==t[4]&&n>=.3){var o=t[0],s=r[e+1],i=o[2]+o[2]/100/10,m=o[3]-o[3]/100/10,u=s[2],d="Market End";s[2]<=m&&(u=m,d="SL Hit");var g=100*(u-i)/i,h=100*(s[2]-i)/i;g;var p=(100*(i-m)/i).toFixed(2),f={foundAt:new Date(t[0]).toLocaleString(),symbol:l.symbol,token:l.token,sellEntyPrice:u,stopLoss:"".concat(m," (").concat(p,"%)"),highAndLow:s[2],perChngOnHighLow:h.toFixed(2),buyExitPrice:i,brokerageCharges:.06,perChange:g.toFixed(2),entryAt:o[0],squareOffAt:s[0],quantity:Math.floor(1e4/o[2]),candleChartData:c,exitStatus:d};console.log("5min strong candle",f),a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[f])}),a.setState({backTestResult:a.state.backTestResult.reverse()})}}),n=n+r.length-35},s=0;s<r.length-4;s++){var i,c;o(s)}else console.log(l.symbol," candle data emply")}),e.next=8,new Promise(function(e){return setTimeout(e,300)});case 8:a.setState({stockTesting:r+1+". "+l.symbol,runningTest:n});case 9:case"end":return e.stop()}},e)}),l=0;case 5:if(!(l<t.length)){e.next=13;break}return e.delegateYield(r(l),"t0",7);case 7:if("break"!==e.t0){e.next=10;break}return e.abrupt("break",13);case 10:l++,e.next=5;break;case 13:a.setState({backTestFlag:!0});case 14:case"end":return e.stop()}},e)})),a.backTestNR4Trail=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({backTestResult:[],backTestFlag:!1}),t=a.state.symbolList,n=1,r=0,l=$.a.mark(function e(l){var o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t[l],!a.state.stopScaningFlag){e.next=4;break}return a.setState({stopScaningFlag:!1}),e.abrupt("return","break");case 4:return s={exchange:"NSE",symboltoken:o.token,interval:"ONE_DAY",fromdate:ot(a.state.startDate).format("YYYY-MM-DD HH:mm"),todate:ot(a.state.endDate).format("YYYY-MM-DD HH:mm")},x.getHistoryData(s).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length)for(var l=t.data,s=0;s<l.length-4;s++){var i=l.slice(s,s+4);if(i.length>=4&&new Date(l[s][0]).toLocaleTimeString()<"14:15:00"){i.reverse();var c=[],m=[];i.forEach(function(e){c.push(e[2]-e[3]),m.push([e[0],e[1],e[2],e[3],e[4]])});var u=c[0],d=0;if(c.forEach(function(e){u<=e&&(u=e,d+=1)}),4==d){var g=i[0],h=l[s+4];m.unshift([h[0],h[1],h[2],h[3],h[4]]);var p=(g[2]+g[2]/100/10).toFixed(2);if(h[2]>p){var f=100*(h[a.state.longExitPriceType]-p)/p,y=100*(h[2]-p)/p;r+=f,console.log(o.symbol,g[0],"upside","same day high",g[2],"same day low",g[3],"nextdaylow",h[3],"nextdayhigh",h[2],"next day closing",h[4],f+"%");var b={foundAt:"Long - "+new Date(g[0]).toLocaleString(),symbol:o.symbol,token:o.token,sellEntyPrice:h[a.state.longExitPriceType],stopLoss:g[3],highAndLow:h[2],perChngOnHighLow:y.toFixed(2),buyExitPrice:p,brokerageCharges:.06,perChange:f.toFixed(2),entryAt:g[0],squareOffAt:h[0],quantity:Math.floor(1e4/g[2]),candleChartData:m};Math.floor(1e4/g[2])&&(a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[b])}),a.setState({backTestResult:a.state.backTestResult.reverse()}))}var E=(g[3]-g[3]/100/10).toFixed(2);if(h[3]<E){f=100*(E-h[a.state.shortExitPriceType])/g[3];var S=100*(E-h[3])/g[3];r+=f,console.log(o.symbol,g[0],"dowside","same day high",g[2],"same day low",g[3],"nextdaylow",h[3],"nextdayhigh",h[2],"next day closing",h[4],f+"%");b={foundAt:"Short - "+new Date(g[0]).toLocaleString(),symbol:o.symbol,token:o.token,sellEntyPrice:E,perChngOnHighLow:S.toFixed(2),stopLoss:g[2],highAndLow:h[3],buyExitPrice:h[a.state.shortExitPriceType],brokerageCharges:.06,perChange:f.toFixed(2),entryAt:g[0],squareOffAt:h[0],quantity:Math.floor(1e4/g[3]),candleChartData:m};Math.floor(1e4/g[3])&&a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[b])})}}}n=n+l.length-35}else console.log(o.symbol," candle data emply")}),e.next=8,new Promise(function(e){return setTimeout(e,300)});case 8:a.setState({stockTesting:l+1+". "+o.symbol,runningTest:n});case 9:case"end":return e.stop()}},e)}),o=0;case 5:if(!(o<t.length)){e.next=13;break}return e.delegateYield(l(o),"t0",7);case 7:if("break"!==e.t0){e.next=10;break}return e.abrupt("break",13);case 10:o++,e.next=5;break;case 13:a.setState({backTestFlag:!0}),console.log("sumPercentage",r);case 15:case"end":return e.stop()}},e)})),a.nr4CheckPastPerfommance=function(e,t){var n=ot.duration("4320:00:00"),r=ot(a.state.endDate).subtract(n),l=0,o=0,s=0,i=0,c=0,m=0,u=[],d=[];console.log("starting function foundStock",t);var g={exchange:"NSE",symboltoken:e,interval:"ONE_DAY",fromdate:ot(r).format("YYYY-MM-DD HH:mm"),todate:ot(a.state.endDate).format("YYYY-MM-DD HH:mm")};x.getHistoryData(g).then(function(n){var r=Q(n,"noPop");if(console.log("candle history",r),r&&r.data&&r.data.length){for(var g=r.data,h=0;h<g.length-4;h++){var p=g.slice(h,h+4);if(p.length>=4&&new Date(g[h][0]).toLocaleTimeString()<"14:15:00"){p.reverse();var f=[],y=[];p.forEach(function(e){f.push(e[2]-e[3]),y.push([e[0],e[1],e[2],e[3],e[4]])});var b=f[0],E=0;if(f.forEach(function(e){b<=e&&(b=e,E+=1)}),4==E){var S=p[0],v=g[h+4];y.unshift([v[0],v[1],v[2],v[3],v[4]]),console.log(e,p,f,E,S[0].toString().substr(0,25));var k=(S[2]+S[2]/100/10).toFixed(2);if(v[2]>k){var T=100*(v[4]-k)/k,L=100*(v[2]-k)/k,C={foundAt:"Long - "+new Date(S[0]).toLocaleString(),sellEntyPrice:v[4],stopLoss:S[3],highAndLow:v[2],perChngOnHighLow:L.toFixed(2),buyExitPrice:k,brokerageCharges:.06,perChange:T.toFixed(2),squareOffAt:new Date(v[0]).toLocaleString(),quantity:Math.floor(1e4/S[2]),candleChartData:y};u.push(C),l+=1,s+=T,c+=L}var w=(S[3]-S[3]/100/10).toFixed(2);if(v[3]<w){T=100*(w-v[4])/S[3];var x=100*(w-v[3])/S[3],I={foundAt:"Short - "+new Date(S[0]).toLocaleString(),sellEntyPrice:w,perChngOnHighLow:x.toFixed(2),stopLoss:S[2],highAndLow:v[3],buyExitPrice:v[4],brokerageCharges:.06,perChange:T.toFixed(2),squareOffAt:new Date(v[0]).toLocaleString(),quantity:Math.floor(1e4/S[3]),candleChartData:y};d.push(I),o+=1,i+=T,m+=x}}}}var D={totalLongs:l,totalShort:o,totalLongPer:s.toFixed(2),totalShortPer:i.toFixed(2),totalLongHighPer:c.toFixed(2),totalShortLowPer:m.toFixed(2)};t&&(t.pastPerferm=D),t.longCandles=u,t.shortCandles=d,console.log("foundStock",t),Math.floor(1e4/S[4])&&(a.setState({FoundPatternList:[].concat(Object(ee.a)(a.state.FoundPatternList),[t])}),localStorage.setItem("FoundPatternList",JSON.stringify(a.state.FoundPatternList)))}else console.log(e," candle data emply")})},a.backtestTweezerTop=function(e,t,n){if(e&&e.length>0){for(var r=(e=e.reverse())[2]&&e[2][2],l=e[2]&&e[2][3],o=3;o<e.length;o++)r<e[o][2]&&(r=e[o][2]),e[o][3]<l&&(l=e[o][3]);var s=e[9][3],i=e[2][2],c={time:e[0]&&e[0][0],open:e[0]&&e[0][1],high:e[0]&&e[0][2],low:e[0]&&e[0][3],close:e[0]&&e[0][4]},m={time:e[1]&&e[1][0],open:e[1]&&e[1][1],high:e[1]&&e[1][2],low:e[1]&&e[1][3],close:e[1]&&e[1][4]},u=100*(i-s)/s,d=m.low<c.low?m.low:c.low,g=m.high<c.high?m.high:c.high;if(u>=1.5&&r<g&&l<d&&m.open<m.close&&c.open>c.close&&Math.round(m.close)==Math.round(c.open)&&Math.round(m.open)==Math.round(c.close)&&(console.log("%c"+new Date(e[0][0]).toString(),"color: #20d020"),console.log(t,"last 8th candle diff% ",u,"10th Low",s,"3rd high",i),console.log(t,"maxHigh",r,"maxLow",l),console.log("last10Candle",e),console.log(t,"perfect twisser top done close=open || open=close"),console.log("next10Candle",n),n&&n.length)){for(var h=(g+g/100/10).toFixed(2),p=(d-d/100/10).toFixed(2),f=0;f<n.length;f++){if(n[f][2]>h){h,n[f][0];break}if("15:15:00"==new Date(n[f][0]).toLocaleTimeString()){n[f][4],n[f][0];break}}for(var y=n[0][4],b=1;b<n.length&&(n[b][4]<y&&(y=n[b][4],n[b][0]),"15:15:00"!=new Date(n[b][0]).toLocaleTimeString());b++);for(var E=h,S=0;S<n.length;S++){if(!(E>n[S][2])){E=n[S][4].toFixed(2),n[S][0];break}if(E=(n[S][2]+n[S][2]/100/4).toFixed(2),n[S][0],"15:15:00"==new Date(n[S][0]).toLocaleTimeString())break}for(var v=0,k="",T=0;T<n.length;T++){if(100*(n[T][3]-p)/p<-.7){v=n[T][3],k=n[T][0];break}if(n[T][2]>h){v=h,k=n[T][0];break}if("15:15:00"==new Date(n[T][0]).toLocaleTimeString()){v=n[T][3],k=n[T][0];break}}for(var L=0;L<n.length;L++){if(100*(n[L][3]-p)/p<=-1.5){n[L][3],n[L][0];break}if(n[L][2]>h){h,n[L][0];break}if("15:15:00"==new Date(n[L][0]).toLocaleTimeString()){n[L][3],n[L][0];break}}var C=localStorage.getItem("backTestResult")?JSON.parse(localStorage.getItem("backTestResult")):[];if(n[0][3]<d||n[1][3]<d||n[2][3]<d){var w={foundAt:new Date(e[0][0]).toLocaleString(),symbol:t,sellEntyPrice:p,stopLoss:h,orderActivated:!1,buyExitPrice:0,brokerageCharges:.06,quantity:Math.floor(1e4/p)};w.orderActivated=!0,w.squareOffAt=new Date(k).toLocaleString(),w.buyExitPrice=v,w.perChange=(100*(w.sellEntyPrice-w.buyExitPrice)/w.sellEntyPrice).toFixed(2),C.push(w),a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[w])})}}}a.setState({backTestFlag:!0})},a.backtestTweezerBottom=function(e,t,n){if(e&&e.length>0){for(var r=(e=e.reverse())[2]&&e[2][2],l=e[2]&&e[2][3],o=3;o<e.length;o++)r<e[o][2]&&(r=e[o][2]),e[o][3]<l&&(l=e[o][3]);var s=e[9][3],i=e[2][2],c={time:e[0]&&e[0][0],open:e[0]&&e[0][1],high:e[0]&&e[0][2],low:e[0]&&e[0][3],close:e[0]&&e[0][4]},m={time:e[1]&&e[1][0],open:e[1]&&e[1][1],high:e[1]&&e[1][2],low:e[1]&&e[1][3],close:e[1]&&e[1][4]},u=100*(i-s)/s,d=m.low<c.low?m.low:c.low,g=m.high<c.high?m.high:c.high;if(u<=-1.5&&g<r&&d<l&&m.open>m.close&&c.close>c.open&&(Math.round(m.close)==Math.round(c.open)||Math.round(m.open)==Math.round(c.close))&&(console.log("%c"+new Date(e[0][0]).toString(),"color: #20d020"),console.log(t,"last 8th candle diff% ",u,"10th Low",s,"3rd high",i),console.log(t,"maxHigh",r,"maxLow",l),console.log("last10Candle",e),console.log(t,"perfect twisser top done close=open || open=close"),console.log("next10Candle",n),n&&n.length)){for(var h=(g+g/100/10).toFixed(2),p=(d-d/100/10).toFixed(2),f=0,y="",b=0;b<n.length;b++){if(n[b][2]<p){f=p,y=n[b][0];break}if("15:15:00"==new Date(n[b][0]).toLocaleTimeString()){f=n[b][4],y=n[b][0];break}}for(var E=n[0][4],S=1;S<n.length&&(E<n[S][4]&&(E=n[S][4],n[S][0]),"15:15:00"!=new Date(n[S][0]).toLocaleTimeString());S++);for(var v=p,k=0;k<n.length;k++){if(!(v>n[k][2])){v=n[k][4].toFixed(2),n[k][0];break}if(v=(n[k][2]+n[k][2]/100/4).toFixed(2),n[k][0],"15:15:00"==new Date(n[k][0]).toLocaleTimeString())break}for(var T=0;T<n.length;T++){if(100*(n[T][3]-h)/h>.7){n[T][3],n[T][0];break}if(n[T][2]>p){p,n[T][0];break}if("15:15:00"==new Date(n[T][0]).toLocaleTimeString()){n[T][3],n[T][0];break}}for(var L=0;L<n.length;L++){if(100*(n[L][3]-h)/h>=-1.5){n[L][3],n[L][0];break}if(n[L][2]>p){p,n[L][0];break}if("15:15:00"==new Date(n[L][0]).toLocaleTimeString()){n[L][3],n[L][0];break}}var C=localStorage.getItem("backTestResult")?JSON.parse(localStorage.getItem("backTestResult")):[];if(n[0][3]<d||n[1][3]<d||n[2][3]<d){var w={foundAt:new Date(e[0][0]).toLocaleString(),symbol:t,sellEntyPrice:0,stopLoss:p,orderActivated:!1,buyExitPrice:h,brokerageCharges:.06,quantity:Math.floor(1e4/h)};w.orderActivated=!0,w.squareOffAt=new Date(y).toLocaleString(),w.sellEntyPrice=f,w.perChange=(100*(w.sellEntyPrice-w.buyExitPrice)/w.sellEntyPrice).toFixed(2),C.push(w),a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[w])})}}}a.setState({backTestFlag:!0})},a.getTimeFrameValue=function(e){switch(e){case"ONE_MINUTE":return"720:00:00";case"FIVE_MINUTE":case"TEN_MINUTE":case"FIFTEEN_MINUTE":case"THIRTY_MINUTE":case"ONE_HOUR":case"ONE_DAY":return"1000:00:00"}},a.calculateSMA=function(e,t){for(var a=function(e){for(var t=0,a=0;a<e.length;a++)t+=e[a].close;return t/e.length},n=[],r=t-1,l=e.length;r<l;r++){var o=a(e.slice(r-t+1,r));n.push({time:e[r].time,value:o})}return n},a.showStaticChart=function(e,t,n,r){console.log("token, symbol, entryAt, exitAt",e,t,n,r),a.setState({chartStaticData:"",lightChartSymbol:t},function(){console.log("reset done",e)});var l="YYYY-MM-DD HH:mm",o=ot(n).set("hour","09").set("minute","15"),s=ot(r).set("hour","15").set("minute","30"),i={exchange:"NSE",symboltoken:e,interval:a.state.timeFrame,fromdate:ot(o).format(l),todate:ot(s).format(l)};x.getHistoryData(i).then(function(t){var n=Q(t,"noPop");if(n&&n.data){var r=n.data,s=r.map(function(e){return{time:new Date(e[0]).getTime(),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4])}}),i=[],c=[],m=[],u=[],d=[],g=[],h=[],p=[],f=[];r.forEach(function(e,t){i.push([e[0],e[1],e[2],e[3],e[4]]),c.push([e[5],(e[2]+e[3]+e[4])/3]),m.push(e[4]),u.push(e[2]),d.push(e[3]),g.push(e[3]),h.push(e[5]),p.push((e[2]+e[3]+e[4])/3),f.push({time:new Date(e[0]).getTime(),value:e[5],color:"rgba(211, 211, 211, 1)"})});var y={period:20,values:p,stdDev:2},b=it.a.calculate(y);console.log(e,"Bolinger band",y,b);b=it.a.calculate(y);console.log(e,"Bolinger band",y,b);var E={values:m,period:14},S=st.a.calculate(E);if(console.log(e,"Rsi",E,S),console.log(e,"vwap",c,mt()(c)),a.setState({chartStaticData:s,bblastValue:b[b.length-1],vwapvalue:mt()(c),rsiValues:S.slice(Math.max(h.length-19,1)),valumeData:h.slice(Math.max(h.length-5,1))},function(){this.state.candleSeries.setData(this.state.chartStaticData),this.state.volumeSeries.setData(f);var e=this.calculateSMA(this.state.chartStaticData,20);this.state.smaLineSeries.setData(e),this.state.chart.subscribeCrosshairMove(function(e){var t=e.seriesPrices[Symbol.iterator](),a="",n="",r=!0,l=!1,o=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var c=s.value;"object"==typeof c[1]?(a+=" Open: <b>"+c[1].open+"</b>",a+=" High: <b>"+c[1].high+"</b>",a+=" Low: <b>"+c[1].low+"</b>",a+=" Close: <b>"+c[1].close+"</b>",a+=" Chng: <b>"+(n=100*(c[1].close-c[1].open)/c[1].open).toFixed(2)+"%</b>"):a+=" &nbsp; "+c[1].toFixed(2)+" "}}catch(u){l=!0,o=u}finally{try{r||null==i.return||i.return()}finally{if(l)throw o}}e.time?a+=" Time: <b>"+new Date(e.time).toLocaleString()+"</b>":a+=" <b>Time: </b>";var m="<span style=color:green>"+a+"</span> ";n<0&&(m="<span style=color:red>"+a+"</span> "),document.getElementById("showChartTitle").innerHTML=m})}),r&&r.sort(function(e,t){return new Date(t[0])-new Date(e[0])}),r.length>0){localStorage.setItem("InstrumentHistroy",JSON.stringify(r)),a.setState({InstrumentHistroy:r});var v=0,k=0,T=0;r.forEach(function(e){var t=100*(e[4]-e[1])/e[1];t>=.3&&(v+=1),t<=-.3&&(k+=1),T+=t}),a.setState({downMoveCount:k,upsideMoveCount:v,totalPerchentageChange:T,startingFrom:ot(o).format(l)})}}})},a.checkSlowMotionStock=function(e,t){var n=ot.duration("240:00:00"),r=ot(new Date).subtract(n),l={exchange:"NSE",symboltoken:e,interval:"FIVE_MINUTE",fromdate:ot(r).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")};x.getHistoryData(l).then(function(e){var n=Q(e,"noPop");if(n&&n.data&&n.data.length){for(var r=n.data,l=0,o=r.length-375;o<r.length;o++){var s=r[o];if(s){var i=100*(s[4]-s[1])/s[1];i>=.4&&(l+=1,console.log(t.symbol,i,s[0])),i<=-.4&&(l+=1,console.log(t.symbol,i,s[0]))}}console.log("Totalcount",t.symbol,l),l<=15&&(t.bigCandleCount=l,a.setState({slowMotionStockList:[].concat(Object(ee.a)(a.state.slowMotionStockList),[t])},function(){localStorage.setItem("slowMotionStockList",JSON.stringify(this.state.slowMotionStockList))}))}})},a.checkSlowMotionCheckLive=Object(te.a)($.a.mark(function e(){var t,n,r,l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.slowMotionStockList[t],"YYYY-MM-DD HH:mm",r=ot.duration("22:00:00"),l=ot(new Date).subtract(r),o={exchange:"NSE",symboltoken:n.token,interval:"FIVE_MINUTE",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")},x.getHistoryData(o).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){for(var r=t.data,l=0,o=r.length-3;o<r.length;o++){var s=r[o];if(s){var i=100*(s[4]-s[1])/s[1];i>=.7&&(l+=1),i>=0&&1}}l>=1&&(n.highlisht=!0,window.document.title="SM: "+n.symbol,console.log("hey listen, slow motion stock"+n.symbol+" broken"),a.speckIt("hey listen, slow motion stock"+n.symbol+" broken"),a.setState({slowMotionStockList:a.state.slowMotionStockList}))}}),e.next=8,new Promise(function(e){return setTimeout(e,310)});case 8:case"end":return e.stop()}},e)}),n=0;case 2:if(!(n<a.state.slowMotionStockList.length)){e.next=7;break}return e.delegateYield(t(n),"t0",4);case 4:n++,e.next=2;break;case 7:case"end":return e.stop()}},e)})),a.copyAll=function(){navigator.clipboard.writeText(a.state.copydata),z.showSuccess("Copied to clickboard")},a.checkLiveBids=Object(te.a)($.a.mark(function e(){var t,n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<a.state.symbolList.length)){e.next=9;break}return n=a.state.symbolList[t],x.checkLiveBids(n.name).then(function(e){if(console.log("bid",e.data.data),e.data&&e.data.data.length){var t=e.data.data[0],n={totalBuyQuantity:t.totalBuyQuantity,totalSellQuantity:t.totalSellQuantity,deliveryToTradedQuantity:t.deliveryToTradedQuantity,symbol:t.symbol,orderType:t.totalBuyQuantity+"|"+t.totalSellQuantity,nc:t.pChange,ltp:t.lastPrice};a.setState({liveBidsList:[].concat(Object(ee.a)(a.state.liveBidsList),[n])},function(){localStorage.setItem("liveBidsList",JSON.stringify(this.state.liveBidsList))})}}),e.next=6,new Promise(function(e){return setTimeout(e,100)});case 6:t++,e.next=1;break;case 9:case"end":return e.stop()}},e)})),a.speckIt=function(e){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)},a.dailyBasisInfoCheck=function(e,t){var n=a.getTimeFrameValue("ONE_DAY"),r=ot.duration(n),l=ot(new Date).subtract(r),o={exchange:"NSE",symboltoken:e,interval:"ONE_DAY",fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(new Date).format("YYYY-MM-DD HH:mm")};x.getHistoryData(o).then(function(n){var r=Q(n,"noPop"),l="";if(r&&r.data&&r.data.length){for(var o=r.data,s=[],i=0,c=o.length-20;c<o.length;c++){var m=o[c];m&&(s.push(m[4]),i+=m[5])}l=Ft.a.calculate({period:20,values:s}),a.setState({dailyAvgValume:i/20});var u=l&&l[l.length-1];console.log(e,"DSMA",u),u&&a.setState({DailyBulishStatus:u,todayCurrentVolume:o[o.length-1][5]}),o[o.length-1][5]>i/20&&(console.log("crosssed voliue",t),a.setState({volumeCrossedList:[].concat(Object(ee.a)(a.state.volumeCrossedList),[t])}))}})},a.getPercentageColor=function(e){return"rgb("+((e*=100)<50?255:Math.floor(255-255*(2*e-100)/100))+","+(e>50?255:Math.floor(2*e*255/100))+",0)"},a.getAveragePrice=function(e){for(var t=localStorage.getItem("oderbookData"),n=0,r=0;r<t.length;r++)if("orderId"===t[r].orderid){n=t[r].averageprice,a.setState({averageprice:n});break}return n},a.showCandleChart=function(e,t,a){e=e&&e.reverse(),localStorage.setItem("candleChartData",JSON.stringify(e)),localStorage.setItem("cadleChartSymbol",t),a&&localStorage.setItem("chartInfoDetails",JSON.stringify(a)),document.getElementById("showCandleChart").click()},a.showCandleBothChart=function(e){var t=e.candleChartData&&e.candleChartData.reverse();localStorage.setItem("candleChartData",JSON.stringify(t)),localStorage.setItem("cadleChartSymbol",e.symbol);var a=e.candleChartDataInside;a&&localStorage.setItem("candleChartDataInside",JSON.stringify(a)),document.getElementById("showCandleChart").click()},a.handleKeyDown=function(e){console.log("key",e.keyCode),38===e.keyCode&&a.state.cursor>0?a.setState(function(e){return{cursor:e.cursor-1}}):40===e.keyCode&&a.state.cursor<a.state.symbolList.length-1&&a.setState(function(e){return{cursor:e.cursor+1}}),setTimeout(function(){a.updateCandleOnkey()},100)},a.state={sumPercentage:0,InstrumentPerChange:"",autoSearchList:[],isDasable:!1,isError:!1,InstrumentLTP:{},ifNotBought:!0,autoSearchTemp:[],backTestResult:[],backTestResultCSV:[],backTestFlag:!0,patternType:"VolumePrice",symboltoken:"",tradingsymbol:"",buyPrice:0,quantity:1,producttype:"INTRADAY",symbolList:localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))||[],totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},selectedWatchlist:"NIFTY BANK",longExitPriceType:4,shortExitPriceType:4,candleChartData:[],stopScaningFlag:!1,backTestResultDateRange:[],searchFailed:0,timeFrame:"FIFTEEN_MINUTE",cursor:"",FoundPatternList:localStorage.getItem("FoundPatternList")&&JSON.parse(localStorage.getItem("FoundPatternList"))||[],fastMovementList:localStorage.getItem("fastMovementList")&&JSON.parse(localStorage.getItem("fastMovementList"))||[]},a.myCallback=a.myCallback.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){window.document.title="Backtest",this.setState({symbolList:this.state.staticData[this.state.selectedWatchlist]});var e=document.getElementById("tvchart");document.getElementById("tvchart").innerHTML="";var t=Object(It.a)(e,{width:550,height:400,timeVisible:!0,secondsVisible:!0}),a=t.addCandlestickSeries(),n=t.addLineSeries({color:"rgba(4, 111, 232, 1)",lineWidth:2}),r=t.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}});this.setState({chart:t,candleSeries:a,smaLineSeries:n,volumeSeries:r})}},{key:"render",value:function(){var e=this,t={myCallback:this.myCallback,startDate:"",endDate:"",firstLavel:"Start Date and Time",secondLavel:"End Date and Time"};console.log("backTestResult",this.state.backTestResult);var a=0,n=0,l=0,o=0,s=0,i=0,c=0,m=0,u=0,d=0,g=0;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement(rt,null),r.a.createElement(N.a,{direction:"row",container:!0,spacing:1,style:{padding:"5px"}},r.a.createElement(N.a,{item:!0,xs:12,sm:8},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(R.a,{style:{textAlign:"center",background:"lightgray"}},"Backtest"),r.a.createElement(N.a,{direction:"row",container:!0,spacing:2},r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:Jn.selectStyle},r.a.createElement(M.a,{htmlFor:"Nationality"},"Pattern Type"),r.a.createElement(ft.a,{value:this.state.patternType,name:"patternType",onChange:this.onChangePattern},r.a.createElement(yt.a,{value:"TweezerTop"},"Tweezer Top"),r.a.createElement(yt.a,{value:"TweezerBottom"},"Tweezer Bottom"),r.a.createElement(yt.a,{value:"NR4"},"NR4 @ 3:30pm "),r.a.createElement(yt.a,{value:"NR4Trail"},"Narrow Range 4 - Trail"),r.a.createElement(yt.a,{value:"NR4ForNextDay"},"NR4 For Next Day"),r.a.createElement(yt.a,{value:"NR4_SameDay"},"NR4 ByDate"),r.a.createElement(yt.a,{value:"NR4_Daywide_daterage"},"NR4 Daywise Range"),r.a.createElement(yt.a,{value:"StrongCandle"},"5min Strong Candle"),r.a.createElement(yt.a,{value:"VolumePrice"},"Volume Price Buy"),r.a.createElement(yt.a,{value:"VolumePriceSell"},"Volume Price Sell")))),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:Jn.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),r.a.createElement(ft.a,{value:this.state.selectedWatchlist,name:"selectedWatchlist",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"selectall"},"Select All"),this.state.totalWatchlist&&this.state.totalWatchlist.map(function(e){return r.a.createElement(yt.a,{value:e},e)})))),r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(Lt,{callbackFromParent:t})),r.a.createElement(N.a,{item:!0,xs:12,sm:4,style:{marginTop:"5px"}},this.state.backTestFlag?r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.backTestAnyPattern()}},"Search"):r.a.createElement(r.a.Fragment,null," ",r.a.createElement(B.a,null," ",r.a.createElement(gt.a,null)," \xa0 ",r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.stopBacktesting()}},"Stop Scaning")," \xa0  ",this.state.stockTesting," ",this.state.runningTest,"  "),"   "),"\xa0 Failed: ",this.state.searchFailed)),r.a.createElement(N.a,{direction:"row",container:!0,spacing:2},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{style:{background:"lightgray"}},r.a.createElement(Qe.a,{style:{color:localStorage.getItem("sumPerChange")>0?"#20d020":"#e66e6e"}},r.a.createElement("b",null,localStorage.getItem("sumPerChange"),"%")),r.a.createElement(Qe.a,{style:{color:localStorage.getItem("sumPnlValue")>0?"#20d020":"#e66e6e"}},localStorage.getItem("sumPnlValue")),r.a.createElement(Qe.a,{style:{color:localStorage.getItem("sumPerChangeHighLow")>0?"#20d020":"#e66e6e"}},r.a.createElement("b",null,localStorage.getItem("sumPerChangeHighLow"),"%")),r.a.createElement(Qe.a,{style:{color:localStorage.getItem("sumPnlValueOnHighLow")>0?"#20d020":"#e66e6e"}},localStorage.getItem("sumPnlValueOnHighLow")),r.a.createElement(Qe.a,{title:"Total Trades"},"T.T: ",this.state.backTestResult&&this.state.backTestResult.length," \xa0 W: ",localStorage.getItem("totalWin")," L: ",localStorage.getItem("totalLoss")),r.a.createElement(Qe.a,{title:"L:long S:short",colSpan:2},"L: ",localStorage.getItem("totalLongTrade")," S:  ",this.state.backTestResult&&this.state.backTestResult.length-localStorage.getItem("totalLongTrade")),r.a.createElement(Qe.a,{title:"ME: MarketEnd SL: Stop Loss",colSpan:2}," ME: ",localStorage.getItem("totalMarketEnd")," SL: ",localStorage.getItem("totalSlHit")),r.a.createElement(Qe.a,{title:"TI: Total Invested ",colSpan:2}," TI:  ",localStorage.getItem("totalInvestedValue")),r.a.createElement(Qe.a,{title:" Average gross/trade PnL: ",colSpan:4}," A.g/t PnL:  ",r.a.createElement("b",{style:{color:localStorage.getItem("sumPerChange")/this.state.backTestResult.length>0?"#20d020":"#e66e6e"}},(localStorage.getItem("sumPerChange")/this.state.backTestResult.length).toFixed(2),"%"),"\xa0 ",r.a.createElement(_n.a,{filename:this.state.filename,data:this.state.backTestResult}),r.a.createElement("button",{onClick:function(){return e.copyAll()}},"Copy"))),r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat"},"CPnl% "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"CNetPnL "),r.a.createElement(Qe.a,{className:"TableHeadFormat",title:"High on long side | Low in short side"},"HLPnL% "),r.a.createElement(Qe.a,{className:"TableHeadFormat",title:"High on long side | Low in short side"},"HLNet PnL"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Symbol"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Entry"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"ExitStatus"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Buy"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Sell(Qty)"),r.a.createElement(Qe.a,{className:"TableHeadFormat",title:"High on long side | Low in short side"},"High/Low"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"StopLoss"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Day Chart ")))),"NR4"==this.state.patternType||"TweezerTop"==this.state.patternType||"TweezerBottom"==this.state.patternType||"NR4_SameDay"==this.state.patternType||"StrongCandle"==this.state.patternType||"VolumePrice"==this.state.patternType||"VolumePriceSell"==this.state.patternType?r.a.createElement("div",{style:{overflow:"auto",maxHeight:"550px"}},r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.backTestResult?this.state.backTestResult.map(function(t,h){return r.a.createElement(ze.a,{hover:!0,key:h},r.a.createElement(Qe.a,Object.assign({style:{color:t.perChange>0?"#20d020":"#e66e6e"}},a+=parseFloat(t.perChange||0)),t.perChange,"%"),r.a.createElement(Qe.a,Object.assign({},c=t.sellEntyPrice*(t.perChange-t.brokerageCharges)/100*t.quantity,l+=c,m+=t.sellEntyPrice*(t.perChange-t.brokerageCharges)/100*t.quantity>0?1:0,u+=t.sellEntyPrice*(t.perChange-t.brokerageCharges)/100*t.quantity<0?1:0,{style:{color:c>0?"#20d020":"#e66e6e"}})," ",c.toFixed(2)),r.a.createElement(Qe.a,Object.assign({style:{color:t.perChngOnHighLow>0?"#20d020":"#e66e6e"}},n+=parseFloat(t.perChngOnHighLow||0))," ",t.perChngOnHighLow,"%"),r.a.createElement(Qe.a,Object.assign({},o+=t.sellEntyPrice*(t.perChngOnHighLow-t.brokerageCharges)/100*t.quantity,{style:{color:t.sellEntyPrice*(t.perChngOnHighLow-t.brokerageCharges)/100*t.quantity>0?"#20d020":"#e66e6e"}}),(t.sellEntyPrice*(t.perChngOnHighLow-t.brokerageCharges)/100*t.quantity).toFixed(2)),r.a.createElement(Qe.a,null," ",r.a.createElement(B.a,{variant:"contained",style:{marginLeft:"20px"},onClick:function(){return e.showCandleBothChart(t)}},t.symbol," ",r.a.createElement(xe.a,null)," ")),r.a.createElement(Qe.a,Object.assign({style:{color:t.foundAt&&0==t.foundAt.indexOf("Long")?"#20d020":"#e66e6e"}},i+=t.foundAt&&0==t.foundAt.indexOf("Long")?1:0),t.foundAt.substr(0,18)),r.a.createElement(Qe.a,Object.assign({},d+="ME@3:30pm"===t.exitStatus?1:0,g+="SLHit"===t.exitStatus?1:0),t.exitStatus),r.a.createElement(Qe.a,null,t.buyExitPrice),r.a.createElement(Qe.a,s+=t.foundAt&&0==t.foundAt.indexOf("Long")?parseFloat(t.buyExitPrice*t.quantity):parseFloat(t.sellEntyPrice*t.quantity),t.sellEntyPrice,"(",t.quantity,")"),r.a.createElement(Qe.a,{title:"High on long side | Low in short side"},t.highAndLow),r.a.createElement(Qe.a,null,t.stopLoss),r.a.createElement(Qe.a,null," ",r.a.createElement(B.a,{variant:"contained",style:{marginLeft:"20px"},onClick:function(){return e.showStaticChart(t.token,t.symbol,t.chartDate,t.chartDate)}},"Day",r.a.createElement(Ce.a,null)," ")))}):"",r.a.createElement(ze.a,{style:{background:"lightgray"}},r.a.createElement(Qe.a,{style:{color:a>0?"#20d020":"#e66e6e"}},r.a.createElement("b",null,localStorage.setItem("sumPerChange",a.toFixed(2)),a.toFixed(2),"%")),r.a.createElement(Qe.a,{style:{color:l>0?"#20d020":"#e66e6e"}},r.a.createElement("b",null,l.toFixed(2)),localStorage.setItem("sumPnlValue",l.toFixed(2))),r.a.createElement(Qe.a,{style:{color:n>0?"#20d020":"#e66e6e"}},r.a.createElement("b",null,localStorage.setItem("sumPerChangeHighLow",n.toFixed(2)),n.toFixed(2),"%")),r.a.createElement(Qe.a,{style:{color:o>0?"#20d020":"#e66e6e"}},r.a.createElement("b",null,o.toFixed(2)),localStorage.setItem("sumPnlValueOnHighLow",o.toFixed(2))),r.a.createElement(Qe.a,null," ",localStorage.setItem("totalLongTrade",i)," ",localStorage.setItem("totalInvestedValue",s.toFixed(2))," "),r.a.createElement(Qe.a,null,localStorage.setItem("sumPerChangeHighLow",n.toFixed(2))," ",localStorage.setItem("sumPnlValueOnHighLow",o.toFixed(2))),r.a.createElement(Qe.a,null,localStorage.setItem("totalWin",m),localStorage.setItem("totalLoss",u)," ",localStorage.setItem("totalMarketEnd",d)," ",localStorage.setItem("totalSlHit",g)," "),r.a.createElement(Qe.a,null," "),r.a.createElement(Qe.a,null," "),r.a.createElement(Qe.a,null," "),r.a.createElement(Qe.a,null," "),r.a.createElement(Qe.a,null," "),r.a.createElement(Qe.a,null," "))))):"","NR4_Daywide_daterage"==this.state.patternType?r.a.createElement(r.a.Fragment,null,this.state.dateAndTypeKeys?this.state.dateAndTypeKeys.map(function(t){return r.a.createElement(qe.a,{size:"small","aria-label":"sticky table",style:{padding:"5px"}},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{style:{background:"lightgray"},key:t},r.a.createElement(Qe.a,{colSpan:11,className:"TableHeadFormat"}," ",t,"  ",(a=0,0,0,n=0,l=0,o=0,s=0,i=0,0))),r.a.createElement(ze.a,{key:t+1,variant:"head",style:{fontWeight:"bold",background:"lightgray"}},r.a.createElement(Qe.a,{className:"TableHeadFormat"}," CPnL% "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"CNetPnL "),r.a.createElement(Qe.a,{className:"TableHeadFormat",title:"High on long side | Low in short side"},"HLPnL% "),r.a.createElement(Qe.a,{className:"TableHeadFormat",title:"High on long side | Low in short side"},"HLNet PnL"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Symbol"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"FoundAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Buy"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Sell(Qty)"),r.a.createElement(Qe.a,{className:"TableHeadFormat",title:"High on long side | Low in short side"},"High/Low"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"SquiredOffAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"StopLoss"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},e.state.backTestResultDateRange[t].map(function(t,c){return r.a.createElement(ze.a,{hover:!0,key:c},r.a.createElement(Qe.a,Object.assign({style:{color:t.perChange>0?"#20d020":"#e66e6e"}},a+=parseFloat(t.perChange||0)),t.perChange,"%"),r.a.createElement(Qe.a,Object.assign({},l+=t.sellEntyPrice*(t.perChange-t.brokerageCharges)/100*t.quantity,{style:{color:t.sellEntyPrice*(t.perChange-t.brokerageCharges)/100*t.quantity>0?"#20d020":"#e66e6e"}})," ",(t.sellEntyPrice*(t.perChange-t.brokerageCharges)/100*t.quantity).toFixed(2)),r.a.createElement(Qe.a,Object.assign({style:{color:t.perChngOnHighLow>0?"#20d020":"#e66e6e"}},n+=parseFloat(t.perChngOnHighLow||0))," ",r.a.createElement("b",null,t.perChngOnHighLow,"%")),r.a.createElement(Qe.a,Object.assign({},o+=t.sellEntyPrice*(t.perChngOnHighLow-t.brokerageCharges)/100*t.quantity,{style:{color:t.sellEntyPrice*(t.perChngOnHighLow-t.brokerageCharges)/100*t.quantity>0?"#20d020":"#e66e6e"}}),(t.sellEntyPrice*(t.perChngOnHighLow-t.brokerageCharges)/100*t.quantity).toFixed(2)),r.a.createElement(Qe.a,null," ",r.a.createElement(B.a,{variant:"contained",style:{marginLeft:"20px"},onClick:function(){return e.showCandleChart(t.candleChartData,t.symbol)}},t.symbol," ",r.a.createElement(xe.a,null)," ")),r.a.createElement(Qe.a,Object.assign({style:{color:0==t.foundAt.indexOf("Long")?"#20d020":"#e66e6e"}},i+=0==t.foundAt.indexOf("Long")?1:0),t.foundAt),r.a.createElement(Qe.a,null,t.buyExitPrice),r.a.createElement(Qe.a,s+=0==t.foundAt.indexOf("Long")?parseFloat(t.buyExitPrice*t.quantity):parseFloat(t.sellEntyPrice*t.quantity),t.sellEntyPrice,"(",t.quantity,")"),r.a.createElement(Qe.a,{title:"High on long side | Low in short side"},t.highAndLow),r.a.createElement(Qe.a,null,t.squareOffAt),r.a.createElement(Qe.a,null,t.stopLoss))}),r.a.createElement(ze.a,{style:{background:"lightgray"}},r.a.createElement(Qe.a,{style:{color:a>0?"#20d020":"#e66e6e"}},r.a.createElement("b",null,localStorage.setItem("sumPerChange",a.toFixed(2)),a.toFixed(2),"%")),r.a.createElement(Qe.a,{style:{color:l>0?"#20d020":"#e66e6e"}},r.a.createElement("b",null,l.toFixed(2)),localStorage.setItem("sumPnlValue",l.toFixed(2))),r.a.createElement(Qe.a,{style:{color:n>0?"#20d020":"#e66e6e"}},r.a.createElement("b",null,localStorage.setItem("sumPerChangeHighLow",n.toFixed(2)),n.toFixed(2),"%")),r.a.createElement(Qe.a,{style:{color:o>0?"#20d020":"#e66e6e"}},r.a.createElement("b",null,o.toFixed(2)),localStorage.setItem("sumPnlValueOnHighLow",o.toFixed(2))),r.a.createElement(Qe.a,null," ",localStorage.setItem("totalLongTrade",i)," ",localStorage.setItem("totalInvestedValue",s.toFixed(2))," "),r.a.createElement(Qe.a,null,localStorage.setItem("sumPerChangeHighLow",n.toFixed(2))," ",localStorage.setItem("sumPnlValueOnHighLow",o.toFixed(2))),r.a.createElement(Qe.a,null),r.a.createElement(Qe.a,null," "),r.a.createElement(Qe.a,null," "),r.a.createElement(Qe.a,null," "),r.a.createElement(Qe.a,null," "))))}):""):"","NR4ForNextDay"==this.state.patternType?r.a.createElement(R.a,{component:"h3",variant:"h6",color:"primary",gutterBottom:!0},"NR4 For Next Day  (",this.state.FoundPatternList.length,")  at ",this.state.endDate&&this.state.endDate?this.state.endDate.toString().substr(0,16):(new Date).toString().substr(0,16)):"","NR4ForNextDay"==this.state.patternType?r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Sr "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Symbol "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"FoundAt "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Past Performance "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"BuyAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"SellAt"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"High"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Low"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Close"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.FoundPatternList?this.state.FoundPatternList.map(function(t,a){return r.a.createElement(ze.a,{hover:!0,key:a},r.a.createElement(Qe.a,null,a+1),r.a.createElement(Qe.a,null," ",r.a.createElement(B.a,{variant:"contained",style:{marginLeft:"20px"},onClick:function(){return e.showCandleChart(t.candleChartData,t.symbol)}},t.symbol," ",r.a.createElement(xe.a,null)," ")),r.a.createElement(Qe.a,null,t.foundAt.substr(0,16)),r.a.createElement(Qe.a,{title:"based on last one 6 month"},r.a.createElement("span",{style:{background:t.pastPerferm.totalLongPer/t.pastPerferm.totalLongs>=1?"#92f192":""}},r.a.createElement("b",null,t.pastPerferm.totalLongs),"  Longs:  ",t.pastPerferm.totalLongPer,"% (",(t.pastPerferm.totalLongPer/t.pastPerferm.totalLongs).toFixed(2),"% per trade)  ")," ",r.a.createElement("br",null),"Longs on High%: ",t.pastPerferm.totalLongHighPer,"%  (",(t.pastPerferm.totalLongHighPer/t.pastPerferm.totalLongs).toFixed(2),"% per trade)",r.a.createElement("br",null),t.longCandles&&t.longCandles.map(function(a,n){return r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{style:{textDecoration:"underline",background:"lightgray",cursor:"pointer"},onClick:function(){return e.showCandleChart(a.candleChartData,t.symbol,a)}}," ",a.foundAt.substr(7,10)," "),"  \xa0")}),r.a.createElement("br",null),r.a.createElement("span",{style:{background:t.pastPerferm.totalShortPer/t.pastPerferm.totalShort>=1?"#e87b7b":""}},r.a.createElement("b",null,t.pastPerferm.totalShort)," Short: ",t.pastPerferm.totalShortPer,"% (",(t.pastPerferm.totalShortPer/t.pastPerferm.totalShort).toFixed(2),"% per trade) ")," ",r.a.createElement("br",null),"Short on Low%: ",t.pastPerferm.totalShortLowPer,"% (",(t.pastPerferm.totalShortLowPer/t.pastPerferm.totalShort).toFixed(2),"% per trade)",r.a.createElement("br",null),t.shortCandles&&t.shortCandles.map(function(a,n){return r.a.createElement(r.a.Fragment,null,r.a.createElement("a",{style:{textDecoration:"underline",background:"lightgray",cursor:"pointer"},onClick:function(){return e.showCandleChart(a.candleChartData,t.symbol,a)}}," ",a.foundAt.substr(7,10),"  ")," \xa0")})),r.a.createElement(Qe.a,null,t.BuyAt),r.a.createElement(Qe.a,null,t.SellAt),r.a.createElement(Qe.a,null,t.high),r.a.createElement(Qe.a,null,t.low),r.a.createElement(Qe.a,null,t.close))}):"")):"")))),r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(N.a,{style:{display:"visible"},spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(N.a,{spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,Object(y.a)({style:Jn.selectStyle},"style",{marginTop:"10px"}),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onInputChange},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1M"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5M"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10M"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15M"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30M"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1H"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1D")))),r.a.createElement(N.a,{item:!0,xs:12,sm:10},r.a.createElement(R.a,null,"Same Day Chart:  ",this.state.lightChartSymbol))),r.a.createElement("div",{id:"showChartTitle"}),r.a.createElement("div",{id:"tvchart"})),r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{overflowY:"scroll",height:"40vh"}},r.a.createElement(R.a,null," Candle Data "),r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Symbol"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Timestamp"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Chng% ",r.a.createElement("b",{style:{color:"#20d020"}}," UP(",this.state.upsideMoveCount,")")," | ",r.a.createElement("b",{style:{color:"red"}}," Down(",this.state.downMoveCount,")")," "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Open"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"High"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Low"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Close "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Volume"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.InstrumentHistroy&&this.state.InstrumentHistroy?this.state.InstrumentHistroy.map(function(t,a){return r.a.createElement(ze.a,{key:a,style:{background:100*(t[4]-t[1])/t[1]>=.3?"#20d020":100*(t[4]-t[1])/t[1]<=-.3?"#e66e6e":"none"}},r.a.createElement(Qe.a,null,e.state.tradingsymbol),r.a.createElement(Qe.a,null,new Date(t[0]).toLocaleString()),r.a.createElement(Qe.a,null," ",r.a.createElement("b",null,100*(t[4]-t[1])/t[1]&&(100*(t[4]-t[1])/t[1]).toFixed(2),"%")),r.a.createElement(Qe.a,null,t[1]),r.a.createElement(Qe.a,null,t[2]),r.a.createElement(Qe.a,null,t[3]),r.a.createElement(Qe.a,null,t[4]),r.a.createElement(Qe.a,null,t[5]))}):""))))))))}}]),t}(r.a.Component),Jn={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},qn=Vn,zn=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.onInputChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.state.tradingsymbol&&this.showStaticChart(this.state.symboltoken)})},a.handleChange=function(e){a.setState({isSameDayDuplcate:e.target.checked},function(){console.log("isSameDayDuplcate",a.state.isSameDayDuplcate,e.target.checked)})},a.stopBacktesting=function(){a.setState({stopScaningFlag:!0})},a.readCsv=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({newJsonList:[]}),n=a.state.csvFormatInput.trim().split("\n"),r=$.a.mark(function e(r){var l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=n[r],o=l.split("\t")[1],s=l.split("\t")[0],a.setState({stockTesting:r+1+". "+o+" getting details"}),x.autoCompleteSearch(o).then(function(e){var l=e.data.filter(function(e){return"NSE"===e.exch_seg&&"1"===e.lotsize&&e.name===o});l.length&&(l[0].startTime=s,a.setState({newJsonList:[].concat(Object(ee.a)(a.state.newJsonList),[l[0]])},function(){n.length-1==r&&t()}))}),e.next=7,new Promise(function(e){return setTimeout(e,150)});case 7:case"end":return e.stop()}},e)}),l=0;case 4:if(!(l<n.length)){e.next=9;break}return e.delegateYield(r(l),"t0",6);case 6:l++,e.next=4;break;case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.getAlltokenOfList=function(e){for(var t=[],n=[],r=[],l=a.state.csvFormatInput.trim().split("\n"),o=function(e){var r=l[e],o=r.split("\t")[1],s=r.split("\t")[0];a.setState({stockTesting:e+1+". "+o+" getting details"}),n.push({name:o,startTime:s}),t.filter(function(e){return e.name===o})[0]||t.push({name:o})},s=0;s<l.length;s++)o(s);if(a.setState({totaluniqueStocks:t.length,allQniqueStockList:t}),a.state.stockList.length>0){var i=function(e){var t=n[e],l=a.state.stockList.filter(function(e){return e.name==t.name});if(l.length>0){var o={symbol:l[0].symbol,name:l[0].name,startTime:t.startTime,token:l[0].token};r.push(o)}};for(s=0;s<n.length;s++)i(s);e(r,t,a.state.stockList)}else x.getAllListTokens(t).then(function(a){var l=a.data;if(l.length>0)for(var o=function(e){var t=n[e],a=l.filter(function(e){return e.name==t.name});if(a.length>0){var o={symbol:a[0].symbol,name:a[0].name,startTime:t.startTime,token:a[0].token};r.push(o)}},s=0;s<n.length;s++)o(s);e(r,t,l)})},a.getDateFormate=function(e,t){var a=e.split(" ")[0].split("-");return ot(a[2]+"/"+a[1]+"/"+a[0]+" "+t)},a.convertDateFormat=function(e){var t=e.split(" "),a=t[0].split("-"),n=a[2]+"/"+a[1]+"/"+a[0],r="";return t&&t[1]&&(r=ot(t[1],"HH:mm").format("HH:mm")),ot(n+" "+r)},a.getPerChangeOfStock=function(e,t){if(e.length>0){var n=e,r=a.state.entryCandlePoint,l=n[0][r];5==r&&(l=(n[0][2]+n[0][3])/2),6==r&&n.forEach(function(e){e[2]>n[0][2]+n[0][2]/100/10&&(l=n[0][2]+n[0][2]/100/10)}),7==r&&n.forEach(function(e){e[3]<n[0][3]-n[0][3]/100/10&&(l=n[0][3]-n[0][3]/100/10)});for(var o={name:t.name,symbol:t.symbol,token:t.token,entryPrice:l.toFixed(2),foundAt:ot(n[0][0]).format("YYYY-MM-DD HH:mm")},s=[],i=1;i<n.length;i++){var c=100*(n[i][4]-o.entryPrice)/o.entryPrice,m=ot(n[i][0]).format("h:mma");"ONE_DAY"==a.state.timeFrame&&(m=ot(n[i][0]).format("DD/MM/YYYY h:mma")),c<a.state.maxDrowDown&&a.setState({maxDrowDown:c.toFixed(2)}),c>a.state.maxProfit&&a.setState({maxProfit:c.toFixed(2)}),s.push({perChange:c.toFixed(2),close:n[i][4],datetime:m})}for(var u=1;u<n.length;u++){if("buy"==a.state.orderType)if(100*(n[u][2]-o.entryPrice)/o.entryPrice>=a.state.targetPer){a.setState({crossedTargetCount:a.state.crossedTargetCount+1});break}if("sell"==a.state.orderType)if(100*(n[u][3]-o.entryPrice)/o.entryPrice<=-a.state.targetPer){a.setState({crossedTargetCount:a.state.crossedTargetCount+1});break}}o.candleData=s;var d=s[s.length-1].perChange>0;o.isWinOnClosing=d,d&&a.setState({totalWinTrade:a.state.totalWinTrade+1}),o.entryPrice>0&&a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[o])},function(){})}else console.log(" candle data emply"),a.setState({searchFailed:a.state.searchFailed+1})},a.backTestAnyPatternStockWise=function(){a.state.csvFormatInput?(a.setState({backTestResult:[],overAllResult:[],stockWiseListOverall:[],backTestFlag:!1,filename:"",searchFailed:0,pertradePandL:0,pertradePandLNet:0}),a.setState({totalgross:0,totalAvg:0,totTrade:0,totalNet:0,totalExp:0,totalWinTrade:0,maxDrowDown:0,maxProfit:0,crossedTargetCount:0}),a.getAlltokenOfList(function(){var e=Object(te.a)($.a.mark(function e(t,n,r){var l,o,s,i;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:l=$.a.mark(function e(l){var o,i,c,m,u,d,g,h,p;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.state.stopScaningFlag){e.next=3;break}return a.setState({stopScaningFlag:!1}),e.abrupt("return","break");case 3:if(o=n[l],console.log("unique loop",o,(new Date).toLocaleTimeString()),i=r.filter(function(e){return e.name==o.name}),!(c=i.length>0?i[0].token:"")){e.next=20;break}m=t.filter(function(e){return e.name==o.name}),a.state.isSameDayDuplcate&&(u=[],m.forEach(function(e){u.filter(function(t){return ot(t.startTime).format("YYYY-MM-DD")==ot(e.startTime).format("YYYY-MM-DD")}).length||u.push(e)}),m=u),d=[],m.forEach(function(e){d.push(a.convertDateFormat(e.startTime))}),g=d.map(function(e){return ot(e)}),h=ot.min(g),p=ot.max(g),a.state.entryTimeAt&&(h=h.format("YYYY-MM-DD")+" "+a.state.entryTimeAt),s={exchange:"NSE",symboltoken:c,interval:a.state.timeFrame,fromdate:ot(h).format("YYYY-MM-DD HH:mm"),todate:ot(p.format("YYYY-MM-DD")+" 15:30").format("YYYY-MM-DD HH:mm")},x.getHistoryData(s).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){console.log("history",o,(new Date).toLocaleTimeString());for(var n=function(e){var n=m[e],r=a.convertDateFormat(n.startTime),l=ot(r.format("YYYY-MM-DD")+" 15:30"),o=t.data.filter(function(e){return ot(e[0]).isSameOrAfter(r)&&ot(e[0]).isSameOrBefore(l)});a.getPerChangeOfStock(o,n)},r=0;r<m.length;r++)n(r);a.updateStockWiseOverall()}else console.log(" candle data emply"),a.setState({searchFailed:a.state.searchFailed+1})}).catch(function(e){console.log(o.symbol,e),a.setState({searchFailed:a.state.searchFailed+1})}),e.next=21;break;case 20:return e.abrupt("return","continue");case 21:return e.next=23,new Promise(function(e){return setTimeout(e,350)});case 23:a.setState({stockTesting:l+1+". "+o.name});case 24:case"end":return e.stop()}},e)}),o=0;case 2:if(!(o<n.length)){e.next=13;break}return e.delegateYield(l(o),"t0",4);case 4:i=e.t0,e.t1=i,e.next="break"===e.t1?8:"continue"===e.t1?9:10;break;case 8:return e.abrupt("break",13);case 9:return e.abrupt("continue",10);case 10:o++,e.next=2;break;case 13:a.setState({backTestFlag:!0});case 14:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}())):z.showError("Paste stocklist datetime  symbol format, tab format")},a.backTestAnyPattern=function(){a.setState({backTestResult:[],overAllResult:[],overallMonthWise:[],backTestFlag:!1,filename:"",searchFailed:0,pertradePandL:0,pertradePandLNet:0}),a.getAlltokenOfList(function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=$.a.mark(function e(n){var r,i,c,m,u;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.state.stopScaningFlag){e.next=3;break}return a.setState({stopScaningFlag:!1}),e.abrupt("return","break");case 3:return r=t[n],i=r.startTime.split(" "),c=i[0].split("-"),m=c[2]+"/"+c[1]+"/"+c[0],"9:15",i&&i[1]&&ot(i[1],"HH:mm").format("HH:mm"),l=ot(m+" 9:15"),"15:30",o=ot(m+" 15:30"),"ONE_DAY"==a.state.timeFrame&&(o=ot(l,"DD-MM-YYYY").add(5,"days"),u=ot(o).format("YYYY-MM-DD"),o=ot(u+" 15:30")),s={exchange:"NSE",symboltoken:r.token,interval:a.state.timeFrame,fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(o).format("YYYY-MM-DD HH:mm")},x.getHistoryData(s).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){for(var n=t.data,l={symbol:r.symbol,token:r.token,entryPrice:n[0][4],foundAt:ot(n[0][0]).format("YYYY-MM-DD HH:mm")},o=[],s=1;s<n.length;s++){var i=100*(n[s][4]-l.entryPrice)/l.entryPrice,c=ot(n[s][0]).format("h:mma");"ONE_DAY"==a.state.timeFrame&&(c=ot(n[s][0]).format("DD/MM/YYYY h:mma")),o.push({perChange:i.toFixed(2),close:n[s][4],datetime:c})}l.candleData=o,a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[l])},function(){a.updateOverall()})}else console.log(" candle data emply"),a.setState({searchFailed:a.state.searchFailed+1})}).catch(function(e){console.log(r.symbol,e),a.setState({searchFailed:a.state.searchFailed+1})}),e.next=17,new Promise(function(e){return setTimeout(e,350)});case 17:a.setState({stockTesting:n+1+". "+r.symbol});case 18:case"end":return e.stop()}},e)}),r=0;case 2:if(!(r<t.length)){e.next=10;break}return e.delegateYield(n(r),"t0",4);case 4:if("break"!==e.t0){e.next=7;break}return e.abrupt("break",10);case 7:r++,e.next=2;break;case 10:a.setState({backTestFlag:!0});case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())},a.updateOverall=function(){var e=[];a.state.backTestResult.forEach(function(t){t.candleData.forEach(function(t){e.filter(function(e){return e===t.datetime})[0]||e.push(t.datetime)})});var t=[];e.forEach(function(e){var n=0;a.state.backTestResult.forEach(function(t){for(var a=0;a<t.candleData.length;a++){var r=t.candleData[a];if(e===r.datetime){n+=parseFloat(r.perChange);break}}});var r=.06*a.state.backTestResult.length;t.push({datetime:e,sumofall:n.toFixed(2),expence:r.toFixed(2),netOverAll:(n-r).toFixed(2),noOfTrade:a.state.backTestResult.length})}),t.sort(function(e,t){return ot(t.datetime,"h:mma")-ot(e.datetime,"h:mma")}),a.setState({overAllResult:t},function(){if(a.state.overAllResult.length>0){var e=a.state.overAllResult[0].sumofall/a.state.overAllResult[0].noOfTrade,t=e-.06;a.setState({pertradePandL:e.toFixed(2),pertradePandLNet:t.toFixed(2)})}})},a.updateStockWiseOverall=function(){a.setState({stockWiseListOverall:[]});var e=[];a.state.allQniqueStockList.forEach(function(t){var n=0,r=0;a.state.backTestResult.forEach(function(e){t.name==e.name&&e.candleData.length>0&&(n+=parseFloat(e.candleData[e.candleData.length-1].perChange),r+=1)});var l=.06*r,o={name:t.name,totalSameTrade:r,sumofall:n,expence:l,netPnL:n-l};e.push(o)}),a.setState({stockWiseListOverall:e},function(){var e,t=0,n=0,r=0,l=0,o=0,s=0;a.state.stockWiseListOverall.forEach(function(e){t+=e.sumofall,n+=e.totalSameTrade,r+=e.netPnL,l+=e.expence,o+=e.netPnL>0?1:0,s+=e.netPnL<0?1:0});var i={name:"Total (Gross Avg%): "+(e=(t/n).toFixed(2)),totalSameTrade:n,sumofall:t,expence:l,netPnL:r,winCount:o,lossCount:s};a.state.stockWiseListOverall.push(i),a.setState({stockWiseListOverall:a.state.stockWiseListOverall,lossCount:s,winCount:o,totalgross:t.toFixed(2),totalAvg:e,totTrade:n,totalNet:r.toFixed(2),totalExp:l.toFixed(2)})})},a.updateMonthWise=function(){a.setState({overallMonthWise:[]});var e=[];[{name:"Jan"},{name:"Feb"},{name:"Mar"},{name:"Apr"},{name:"May"},{name:"Jun"},{name:"Jul"},{name:"Aug"},{name:"Sep"},{name:"Nov"},{name:"Dec"}].forEach(function(t){var n=0,r=0;a.state.backTestResult.forEach(function(e){var a=ot(e.foundAt).format("MMM");t.name==a&&e.candleData.length>0&&(n+=parseFloat(e.candleData[e.candleData.length-1].perChange),r+=1)});var l=.06*r,o={name:t.name,totalSameTrade:r,sumofall:n.toFixed(2),expence:l.toFixed(2),netPnL:(n-l).toFixed(2)};e.push(o)}),a.setState({overallMonthWise:e},function(){})},a.calculateSMA=function(e,t){for(var a=function(e){for(var t=0,a=0;a<e.length;a++)t+=e[a].close;return t/e.length},n=[],r=t-1,l=e.length;r<l;r++){var o=a(e.slice(r-t+1,r));n.push({time:e[r].time,value:o})}return n},a.showStaticChart=function(e,t,n,r){console.log("token, symbol, entryAt, exitAt",e,t,n,r),a.setState({chartStaticData:"",lightChartSymbol:t},function(){console.log("reset done",e)});var l="YYYY-MM-DD HH:mm",o=ot(n).set("hour","09").set("minute","15"),s=ot(r).set("hour","15").set("minute","30"),i={exchange:"NSE",symboltoken:e,interval:a.state.timeFrame,fromdate:ot(o).format(l),todate:ot(s).format(l)};x.getHistoryData(i).then(function(t){var n=Q(t,"noPop");if(n&&n.data){var r=n.data,s=r.map(function(e){return{time:new Date(e[0]).getTime(),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4])}}),i=[],c=[],m=[],u=[],d=[],g=[],h=[],p=[],f=[];r.forEach(function(e,t){i.push([e[0],e[1],e[2],e[3],e[4]]),c.push([e[5],(e[2]+e[3]+e[4])/3]),m.push(e[4]),u.push(e[2]),d.push(e[3]),g.push(e[3]),h.push(e[5]),p.push((e[2]+e[3]+e[4])/3),f.push({time:new Date(e[0]).getTime(),value:e[5],color:"rgba(211, 211, 211, 1)"})});var y={period:20,values:p,stdDev:2},b=it.a.calculate(y);console.log(e,"Bolinger band",y,b);b=it.a.calculate(y);console.log(e,"Bolinger band",y,b);var E={values:m,period:14},S=st.a.calculate(E);if(console.log(e,"Rsi",E,S),console.log(e,"vwap",c,mt()(c)),a.setState({chartStaticData:s,bblastValue:b[b.length-1],vwapvalue:mt()(c),rsiValues:S.slice(Math.max(h.length-19,1)),valumeData:h.slice(Math.max(h.length-5,1))},function(){this.state.candleSeries.setData(this.state.chartStaticData),this.state.volumeSeries.setData(f);var e=this.calculateSMA(this.state.chartStaticData,20);this.state.smaLineSeries.setData(e),this.state.chart.subscribeCrosshairMove(function(e){var t=e.seriesPrices[Symbol.iterator](),a="",n="",r=!0,l=!1,o=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var c=s.value;"object"==typeof c[1]?(a+=" Open: <b>"+c[1].open+"</b>",a+=" High: <b>"+c[1].high+"</b>",a+=" Low: <b>"+c[1].low+"</b>",a+=" Close: <b>"+c[1].close+"</b>",a+=" Chng: <b>"+(n=100*(c[1].close-c[1].open)/c[1].open).toFixed(2)+"%</b>"):a+=" &nbsp; "+c[1].toFixed(2)+" "}}catch(u){l=!0,o=u}finally{try{r||null==i.return||i.return()}finally{if(l)throw o}}e.time?a+=" Time: <b>"+ot(e.time).format("DD/MM/YYYY h:mma")+"</b>":a+=" <b>Time: </b>";var m="<span style=color:green>"+a+"</span> ";n<0&&(m="<span style=color:red>"+a+"</span> "),document.getElementById("showChartTitle").innerHTML=m})}),r&&r.sort(function(e,t){return new Date(t[0])-new Date(e[0])}),r.length>0){localStorage.setItem("InstrumentHistroy",JSON.stringify(r)),a.setState({InstrumentHistroy:r});var v=0,k=0,T=0;r.forEach(function(e){var t=100*(e[4]-e[1])/e[1];t>=.3&&(v+=1),t<=-.3&&(k+=1),T+=t}),a.setState({downMoveCount:k,upsideMoveCount:v,totalPerchentageChange:T,startingFrom:ot(o).format(l)})}}})},a.speckIt=function(e){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)},a.getPercentageColor=function(e){return"rgb("+((e*=100)<50?255:Math.floor(255-255*(2*e-100)/100))+","+(e>50?255:Math.floor(2*e*255/100))+",0)"},a.onFileChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.files[0]))},a.state={sumPercentage:0,InstrumentPerChange:"",autoSearchList:[],isDasable:!1,isError:!1,InstrumentLTP:{},ifNotBought:!0,autoSearchTemp:[],backTestResult:[],backTestResultCSV:[],backTestFlag:!0,patternType:"NR4",symboltoken:"",tradingsymbol:"",buyPrice:0,quantity:1,producttype:"INTRADAY",symbolList:localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))||[],totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},selectedWatchlist:"NIFTY BANK",longExitPriceType:4,shortExitPriceType:4,candleChartData:[],stopScaningFlag:!1,backTestResultDateRange:[],searchFailed:0,FoundPatternList:localStorage.getItem("FoundPatternList")&&JSON.parse(localStorage.getItem("FoundPatternList"))||[],fastMovementList:localStorage.getItem("fastMovementList")&&JSON.parse(localStorage.getItem("fastMovementList"))||[],newJsonList:[],timeFrame:"FIFTEEN_MINUTE",overAllResult:[],pertradePandL:0,pertradePandLNet:0,allQniqueStockList:[],isSameDayDuplcate:!0,stockWiseListOverall:[],filename:"",overallMonthWise:[],entryCandlePoint:5,totalWinTrade:0,maxDrowDown:0,maxProfit:0,crossedTargetCount:0,orderType:"buy",targetPer:.5},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.document.title="Backtest",this.setState({symbolList:this.state.staticData[this.state.selectedWatchlist]});var t=new Worker(Ra);this.setState({myWorker:t});var a=document.getElementById("tvchart");document.getElementById("tvchart").innerHTML="";var n=Object(It.a)(a,{width:500,height:250,timeVisible:!0,secondsVisible:!0}),r=n.addCandlestickSeries(),l=n.addLineSeries({color:"rgba(4, 111, 232, 1)",lineWidth:2}),o=n.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}});this.setState({chart:n,candleSeries:r,smaLineSeries:l,volumeSeries:o}),x.updateStockList().then(function(t){e.setState({stockList:t.data})})}},{key:"render",value:function(){var e=this;this.myCallback;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement(rt,null),r.a.createElement(N.a,{direction:"row",container:!0,spacing:1,style:{padding:"5px"}},r.a.createElement(N.a,{item:!0,xs:12,sm:8},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(N.a,{direction:"row",container:!0,spacing:2},r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(Y.a,{variant:"outlined",id:"textarea",multiline:!0,rows:10,fullwidth:!0,style:{width:"90%",height:"50%"},label:"1. Datetime 2. Symbol format : Paste",value:this.state.csvFormatInput,name:"csvFormatInput",onChange:this.onChange})),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,Object(y.a)({style:Qn.selectStyle},"style",{marginTop:"10px"}),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onInputChange},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1M"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5M"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10M"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15M"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30M"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1H"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1D")),r.a.createElement(ft.a,{title:"Entry candle point , mid means high+low/2",value:this.state.entryCandlePoint,name:"entryCandlePoint",onChange:this.onInputChange},r.a.createElement(yt.a,{value:1},"Open"),r.a.createElement(yt.a,{value:2},"High"),r.a.createElement(yt.a,{value:3},"Low"),r.a.createElement(yt.a,{value:4},"Close"),r.a.createElement(yt.a,{value:5},"Mid"),r.a.createElement(yt.a,{value:6},"Above High"),r.a.createElement(yt.a,{value:7},"Below Low")),r.a.createElement(ft.a,{title:"checking for buy or sell",value:this.state.orderType,name:"orderType",onChange:this.onInputChange},r.a.createElement(yt.a,{value:"buy"},"Buy"),r.a.createElement(yt.a,{value:"sell"},"Sell")),r.a.createElement("input",{placeholder:"9:20",fullwidth:!0,style:{width:"90%",height:"50%"},label:"entryTimeAt",value:this.state.entryTimeAt,name:"entryTimeAt",onChange:this.onChange}),r.a.createElement("input",{placeholder:"target %: 0.5",type:"number",step:.1,fullwidth:!0,style:{width:"90%",height:"50%"},label:"Target",value:this.state.targetPer,name:"targetPer",onChange:this.onChange}),r.a.createElement(Be.a,null,r.a.createElement(Me.a,{control:r.a.createElement(Ne.a,{checked:this.state.isSameDayDuplcate,onChange:this.handleChange,"aria-label":"Speek ON/OFF"}),label:this.state.isSameDayDuplcate?"Same Day Duplcate: Yes":"Same Day Duplcate: No"})),r.a.createElement("input",{placeholder:"filename",id:"textarea",fullwidth:!0,style:{width:"90%",height:"50%"},label:"Filename",value:this.state.filename,name:"filename",onChange:this.onChange}),"Failed:",this.state.searchFailed,r.a.createElement("br",null),this.state.totaluniqueStocks?this.state.totaluniqueStocks+" unique stocks found":"",r.a.createElement("br",null),this.state.stockTesting)),r.a.createElement(N.a,{item:!0,xs:12,sm:4,style:{marginTop:"5px"}},this.state.backTestFlag?r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.backTestAnyPatternStockWise()}},"Test Stock Wise"):r.a.createElement(r.a.Fragment,null,"  ",r.a.createElement(gt.a,null),"  \xa0 ",r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.stopBacktesting()}},"Stop"),"  "),r.a.createElement("span",{title:"Success Ratio"},"Success Ratio: ",(100*this.state.crossedTargetCount/this.state.backTestResult.length).toFixed(2),"%"),r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat"},r.a.createElement(B.a,{size:"small",variant:"outlined",onClick:this.updateMonthWise},"Month"),"                                                "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Trades"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Gross P/L"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Expence"),r.a.createElement(Qe.a,{className:"TableHeadFormat"}," Net P/L"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.overallMonthWise?this.state.overallMonthWise.map(function(e,t){return e.totalSameTrade>0?r.a.createElement(ze.a,{key:t},r.a.createElement(Qe.a,null,e.name),r.a.createElement(Qe.a,null,e.totalSameTrade),r.a.createElement(Qe.a,null,e.sumofall>0?r.a.createElement("span",{style:{color:"green"}}," ",e.sumofall):r.a.createElement("span",{style:{color:"red"}}," ",e.sumofall),"% "),r.a.createElement(Qe.a,null,e.expence,"%"),r.a.createElement(Qe.a,null,e.netPnL>0?r.a.createElement("span",{style:{color:"green"}}," ",e.netPnL):r.a.createElement("span",{style:{color:"red"}}," ",e.netPnL),"% ")):""}):""))),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement("div",{style:{overflow:"auto",maxHeight:"200px"}},r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,null,"Sr.\xa0"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Stock (",this.state.stockWiseListOverall.length,") ",r.a.createElement(_n.a,{filename:"Overall_"+this.state.timeFrame+"_"+this.state.entryCandlePoint+"_"+this.state.orderType+"_"+this.state.filename+".csv",data:this.state.stockWiseListOverall}),"                                                    "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"T.T (",this.state.totTrade,")  Avg: (",this.state.totalAvg>0?r.a.createElement("span",{style:{color:"green"}}," ",this.state.totalAvg):r.a.createElement("span",{style:{color:"red"}}," ",this.state.totalAvg),")%"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Gross P/L (",this.state.totalgross>0?r.a.createElement("span",{style:{color:"green"}}," ",this.state.totalgross):r.a.createElement("span",{style:{color:"red"}}," ",this.state.totalgross),")%"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Expence (",this.state.totalExp,")%"),r.a.createElement(Qe.a,{className:"TableHeadFormat"}," Net P/L (",this.state.totalNet>0?r.a.createElement("span",{style:{color:"green"}}," ",this.state.totalNet):r.a.createElement("span",{style:{color:"red"}}," ",this.state.totalNet),")% \xa0  W:",this.state.winCount,"  \xa0 L:",this.state.lossCount))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.stockWiseListOverall?this.state.stockWiseListOverall.map(function(e,t){return r.a.createElement(ze.a,{key:t},r.a.createElement(Qe.a,null,t+1),r.a.createElement(Qe.a,null,e.name),r.a.createElement(Qe.a,null,e.totalSameTrade),r.a.createElement(Qe.a,null,e.sumofall>0?r.a.createElement("span",{style:{color:"green"}}," ",e.sumofall):r.a.createElement("span",{style:{color:"red"}}," ",e.sumofall),"% "),r.a.createElement(Qe.a,null,e.expence,"%"),r.a.createElement(Qe.a,null,e.netPnL>0?r.a.createElement("span",{style:{color:"green"}}," ",e.netPnL):r.a.createElement("span",{style:{color:"red"}}," ",e.netPnL),"% "))}):""))))),r.a.createElement(N.a,{direction:"row",container:!0,spacing:2},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement("div",{style:{overflow:"auto",maxHeight:"550px"}},r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Sr."),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Datetime ",r.a.createElement(_n.a,{filename:"Trade_"+this.state.timeFrame+"_"+this.state.entryCandlePoint+"_"+this.state.orderType+"_"+this.state.filename+".csv",data:this.state.backTestResult})),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Symbol \xa0"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"EntryPrice \xa0"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"ExitPrice \xa0"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"T.T:(",this.state.backTestResult.length,") \xa0W:",this.state.totalWinTrade," \xa0L:",this.state.backTestResult.length-this.state.totalWinTrade,"\xa0",r.a.createElement("span",{title:"Max Loss"},"ML:",this.state.maxDrowDown,"%"),"\xa0",r.a.createElement("span",{title:"Max Profit"},"MP:",this.state.maxProfit,"%"),"\xa0",r.a.createElement("span",{title:"target crossed"}," C.T:",this.state.crossedTargetCount),"\xa0",r.a.createElement("span",{title:"target not crossed"},"N.C:",this.state.backTestResult.length-this.state.crossedTargetCount," ")," \xa0",r.a.createElement("span",{title:"Success Ratio"},"S.R.",(100*this.state.crossedTargetCount/this.state.backTestResult.length).toFixed(2),"%")))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.backTestResult?this.state.backTestResult.map(function(t,a){return r.a.createElement(ze.a,{hover:!0,key:a,style:{background:t.isWinOnClosing?"":"bisque"}},r.a.createElement(Qe.a,null,a+1,"\xa0"),r.a.createElement(Qe.a,null,t.foundAt," \xa0"),r.a.createElement(Qe.a,null,r.a.createElement(B.a,{size:"small",variant:"contained",onClick:function(){return e.showStaticChart(t.token,t.symbol,t.foundAt,t.foundAt)}},t.symbol," ")," "),r.a.createElement(Qe.a,null,r.a.createElement("span",{style:{fontStyle:"italic"}}," ",t.entryPrice)," \xa0"),r.a.createElement(Qe.a,null,r.a.createElement("span",{style:{fontStyle:"italic",color:t.candleData[t.candleData.length-1].close>t.entryPrice?"green":"red"}}," ",t.candleData[t.candleData.length-1].close," (",t.candleData[t.candleData.length-1].perChange,"%) ")," \xa0"),r.a.createElement(Qe.a,null,t.candleData.map(function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,e.datetime,": "),e.close,"(",e.perChange>0?r.a.createElement("span",{style:{color:"green"}}," ",e.perChange,"%"):r.a.createElement("span",{style:{color:"red"}}," ",e.perChange,"%"),") \xa0")})))}):""))))))),r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(Ct.a,{style:{padding:"10px",position:navigator.userAgentData.mobile?"":"fixed"}},r.a.createElement(N.a,{style:{display:"visible"},spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(N.a,{spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,Object(y.a)({style:Qn.selectStyle},"style",{marginTop:"10px"}),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onInputChange},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1M"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5M"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10M"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15M"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30M"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1H"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1D")))),r.a.createElement(N.a,{item:!0,xs:12,sm:10},r.a.createElement(R.a,null,"Same Day Chart:  ",this.state.lightChartSymbol))),r.a.createElement("div",{id:"showChartTitle"}),r.a.createElement("div",{id:"tvchart"})),r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{overflowY:"scroll",height:"40vh"}},r.a.createElement(R.a,null," ",r.a.createElement(B.a,{size:"small",variant:"outlined",onClick:this.updateOverall}," Overall "),this.state.pertradePandL>0?r.a.createElement("span",{style:{color:"green"}}," ",this.state.pertradePandL):r.a.createElement("span",{style:{color:"red"}}," ",this.state.pertradePandL),"% Gross/Trade   |",this.state.pertradePandLNet>0?r.a.createElement("span",{style:{color:"green"}}," ",this.state.pertradePandLNet):r.a.createElement("span",{style:{color:"red"}}," ",this.state.pertradePandLNet),"% Net/Trade  "),r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Timestamp"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"No Of Trade"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Gross Overall P/L%"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Expence%"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Net P/L%"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.overAllResult?this.state.overAllResult.map(function(e,t){return r.a.createElement(ze.a,{key:t},r.a.createElement(Qe.a,null,e.datetime),r.a.createElement(Qe.a,null,e.noOfTrade),r.a.createElement(Qe.a,null,e.sumofall>0?r.a.createElement("span",{style:{color:"green"}}," ",e.sumofall):r.a.createElement("span",{style:{color:"red"}}," ",e.sumofall),"% "),r.a.createElement(Qe.a,null,e.expence,"%"),r.a.createElement(Qe.a,null,e.netOverAll>0?r.a.createElement("span",{style:{color:"green"}}," ",e.netOverAll):r.a.createElement("span",{style:{color:"red"}}," ",e.netOverAll),"% "))}):"")))))),r.a.createElement(N.a,{item:!0,xs:12},r.a.createElement("div",{id:"showChartTitle"}),r.a.createElement("div",{id:"tvchart"}))))}}]),t}(r.a.Component),Qn={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},Kn=zn,Gn=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value))},a.onInputChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.state.tradingsymbol&&this.showStaticChart(this.state.symboltoken)})},a.handleChange=function(e){a.setState({isSameDayDuplcate:e.target.checked},function(){console.log("isSameDayDuplcate",a.state.isSameDayDuplcate,e.target.checked)})},a.stopBacktesting=function(){a.setState({stopScaningFlag:!0})},a.readCsv=function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.setState({newJsonList:[]}),n=a.state.csvFormatInput.trim().split("\n"),r=$.a.mark(function e(r){var l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l=n[r],o=l.split("\t")[1],s=l.split("\t")[0],a.setState({stockTesting:r+1+". "+o+" getting details"}),x.autoCompleteSearch(o).then(function(e){var l=e.data.filter(function(e){return"NSE"===e.exch_seg&&"1"===e.lotsize&&e.name===o});l.length&&(l[0].startTime=s,a.setState({newJsonList:[].concat(Object(ee.a)(a.state.newJsonList),[l[0]])},function(){n.length-1==r&&t()}))}),e.next=7,new Promise(function(e){return setTimeout(e,150)});case 7:case"end":return e.stop()}},e)}),l=0;case 4:if(!(l<n.length)){e.next=9;break}return e.delegateYield(r(l),"t0",6);case 6:l++,e.next=4;break;case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),a.getAlltokenOfList=function(e){for(var t=[],n=[],r=[],l=a.state.csvFormatInput.trim().split("\n"),o=function(e){var r=l[e],o=r.split("\t")[1],s=r.split("\t")[0];a.setState({stockTesting:e+1+". "+o+" getting details"}),n.push({name:o,startTime:s}),t.filter(function(e){return e.name===o})[0]||t.push({name:o})},s=0;s<l.length;s++)o(s);if(a.setState({totaluniqueStocks:t.length,allQniqueStockList:t}),a.state.stockList.length>0){var i=function(e){var t=n[e],l=a.state.stockList.filter(function(e){return e.name==t.name});if(l.length>0){var o={symbol:l[0].symbol,name:l[0].name,startTime:t.startTime,token:l[0].token};r.push(o)}};for(s=0;s<n.length;s++)i(s);e(r,t,a.state.stockList)}else x.getAllListTokens(t).then(function(a){var l=a.data;if(l.length>0)for(var o=function(e){var t=n[e],a=l.filter(function(e){return e.name==t.name});if(a.length>0){var o={symbol:a[0].symbol,name:a[0].name,startTime:t.startTime,token:a[0].token};r.push(o)}},s=0;s<n.length;s++)o(s);e(r,t,l)})},a.getDateFormate=function(e,t){var a=e.split(" ")[0].split("-");return ot(a[2]+"/"+a[1]+"/"+a[0]+" "+t)},a.convertDateFormat=function(e){var t=e.split(" "),a=t[0].split("-"),n=a[2]+"/"+a[1]+"/"+a[0],r="";return t&&t[1]&&(r=ot(t[1],"HH:mm").format("HH:mm")),ot(n+" "+r)},a.getPerChangeOfStock=function(e,t){if(e.length>0){var n=e,r=a.state.entryCandlePoint,l=n[0][r];5==r&&(l=(n[0][2]+n[0][3])/2),6==r&&n.forEach(function(e){e[2]>n[0][2]+n[0][2]/100/10&&(l=n[0][2]+n[0][2]/100/10)}),7==r&&n.forEach(function(e){e[3]<n[0][3]-n[0][3]/100/10&&(l=n[0][3]-n[0][3]/100/10)});for(var o={name:t.name,symbol:t.symbol,token:t.token,entryPrice:l.toFixed(2),foundAt:ot(n[0][0]).format("YYYY-MM-DD HH:mm")},s=[],i=1;i<n.length;i++){var c=100*(n[i][4]-o.entryPrice)/o.entryPrice,m=ot(n[i][0]).format("h:mma");"ONE_DAY"==a.state.timeFrame&&(m=ot(n[i][0]).format("DD/MM/YYYY h:mma")),c<a.state.maxDrowDown&&a.setState({maxDrowDown:c.toFixed(2)}),c>a.state.maxProfit&&a.setState({maxProfit:c.toFixed(2)}),s.push({perChange:c.toFixed(2),close:n[i][4],datetime:m})}for(var u=1;u<n.length;u++){if("buy"==a.state.orderType)if(100*(n[u][2]-o.entryPrice)/o.entryPrice>a.state.targetPer){a.setState({crossedTargetCount:a.state.crossedTargetCount+1});break}if("sell"==a.state.orderType)if(100*(n[u][3]-o.entryPrice)/o.entryPrice<-a.state.targetPer){a.setState({crossedTargetCount:a.state.crossedTargetCount+1});break}}o.candleData=s;var d=s[s.length-1].perChange>0;o.isWinOnClosing=d,d&&a.setState({totalWinTrade:a.state.totalWinTrade+1}),o.entryPrice>0&&a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[o])},function(){})}else console.log(" candle data emply"),a.setState({searchFailed:a.state.searchFailed+1})},a.backTestAnyPatternStockWise=function(){a.setState({backTestResult:[],overAllResult:[],stockWiseListOverall:[],backTestFlag:!0,filename:"",searchFailed:0,pertradePandL:0,pertradePandLNet:0}),a.setState({totalgross:0,totalAvg:0,totTrade:0,totalNet:0,totalExp:0,totalWinTrade:0,maxDrowDown:0,maxProfit:0,crossedTargetCount:0});var e=JSON.parse(a.state.csvFormatInput);if(a.state.csvFormatInput)for(var t=e[0][3],n=e[0][2],r=0,l=(e[0][0],e[0][0],0);l<e.length-1;l++){var o=e[l],s=o[2],i=o[3];if(r<=1&&(i<t&&(t=i,o[0]),n<s&&(n=s,o[0]),r++),1==r){var c=e.slice(l,l+25),m=20*(n-t)/100;t-=m,n+=m,a.findRange(c,t,n),r=0,t=e[l+1][3],n=e[l+1][2]}}else z.showError("Paste candle data json format")},a.backTestAnyPattern=function(){a.setState({backTestResult:[],overAllResult:[],overallMonthWise:[],backTestFlag:!1,filename:"",searchFailed:0,pertradePandL:0,pertradePandLNet:0}),a.getAlltokenOfList(function(){var e=Object(te.a)($.a.mark(function e(t){var n,r,l,o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=$.a.mark(function e(n){var r,i,c,m,u;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.state.stopScaningFlag){e.next=3;break}return a.setState({stopScaningFlag:!1}),e.abrupt("return","break");case 3:return r=t[n],i=r.startTime.split(" "),c=i[0].split("-"),m=c[2]+"/"+c[1]+"/"+c[0],"9:15",i&&i[1]&&ot(i[1],"HH:mm").format("HH:mm"),l=ot(m+" 9:15"),"15:30",o=ot(m+" 15:30"),"ONE_DAY"==a.state.timeFrame&&(o=ot(l,"DD-MM-YYYY").add(5,"days"),u=ot(o).format("YYYY-MM-DD"),o=ot(u+" 15:30")),s={exchange:"NSE",symboltoken:r.token,interval:a.state.timeFrame,fromdate:ot(l).format("YYYY-MM-DD HH:mm"),todate:ot(o).format("YYYY-MM-DD HH:mm")},x.getHistoryData(s).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){for(var n=t.data,l={symbol:r.symbol,token:r.token,entryPrice:n[0][4],foundAt:ot(n[0][0]).format("YYYY-MM-DD HH:mm")},o=[],s=1;s<n.length;s++){var i=100*(n[s][4]-l.entryPrice)/l.entryPrice,c=ot(n[s][0]).format("h:mma");"ONE_DAY"==a.state.timeFrame&&(c=ot(n[s][0]).format("DD/MM/YYYY h:mma")),o.push({perChange:i.toFixed(2),close:n[s][4],datetime:c})}l.candleData=o,a.setState({backTestResult:[].concat(Object(ee.a)(a.state.backTestResult),[l])},function(){a.updateOverall()})}else console.log(" candle data emply"),a.setState({searchFailed:a.state.searchFailed+1})}).catch(function(e){console.log(r.symbol,e),a.setState({searchFailed:a.state.searchFailed+1})}),e.next=17,new Promise(function(e){return setTimeout(e,350)});case 17:a.setState({stockTesting:n+1+". "+r.symbol});case 18:case"end":return e.stop()}},e)}),r=0;case 2:if(!(r<t.length)){e.next=10;break}return e.delegateYield(n(r),"t0",4);case 4:if("break"!==e.t0){e.next=7;break}return e.abrupt("break",10);case 7:r++,e.next=2;break;case 10:a.setState({backTestFlag:!0});case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())},a.updateOverall=function(){var e=[];a.state.backTestResult.forEach(function(t){t.candleData.forEach(function(t){e.filter(function(e){return e===t.datetime})[0]||e.push(t.datetime)})});var t=[];e.forEach(function(e){var n=0;a.state.backTestResult.forEach(function(t){for(var a=0;a<t.candleData.length;a++){var r=t.candleData[a];if(e===r.datetime){n+=parseFloat(r.perChange);break}}});var r=.06*a.state.backTestResult.length;t.push({datetime:e,sumofall:n.toFixed(2),expence:r.toFixed(2),netOverAll:(n-r).toFixed(2),noOfTrade:a.state.backTestResult.length})}),t.sort(function(e,t){return ot(t.datetime,"h:mma")-ot(e.datetime,"h:mma")}),a.setState({overAllResult:t},function(){if(a.state.overAllResult.length>0){var e=a.state.overAllResult[0].sumofall/a.state.overAllResult[0].noOfTrade,t=e-.06;a.setState({pertradePandL:e.toFixed(2),pertradePandLNet:t.toFixed(2)})}})},a.updateStockWiseOverall=function(){a.setState({stockWiseListOverall:[]});var e=[];a.state.allQniqueStockList.forEach(function(t){var n=0,r=0;a.state.backTestResult.forEach(function(e){t.name==e.name&&e.candleData.length>0&&(n+=parseFloat(e.candleData[e.candleData.length-1].perChange),r+=1)});var l=.06*r,o={name:t.name,totalSameTrade:r,sumofall:n,expence:l,netPnL:n-l};e.push(o)}),a.setState({stockWiseListOverall:e},function(){var e,t=0,n=0,r=0,l=0,o=0,s=0;a.state.stockWiseListOverall.forEach(function(e){t+=e.sumofall,n+=e.totalSameTrade,r+=e.netPnL,l+=e.expence,o+=e.netPnL>0?1:0,s+=e.netPnL<0?1:0});var i={name:"Total (Gross Avg%): "+(e=(t/n).toFixed(2)),totalSameTrade:n,sumofall:t,expence:l,netPnL:r,winCount:o,lossCount:s};a.state.stockWiseListOverall.push(i),a.setState({stockWiseListOverall:a.state.stockWiseListOverall,lossCount:s,winCount:o,totalgross:t.toFixed(2),totalAvg:e,totTrade:n,totalNet:r.toFixed(2),totalExp:l.toFixed(2)})})},a.updateMonthWise=function(){a.setState({overallMonthWise:[]});var e=[];[{name:"Jan"},{name:"Feb"},{name:"Mar"},{name:"Apr"},{name:"May"},{name:"Jun"},{name:"Jul"},{name:"Aug"},{name:"Sep"},{name:"Nov"},{name:"Dec"}].forEach(function(t){var n=0,r=0;a.state.backTestResult.forEach(function(e){var a=ot(e.foundAt).format("MMM");t.name==a&&e.candleData.length>0&&(n+=parseFloat(e.candleData[e.candleData.length-1].perChange),r+=1)});var l=.06*r,o={name:t.name,totalSameTrade:r,sumofall:n.toFixed(2),expence:l.toFixed(2),netPnL:(n-l).toFixed(2)};e.push(o)}),a.setState({overallMonthWise:e},function(){})},a.calculateSMA=function(e,t){for(var a=function(e){for(var t=0,a=0;a<e.length;a++)t+=e[a].close;return t/e.length},n=[],r=t-1,l=e.length;r<l;r++){var o=a(e.slice(r-t+1,r));n.push({time:e[r].time,value:o})}return n},a.showStaticChart=function(e,t,n,r){console.log("token, symbol, entryAt, exitAt",e,t,n,r),a.setState({chartStaticData:"",lightChartSymbol:t},function(){console.log("reset done",e)});var l="YYYY-MM-DD HH:mm",o=ot(n).set("hour","09").set("minute","15"),s=ot(r).set("hour","15").set("minute","30"),i={exchange:"NSE",symboltoken:e,interval:a.state.timeFrame,fromdate:ot(o).format(l),todate:ot(s).format(l)};x.getHistoryData(i).then(function(t){var n=Q(t,"noPop");if(n&&n.data){var r=n.data,s=r.map(function(e){return{time:new Date(e[0]).getTime(),open:parseFloat(e[1]),high:parseFloat(e[2]),low:parseFloat(e[3]),close:parseFloat(e[4])}}),i=[],c=[],m=[],u=[],d=[],g=[],h=[],p=[],f=[];r.forEach(function(e,t){i.push([e[0],e[1],e[2],e[3],e[4]]),c.push([e[5],(e[2]+e[3]+e[4])/3]),m.push(e[4]),u.push(e[2]),d.push(e[3]),g.push(e[3]),h.push(e[5]),p.push((e[2]+e[3]+e[4])/3),f.push({time:new Date(e[0]).getTime(),value:e[5],color:"rgba(211, 211, 211, 1)"})});var y={period:20,values:p,stdDev:2},b=it.a.calculate(y);console.log(e,"Bolinger band",y,b);b=it.a.calculate(y);console.log(e,"Bolinger band",y,b);var E={values:m,period:14},S=st.a.calculate(E);if(console.log(e,"Rsi",E,S),console.log(e,"vwap",c,mt()(c)),a.setState({chartStaticData:s,bblastValue:b[b.length-1],vwapvalue:mt()(c),rsiValues:S.slice(Math.max(h.length-19,1)),valumeData:h.slice(Math.max(h.length-5,1))},function(){this.state.candleSeries.setData(this.state.chartStaticData),this.state.volumeSeries.setData(f);var e=this.calculateSMA(this.state.chartStaticData,20);this.state.smaLineSeries.setData(e),this.state.chart.subscribeCrosshairMove(function(e){var t=e.seriesPrices[Symbol.iterator](),a="",n="",r=!0,l=!1,o=void 0;try{for(var s,i=t[Symbol.iterator]();!(r=(s=i.next()).done);r=!0){var c=s.value;"object"==typeof c[1]?(a+=" Open: <b>"+c[1].open+"</b>",a+=" High: <b>"+c[1].high+"</b>",a+=" Low: <b>"+c[1].low+"</b>",a+=" Close: <b>"+c[1].close+"</b>",a+=" Chng: <b>"+(n=100*(c[1].close-c[1].open)/c[1].open).toFixed(2)+"%</b>"):a+=" &nbsp; "+c[1].toFixed(2)+" "}}catch(u){l=!0,o=u}finally{try{r||null==i.return||i.return()}finally{if(l)throw o}}e.time?a+=" Time: <b>"+ot(e.time).format("DD/MM/YYYY h:mma")+"</b>":a+=" <b>Time: </b>";var m="<span style=color:green>"+a+"</span> ";n<0&&(m="<span style=color:red>"+a+"</span> "),document.getElementById("showChartTitle").innerHTML=m})}),r&&r.sort(function(e,t){return new Date(t[0])-new Date(e[0])}),r.length>0){localStorage.setItem("InstrumentHistroy",JSON.stringify(r)),a.setState({InstrumentHistroy:r});var v=0,k=0,T=0;r.forEach(function(e){var t=100*(e[4]-e[1])/e[1];t>=.3&&(v+=1),t<=-.3&&(k+=1),T+=t}),a.setState({downMoveCount:k,upsideMoveCount:v,totalPerchentageChange:T,startingFrom:ot(o).format(l)})}}})},a.speckIt=function(e){var t=new SpeechSynthesisUtterance;t.text=e.toString(),window.speechSynthesis.speak(t)},a.getPercentageColor=function(e){return"rgb("+((e*=100)<50?255:Math.floor(255-255*(2*e-100)/100))+","+(e>50?255:Math.floor(2*e*255/100))+",0)"},a.onFileChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.files[0]))},a.state={sumPercentage:0,InstrumentPerChange:"",autoSearchList:[],isDasable:!1,isError:!1,InstrumentLTP:{},ifNotBought:!0,autoSearchTemp:[],backTestResult:[],backTestResultCSV:[],backTestFlag:!0,patternType:"NR4",symboltoken:"",tradingsymbol:"",buyPrice:0,quantity:1,producttype:"INTRADAY",symbolList:localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))||[],totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},selectedWatchlist:"NIFTY BANK",longExitPriceType:4,shortExitPriceType:4,candleChartData:[],stopScaningFlag:!1,backTestResultDateRange:[],searchFailed:0,FoundPatternList:localStorage.getItem("FoundPatternList")&&JSON.parse(localStorage.getItem("FoundPatternList"))||[],fastMovementList:localStorage.getItem("fastMovementList")&&JSON.parse(localStorage.getItem("fastMovementList"))||[],newJsonList:[],timeFrame:"FIFTEEN_MINUTE",overAllResult:[],pertradePandL:0,pertradePandLNet:0,allQniqueStockList:[],isSameDayDuplcate:!0,stockWiseListOverall:[],filename:"",overallMonthWise:[],entryCandlePoint:5,totalWinTrade:0,maxDrowDown:0,maxProfit:0,crossedTargetCount:0,orderType:"buy",targetPer:.5},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.document.title="Backtest",this.setState({symbolList:this.state.staticData[this.state.selectedWatchlist]});var t=new Worker(Ra);this.setState({myWorker:t});var a=document.getElementById("tvchart");document.getElementById("tvchart").innerHTML="";var n=Object(It.a)(a,{width:500,height:250,timeVisible:!0,secondsVisible:!0}),r=n.addCandlestickSeries(),l=n.addLineSeries({color:"rgba(4, 111, 232, 1)",lineWidth:2}),o=n.addHistogramSeries({color:"#26a69a",priceFormat:{type:"volume"},priceScaleId:"",scaleMargins:{top:.8,bottom:0}});this.setState({chart:n,candleSeries:r,smaLineSeries:l,volumeSeries:o}),x.updateStockList().then(function(t){e.setState({stockList:t.data})})}},{key:"findRange",value:function(e,t,a){var n=0,r=a-t;if(r>=30&&r<=60){for(var l=0;l<e.length;l++){var o=e[l];if(!(o[2]<=a&&o[3]>=t))break;n++}n>=3&&console.log(n,t,a,r,new Date(e[0][0]).toLocaleString())}}},{key:"render",value:function(){var e=this;this.myCallback;return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement(rt,null),r.a.createElement(N.a,{direction:"row",container:!0,spacing:1,style:{padding:"5px"}},r.a.createElement(N.a,{item:!0,xs:12,sm:8},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(N.a,{direction:"row",container:!0,spacing:2},r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(Y.a,{variant:"outlined",id:"textarea",multiline:!0,rows:10,fullwidth:!0,style:{width:"90%",height:"50%"},label:"historic candle  paste",value:this.state.csvFormatInput,name:"csvFormatInput",onChange:this.onChange})),r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,Object(y.a)({style:Xn.selectStyle},"style",{marginTop:"10px"}),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onInputChange},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1M"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5M"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10M"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15M"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30M"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1H"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1D")),r.a.createElement(ft.a,{title:"Entry candle point , mid means high+low/2",value:this.state.entryCandlePoint,name:"entryCandlePoint",onChange:this.onInputChange},r.a.createElement(yt.a,{value:1},"Open"),r.a.createElement(yt.a,{value:2},"High"),r.a.createElement(yt.a,{value:3},"Low"),r.a.createElement(yt.a,{value:4},"Close"),r.a.createElement(yt.a,{value:5},"Mid"),r.a.createElement(yt.a,{value:6},"Above High"),r.a.createElement(yt.a,{value:7},"Below Low")),r.a.createElement(ft.a,{title:"checking for buy or sell",value:this.state.orderType,name:"orderType",onChange:this.onInputChange},r.a.createElement(yt.a,{value:"buy"},"Buy"),r.a.createElement(yt.a,{value:"sell"},"Sell")),r.a.createElement("input",{placeholder:"9:20",fullwidth:!0,style:{width:"90%",height:"50%"},label:"entryTimeAt",value:this.state.entryTimeAt,name:"entryTimeAt",onChange:this.onChange}),r.a.createElement("input",{placeholder:"target %: 0.5",type:"number",step:.1,fullwidth:!0,style:{width:"90%",height:"50%"},label:"Target",value:this.state.targetPer,name:"targetPer",onChange:this.onChange}),r.a.createElement(Be.a,null,r.a.createElement(Me.a,{control:r.a.createElement(Ne.a,{checked:this.state.isSameDayDuplcate,onChange:this.handleChange,"aria-label":"Speek ON/OFF"}),label:this.state.isSameDayDuplcate?"Same Day Duplcate: Yes":"Same Day Duplcate: No"})),r.a.createElement("input",{placeholder:"filename",id:"textarea",fullwidth:!0,style:{width:"90%",height:"50%"},label:"Filename",value:this.state.filename,name:"filename",onChange:this.onChange}),"Failed:",this.state.searchFailed,r.a.createElement("br",null),this.state.totaluniqueStocks?this.state.totaluniqueStocks+" unique stocks found":"",r.a.createElement("br",null),this.state.stockTesting)),r.a.createElement(N.a,{item:!0,xs:12,sm:4,style:{marginTop:"5px"}},this.state.backTestFlag?r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.backTestAnyPatternStockWise()}},"Test "):r.a.createElement(r.a.Fragment,null,"  ",r.a.createElement(gt.a,null),"  \xa0 ",r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.stopBacktesting()}},"Stop"),"  "),r.a.createElement("span",{title:"Success Ratio"},"Success Ratio: ",(100*this.state.crossedTargetCount/this.state.backTestResult.length).toFixed(2),"%"),r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat"},r.a.createElement(B.a,{size:"small",variant:"outlined",onClick:this.updateMonthWise},"Month"),"                                                "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Trades"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Gross P/L"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Expence"),r.a.createElement(Qe.a,{className:"TableHeadFormat"}," Net P/L"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.overallMonthWise?this.state.overallMonthWise.map(function(e,t){return e.totalSameTrade>0?r.a.createElement(ze.a,{key:t},r.a.createElement(Qe.a,null,e.name),r.a.createElement(Qe.a,null,e.totalSameTrade),r.a.createElement(Qe.a,null,e.sumofall>0?r.a.createElement("span",{style:{color:"green"}}," ",e.sumofall):r.a.createElement("span",{style:{color:"red"}}," ",e.sumofall),"% "),r.a.createElement(Qe.a,null,e.expence,"%"),r.a.createElement(Qe.a,null,e.netPnL>0?r.a.createElement("span",{style:{color:"green"}}," ",e.netPnL):r.a.createElement("span",{style:{color:"red"}}," ",e.netPnL),"% ")):""}):""))),r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement("div",{style:{overflow:"auto",maxHeight:"200px"}},r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,null,"Sr.\xa0"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Stock (",this.state.stockWiseListOverall.length,") ",r.a.createElement(_n.a,{filename:"Overall_"+this.state.timeFrame+"_"+this.state.entryCandlePoint+"_"+this.state.orderType+"_"+this.state.filename+".csv",data:this.state.stockWiseListOverall}),"                                                    "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"T.T (",this.state.totTrade,")  Avg: (",this.state.totalAvg>0?r.a.createElement("span",{style:{color:"green"}}," ",this.state.totalAvg):r.a.createElement("span",{style:{color:"red"}}," ",this.state.totalAvg),")%"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Gross P/L (",this.state.totalgross>0?r.a.createElement("span",{style:{color:"green"}}," ",this.state.totalgross):r.a.createElement("span",{style:{color:"red"}}," ",this.state.totalgross),")%"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Expence (",this.state.totalExp,")%"),r.a.createElement(Qe.a,{className:"TableHeadFormat"}," Net P/L (",this.state.totalNet>0?r.a.createElement("span",{style:{color:"green"}}," ",this.state.totalNet):r.a.createElement("span",{style:{color:"red"}}," ",this.state.totalNet),")% \xa0  W:",this.state.winCount,"  \xa0 L:",this.state.lossCount))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.stockWiseListOverall?this.state.stockWiseListOverall.map(function(e,t){return r.a.createElement(ze.a,{key:t},r.a.createElement(Qe.a,null,t+1),r.a.createElement(Qe.a,null,e.name),r.a.createElement(Qe.a,null,e.totalSameTrade),r.a.createElement(Qe.a,null,e.sumofall>0?r.a.createElement("span",{style:{color:"green"}}," ",e.sumofall):r.a.createElement("span",{style:{color:"red"}}," ",e.sumofall),"% "),r.a.createElement(Qe.a,null,e.expence,"%"),r.a.createElement(Qe.a,null,e.netPnL>0?r.a.createElement("span",{style:{color:"green"}}," ",e.netPnL):r.a.createElement("span",{style:{color:"red"}}," ",e.netPnL),"% "))}):""))))),r.a.createElement(N.a,{direction:"row",container:!0,spacing:2},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement("div",{style:{overflow:"auto",maxHeight:"550px"}},r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Sr."),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Datetime ",r.a.createElement(_n.a,{filename:"Trade_"+this.state.timeFrame+"_"+this.state.entryCandlePoint+"_"+this.state.orderType+"_"+this.state.filename+".csv",data:this.state.backTestResult})),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Symbol \xa0"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"EntryPrice \xa0"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"ExitPrice \xa0"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"T.T:(",this.state.backTestResult.length,") \xa0W:",this.state.totalWinTrade," \xa0L:",this.state.backTestResult.length-this.state.totalWinTrade,"\xa0",r.a.createElement("span",{title:"Max Loss"},"ML:",this.state.maxDrowDown,"%"),"\xa0",r.a.createElement("span",{title:"Max Profit"},"MP:",this.state.maxProfit,"%"),"\xa0",r.a.createElement("span",{title:"target crossed"}," C.T:",this.state.crossedTargetCount),"\xa0",r.a.createElement("span",{title:"target not crossed"},"N.C:",this.state.backTestResult.length-this.state.crossedTargetCount," ")," \xa0",r.a.createElement("span",{title:"Success Ratio"},"S.R.",(100*this.state.crossedTargetCount/this.state.backTestResult.length).toFixed(2),"%")))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.backTestResult?this.state.backTestResult.map(function(t,a){return r.a.createElement(ze.a,{hover:!0,key:a,style:{background:t.isWinOnClosing?"":"bisque"}},r.a.createElement(Qe.a,null,a+1,"\xa0"),r.a.createElement(Qe.a,null,t.foundAt," \xa0"),r.a.createElement(Qe.a,null,r.a.createElement(B.a,{size:"small",variant:"contained",onClick:function(){return e.showStaticChart(t.token,t.symbol,t.foundAt,t.foundAt)}},t.symbol," ")," "),r.a.createElement(Qe.a,null,r.a.createElement("span",{style:{fontStyle:"italic"}}," ",t.entryPrice)," \xa0"),r.a.createElement(Qe.a,null,r.a.createElement("span",{style:{fontStyle:"italic",color:t.candleData[t.candleData.length-1].close>t.entryPrice?"green":"red"}}," ",t.candleData[t.candleData.length-1].close," (",t.candleData[t.candleData.length-1].perChange,"%) ")," \xa0"),r.a.createElement(Qe.a,null,t.candleData.map(function(e,t){return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,e.datetime,": "),e.close,"(",e.perChange>0?r.a.createElement("span",{style:{color:"green"}}," ",e.perChange,"%"):r.a.createElement("span",{style:{color:"red"}}," ",e.perChange,"%"),") \xa0")})))}):""))))))),r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(Ct.a,{style:{padding:"10px",position:navigator.userAgentData.mobile?"":"fixed"}},r.a.createElement(N.a,{style:{display:"visible"},spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(N.a,{spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,Object(y.a)({style:Xn.selectStyle},"style",{marginTop:"10px"}),r.a.createElement(ft.a,{value:this.state.timeFrame,name:"timeFrame",onChange:this.onInputChange},r.a.createElement(yt.a,{value:"ONE_MINUTE"},"1M"),r.a.createElement(yt.a,{value:"FIVE_MINUTE"},"5M"),r.a.createElement(yt.a,{value:"TEN_MINUTE"},"10M"),r.a.createElement(yt.a,{value:"FIFTEEN_MINUTE"},"15M"),r.a.createElement(yt.a,{value:"THIRTY_MINUTE"},"30M"),r.a.createElement(yt.a,{value:"ONE_HOUR"},"1H"),r.a.createElement(yt.a,{value:"ONE_DAY"},"1D")))),r.a.createElement(N.a,{item:!0,xs:12,sm:10},r.a.createElement(R.a,null,"Same Day Chart:  ",this.state.lightChartSymbol))),r.a.createElement("div",{id:"showChartTitle"}),r.a.createElement("div",{id:"tvchart"})),r.a.createElement(N.a,{item:!0,xs:12,sm:12,style:{overflowY:"scroll",height:"40vh"}},r.a.createElement(R.a,null," ",r.a.createElement(B.a,{size:"small",variant:"outlined",onClick:this.updateOverall}," Overall "),this.state.pertradePandL>0?r.a.createElement("span",{style:{color:"green"}}," ",this.state.pertradePandL):r.a.createElement("span",{style:{color:"red"}}," ",this.state.pertradePandL),"% Gross/Trade   |",this.state.pertradePandLNet>0?r.a.createElement("span",{style:{color:"green"}}," ",this.state.pertradePandLNet):r.a.createElement("span",{style:{color:"red"}}," ",this.state.pertradePandLNet),"% Net/Trade  "),r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Timestamp"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"No Of Trade"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Gross Overall P/L%"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Expence%"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Net P/L%"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.overAllResult?this.state.overAllResult.map(function(e,t){return r.a.createElement(ze.a,{key:t},r.a.createElement(Qe.a,null,e.datetime),r.a.createElement(Qe.a,null,e.noOfTrade),r.a.createElement(Qe.a,null,e.sumofall>0?r.a.createElement("span",{style:{color:"green"}}," ",e.sumofall):r.a.createElement("span",{style:{color:"red"}}," ",e.sumofall),"% "),r.a.createElement(Qe.a,null,e.expence,"%"),r.a.createElement(Qe.a,null,e.netOverAll>0?r.a.createElement("span",{style:{color:"green"}}," ",e.netOverAll):r.a.createElement("span",{style:{color:"red"}}," ",e.netOverAll),"% "))}):"")))))),r.a.createElement(N.a,{item:!0,xs:12},r.a.createElement("div",{id:"showChartTitle"}),r.a.createElement("div",{id:"tvchart"}))))}}]),t}(r.a.Component),Xn={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},Zn=Gn,$n=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).getTodayOrder=function(){var e=localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))||[];x.retrieveOrderBook().then(function(t){var n=Q(t,"noPop");if(n&&n.data){var r=n.data;r.sort(function(e,t){return new Date(t.updatetime)-new Date(e.updatetime)}),r.forEach(function(t){var n=e.filter(function(e){return e.tradingsymbol==t.tradingsymbol});n.length>0&&t.tradingsymbol==n[0].tradingsymbol&&(a.setState(Object(y.a)({},"priceTarget_"+t.tradingsymbol,n[0].priceTarget)),a.setState(Object(y.a)({},"priceStopLoss_"+t.tradingsymbol,n[0].priceStopLoss)))}),a.setState({oderbookData:r}),localStorage.setItem("oderbookData",JSON.stringify(r))}})},a.decodeWebsocketData=function(e){var t=[];try{for(var a=0;a<e.length;a++)t.push(String.fromCharCode(e[a]))}catch(n){}return t.join("")},a.updateSocketWatch=function(e){var t=a.state.symbolList.map(function(e){return"nse_cm|"+e.token}),n={task:"mw",channel:t=t.join("&"),token:a.state.feedToken,user:a.state.clientcode,acctid:a.state.clientcode};e.send(JSON.stringify(n))},a.makeConnection=function(e){var t='{"task":"cn","channel":"NONLM","token":"'+a.state.feedToken+'","user": "'+a.state.clientcode+'","acctid":"'+a.state.clientcode+'"}';e.send(t),a.updateSocketWatch(e)},a.updateSocketDetails=function(e){e.onopen=function(t){a.makeConnection(e),a.updateSocketWatch(e)},e.onmessage=function(e){var t=window.atob(e.data),n=a.decodeWebsocketData(Pt.a.inflate(t)),r=JSON.parse(n),l=a.state.symbolList;a.state.symbolList&&a.state.symbolList.forEach(function(e,t){var a=r.filter(function(t){return t.tk==e.token});a.length>0&&a[0].ltp&&a[0].nc&&(l[t].ltp=a[0].ltp,l[t].pChange=a[0].nc,l[t].totalBuyQuantity=a[0].tbq,l[t].totalSellQuantity=a[0].tsq,l[t].totalTradedVolume=a[0].v,l[t].averagePrice=a[0].ap,l[t].lowPrice=a[0].lo,l[t].highPrice=a[0].h,l[t].openPrice=a[0].op,l[t].volume=a[0].v,l[t].bestbuyquantity=a[0].bq,l[t].bestbuyprice=a[0].bp,l[t].bestsellquantity=a[0].bs,l[t].bestsellprice=a[0].sp,l[t].ltt=ot(a[0].ltt,"YYYY-MM-DD HH:mm:ss").toString(),l[t].buytosellTime=(a[0].tbq/a[0].tsq).toFixed(2),l[t].selltobuyTime=(a[0].tsq/a[0].tbq).toFixed(2))});var o=a.state.sortedType;l&&l.sort(function(e,t){return t[o]-e[o]}),a.setState({symbolList:l},function(){})},e.onerror=function(e){console.log("socket error",e)},setInterval(function(){console.log("this.wsClint",a.wsClint),1!=a.wsClint.readyState&&a.makeConnection(a.wsClint);var t='{"task":"hb","channel":"","token":"'+a.state.feedToken+'","user": "'+a.state.clientcode+'","acctid":"'+a.state.clientcode+'"}';console.log("Request :- "+t),e.send(t)},59e3)},a.getNiftyLTP=function(){x.getLTP({exchange:"NSE",tradingsymbol:"NIFTY",symboltoken:"26000"}).then(function(e){var t=Q(e,"noPop"),n=t&&t.data;if(n&&n.ltp){var r=100*(n.ltp-n.close)/n.close;if(a.setState({niftyLtp:{ltp:n.ltp,per:r.toFixed(2)}}),a.state.firstTimeFlag){for(var l=n.ltp-3*n.ltp/100,o=n.ltp+3*n.ltp/100,s=o+o%100,i=l-l%100;i<=s;i+=50)a.setState({selectedStrike:[].concat(Object(ee.a)(a.state.selectedStrike),[i])});a.getToketForStrike(),a.setState({firstTimeFlag:!1})}}localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))})},a.getToketForStrike=function(){console.log(a.state.selectedStrike),x.getAll145Tokens(a.state.selectedStrike).then(function(e){a.setState({rowSymbolList:e.data},function(){a.selectOnlyLtp150To170()})})},a.selectOnlyLtp150To170=Object(te.a)($.a.mark(function e(){var t,n,r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a.setState({symbolList:[]}),console.log("refresh",a.state.symbolList),!a.state.rowSymbolList){e.next=7;break}for(t=function(e){var t=a.state.rowSymbolList[e];r={exchange:t.exch_seg,tradingsymbol:t.symbol,symboltoken:t.token},x.getLTP(r).then(function(e){var n=Q(e,"noPop"),r=n&&n.data;r&&r.ltp&&(t.ltp=r.ltp,t.perChange=(100*(r.ltp-r.close)/r.close).toFixed(2)),r&&r.ltp>150&&r.ltp<185&&a.setState({symbolList:[].concat(Object(ee.a)(a.state.symbolList),[t])})})},n=0;n<a.state.rowSymbolList.length;n++)t(n);return e.next=7,new Promise(function(e){return setTimeout(e,100)});case 7:case"end":return e.stop()}},e)})),a.updateLTP=Object(te.a)($.a.mark(function e(){var t,n,r;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=$.a.mark(function e(t){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.state.symbolList[t],r={exchange:n.exch_seg,tradingsymbol:n.symbol,symboltoken:n.token},x.getLTP(r).then(function(e){var t=Q(e,"noPop"),r=t&&t.data;r&&r.ltp&&(n.ltp=r.ltp,n.perChange=(100*(r.ltp-r.close)/r.close).toFixed(2),a.updateBOPerformance(n,r))}),e.next=5,new Promise(function(e){return setTimeout(e,100)});case 5:case"end":return e.stop()}},e)}),n=0;case 2:if(!(n<a.state.symbolList.length)){e.next=7;break}return e.delegateYield(t(n),"t0",4);case 4:n++,e.next=2;break;case 7:case"end":return e.stop()}},e)})),a.updateBOPerformance=function(e,t){var a=localStorage.getItem("Track145")&&JSON.parse(localStorage.getItem("Track145"))||[],n=a.filter(function(t){return t.symbol==e.symbol}),r=a.findIndex(function(t){return t.symbol===e.symbol});if(t.ltp>185)if(n.length){if(t.ltp>n[0].upsideLtp){var l=Object(m.a)({},a[r],{upsideLtp:t.ltp,returnPer:100*(t.ltp-n[0].entry)/n[0].entry}),o=[].concat(Object(ee.a)(a.slice(0,r)),[l],Object(ee.a)(a.slice(r+1)));console.log("updatedObj",l),localStorage.setItem("Track145",JSON.stringify(o))}}else e.entry=t.ltp,e.upsideLtp=t.ltp,e.downsideLtp=t.ltp,a.push(e),localStorage.setItem("Track145",JSON.stringify(a));else if(n.length&&t.ltp<n[0].downsideLtp){var s=Object(m.a)({},a[r],{downsideLtp:t.ltp}),i=[].concat(Object(ee.a)(a.slice(0,r)),[s],Object(ee.a)(a.slice(r+1)));localStorage.setItem("Track145",JSON.stringify(i))}},a.cancelOrderOfSame=function(e,t){var n={variety:t,orderid:e};x.cancelOrder(n).then(function(e){var t=Q(e);t.status&&"SUCCESS"===t.message&&a.getTodayOrder()})},a.modifyOrder=function(e,t){var n={variety:e.variety,orderid:e.orderid,ordertype:0!==a.state.price?"STOPLOSS_LIMIT":"STOPLOSS_MARKET",producttype:e.producttype,duration:e.duration,price:a.state.price,triggerprice:t||a.state.triggerprice,quantity:e.quantity,tradingsymbol:e.tradingsymbol,symboltoken:e.symboltoken,exchange:e.exchange};x.modifyOrder(n).then(function(e){var t=Q(e);t.status&&"SUCCESS"===t.message&&(a.setState({triggerprice:0}),a.getTodayOrder())})},a.onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value.trim()))},a.onChangePriceStopLoss=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value.trim()));for(var t=e.target.name.split("_")[1],n=localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))||[],r=!1,l=0;l<n.length;l++){var o=n[l];if(o.tradingsymbol===t){o.priceStopLoss=e.target.value.trim(),r=!0;break}}r||n.push({priceStopLoss:e.target.value.trim(),tradingsymbol:t,optiontype:t.substr(t.length-2,t.length-1),name:t.includes("BANKNIFTY")?"BANKNIFTY":"NIFTY"}),localStorage.setItem("trackSLPrice",JSON.stringify(n))},a.onChangePriceTarget=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value.trim()));for(var t=e.target.name.split("_")[1],n=localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))||[],r=!1,l=0;l<n.length;l++){var o=n[l];if(o.tradingsymbol===t){o.priceTarget=e.target.value.trim(),r=!0;break}}r||n.push({priceStopLoss:e.target.value.trim(),tradingsymbol:t,optiontype:t.substr(t.length-2,t.length-1),name:t.includes("BANKNIFTY")?"BANKNIFTY":"NIFTY"}),localStorage.setItem("trackSLPrice",JSON.stringify(n))},a.state={oderbookData:[],listofzones:[],selectedZone:[],niftyLtp:{},zone:"",selectAllzone:"Select All",triggerprice:0,price:0,lotsize:0,firstTimeFlag:!0,selectedStrike:[],symbolList:[],trackSLPrice:localStorage.getItem("trackSLPrice")&&JSON.parse(localStorage.getItem("trackSLPrice"))||[]},a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this;setInterval(function(){e.getNiftyLTP()},1e3);var t=JSON.parse(localStorage.getItem("userTokens")),a=t&&t.feedToken,n=JSON.parse(localStorage.getItem("userProfile")),r=n&&n.clientcode;this.setState({feedToken:a,clientcode:r},function(){this.wsClint=new Dt.w3cwebsocket("wss://omnefeeds.angelbroking.com/NestHtml5Mobile/socket/stream")}),setInterval(function(){e.updateLTP()},1e3),setInterval(function(){e.selectOnlyLtp150To170()},12e4)}},{key:"render",value:function(){var e=this;console.log("this.state.symbolList",this.state.symbolList),this.state.symbolList.sort(function(e,t){return t.ltp-e.ltp});var t=localStorage.getItem("Track145")&&JSON.parse(localStorage.getItem("Track145"))||[];return r.a.createElement(r.a.Fragment,null,"#/position"!==window.location.hash?r.a.createElement(Et,null):"",r.a.createElement(N.a,{direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(N.a,{spacing:1,direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(R.a,{color:"primary",gutterBottom:!0},"145 Strategy: Legs (",this.state.symbolList.length,")  ",r.a.createElement("span",{style:{color:this.state.niftyLtp.per>0?"green":"red"}}," Nifty ",this.state.niftyLtp.ltp,"  (",this.state.niftyLtp.per,"%) "))),r.a.createElement(N.a,{item:!0,xs:12,sm:6},r.a.createElement(B.a,{id:"orderRefresh",type:"number",variant:"contained",style:{float:"right"},onClick:function(){return e.selectOnlyLtp150To170()}},"Refresh"))),r.a.createElement(qe.a,{size:"small",style:{width:"100%"},"aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Name")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Option")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Expiry")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Ltp")))),r.a.createElement(Ke.a,null,this.state.symbolList.length?this.state.symbolList.map(function(e,t){return r.a.createElement(ze.a,{hover:!0,key:t},r.a.createElement(Qe.a,{style:{width:"10%"},align:"center"},e.name),r.a.createElement(Qe.a,{align:"center"},e.symbol),r.a.createElement(Qe.a,{align:"center"},e.expiry),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("span",{style:{color:e.perChange>0?"green":"red"}}," ",e.ltp," (",e.perChange,"%) ")))}):r.a.createElement(gt.a,null)))))),r.a.createElement(N.a,{direction:"row",alignItems:"center",container:!0},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(R.a,{color:"primary",gutterBottom:!0}," Performance"),r.a.createElement(qe.a,{size:"small",style:{width:"100%"},"aria-label":"sticky table"},r.a.createElement(wt.a,{style:{whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head"},r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Name")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Option")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Expiry")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Ltp")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Entry")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Upside Price")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Return%")),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("b",null,"Downside Price")))),r.a.createElement(Ke.a,null,t.length?t.map(function(e,t){return r.a.createElement(ze.a,{hover:!0,key:t},r.a.createElement(Qe.a,{style:{width:"10%"},align:"center"},e.name),r.a.createElement(Qe.a,{align:"center"},e.symbol),r.a.createElement(Qe.a,{align:"center"},e.expiry),r.a.createElement(Qe.a,{align:"center"},r.a.createElement("span",{style:{color:e.perChange>0?"green":"red"}}," ",e.ltp," (",e.perChange,"%) ")),r.a.createElement(Qe.a,{align:"center"},e.entry),r.a.createElement(Qe.a,{align:"center"},e.upsideLtp),r.a.createElement(Qe.a,{align:"center"},e.returnPer),r.a.createElement(Qe.a,{align:"center"},e.downsideLtp))}):r.a.createElement(R.a,null," Nothing crossed as of now")))))))}}]),t}(r.a.Component),er=function(e){function t(e){var a;return Object(b.a)(this,t),(a=Object(S.a)(this,Object(v.a)(t).call(this,e))).onChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));var t=e.target.value;x.autoCompleteSearch(t).then(function(e){var t=e.data;localStorage.setItem("autoSearchTemp",JSON.stringify(t)),a.setState({autoSearchList:t})})},a.onInputChange=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value),function(){this.state.tradingsymbol&&this.showStaticChart(this.state.symboltoken)})},a.onChangePattern=function(e){if(a.setState(Object(y.a)({},e.target.name,e.target.value)),"NR4_Daywide_daterage"==e.target.value){var t=localStorage.getItem("backTestResultDateRange")&&JSON.parse(localStorage.getItem("backTestResultDateRange"));a.setState({dateAndTypeKeys:Object.keys(t||{}),backTestResultDateRange:t})}},a.onChangeWatchlist=function(e){a.setState(Object(y.a)({},e.target.name,e.target.value));var t=a.state.staticData;a.setState({symbolList:t[e.target.value]},function(){this.setState({cursor:""})}),"selectall"==e.target.value&&a.setState({symbolList:localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))},function(){this.setState({cursor:""})})},a.myCallback=function(e,t){"START_DATE"===t?a.setState({startDate:e}):"END_DATE"===t&&a.setState({endDate:e})},a.getCandleHistoryAndStore=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s,i;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log("last candle called time",(new Date).toLocaleTimeString()),(new Date).toLocaleTimeString()>"15:00:00"?clearInterval(a.state.candleHistoryInterval):"",t=ot.duration("00:01:00"),a.setState({backupHistoryStatus:[]}),n="YYYY-MM-DD HH:mm",r=ot(new Date).subtract(t),l=a.state.symbolList,o=$.a.mark(function e(t){var o,s;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=l[t],i={exchange:"NSE",symboltoken:o.token,interval:"ONE_MINUTE",fromdate:ot(r).format(n),todate:ot(new Date).format(n)},s={symbol:o.name,startDate:ot(r).format(n),endDate:ot(new Date).format(n),downloadStatus:!1,noOfRows:0,backStatus:!1,hugeVol:!1},x.getHistoryData(i).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){var a={symbol:o.symbol,token:o.token,candleData:t.data,analysis:!0};s.downloadStatus=!0,x.backupHistoryData(a).then(function(e){if(s.backStatus=!0,s.noOfRows=e.data&&e.data.result,s.hugeVol=e.data&&e.data.hugeVol,e.data&&e.data.hugeVol){console.log(" huge Volume in "+o.symbol);var t=new SpeechSynthesisUtterance;t.text=" huge Volume in "+o.symbol,window.speechSynthesis.speak(t)}})}else console.log(" candle data emply")}),e.next=6,new Promise(function(e){return setTimeout(e,310)});case 6:a.setState({backupHistoryStatus:[].concat(Object(ee.a)(a.state.backupHistoryStatus),[s])});case 7:case"end":return e.stop()}},e)}),s=0;case 9:if(!(s<l.length)){e.next=14;break}return e.delegateYield(o(s),"t0",11);case 11:s++,e.next=9;break;case 14:case"end":return e.stop()}},e)})),a.stopBacktesting=function(){a.setState({stopScaningFlag:!0})},a.storyHistoryData=Object(te.a)($.a.mark(function e(){var t,n,r,l,o,s,i,c,m,u,d,g,h;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=a.state.patternType+" "+a.state.selectedWatchlist+" "+ot(a.state.startDate).format("YYYY-MM-DD")+" "+ot(a.state.endDate).format("YYYY-MM-DD")+".csv",a.setState({backupHistoryStatus:[],backTestFlag:!1,filename:t,stopScaningFlag:!1}),n=a.state.symbolList,r=1,l=ot(a.state.startDate),o=ot(a.state.endDate),s=o.diff(l,"days"),i=Math.ceil(s/30),console.log("nod",i),c=ot(a.state.startDate).set("9:15am","h:mma"),m=0;case 11:if(!(m<i)){e.next=30;break}u=ot(c).add(29,"days"),console.log("nod",i),d=$.a.mark(function e(t){var l,o;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l=n[t],!a.state.stopScaningFlag){e.next=3;break}return e.abrupt("return","break");case 3:return h={exchange:"NSE",symboltoken:l.token,interval:"ONE_MINUTE",fromdate:ot(c).format("YYYY-MM-DD HH:mm"),todate:u.format("YYYY-MM-DD HH:mm")},o={symbol:l.name,startDate:ot(c).format("DD-MM-YYYY"),endDate:ot(u).format("DD-MM-YYYY"),downloadStatus:!1,noOfRows:0,backStatus:!1},x.getHistoryData(h).then(function(e){var t=Q(e,"noPop");if(t&&t.data&&t.data.length){t.data.pop();var a={symbol:l.symbol,token:l.token,candleData:t.data};o.downloadStatus=!0,x.backupHistoryData(a).then(function(e){o.backStatus=!0,console.log("test",e.data),o.noOfRows=e.data&&e.data.result})}else console.log(" candle data emply")}),e.next=8,new Promise(function(e){return setTimeout(e,400)});case 8:a.setState({stockTesting:t+1+". "+l.symbol,runningTest:r}),a.setState({backupHistoryStatus:[].concat(Object(ee.a)(a.state.backupHistoryStatus),[o])}),a.setState({done:!0}),console.log("status",o);case 12:case"end":return e.stop()}},e)}),g=0;case 16:if(!(g<n.length)){e.next=24;break}return e.delegateYield(d(g),"t0",18);case 18:if("break"!==e.t0){e.next=21;break}return e.abrupt("break",24);case 21:g++,e.next=16;break;case 24:return c=u,e.next=27,new Promise(function(e){return setTimeout(e,400*n.length)});case 27:m++,e.next=11;break;case 30:a.setState({backTestFlag:!0});case 31:case"end":return e.stop()}},e)})),a.state={symbolList:localStorage.getItem("watchList")&&JSON.parse(localStorage.getItem("watchList"))||[],totalWatchlist:localStorage.getItem("totalWatchlist")&&JSON.parse(localStorage.getItem("totalWatchlist"))||[],staticData:localStorage.getItem("staticData")&&JSON.parse(localStorage.getItem("staticData"))||{},selectedWatchlist:"NIFTY 50",stopScaningFlag:!1,backTestResultDateRange:[],searchFailed:0,backTestFlag:!0,backupHistoryStatus:[]},a.myCallback=a.myCallback.bind(Object(k.a)(a)),a}return Object(T.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){window.document.title="Backtest",this.setState({symbolList:this.state.staticData[this.state.selectedWatchlist]},function(){var e=this;this.getCandleHistoryAndStore();var t=ot(new Date,"h:mma"),a=ot().isoWeekday(),n=ot("9:15am","h:mma"),r=ot("3:30pm","h:mma");if(a<=5&&t.isBetween(n,r))var l=setInterval(function(){0===(new Date).getSeconds()&&(setTimeout(function(){e.getCandleHistoryAndStore()},1e4),setInterval(function(){e.getCandleHistoryAndStore()},7e4),clearInterval(l))},1e3)})}},{key:"render",value:function(){var e=this,t={myCallback:this.myCallback,startDate:"",endDate:"",firstLavel:"Start Date and Time",secondLavel:"End Date and Time"};return r.a.createElement(r.a.Fragment,null,r.a.createElement(Et,null),r.a.createElement(rt,null),r.a.createElement(N.a,{direction:"row",container:!0,spacing:1,style:{padding:"5px"}},r.a.createElement(N.a,{item:!0,xs:12,sm:12},r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(R.a,{style:{textAlign:"center",background:"lightgray"}},"History Backup"),r.a.createElement(N.a,{direction:"row",container:!0,spacing:2},r.a.createElement(N.a,{item:!0,xs:12,sm:2},r.a.createElement(pt.a,{style:tr.selectStyle},r.a.createElement(M.a,{htmlFor:"gender"},"Select Watchlist"),r.a.createElement(ft.a,{value:this.state.selectedWatchlist,name:"selectedWatchlist",onChange:this.onChangeWatchlist},r.a.createElement(yt.a,{value:"selectall"},"Select All"),this.state.totalWatchlist&&this.state.totalWatchlist.map(function(e){return r.a.createElement(yt.a,{value:e},e)})))),r.a.createElement(N.a,{item:!0,xs:12,sm:4},r.a.createElement(Lt,{callbackFromParent:t})),r.a.createElement(N.a,{item:!0,xs:12,sm:4,style:{marginTop:"5px"}},this.state.backTestFlag?r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.storyHistoryData()}},"Backup"):r.a.createElement(r.a.Fragment,null," ",r.a.createElement(B.a,null," ",r.a.createElement(gt.a,null)," \xa0 ",r.a.createElement(B.a,{variant:"contained",onClick:function(){return e.stopBacktesting()}},"Stop Scaning")," \xa0  ",this.state.stockTesting," ",this.state.runningTest,"  "),"   "),"\xa0 Failed: ",this.state.searchFailed))),r.a.createElement(Ct.a,{style:{padding:"10px"}},r.a.createElement(qe.a,{size:"small","aria-label":"sticky table"},r.a.createElement(wt.a,{style:{width:"",whiteSpace:"nowrap"},variant:"head"},r.a.createElement(ze.a,{variant:"head",style:{fontWeight:"bold"}},r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Sr. No."),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Symbol"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"From date"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"To date  "),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Download Status"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Backup Status"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"No of Rows"),r.a.createElement(Qe.a,{className:"TableHeadFormat"},"Huge Volume(last 100min)"))),r.a.createElement(Ke.a,{style:{width:"",whiteSpace:"nowrap"}},this.state.backupHistoryStatus&&this.state.backupHistoryStatus?this.state.backupHistoryStatus.map(function(e,t){return r.a.createElement(ze.a,{key:t},r.a.createElement(Qe.a,null,t+1),r.a.createElement(Qe.a,null,e.symbol),r.a.createElement(Qe.a,null,e.startDate),r.a.createElement(Qe.a,null,e.endDate),r.a.createElement(Qe.a,null,e.downloadStatus?"Yes":"No"),r.a.createElement(Qe.a,null,e.backStatus?"Yes":"No"),r.a.createElement(Qe.a,null,e.noOfRows),r.a.createElement(Qe.a,null,e.hugeVol?"Yes":"-"))}):""))))))}}]),t}(r.a.Component),tr={formContainer:{display:"flex",flexFlow:"row wrap"},textStyle:{display:"flex",justifyContent:"center"},imgStyle:{display:"flex"},selectStyle:{minWidth:"100%",marginBottom:"10px"},MuiTextField:{overflowY:"scroll",fontSize:"12px",maxHeight:"50px"},footerButton:{position:"fixed",left:0,bottom:"20px",width:"100%",textAlign:"right"}},ar=er,nr=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,null,r.a.createElement(f.c,null,r.a.createElement(f.a,{path:"/",exact:!0,component:X}),r.a.createElement(f.a,{path:"/login",component:X}),r.a.createElement(f.a,{path:"/nifty-view",component:fa}),r.a.createElement(f.a,{path:"/bn-view",component:la}),r.a.createElement(f.a,{path:"/sector",component:ka}),r.a.createElement(f.a,{path:"/chart",component:ta}),r.a.createElement(f.a,{path:"/candle-chart",component:Ca}),r.a.createElement(f.a,{path:"/home",component:da}),r.a.createElement(f.a,{path:"/funds",component:xa}),r.a.createElement(f.a,{path:"/order",component:Ia}),r.a.createElement(f.a,{path:"/trade",component:Da}),r.a.createElement(f.a,{path:"/order-status-live",component:Oa}),r.a.createElement(f.a,{path:"/position",component:Ya}),r.a.createElement(f.a,{path:"/position-new",component:Ha}),r.a.createElement(f.a,{path:"/addtowatchlist",component:Va}),r.a.createElement(f.a,{path:"/sector-heat-map",component:Qa}),r.a.createElement(f.a,{path:"/sector-heat-map2",component:bn}),r.a.createElement(f.a,{path:"/find-fast-movement",component:vn}),r.a.createElement(f.a,{path:"/find-fast-movement2",component:Cn}),r.a.createElement(f.a,{path:"/find-fast-movement3",component:In}),r.a.createElement(f.a,{path:"/order-watchlist",component:ca}),r.a.createElement(f.a,{path:"/delivery",component:tn}),r.a.createElement(f.a,{path:"/slow-motion",component:Bn}),r.a.createElement(f.a,{path:"/index-charts",component:rn}),r.a.createElement(f.a,{path:"/strong-charts",component:un}),r.a.createElement(f.a,{path:"/market-depth",component:Hn}),r.a.createElement(f.a,{path:"/market-depth-mobile",component:Rn}),r.a.createElement(f.a,{path:"/backtest",component:qn}),r.a.createElement(f.a,{path:"/chartink-backtest",component:Kn}),r.a.createElement(f.a,{path:"/backup-history",component:ar}),r.a.createElement(f.a,{path:"/custom-backtest",component:Zn}),r.a.createElement(f.a,{path:"/track145",component:$n}),r.a.createElement(f.a,{path:"/test",component:Ua}),r.a.createElement(f.a,{path:"*",component:X}))))};a(475);var rr=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(nr,null),r.a.createElement(q.a,null))};o.a.render(r.a.createElement(s.a,{store:h},r.a.createElement(rr,null)),document.querySelector("#root"))},94:function(e,t,a){}},[[307,1,2]]]);
//# sourceMappingURL=main.415386a4.chunk.js.map